<div id="Degree_Section">
<div class="head">
<h1>Theory Degree_Section</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Alexander Maletzky *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Degree Sections of Power-Products›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Degree_Section
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../Polynomials/MPoly_PM.html">Polynomials.MPoly_PM</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">deg_sect</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> set <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'x</span><span class="main">::</span>countable <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">deg_sect</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">=</span> <span class="main">.[</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">]</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> deg_pm <span class="bound">t</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">deg_le_sect</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> set <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'x</span><span class="main">::</span>countable <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">deg_le_sect</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">d0</span><span class="main">≤</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">.</span> deg_sect <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="bound">d0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> deg_sectI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span> <span class="main">⟹</span> deg_pm <span class="free">t</span> <span class="main">=</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> deg_sect <span class="free">X</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_sect_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deg_sectD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> deg_sect <span class="free">X</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="free">t</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_sect_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deg_le_sect_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"deg_le_sect <span class="free">X</span> <span class="free">d</span> <span class="main">=</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> deg_pm <span class="bound">t</span> <span class="main">≤</span> <span class="free">d</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deg_le_sect_def deg_sect_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deg_le_sectI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span> <span class="main">⟹</span> deg_pm <span class="free">t</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> deg_le_sect <span class="free">X</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_le_sect_alt<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deg_le_sectD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> deg_le_sect <span class="free">X</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="free">t</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_le_sect_alt<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deg_sect_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"deg_sect <span class="free">X</span> <span class="main">0</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deg_sect_def zero_in_PPs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deg_sect_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"deg_sect <span class="main">{}</span> <span class="free">d</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">d</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deg_sect_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deg_sect_singleton <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"deg_sect <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="free">d</span> <span class="main">=</span> <span class="main">{</span>Poly_Mapping.single <span class="free">x</span> <span class="free">d</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deg_sect_def deg_pm_single PPs_singleton<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deg_le_sect_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"deg_le_sect <span class="free">X</span> <span class="main">0</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deg_le_sect_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deg_le_sect_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"deg_le_sect <span class="main">{}</span> <span class="free">d</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deg_le_sect_alt varnum_eq_zero_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deg_le_sect_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"deg_le_sect <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="free">d</span> <span class="main">=</span> Poly_Mapping.single <span class="free">x</span> <span class="main">`</span> <span class="main">{..</span><span class="free">d</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deg_le_sect_alt deg_pm_single PPs_singleton<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deg_sect_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">Y</span> <span class="main">⟹</span> deg_sect <span class="free">X</span> <span class="free">d</span> <span class="main">⊆</span> deg_sect <span class="free">Y</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deg_sect_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> PPs_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deg_le_sect_mono_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">Y</span> <span class="main">⟹</span> deg_le_sect <span class="free">X</span> <span class="free">d</span> <span class="main">⊆</span> deg_le_sect <span class="free">Y</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deg_le_sect_alt <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> PPs_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deg_le_sect_mono_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d1</span> <span class="main">≤</span> <span class="free">d2</span> <span class="main">⟹</span> deg_le_sect <span class="free">X</span> <span class="free">d1</span> <span class="main">⊆</span> deg_le_sect <span class="free">X</span> <span class="free">d2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deg_le_sect_alt<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> zero_in_deg_le_sect<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> deg_le_sect <span class="free">n</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_le_sect_alt zero_in_PPs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deg_sect_disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d1</span> <span class="main">≠</span> <span class="free">d2</span> <span class="main">⟹</span> deg_sect <span class="free">X</span> <span class="free">d1</span> <span class="main">∩</span> deg_sect <span class="free">Y</span> <span class="free">d2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deg_sect_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deg_le_sect_deg_sect_disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d1</span> <span class="main">&lt;</span> <span class="free">d2</span> <span class="main">⟹</span> deg_le_sect <span class="free">Y</span> <span class="free">d1</span> <span class="main">∩</span> deg_sect <span class="free">X</span> <span class="free">d2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deg_sect_def deg_le_sect_alt<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deg_sect_Suc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"deg_sect <span class="free">X</span> <span class="main">(</span>Suc <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">(+)</span> <span class="main">(</span>Poly_Mapping.single <span class="bound">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> deg_sect <span class="free">X</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?A</span> <span class="main">⟷</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">=</span> Suc <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> deg_sectD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">t</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> keys <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> lookup <span class="skolem">t</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">t</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPsD<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> keys <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="skolem">x</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">≤</span> lookup <span class="skolem">t</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="keyword1">adds</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_single when_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> adds_poly_mappingI le_funI<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="var">?s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute adds_minus<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">-</span> <span class="var">?s</span> <span class="main">∈</span> deg_sect <span class="free">X</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> deg_sectI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">-</span> <span class="var">?s</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_minus<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> deg_pm_plus<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">-</span> <span class="var">?s</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">=</span> Suc <span class="main">(</span>deg_pm <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="var">?s</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> t deg_pm_single<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="var">?s</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹deg_pm <span class="skolem">t</span> <span class="main">=</span> Suc <span class="free">d</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="var">?s</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(+)</span> <span class="var">?s</span> <span class="main">`</span> deg_sect <span class="free">X</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">(+)</span> <span class="var">?s</span> <span class="main">`</span> deg_sect <span class="free">X</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> t<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">(+)</span> <span class="main">(</span>Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> deg_sect <span class="free">X</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> deg_sect <span class="free">X</span> <span class="free">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">s</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="var">?s</span> <span class="main">+</span> <span class="skolem">s</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> deg_sectI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_single<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> deg_sectD<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_plus<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">s</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> deg_sectD<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">=</span> Suc <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t deg_pm_single deg_pm_plus<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> deg_sect_insert<span class="main">:</span>
  <span class="quoted"><span class="quoted">"deg_sect <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="free">d</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">d0</span><span class="main">≤</span><span class="free">d</span><span class="main">.</span> <span class="main">(+)</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="bound">d0</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> deg_sect <span class="free">X</span> <span class="bound">d0</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?A</span> <span class="main">⟷</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> deg_sectD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">tx</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tx</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> Poly_Mapping.single <span class="free">x</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">tx</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_insertE<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">+</span> deg_pm <span class="skolem">tx</span> <span class="main">=</span> deg_pm <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t deg_pm_plus deg_pm_single<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">+</span> deg_pm <span class="skolem">tx</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹deg_pm <span class="skolem">t</span> <span class="main">=</span> <span class="free">d</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">tx</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">d</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="free">d</span> <span class="main">-</span> deg_pm <span class="skolem">tx</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">tx</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>›</span></span> refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tx</span> <span class="main">∈</span> deg_sect <span class="free">X</span> <span class="main">(</span>deg_pm <span class="skolem">tx</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> deg_sectI<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">(+)</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> deg_pm <span class="skolem">tx</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> deg_sect <span class="free">X</span> <span class="main">(</span>deg_pm <span class="skolem">tx</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> t e <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹deg_pm <span class="skolem">tx</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">d</span><span class="main">}</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d0</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">d</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">(+)</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="skolem">d0</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> deg_sect <span class="free">X</span> <span class="skolem">d0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> deg_sect <span class="free">X</span> <span class="skolem">d0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> Poly_Mapping.single <span class="free">x</span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="skolem">d0</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">s</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="var">?s</span> <span class="main">+</span> <span class="skolem">s</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> deg_sectI<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">∈</span> <span class="main">.[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_single<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> deg_sectD<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> <span class="main">.[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">.[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?s</span> <span class="main">∈</span> <span class="main">.[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_plus<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">d0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> deg_sectD<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d0</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">d</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d0</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t deg_pm_single deg_pm_plus<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> deg_le_sect_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"deg_le_sect <span class="free">X</span> <span class="main">(</span>Suc <span class="free">d</span><span class="main">)</span> <span class="main">=</span> deg_le_sect <span class="free">X</span> <span class="free">d</span> <span class="main">∪</span> deg_sect <span class="free">X</span> <span class="main">(</span>Suc <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_le_sect_def atMost_Suc Un_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deg_le_sect_Suc_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"deg_le_sect <span class="free">X</span> <span class="main">(</span>Suc <span class="free">d</span><span class="main">)</span> <span class="main">=</span> insert <span class="main">0</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">(+)</span> <span class="main">(</span>Poly_Mapping.single <span class="bound">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> deg_le_sect <span class="free">X</span> <span class="free">d</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>Suc <span class="main">0</span><span class="main">..</span>Suc <span class="free">d</span><span class="main">}</span> <span class="main">=</span> Suc <span class="main">`</span> <span class="main">{..</span><span class="free">d</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_Suc_atMost<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">0</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span>Suc <span class="free">d</span><span class="main">}</span> <span class="main">=</span> <span class="main">{..</span>Suc <span class="free">d</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">d0</span><span class="main">∈</span>insert <span class="main">0</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span>Suc <span class="free">d</span><span class="main">}</span><span class="main">.</span> deg_sect <span class="free">X</span> <span class="bound">d0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_le_sect_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> insert <span class="main">0</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">d0</span><span class="main">≤</span><span class="free">d</span><span class="main">.</span> deg_sect <span class="free">X</span> <span class="main">(</span>Suc <span class="bound">d0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> insert <span class="main">0</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">d0</span><span class="main">≤</span><span class="free">d</span><span class="main">.</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">(+)</span> <span class="main">(</span>Poly_Mapping.single <span class="bound">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> deg_sect <span class="free">X</span> <span class="bound">d0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> deg_sect_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> insert <span class="main">0</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">(+)</span> <span class="main">(</span>Poly_Mapping.single <span class="bound">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">d0</span><span class="main">≤</span><span class="free">d</span><span class="main">.</span> deg_sect <span class="free">X</span> <span class="bound">d0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> deg_le_sect_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_deg_sect<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span>deg_sect <span class="free">X</span> <span class="free">d</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'x</span><span class="main">::</span>countable <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">d</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_sect_Suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> finite_deg_le_sect<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="main">(</span>deg_le_sect <span class="free">X</span> <span class="free">d</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'x</span><span class="main">::</span>countable <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_le_sect_def finite_deg_sect<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> keys_subset_deg_le_sectI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">p</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"keys <span class="free">p</span> <span class="main">⊆</span> deg_le_sect <span class="free">X</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysD<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">≤</span> poly_deg <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_deg_max_keys<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> deg_le_sect <span class="free">X</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> deg_le_sectI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> binomial_symmetric_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_diff_cancel_left' binomial_symmetric le_add1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> card_deg_sect<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>deg_sect <span class="free">X</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">d</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">X</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> insert<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> insert.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> card <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_gt_0_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">d0</span><span class="main">.</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="bound">d0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>deg_sect <span class="skolem">X</span> <span class="skolem">d0</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d0</span> <span class="main">+</span> <span class="main">(</span>card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">d0</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> insert.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{..</span><span class="skolem">d</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> insert.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d0</span><span class="main">∈</span><span class="main">{..</span><span class="skolem">d</span><span class="main">}</span><span class="main">.</span> finite <span class="main">(</span><span class="main">(+)</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">d0</span><span class="main">)</span> <span class="main">`</span> deg_sect <span class="skolem">X</span> <span class="bound">d0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_deg_sect<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d0</span><span class="main">∈</span><span class="main">{..</span><span class="skolem">d</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">d1</span><span class="main">∈</span><span class="main">{..</span><span class="skolem">d</span><span class="main">}</span><span class="main">.</span> <span class="bound">d0</span> <span class="main">≠</span> <span class="bound">d1</span> <span class="main">⟶</span>
                          <span class="main">(</span><span class="main">(+)</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">d0</span><span class="main">)</span> <span class="main">`</span> deg_sect <span class="skolem">X</span> <span class="bound">d0</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">(+)</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">d1</span><span class="main">)</span> <span class="main">`</span> deg_sect <span class="skolem">X</span> <span class="bound">d1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d1</span> <span class="skolem">d2</span> <span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d1</span> <span class="main">≠</span> <span class="skolem">d2</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(+)</span> <span class="main">(</span><span class="var">?f</span> <span class="skolem">d1</span><span class="main">)</span> <span class="main">`</span> deg_sect <span class="skolem">X</span> <span class="skolem">d1</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">(+)</span> <span class="main">(</span><span class="var">?f</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">`</span> deg_sect <span class="skolem">X</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(+)</span> <span class="main">(</span><span class="var">?f</span> <span class="skolem">d1</span><span class="main">)</span> <span class="main">`</span> deg_sect <span class="skolem">X</span> <span class="skolem">d1</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">(+)</span> <span class="main">(</span><span class="var">?f</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">`</span> deg_sect <span class="skolem">X</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> t1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">(+)</span> <span class="main">(</span><span class="var">?f</span> <span class="skolem">d1</span><span class="main">)</span> <span class="main">`</span> deg_sect <span class="skolem">X</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">(+)</span> <span class="main">(</span><span class="var">?f</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">`</span> deg_sect <span class="skolem">X</span> <span class="skolem">d2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> t1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">∈</span> deg_sect <span class="skolem">X</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">d1</span> <span class="main">+</span> <span class="skolem">s1</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">∈</span> <span class="main">.[</span><span class="skolem">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> deg_sectD<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">s1</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPsD<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> insert.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">s1</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> t2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">∈</span> deg_sect <span class="skolem">X</span> <span class="skolem">d2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">d2</span> <span class="main">+</span> <span class="skolem">s2</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">∈</span> <span class="main">.[</span><span class="skolem">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> deg_sectD<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">s2</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPsD<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> insert.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> eq4<span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">s2</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> s2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span><span class="var">?f</span> <span class="skolem">d1</span> <span class="main">+</span> <span class="skolem">s1</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> lookup <span class="main">(</span><span class="var">?f</span> <span class="skolem">d2</span> <span class="main">+</span> <span class="skolem">s2</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> s1<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">-</span> <span class="skolem">d1</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">-</span> <span class="skolem">d2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_add eq3 eq4<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d1</span> <span class="main">∈</span> <span class="main">{..</span><span class="skolem">d</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d2</span> <span class="main">∈</span> <span class="main">{..</span><span class="skolem">d</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d1</span> <span class="main">=</span> <span class="skolem">d2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d1</span> <span class="main">≠</span> <span class="skolem">d2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>deg_sect <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">X</span><span class="main">)</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span>
                       <span class="main">(</span><span class="main">∑</span><span class="bound">d0</span><span class="main">≤</span><span class="skolem">d</span><span class="main">.</span> card <span class="main">(</span><span class="main">(+)</span> <span class="main">(</span>monomial <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="bound">d0</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">`</span> deg_sect <span class="skolem">X</span> <span class="bound">d0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> deg_sect_insert <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_UN_disjoint<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">d0</span><span class="main">≤</span><span class="skolem">d</span><span class="main">.</span> card <span class="main">(</span>deg_sect <span class="skolem">X</span> <span class="bound">d0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d0</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">(+)</span> <span class="main">(</span>monomial <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="skolem">d0</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>deg_sect <span class="skolem">X</span> <span class="skolem">d0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> add_left_imp_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(+)</span> <span class="main">(</span>monomial <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="skolem">d0</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">`</span> deg_sect <span class="skolem">X</span> <span class="skolem">d0</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>deg_sect <span class="skolem">X</span> <span class="skolem">d0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_image<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">d0</span><span class="main">≤</span><span class="skolem">d</span><span class="main">.</span> <span class="main">(</span>card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="bound">d0</span> <span class="keyword1">choose</span> <span class="main">(</span>card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq2 add.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">d0</span><span class="main">≤</span><span class="skolem">d</span><span class="main">.</span> <span class="main">(</span>card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="bound">d0</span> <span class="keyword1">choose</span> <span class="bound">d0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> binomial_symmetric_plus<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Suc <span class="main">(</span><span class="main">(</span>card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">d</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_choose_lower<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> card <span class="skolem">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">+</span> <span class="main">(</span>card <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq1 add.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">+</span> <span class="main">(</span>card <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>card <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> binomial_symmetric_plus<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> card_deg_sect_Suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>deg_sect <span class="free">X</span> <span class="main">(</span>Suc <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">d</span> <span class="main">+</span> card <span class="free">X</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>Suc <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_sect_empty<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_gt_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>deg_sect <span class="free">X</span> <span class="main">(</span>Suc <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="free">d</span> <span class="main">+</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_deg_sect<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="free">d</span> <span class="main">+</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>Suc <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> binomial_symmetric_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> card <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">d</span> <span class="main">+</span> card <span class="free">X</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>Suc <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> card_deg_le_sect<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>deg_le_sect <span class="free">X</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">d</span> <span class="main">+</span> card <span class="free">X</span><span class="main">)</span> <span class="keyword1">choose</span> card <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">d</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>deg_le_sect <span class="free">X</span> <span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_deg_le_sect<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>deg_sect <span class="free">X</span> <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_deg_sect<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> lessI <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deg_le_sect <span class="free">X</span> <span class="skolem">d</span> <span class="main">∩</span> deg_sect <span class="free">X</span> <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> deg_le_sect_deg_sect_disjoint<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>deg_le_sect <span class="free">X</span> <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>deg_le_sect <span class="free">X</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span>deg_sect <span class="free">X</span> <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> deg_le_sect_Suc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_Un_disjoint<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="skolem">d</span> <span class="main">+</span> card <span class="free">X</span><span class="main">)</span> <span class="keyword1">choose</span> Suc <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.hyps card_deg_sect_Suc binomial_symmetric_plus<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">d</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="skolem">d</span> <span class="main">+</span> card <span class="free">X</span><span class="main">)</span> <span class="keyword1">choose</span> card <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> binomial_symmetric_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* theory *)</span>
</pre>
</div><div id="Degree_Bound_Utils">
<div class="head">
<h1>Theory Degree_Bound_Utils</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Alexander Maletzky *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Utility Definitions and Lemmas about Degree Bounds for Gr\"obner Bases›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Degree_Bound_Utils
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../Groebner_Bases/Groebner_PM.html">Groebner_Bases.Groebner_PM</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> pm_powerprod
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_GB_cofactor_bound</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">::</span>field<span class="main">)</span> set <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_GB_cofactor_bound</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟷</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">G</span><span class="main">.</span> punit.is_Groebner_basis <span class="bound">G</span> <span class="main">∧</span> ideal <span class="bound">G</span> <span class="main">=</span> ideal <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">UN</span> <span class="bound">g</span><span class="main">:</span><span class="bound">G</span><span class="main">.</span> indets <span class="bound">g</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="keyword1">UN</span> <span class="bound">f</span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">.</span> indets <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">g</span><span class="main">∈</span><span class="bound">G</span><span class="main">.</span> <span class="main">∃</span><span class="bound">F'</span> <span class="bound">q</span><span class="main">.</span> finite <span class="bound">F'</span> <span class="main">∧</span> <span class="bound">F'</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> <span class="bound">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="bound">F'</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">∈</span><span class="bound">F'</span><span class="main">.</span> poly_deg <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_hom_GB_bound</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">::</span>field<span class="main">)</span> set <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_hom_GB_bound</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">.</span> homogeneous <span class="bound">f</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">g</span><span class="main">∈</span>punit.reduced_GB <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">.</span> poly_deg <span class="bound">g</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_GB_cofactor_boundI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">G</span> <span class="main">=</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="free">G</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">F'</span> <span class="bound">q</span><span class="main">.</span> finite <span class="bound">F'</span> <span class="main">∧</span> <span class="bound">F'</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> <span class="bound">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="bound">F'</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">∈</span><span class="bound">F'</span><span class="main">.</span> poly_deg <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_GB_cofactor_bound <span class="free">F</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_GB_cofactor_bound_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> is_GB_cofactor_boundE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">::</span>field<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_GB_cofactor_bound <span class="free">F</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">G</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">G</span> <span class="main">=</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="free">G</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">F'</span> <span class="bound">q</span><span class="main">.</span> finite <span class="bound">F'</span> <span class="main">∧</span> <span class="bound">F'</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> <span class="bound">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="bound">F'</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span>
                          <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">.</span> indets <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">∧</span> poly_deg <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∉</span> <span class="bound">F'</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal <span class="skolem">G</span> <span class="main">=</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="skolem">G</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">F'</span> <span class="bound">q</span><span class="main">.</span> finite <span class="bound">F'</span> <span class="main">∧</span> <span class="bound">F'</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> <span class="bound">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="bound">F'</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">∈</span><span class="bound">F'</span><span class="main">.</span> poly_deg <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_GB_cofactor_bound_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">F'</span> <span class="bound">q</span><span class="main">.</span> finite <span class="bound">F'</span> <span class="main">∧</span> <span class="bound">F'</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="bound">F'</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">.</span> indets <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?X</span> <span class="main">∧</span> poly_deg <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∉</span> <span class="bound">F'</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">.</span> <span class="main">0</span><span class="main">::</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI allI<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="main">{}</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True q_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">F'</span> <span class="bound">q</span><span class="main">.</span> finite <span class="bound">F'</span> <span class="main">∧</span> <span class="bound">F'</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="bound">F'</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">∈</span><span class="bound">F'</span><span class="main">.</span> poly_deg <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F'</span></span> <span class="skolem"><span class="skolem">q0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">F'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F'</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">F'</span><span class="main">.</span> <span class="skolem">q0</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> q0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="skolem">F'</span> <span class="main">⟹</span> poly_deg <span class="main">(</span><span class="skolem">q0</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">sub</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sub</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="var">?X</span> <span class="keyword1">then</span>
                                         monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span>Poly_Mapping.single <span class="bound">x</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>
                                       <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sub</span> <span class="skolem">x</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> indets <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sub_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="skolem">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> indets <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∉</span> indets <span class="bound">f</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> indets <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">1</span> <span class="main">(</span>monomial <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> indets <span class="skolem">f</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sub</span> <span class="skolem">x</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> indets <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sub_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∉</span> indets <span class="bound">f</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">F'</span> <span class="main">⊆</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> indets <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">1</span> <span class="main">(</span>monomial <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_subst <span class="skolem">sub</span> <span class="skolem">f</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_subst_id<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> 2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> that<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">f</span> <span class="main">∈</span> <span class="skolem">F'</span> <span class="keyword1">then</span> poly_subst <span class="skolem">sub</span> <span class="main">(</span><span class="skolem">q0</span> <span class="bound">f</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI allI conjI impI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> poly_subst <span class="skolem">sub</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_subst_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">F'</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="main">(</span>poly_subst <span class="skolem">sub</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g poly_subst_sum poly_subst_times q_def <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">F'</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F'</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_subst <span class="skolem">sub</span> <span class="skolem">f</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">f</span> <span class="main">*</span> poly_subst <span class="skolem">sub</span> <span class="skolem">f</span> <span class="main">=</span> <span class="skolem">q</span> <span class="skolem">f</span> <span class="main">*</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">F'</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indets <span class="main">(</span><span class="skolem">q</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?X</span> <span class="main">∧</span> poly_deg <span class="main">(</span><span class="skolem">q</span> <span class="skolem">f</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F'</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">hence</span></span> qf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">f</span> <span class="main">=</span> poly_subst <span class="skolem">sub</span> <span class="main">(</span><span class="skolem">q0</span> <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q_def<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"indets <span class="main">(</span><span class="skolem">q</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?X</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> indets <span class="main">(</span><span class="skolem">q</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> indets <span class="main">(</span><span class="skolem">sub</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> qf <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_indets_poly_substE<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="var">?X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> indets <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sub_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> indets_monomial<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> y <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_subst <span class="skolem">sub</span> <span class="skolem">f</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span><span class="skolem">q</span> <span class="skolem">f</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> poly_deg <span class="main">(</span><span class="skolem">q</span> <span class="skolem">f</span> <span class="main">*</span> poly_subst <span class="skolem">sub</span> <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> poly_deg <span class="main">(</span>poly_subst <span class="skolem">sub</span> <span class="main">(</span><span class="skolem">q0</span> <span class="skolem">f</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> qf poly_subst_times<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> poly_deg <span class="main">(</span><span class="skolem">q0</span> <span class="skolem">f</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_deg_poly_subst_le<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span><span class="skolem">sub</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sub_def poly_deg_monomial deg_pm_single<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> q0<span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span><span class="skolem">q</span> <span class="skolem">f</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"indets <span class="main">(</span><span class="skolem">q</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span><span class="skolem">q</span> <span class="skolem">f</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∉</span> <span class="skolem">F'</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_GB_cofactor_boundE_Polys<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">::</span>field<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_GB_cofactor_bound <span class="free">F</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">G</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">G</span> <span class="main">=</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">F'</span> <span class="bound">q</span><span class="main">.</span> finite <span class="bound">F'</span> <span class="main">∧</span> <span class="bound">F'</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> <span class="bound">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="bound">F'</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span>
                            <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∧</span> poly_deg <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∉</span> <span class="bound">F'</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?X</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> indets <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"indets <span class="skolem">f</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysD<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> indets <span class="skolem">f</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal <span class="skolem">G</span> <span class="main">=</span> ideal <span class="free">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="skolem">G</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">F'</span> <span class="bound">q</span><span class="main">.</span> finite <span class="bound">F'</span> <span class="main">∧</span> <span class="bound">F'</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> <span class="bound">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="bound">F'</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span>
                            <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">.</span> indets <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?X</span> <span class="main">∧</span> poly_deg <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∉</span> <span class="bound">F'</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_GB_cofactor_boundE<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"indets <span class="skolem">g</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="skolem">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysI_alt<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">F'</span> <span class="bound">q</span><span class="main">.</span> finite <span class="bound">F'</span> <span class="main">∧</span> <span class="bound">F'</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="bound">F'</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">.</span> indets <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?X</span> <span class="main">∧</span> poly_deg <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∉</span> <span class="bound">F'</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F'</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">F'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F'</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">F'</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> indets <span class="main">(</span><span class="skolem">q</span> <span class="bound">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> poly_deg <span class="main">(</span><span class="skolem">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∉</span> <span class="skolem">F'</span> <span class="main">⟹</span> <span class="skolem">q</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">F'</span> <span class="bound">q</span><span class="main">.</span> finite <span class="bound">F'</span> <span class="main">∧</span> <span class="bound">F'</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="bound">F'</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∧</span> poly_deg <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∉</span> <span class="bound">F'</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI allI conjI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹indets <span class="main">(</span><span class="skolem">q</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?X</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indets <span class="main">(</span><span class="skolem">q</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysI_alt<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_GB_cofactor_boundE_finite_Polys<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">::</span>field<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_GB_cofactor_bound <span class="free">F</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">G</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">G</span> <span class="main">=</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="bound">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∧</span> poly_deg <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal <span class="skolem">G</span> <span class="main">=</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="skolem">G</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">F'</span> <span class="bound">q</span><span class="main">.</span> finite <span class="bound">F'</span> <span class="main">∧</span> <span class="bound">F'</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> <span class="bound">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="bound">F'</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span>
                            <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∧</span> poly_deg <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∉</span> <span class="bound">F'</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_GB_cofactor_boundE_Polys<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">F'</span> <span class="bound">q</span><span class="main">.</span> finite <span class="bound">F'</span> <span class="main">∧</span> <span class="bound">F'</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="bound">F'</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span>
                            <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∧</span> poly_deg <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∉</span> <span class="bound">F'</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F'</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F'</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">F'</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> poly_deg <span class="main">(</span><span class="skolem">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∉</span> <span class="skolem">F'</span> <span class="main">⟹</span> <span class="skolem">q</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∧</span> poly_deg <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI impI allI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">F'</span> <span class="main">⊆</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">F'</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_left ballI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">-</span> <span class="skolem">F'</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∉</span> <span class="skolem">F'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">f</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> g<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_GB_cofactor_boundI_subset_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_GB_cofactor_bound <span class="free">F</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> punit.is_Groebner_basis_empty
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_GB_cofactor_boundI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">{}</span> <span class="main">=</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ideal.span_empty ideal_eq_zero_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> is_hom_GB_boundI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> homogeneous <span class="bound">f</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">g</span> <span class="main">∈</span> punit.reduced_GB <span class="free">F</span> <span class="main">⟹</span> poly_deg <span class="bound">g</span> <span class="main">≤</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> is_hom_GB_bound <span class="free">F</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_hom_GB_bound_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> is_hom_GB_boundD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_hom_GB_bound <span class="free">F</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> homogeneous <span class="bound">f</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">∈</span> punit.reduced_GB <span class="free">F</span> <span class="main">⟹</span> poly_deg <span class="free">g</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_hom_GB_bound_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following is the main theorem in this theory. It shows that a bound for Gr\"obner bases of
  homogenized input sets is always also a cofactor bound for the original input sets.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> extended_ord_pm_powerprod<span class="main">)</span> hom_GB_bound_is_GB_cofactor_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"extended_ord.is_hom_GB_bound <span class="main">(</span>homogenize None <span class="main">`</span> extend_indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_GB_cofactor_bound <span class="free">F</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"homogenize None <span class="main">`</span> extend_indets <span class="main">`</span> <span class="free">F</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span>indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> restrict_indets <span class="main">`</span> <span class="main">(</span>extended_ord.punit.reduced_GB <span class="var">?F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> indets <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"indets <span class="skolem">f</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysD<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> indets <span class="skolem">f</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="skolem">Y</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Y_def Polys_alt<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal <span class="skolem">G</span> <span class="main">=</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="skolem">Y</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> G_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> restrict_indets_reduced_GB<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_GB_cofactor_boundI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="skolem">Y</span><span class="main">]</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>indets <span class="main">`</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">(</span>indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Y_def Polys_alt<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> g'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> extended_ord.punit.reduced_GB <span class="var">?F</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> restrict_indets <span class="skolem">g'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G_def <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="var">?F</span> <span class="main">⟹</span> homogeneous <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> homogeneous_homogenize<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">g'</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> extended_ord.is_hom_GB_boundD<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> g' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> ideal <span class="main">(</span>extended_ord.punit.reduced_GB <span class="var">?F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_base<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ideal <span class="var">?F</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> extended_ord.reduced_GB_ideal_Polys<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>insert None <span class="main">(</span>Some <span class="main">`</span> <span class="skolem">Y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?F</span> <span class="main">⊆</span> <span class="keyword1">P[</span>insert None <span class="main">(</span>Some <span class="main">`</span> <span class="skolem">Y</span><span class="main">)</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f0</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f0</span> <span class="main">∈</span> <span class="var">?F</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f0</span> <span class="main">=</span> homogenize None <span class="main">(</span>extend_indets <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="skolem">Y</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="skolem">Y</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"extend_indets <span class="skolem">f</span> <span class="main">∈</span> <span class="keyword1">P[</span>Some <span class="main">`</span> <span class="skolem">Y</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indets_extend_indets Polys_alt<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f0</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert None <span class="main">(</span>Some <span class="main">`</span> <span class="skolem">Y</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> homogenize_in_Polys<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> ideal <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="var">?F</span> <span class="main">⟹</span> homogeneous <span class="bound">f</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F0</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">F0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F0</span> <span class="main">⊆</span> <span class="var">?F</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> g'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">F0</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> poly_deg <span class="main">(</span><span class="skolem">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> poly_deg <span class="skolem">g'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> homogeneous_idealE<span class="main">)</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F'</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> F0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F0</span> <span class="main">=</span> homogenize None <span class="main">`</span> extend_indets <span class="main">`</span> <span class="skolem">F'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> inj_on<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>homogenize None <span class="main">∘</span> extend_indets<span class="main">)</span> <span class="skolem">F'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> image_comp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_imageE_inj<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">F'</span> <span class="bound">q</span><span class="main">.</span> finite <span class="bound">F'</span> <span class="main">∧</span> <span class="bound">F'</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="bound">F'</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">∈</span><span class="bound">F'</span><span class="main">.</span> poly_deg <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI ballI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> inj_on <span class="quoted"><span class="quoted">‹finite <span class="skolem">F0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">F'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> finite_image_iff F0 image_comp<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> inj_on <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">F'</span><span class="main">.</span> <span class="main">(</span>restrict_indets <span class="main">∘</span> <span class="skolem">q</span> <span class="main">∘</span> homogenize None <span class="main">∘</span> extend_indets<span class="main">)</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g g' F0 restrict_indets_sum restrict_indets_times sum.reindex image_comp o_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span><span class="main">(</span>restrict_indets <span class="main">∘</span> <span class="skolem">q</span> <span class="main">∘</span> homogenize None <span class="main">∘</span> extend_indets<span class="main">)</span> <span class="skolem">f</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span>
              poly_deg <span class="main">(</span>restrict_indets <span class="main">(</span><span class="skolem">q</span> <span class="main">(</span>homogenize None <span class="main">(</span>extend_indets <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> homogenize None <span class="main">(</span>extend_indets <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_indets_times<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> poly_deg <span class="main">(</span><span class="skolem">q</span> <span class="main">(</span>homogenize None <span class="main">(</span>extend_indets <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> homogenize None <span class="main">(</span>extend_indets <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_deg_restrict_indets_le<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> poly_deg <span class="skolem">g'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> deg_le<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span><span class="main">(</span>restrict_indets <span class="main">∘</span> <span class="skolem">q</span> <span class="main">∘</span> homogenize None <span class="main">∘</span> extend_indets<span class="main">)</span> <span class="skolem">f</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* pm_powerprod *)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* theory *)</span>
</pre>
</div><div id="Groebner_Macaulay">
<div class="head">
<h1>Theory Groebner_Macaulay</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Alexander Maletzky *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Computing Gr\"obner Bases by Triangularizing Macaulay Matrices›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Groebner_Macaulay
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../Groebner_Bases/Macaulay_Matrix.html">Groebner_Bases.Macaulay_Matrix</a> <a href="../Groebner_Bases/Groebner_PM.html">Groebner_Bases.Groebner_PM</a> <a href="Degree_Section.html">Degree_Section</a> <a href="Degree_Bound_Utils.html">Degree_Bound_Utils</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Relationship between Gr\"obner bases and Macaulay matrices, following
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Wiesinger-Widi2015"<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Gr\"obner Bases›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> gd_term<span class="main">)</span> Macaulay_list_is_GB<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_Groebner_basis <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pmdl <span class="main">(</span>set <span class="free">ps</span><span class="main">)</span> <span class="main">=</span> pmdl <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> phull <span class="main">(</span>set <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_Groebner_basis <span class="main">(</span>set <span class="main">(</span>Macaulay_list <span class="free">ps</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> GB_alt_3_finite<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_set<span class="main"><span class="main">]</span></span> pmdl_Macaulay_list<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> ballI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> pmdl <span class="main">(</span>set <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> pmdl <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> pmdl <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> pmdl <span class="free">G</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> GB_adds_lt<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> phull <span class="main">(</span>set <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> set <span class="main">(</span>Macaulay_list <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g</span> <span class="main">=</span> lt <span class="skolem">g'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Macaulay_list_lt<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">∈</span>set <span class="main">(</span>Macaulay_list <span class="free">ps</span><span class="main">)</span><span class="main">.</span> <span class="bound">g</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> lt <span class="bound">g</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">g</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="skolem">f</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">g</span> <span class="main">=</span> lt <span class="skolem">g'</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bounds›</span></span>

<span class="keyword1"><span class="command">context</span></span> pm_powerprod
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin_X<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">deg_shifts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">::</span>semiring_1<span class="main">)</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">deg_shifts</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">=</span> concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> punit.monom_mult <span class="main">1</span> <span class="bound">t</span> <span class="bound">f</span><span class="main">)</span>
                                        <span class="main">(</span>punit.pps_to_list <span class="main">(</span>deg_le_sect <span class="free">X</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">-</span> poly_deg <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_deg_shifts<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>deg_shifts <span class="free">d</span> <span class="free">fs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">f</span><span class="main">∈</span>set <span class="free">fs</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> punit.monom_mult <span class="main">1</span> <span class="bound">t</span> <span class="bound">f</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>deg_le_sect <span class="free">X</span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> poly_deg <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> fin_X <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>deg_le_sect <span class="free">X</span> <span class="skolem">d0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">d0</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_deg_le_sect<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_shifts_def punit.set_pps_to_list<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> set_deg_shifts_singleton<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>deg_shifts <span class="free">d</span> <span class="main">[</span><span class="free">f</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> punit.monom_mult <span class="main">1</span> <span class="bound">t</span> <span class="free">f</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>deg_le_sect <span class="free">X</span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> poly_deg <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_deg_shifts<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deg_shifts_superset<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">fs</span> <span class="main">⊆</span> set <span class="main">(</span>deg_shifts <span class="free">d</span> <span class="free">fs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">fs</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">f</span><span class="main">∈</span>set <span class="free">fs</span><span class="main">.</span> <span class="main">{</span>punit.monom_mult <span class="main">1</span> <span class="main">0</span> <span class="bound">f</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> set <span class="main">(</span>deg_shifts <span class="free">d</span> <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_deg_shifts <span class="keyword1"><span class="command">using</span></span> subset_refl
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> UN_mono<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> set <span class="free">fs</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.monom_mult <span class="main">1</span> <span class="main">0</span> <span class="skolem">f</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> punit.monom_mult <span class="main">1</span> <span class="bound">t</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">`</span> deg_le_sect <span class="free">X</span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> poly_deg <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> zero_in_deg_le_sect <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>punit.monom_mult <span class="main">1</span> <span class="main">0</span> <span class="skolem">f</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> punit.monom_mult <span class="main">1</span> <span class="bound">t</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">`</span> deg_le_sect <span class="free">X</span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> poly_deg <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> deg_shifts_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">fs</span> <span class="main">⊆</span> set <span class="free">gs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>deg_shifts <span class="free">d</span> <span class="free">fs</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>deg_shifts <span class="free">d</span> <span class="free">gs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_deg_shifts<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ideal_deg_shifts <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>set <span class="main">(</span>deg_shifts <span class="free">d</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>set <span class="main">(</span>deg_shifts <span class="free">d</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_subset_spanI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_deg_shifts UN_subset_iff<span class="main"><span class="keyword3">,</span></span>
        <span class="operator">intro</span> ballI image_subsetI<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> ideal.span_scale times_monomial_left ideal.span_base<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> deg_shifts_superset <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span> <span class="main">⊆</span> ideal <span class="main">(</span>set <span class="main">(</span>deg_shifts <span class="free">d</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> thm_2_3_6<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">fs</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_GB_cofactor_bound <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="main">(</span>set <span class="main">(</span>punit.Macaulay_list <span class="main">(</span>deg_shifts <span class="free">b</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> finite_set assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="skolem">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ideal_G<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="skolem">G</span> <span class="main">=</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> G_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="skolem">G</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="bound">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span>set <span class="free">fs</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∧</span> poly_deg <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_GB_cofactor_boundE_finite_Polys<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> punit.Macaulay_list_is_GB<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">⊆</span> phull <span class="main">(</span>set <span class="main">(</span>deg_shifts <span class="free">b</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⊆</span> <span class="var">?H</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span>set <span class="free">fs</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∧</span> poly_deg <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span>set <span class="free">fs</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> poly_deg <span class="main">(</span><span class="skolem">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="var">?H</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> phull.span_sum<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> set <span class="free">fs</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">f</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">∈</span> <span class="var">?H</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">q</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> phull.span_zero<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹poly_deg <span class="main">(</span><span class="skolem">q</span> <span class="skolem">f</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span><span class="skolem">q</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">-</span> poly_deg <span class="skolem">f</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_deg_times<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="skolem">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span><span class="skolem">q</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">⊆</span> deg_le_sect <span class="free">X</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> poly_deg <span class="skolem">f</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> keys_subset_deg_le_sectI<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> finite_deg_le_sect<span class="main">[</span><span class="operator">OF</span> fin_X<span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">f</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">∈</span>deg_le_sect <span class="free">X</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> poly_deg <span class="skolem">f</span><span class="main">)</span><span class="main">.</span> punit.monom_mult <span class="main">(</span>lookup <span class="main">(</span><span class="skolem">q</span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="bound">t</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> punit.mult_scalar_sum_monomials<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.mono_neutral_left<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">∈</span>deg_le_sect <span class="free">X</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> poly_deg <span class="skolem">f</span><span class="main">)</span><span class="main">.</span>
                              <span class="main">(</span>lookup <span class="main">(</span><span class="skolem">q</span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span>punit.monom_mult <span class="main">1</span> <span class="bound">t</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.monom_mult_assoc punit.map_scale_eq_monom_mult<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">∈</span>deg_le_sect <span class="free">X</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> poly_deg <span class="skolem">f</span><span class="main">)</span><span class="main">.</span>
                          <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">f0</span><span class="main">.</span> <span class="main">(</span>lookup <span class="main">(</span><span class="skolem">q</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>punit.lp <span class="bound">f0</span> <span class="main">-</span> punit.lp <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">f0</span><span class="main">)</span> <span class="main">∘</span>
                          <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> punit.monom_mult <span class="main">1</span> <span class="bound">t</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> refl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.lt_monom_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f0</span><span class="main">∈</span>set <span class="main">(</span>deg_shifts <span class="free">b</span> <span class="main">[</span><span class="skolem">f</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>lookup <span class="main">(</span><span class="skolem">q</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>punit.lp <span class="bound">f0</span> <span class="main">-</span> punit.lp <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">f0</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> set_deg_shifts_singleton
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> inj_onI<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"punit.monom_mult <span class="main">1</span> <span class="skolem">s</span> <span class="skolem">f</span> <span class="main">=</span> punit.monom_mult <span class="main">1</span> <span class="skolem">t</span> <span class="skolem">f</span>"</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.monom_mult_inj_2<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">f</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">∈</span> phull <span class="main">(</span>set <span class="main">(</span>deg_shifts <span class="free">b</span> <span class="main">[</span><span class="skolem">f</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> phull.sum_in_spanI<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="var">?H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phull.span_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> deg_shifts_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> set <span class="free">fs</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal_G<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> thm_2_3_7<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">fs</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_GB_cofactor_bound <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">1</span> <span class="main">∈</span> set <span class="main">(</span>punit.Macaulay_list <span class="main">(</span>deg_shifts <span class="free">b</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>punit.Macaulay_list <span class="main">(</span>deg_shifts <span class="free">b</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> thm_2_3_6<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.pmdl_Macaulay_list<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="var">?G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="skolem">g</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.GB_adds_lt<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> lp_g<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="skolem">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.lt_monomial adds_zero <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> single_one<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> punit.Macaulay_list_is_monic_set <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="var">?G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> lc_g<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lc <span class="skolem">g</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.is_monic_setD<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_mapping_eqI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">g</span> <span class="skolem">t</span> <span class="main">=</span> lookup <span class="main">1</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> lc_g <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_one punit.lc_def lp_g<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> zero_min<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">t</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lp_g<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> punit.lt_max_keys <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∉</span> keys <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_one in_keys_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="var">?G</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> phull <span class="main">(</span>set <span class="main">(</span>punit.Macaulay_list <span class="main">(</span>deg_shifts <span class="free">b</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phull.span_superset<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> phull <span class="main">(</span>set <span class="main">(</span>deg_shifts <span class="free">b</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> punit.phull_Macaulay_list<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> ideal <span class="main">(</span>set <span class="main">(</span>deg_shifts <span class="free">b</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> punit.phull_subset_module <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> thm_2_3_6_indets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_GB_cofactor_bound <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="main">(</span>set <span class="main">(</span>punit.Macaulay_list <span class="main">(</span>deg_shifts <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> _ _ assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> thm_2_3_6<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> finite_set <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_indets<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="free">fs</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Polys_alt<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> thm_2_3_7_indets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_GB_cofactor_bound <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">1</span> <span class="main">∈</span> set <span class="main">(</span>punit.Macaulay_list <span class="main">(</span>deg_shifts <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> _ _ assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> thm_2_3_7<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> finite_set <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_indets<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="free">fs</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Polys_alt<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* pm_powerprod *)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* theory *)</span>
</pre>
</div><div id="Binomial_Int">
<div class="head">
<h1>Theory Binomial_Int</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Alexander Maletzky *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Integer Binomial Coefficients›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Binomial_Int
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> upper_le_binomial<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">n</span> <span class="keyword1">choose</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="free">k</span> <span class="keyword1">then</span> <span class="free">k</span> <span class="keyword1">else</span> <span class="free">n</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">k'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> k'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">choose</span> <span class="free">k</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">choose</span> <span class="skolem">k'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> k'_def binomial_symmetric<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≤</span> <span class="free">n</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">choose</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> choose_one<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">≤</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> binomial_symmetric<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">n</span> <span class="keyword1">choose</span> <span class="skolem">k'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> binomial_antimono<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">choose</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> k'_def binomial_symmetric<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≤</span> <span class="free">n</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Restore original sort constraints:›</span></span>
<span class="keyword1"><span class="command">setup</span></span> <span class="quoted">‹Sign.add_const_constraint <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> gbinomial<span class="antiquote">}</span></span><span class="main">,</span> SOME <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semidom_divide<span class="main">,</span>semiring_char_0<span class="main">}</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span><span class="antiquote">}</span></span><span class="main">)</span>›</span>

<span class="keyword1"><span class="command">lemma</span></span> gbinomial_0_left<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> gbinomial_eq_0_int<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="free">n</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">}</span><span class="main">.</span> int <span class="free">n</span> <span class="main">-</span> int <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"int <span class="free">n</span> <span class="main">-</span> int <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> finite_atLeastLessThan <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"prod <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> int <span class="free">n</span> <span class="main">-</span> int <span class="bound">i</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod_zero<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gbinomial_prod_rev eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> gbinomial_eq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">&lt;</span> int <span class="free">k</span> <span class="main">⟹</span> <span class="free">a</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nat_eq_iff2 nat_less_iff gbinomial_eq_0_int<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> int_binomial<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>int <span class="free">n</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">n</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">from</span></span> refl <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">.</span> int <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">.</span> int <span class="free">n</span> <span class="main">-</span> int <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> prod.cong<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> int <span class="free">n</span> <span class="main">-</span> int <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gbinomial_binomial<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> gbinomial_prod_rev zdiv_int eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gbinomial_eq_0_int<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> falling_fact_pochhammer<span class="main">:</span> <span class="quoted"><span class="quoted">"prod <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">a</span> <span class="main">-</span> int <span class="bound">i</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">*</span> pochhammer <span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">^</span> Suc <span class="skolem">n</span> <span class="main">*</span> prod <span class="skolem">f</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> prod <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">z</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">n</span> <span class="skolem">f</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pochhammer_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> pochhammer_prod atLeastLessThanSuc_atLeastAtMost
          prod.atLeast_Suc_atMost_Suc_shift eq <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_nat_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> falling_fact_pochhammer'<span class="main">:</span> <span class="quoted"><span class="quoted">"prod <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">a</span> <span class="main">-</span> int <span class="bound">i</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">}</span> <span class="main">=</span> pochhammer <span class="main">(</span><span class="free">a</span> <span class="main">-</span> int <span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> falling_fact_pochhammer pochhammer_minus'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> gbinomial_int_pochhammer<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span>int<span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">*</span> pochhammer <span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="free">k</span> <span class="keyword1">div</span> fact <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gbinomial_prod_rev falling_fact_pochhammer<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> gbinomial_int_pochhammer'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">=</span> pochhammer <span class="main">(</span><span class="free">a</span> <span class="main">-</span> int <span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">k</span> <span class="keyword1">div</span> fact <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gbinomial_prod_rev falling_fact_pochhammer'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fact_dvd_pochhammer<span class="main">:</span> <span class="quoted"><span class="quoted">"fact <span class="free">k</span> <span class="keyword1">dvd</span> pochhammer <span class="main">(</span><span class="free">a</span><span class="main">::</span>int<span class="main">)</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>of_int <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">div</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>field_char_0<span class="main">)</span> <span class="main">=</span> of_int <span class="skolem">x</span> <span class="main">/</span> of_int <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="keyword1">dvd</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">int</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> dvd_triv_left mult.commute nonzero_eq_divide_eq of_int_eq_0_iff of_int_eq_iff of_int_mult<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">a</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> nat <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> int <span class="skolem">n</span> <span class="main">-</span> int <span class="free">k</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> fact_nonzero <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> dvd<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span>pochhammer <span class="main">(</span>int <span class="skolem">n</span> <span class="main">-</span> int <span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">k</span> <span class="keyword1">div</span> fact <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="main">(</span>int <span class="skolem">n</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span><span class="main">::</span>rat<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gbinomial_int_pochhammer'<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_int <span class="main">(</span>int <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> int_binomial<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_nat <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>of_nat <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> binomial_gbinomial<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> pochhammer <span class="main">(</span>of_nat <span class="skolem">n</span> <span class="main">-</span> of_nat <span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">k</span> <span class="main">/</span> fact <span class="free">k</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> gbinomial_pochhammer'<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> pochhammer <span class="main">(</span>of_int <span class="main">(</span>int <span class="skolem">n</span> <span class="main">-</span> int <span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="main">/</span> fact <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="main">(</span>pochhammer <span class="main">(</span>int <span class="skolem">n</span> <span class="main">-</span> int <span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_int <span class="main">(</span>fact <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_int_fact pochhammer_of_int<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span>pochhammer <span class="main">(</span>int <span class="skolem">n</span> <span class="main">-</span> int <span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">k</span> <span class="keyword1">div</span> fact <span class="free">k</span><span class="main">)</span> <span class="main">=</span>
                      of_int <span class="main">(</span>pochhammer <span class="main">(</span>int <span class="skolem">n</span> <span class="main">-</span> int <span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span> <span class="main">/</span> rat_of_int <span class="main">(</span>fact <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> nat <span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">-</span> int <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> fact_nonzero <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fact <span class="free">k</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> pochhammer <span class="main">(</span><span class="main">-</span> int <span class="skolem">n</span><span class="main">)</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> dvd<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> pochhammer <span class="main">(</span><span class="main">-</span> int <span class="skolem">n</span><span class="main">)</span> <span class="free">k</span> <span class="keyword1">div</span> fact <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="main">(</span>int <span class="skolem">n</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span><span class="main">::</span>rat<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gbinomial_int_pochhammer<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_int <span class="main">(</span>int <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> int_binomial<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_nat <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>of_nat <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> binomial_gbinomial<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> pochhammer <span class="main">(</span><span class="main">-</span> of_nat <span class="skolem">n</span><span class="main">)</span> <span class="free">k</span> <span class="main">/</span> fact <span class="free">k</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> gbinomial_pochhammer<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> pochhammer <span class="main">(</span>of_int <span class="main">(</span><span class="main">-</span> int <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="main">/</span> fact <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> <span class="main">(</span>of_int <span class="main">(</span>pochhammer <span class="main">(</span><span class="main">-</span> int <span class="skolem">n</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_int <span class="main">(</span>fact <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_int_fact pochhammer_of_int<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> pochhammer <span class="main">(</span><span class="main">-</span> int <span class="skolem">n</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_int <span class="main">(</span>fact <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">*</span> pochhammer <span class="main">(</span><span class="main">-</span> int <span class="skolem">n</span><span class="main">)</span> <span class="free">k</span> <span class="keyword1">div</span> fact <span class="free">k</span><span class="main">)</span> <span class="main">=</span>
                    of_int <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">*</span> pochhammer <span class="main">(</span><span class="main">-</span> int <span class="skolem">n</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span> <span class="main">/</span> rat_of_int <span class="main">(</span>fact <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvdI dvd_mult_unit_iff' minus_one_mult_self<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> gbinomial_int_negated_upper<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int <span class="free">k</span> <span class="main">-</span> <span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gbinomial_int_pochhammer pochhammer_minus <span class="dynamic"><span class="dynamic">algebra_simps</span></span> fact_dvd_pochhammer div_mult_swap<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> gbinomial_int_mult_fact<span class="main">:</span> <span class="quoted"><span class="quoted">"fact <span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">a</span> <span class="main">-</span> int <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gbinomial_int_pochhammer' fact_dvd_pochhammer dvd_mult_div_cancel falling_fact_pochhammer'<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> gbinomial_int_mult_fact'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> fact <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">a</span> <span class="main">-</span> int <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> gbinomial_int_mult_fact<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> gbinomial_int_binomial<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">a</span> <span class="keyword1">then</span> int <span class="main">(</span><span class="main">(</span>nat <span class="free">a</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> int <span class="main">(</span><span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">(</span>nat <span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> int_binomial gbinomial_int_negated_upper<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="main">]</span></span> int_ops<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> gbinomial_nneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">a</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">=</span> int <span class="main">(</span><span class="main">(</span>nat <span class="free">a</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gbinomial_int_binomial<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> gbinomial_neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">a</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> int <span class="main">(</span><span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">(</span>nat <span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gbinomial_int_binomial<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> of_int_gbinomial<span class="main">:</span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span><span class="free">a</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="free">a</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">::</span>field_char_0<span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> of_int_div<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="keyword1">dvd</span> <span class="skolem">x</span> <span class="main">⟹</span> of_int <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">div</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> of_int <span class="skolem">x</span> <span class="main">/</span> <span class="main">(</span>of_int <span class="skolem">y</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gbinomial_int_pochhammer' gbinomial_pochhammer' of_int_div fact_dvd_pochhammer
        pochhammer_of_int<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> uminus_one_gbinomial <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gbinomial_int_binomial<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> gbinomial_int_Suc_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">::</span>int<span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> linorder_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span><span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not0_implies_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span><span class="main">-</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 1 2 3 4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">=</span> Suc <span class="skolem">k'</span>›</span></span> gbinomial_int_binomial int_distrib<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>nat <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gbinomial_int_binomial<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> plus_Suc_gbinomial<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> int <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> int <span class="free">k</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> int <span class="free">k</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> int <span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> gbinomial_int_Suc_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> gbinomial_int_n_n <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="free">n</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">gchoose</span> Suc <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span>int <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>int <span class="skolem">n</span> <span class="keyword1">gchoose</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="skolem">n</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> gbinomial_int_Suc_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc gbinomial_eq_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> gbinomial_int_Suc_n <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> int <span class="free">n</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> int <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> int <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">gchoose</span> Suc <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> int <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="keyword1">gchoose</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> int <span class="skolem">n</span> <span class="keyword1">gchoose</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> int <span class="skolem">n</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> gbinomial_int_Suc_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> int <span class="skolem">n</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> int <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gbinomial_int_n_n<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zbinomial_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> int <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&lt;</span> int <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">b</span> <span class="main">&lt;</span> int <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> nat <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="main">(</span>nat <span class="skolem">b</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span> <span class="keyword1">gchoose</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gbinomial_int_binomial<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> that<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≤</span> nat <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> int <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int <span class="free">k</span> <span class="main">-</span> <span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">gchoose</span> <span class="free">k</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gbinomial_int_negated_upper<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> a<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="free">k</span> <span class="main">-</span> <span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"int <span class="free">k</span> <span class="main">-</span> <span class="free">a</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> int <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">a</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> int <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> gbinomial_eq_0<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Sums›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> gchoose_rising_sum_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> int <span class="bound">j</span> <span class="main">+</span> int <span class="free">k</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>int <span class="free">n</span> <span class="main">+</span> int <span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> int <span class="bound">j</span> <span class="main">+</span> int <span class="free">k</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">j</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_binomial add.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">j</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> choose_rising_sum<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">…</span> <span class="main">=</span> <span class="main">(</span>int <span class="free">n</span> <span class="main">+</span> int <span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_binomial <span class="dynamic"><span class="dynamic">ac_simps</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> binomial_Suc_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> gchoose_rising_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>   <span class="comment1">―‹Necessary condition.›</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="bound">j</span> <span class="main">+</span> int <span class="free">k</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> int <span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> _ refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="bound">j</span> <span class="main">+</span> int <span class="free">k</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span>int <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>nat <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="bound">j</span> <span class="main">+</span> int <span class="free">k</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> int <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>nat <span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_int_atLeastAtMost<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span>nat <span class="free">n</span><span class="main">.</span> int <span class="bound">j</span> <span class="main">+</span> int <span class="free">k</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.reindex atMost_atLeast0<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>int <span class="main">(</span>nat <span class="free">n</span><span class="main">)</span> <span class="main">+</span> int <span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> gchoose_rising_sum_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> int <span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc add.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Inequalities›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> binomial_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">choose</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="keyword1">choose</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">choose</span> <span class="free">k</span> <span class="main">≤</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> *<span class="main">:</span> <span class="main">(</span>Suc <span class="skolem">l</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> k<span class="main">:</span> <span class="main">(</span>Suc <span class="skolem">k0</span><span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> *
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">+</span> <span class="skolem">l</span> <span class="keyword1">choose</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">+</span> <span class="skolem">l</span> <span class="keyword1">choose</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="skolem">l</span> <span class="keyword1">choose</span> <span class="skolem">k0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> Suc <span class="skolem">l</span> <span class="keyword1">choose</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> k<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> n<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> binomial_plus_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k0</span> <span class="main">=</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> Suc <span class="skolem">k0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> k
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">choose</span> Suc <span class="skolem">k0</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="keyword1">choose</span> Suc <span class="skolem">k0</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="keyword1">choose</span> Suc <span class="skolem">k0</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">choose</span> Suc <span class="skolem">k0</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">choose</span> <span class="skolem">k0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> binomial_Suc_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">choose</span> Suc <span class="skolem">k0</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="skolem">k0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> add_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">+</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">choose</span> <span class="skolem">k0</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">+</span> <span class="skolem">n</span> <span class="keyword1">choose</span> <span class="skolem">k0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> binomial_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> Suc <span class="skolem">n</span> <span class="keyword1">choose</span> Suc <span class="skolem">k0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> binomial_ineq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span> <span class="keyword1">choose</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> k<span class="main">:</span> <span class="main">(</span>Suc <span class="skolem">k0</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> k
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> Suc <span class="skolem">i</span> <span class="keyword1">choose</span> Suc <span class="skolem">k0</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="skolem">i</span> <span class="keyword1">choose</span> <span class="skolem">k0</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="skolem">i</span> <span class="keyword1">choose</span> Suc <span class="skolem">k0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">i</span> <span class="keyword1">choose</span> <span class="skolem">k0</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="skolem">k0</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> Suc <span class="skolem">k0</span> <span class="main">+</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">i</span> <span class="keyword1">choose</span> Suc <span class="skolem">k0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> add_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="skolem">i</span> <span class="keyword1">choose</span> <span class="skolem">k0</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">i</span> <span class="keyword1">choose</span> <span class="skolem">k0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> binomial_mono<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">i</span> <span class="keyword1">choose</span> <span class="skolem">k0</span> <span class="main">≤</span> Suc <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="skolem">k0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> binomial_mono<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="skolem">i</span> <span class="keyword1">choose</span> <span class="skolem">k0</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">i</span> <span class="keyword1">choose</span> <span class="skolem">k0</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="skolem">k0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">choose</span> Suc <span class="skolem">k0</span> <span class="main">+</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> Suc <span class="skolem">i</span> <span class="keyword1">choose</span> Suc <span class="skolem">k0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> gbinomial_int_nonneg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span>int<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span> <span class="keyword1">gchoose</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> int <span class="main">(</span>nat <span class="free">x</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">x</span> <span class="keyword1">gchoose</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_binomial<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> gbinomial_int_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span><span class="main">::</span>int<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">y</span> <span class="keyword1">gchoose</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="free">x</span> <span class="main">≤</span> nat <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nat <span class="free">x</span> <span class="keyword1">choose</span> <span class="free">k</span> <span class="main">≤</span> nat <span class="free">y</span> <span class="keyword1">choose</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> binomial_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>nat <span class="free">x</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> int <span class="main">(</span>nat <span class="free">y</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> zle_int<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>nat <span class="free">x</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">≤</span> int <span class="main">(</span>nat <span class="free">y</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> int_binomial<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> gbinomial_int_plus_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span><span class="main">::</span>int<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">y</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="free">x</span> <span class="keyword1">choose</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span>nat <span class="free">y</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> nat <span class="free">x</span> <span class="main">+</span> nat <span class="free">y</span> <span class="keyword1">choose</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> binomial_plus_le<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>nat <span class="free">x</span> <span class="keyword1">choose</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span>nat <span class="free">y</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> int <span class="main">(</span>nat <span class="free">x</span> <span class="main">+</span> nat <span class="free">y</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> zle_int<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>nat <span class="free">x</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>nat <span class="free">y</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> int <span class="main">(</span>nat <span class="free">x</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span>nat <span class="free">y</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> int_plus int_binomial<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> binomial_int_ineq_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span><span class="main">::</span>int<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> binomial_ineq_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"nat <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"nat <span class="free">y</span>"</span></span> <span class="quoted"><span class="free">k</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>nat <span class="free">x</span> <span class="main">+</span> nat <span class="free">y</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> int <span class="main">(</span>nat <span class="free">x</span> <span class="keyword1">choose</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span>nat <span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> nat <span class="free">y</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> zle_int<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>int <span class="main">(</span>nat <span class="free">x</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span>nat <span class="free">y</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> int <span class="main">(</span>nat <span class="free">x</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>nat <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> int <span class="main">(</span>nat <span class="free">y</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> int_binomial int_plus int_ops<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> binomial_int_ineq_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span>int<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="free">y</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> binomial_int_ineq_1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">smt</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> binomial_int_ineq_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span>int<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> binomial_int_ineq_2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">-</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">-</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">-</span> <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> binomial_int_ineq_2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Backward Difference Operator›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bw_diff</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ab_group_add<span class="main">,</span>one<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bw_diff</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bw_diff_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bw_diff <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bw_diff_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bw_diff_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bw_diff <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bw_diff_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bw_diff_plus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bw_diff <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> bw_diff <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> bw_diff <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bw_diff_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bw_diff_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bw_diff <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> bw_diff <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bw_diff_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bw_diff_minus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bw_diff <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> bw_diff <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> bw_diff <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bw_diff_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bw_diff_const_pow<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bw_diff_id_pow<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">k</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bw_diff_plus_pow <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bw_diff_uminus_pow <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bw_diff_minus_pow <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bw_diff_sum_pow <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bw_diff_const_pow<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bw_diff_gbinomial<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bw_diff <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>int<span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">int</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="free">n</span> <span class="keyword1">gchoose</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> gbinomial_int_Suc_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bw_diff <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">n</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq bw_diff_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bw_diff_gbinomial_pow<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">l</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>int<span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">k</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> int <span class="free">l</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l0</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span>bw_diff <span class="main">^^</span> <span class="skolem">l0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>int<span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> int <span class="skolem">l0</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="skolem">l0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">l0</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">l0</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">l0</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Suc.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">-</span> <span class="skolem">l0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l0</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bw_diff <span class="main">^^</span> <span class="skolem">l0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">n</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> int <span class="skolem">l0</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="skolem">l0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bw_diff <span class="main">^^</span> Suc <span class="skolem">l0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">n</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> bw_diff <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> int <span class="skolem">l0</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="skolem">l0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">-</span> <span class="skolem">l0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> int <span class="skolem">l0</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="skolem">l0</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bw_diff_gbinomial<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> int <span class="main">(</span>Suc <span class="skolem">l0</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">l0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> * <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">+</span> <span class="free">k</span> <span class="main">=</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">-</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">l</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">n</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>bw_diff <span class="main">^^</span> <span class="main">(</span><span class="main">(</span><span class="free">l</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">n</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>bw_diff <span class="main">^^</span> <span class="main">(</span><span class="free">l</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> * funpow_add<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">-</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bw_diff_const_pow<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">l</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">n</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* theory *)</span>
</pre>
</div><div id="Poly_Fun">
<div class="head">
<h1>Theory Poly_Fun</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Integer Polynomial Functions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Poly_Fun
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Binomial_Int.html">Binomial_Int</a> <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Polynomial.html">HOL-Computational_Algebra.Polynomial</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition and Basic Properties›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly_fun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="main">⇒</span> int<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">poly_fun</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">::</span>rat poly<span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> rat_of_int <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> poly <span class="bound">p</span> <span class="main">(</span>rat_of_int <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_funI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> rat_of_int <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> poly <span class="free">p</span> <span class="main">(</span>rat_of_int <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> poly_fun <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_fun_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_funE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">p</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> rat_of_int <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> poly <span class="free">p</span> <span class="main">(</span>rat_of_int <span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_fun_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_fun_eqI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">a</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> rat_of_int <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">p</span> <span class="main">(</span>rat_of_int <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_funE<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> rat_of_int <span class="main">(</span><span class="free">g</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">q</span> <span class="main">(</span>rat_of_int <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_funE<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">a</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="main">(</span>rat_of_int <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">q</span> <span class="main">(</span>rat_of_int <span class="bound">a</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_roots_finite<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_of_int <span class="main">`</span> <span class="var">?A</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_Collect_subsetI<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>rat_of_int <span class="main">`</span> <span class="var">?A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on rat_of_int <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> finite_image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> p q<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rat_of_int <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> rat_of_int <span class="main">(</span><span class="free">g</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p q<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> poly_fun_eqI_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="free">b</span> <span class="main">≤</span> <span class="bound">a</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_fun_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">b</span><span class="main">..}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> infinite_Ici <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> infinite_super<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> poly_fun_eqI_gr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="bound">a</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_fun_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">b</span><span class="main">&lt;..}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> infinite_Ioi <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> infinite_super<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Closure Properties›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_fun_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_funI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> p<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[:</span></span></span>rat_of_int <span class="free"><span class="free"><span class="free">c</span></span></span><span class="main"><span class="main"><span class="main">:]</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_fun_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"poly_fun id"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_funI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> p<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[:</span></span></span><span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">:]</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly_fun id"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> id_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_fun_uminus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">-</span> <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> rat_of_int <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">p</span> <span class="main">(</span>rat_of_int <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_funE<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_funI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> p<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">-</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">p</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">-</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fun_Compl_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_fun_uminus_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> poly_fun <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">-</span> <span class="free">f</span><span class="main">)</span> <span class="main">⟷</span> poly_fun <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> poly_fun <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_fun_uminus<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> poly_fun_uminus<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">-</span> <span class="free">f</span><span class="main">)</span> <span class="main">⟷</span> poly_fun <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fun_Compl_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_fun_plus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> rat_of_int <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">p</span> <span class="main">(</span>rat_of_int <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_funE<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> rat_of_int <span class="main">(</span><span class="free">g</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">q</span> <span class="main">(</span>rat_of_int <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_funE<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_funI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> p<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">p</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">q</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p q<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_fun_minus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> rat_of_int <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">p</span> <span class="main">(</span>rat_of_int <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_funE<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> rat_of_int <span class="main">(</span><span class="free">g</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">q</span> <span class="main">(</span>rat_of_int <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_funE<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_funI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> p<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">p</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">q</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p q<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_fun_times <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> rat_of_int <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">p</span> <span class="main">(</span>rat_of_int <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_funE<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> rat_of_int <span class="main">(</span><span class="free">g</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">q</span> <span class="main">(</span>rat_of_int <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_funE<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_funI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> p<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">p</span></span></span> <span class="main"><span class="main"><span class="main">*</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">q</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p q<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_fun_divide<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="free">c</span> <span class="keyword1">dvd</span> <span class="free">f</span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> rat_of_int <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">p</span> <span class="main">(</span>rat_of_int <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_funE<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">*</span> <span class="main">[:</span><span class="main">1</span> <span class="main">/</span> rat_of_int <span class="free">c</span><span class="main">:]</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_funI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">dvd</span> <span class="free">f</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rat_of_int <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> rat_of_int <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">/</span> rat_of_int <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> poly <span class="var">?p</span> <span class="main">(</span>rat_of_int <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rat_of_int <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> poly <span class="var">?p</span> <span class="main">(</span>rat_of_int <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_fun_pow <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> rat_of_int <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">p</span> <span class="main">(</span>rat_of_int <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_funE<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_funI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> p<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">p</span></span></span> <span class="main"><span class="main"><span class="main">^</span></span></span> <span class="free"><span class="free"><span class="free">k</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_fun_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> rat_of_int <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">p</span> <span class="main">(</span>rat_of_int <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_funE<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> rat_of_int <span class="main">(</span><span class="free">g</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">q</span> <span class="main">(</span>rat_of_int <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_funE<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_funI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> p<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">p</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">q</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p q poly_pcompose<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> comp_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_fun_sum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> poly_fun <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>infinite <span class="skolem">I</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> infinite<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">i</span> <span class="skolem">I</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> insert <span class="skolem">i</span> <span class="skolem">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> insert.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> insert.hyps<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> insert <span class="skolem">i</span> <span class="skolem">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> insert.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">i</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_fun_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> insert.hyps<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_fun_prod <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> poly_fun <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>infinite <span class="skolem">I</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> infinite<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">i</span> <span class="skolem">I</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> insert <span class="skolem">i</span> <span class="skolem">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> insert.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> insert.hyps<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> insert <span class="skolem">i</span> <span class="skolem">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> insert.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">i</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_fun_times<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> insert.hyps<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_fun_pochhammer <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_fun <span class="free">f</span> <span class="main">⟹</span> poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> pochhammer <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pochhammer_prod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_fun_gbinomial <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_fun <span class="free">f</span> <span class="main">⟹</span> poly_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">gchoose</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gbinomial_int_pochhammer' poly_fun_divide fact_dvd_pochhammer<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* theory *)</span>
</pre>
</div><div id="Monomial_Module">
<div class="head">
<h1>Theory Monomial_Module</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Monomial Modules›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Monomial_Module
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../Groebner_Bases/Reduced_GB.html">Groebner_Bases.Reduced_GB</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Properties of modules generated by sets of monomials, and (reduced) Gr\"obner bases thereof.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Sets of Monomials›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_monomial_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">::</span>zero<span class="main">)</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_monomial_set</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> is_monomial <span class="bound">p</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_monomial_setI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> is_monomial <span class="bound">p</span><span class="main">)</span> <span class="main">⟹</span> is_monomial_set <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_monomial_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_monomial_setD<span class="main">:</span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="free">A</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> is_monomial <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_monomial_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_monomial_set_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="free">B</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> is_monomial_set <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_monomial_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_monomial_set_Un<span class="main">:</span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span>is_monomial_set <span class="free">A</span> <span class="main">∧</span> is_monomial_set <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_monomial_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Modules›</span></span>

<span class="keyword1"><span class="command">context</span></span> term_powerprod
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> monomial_pmdl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> pmdl <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>lookup <span class="free">p</span> <span class="free">v</span><span class="main">)</span> <span class="free">v</span> <span class="main">∈</span> pmdl <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> pmdl_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> base<span class="main">:</span> module_0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pmdl.span_zero<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span> <span class="main">(</span>module_plus <span class="skolem">p</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>lookup <span class="main">(</span><span class="skolem">p</span> <span class="main">+</span> monom_mult <span class="skolem">c</span> <span class="skolem">t</span> <span class="skolem">b</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span>
            monomial <span class="main">(</span>lookup <span class="skolem">p</span> <span class="free">v</span><span class="main">)</span> <span class="free">v</span> <span class="main">+</span> monomial <span class="main">(</span>lookup <span class="main">(</span>monom_mult <span class="skolem">c</span> <span class="skolem">t</span> <span class="skolem">b</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> single_add lookup_add<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> step.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_monomial_setD<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> monomial <span class="skolem">d</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_monomial_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>lookup <span class="main">(</span>monom_mult <span class="skolem">c</span> <span class="skolem">t</span> <span class="skolem">b</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span> <span class="free">v</span> <span class="main">∈</span> pmdl <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b monom_mult_monomial lookup_single when_def pmdl.span_zero<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">⊕</span> <span class="skolem">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> monom_mult <span class="skolem">c</span> <span class="skolem">t</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b monom_mult_monomial<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> step.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> pmdl <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monom_mult_in_pmdl<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span><span class="main">)</span> <span class="free">v</span> <span class="main">∈</span> pmdl <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> step.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pmdl.span_add<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> monomial_pmdl_field<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> pmdl <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> keys <span class="main">(</span><span class="free">p</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">::</span>field<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monomial <span class="free">c</span> <span class="free">v</span> <span class="main">∈</span> pmdl <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>lookup <span class="free">p</span> <span class="free">v</span><span class="main">)</span> <span class="free">v</span> <span class="main">∈</span> pmdl <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_pmdl<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monom_mult <span class="main">(</span><span class="free">c</span> <span class="main">/</span> lookup <span class="free">p</span> <span class="free">v</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>monomial <span class="main">(</span>lookup <span class="free">p</span> <span class="free">v</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> pmdl <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pmdl_closed_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_mult_monomial splus_zero in_keys_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* term_powerprod *)</span>

<span class="keyword1"><span class="command">context</span></span> ordered_term
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> keys_monomial_pmdl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> pmdl <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> keys <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">f</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">f</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> pmdl_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> module_0
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span> <span class="main">(</span>module_plus <span class="skolem">p</span> <span class="skolem">f0</span> <span class="skolem">c</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> step<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="skolem">f0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_monomial_set_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">f0</span> <span class="main">=</span> <span class="main">{</span>lt <span class="skolem">f0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> keys_monomial<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> monomial_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Poly_Mapping.keys_add step<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> keys <span class="skolem">p</span> <span class="main">∪</span> keys <span class="main">(</span>monom_mult <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">f0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> keys <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> step<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">f</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> step<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> keys <span class="main">(</span>monom_mult <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">f0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> keys_monom_mult_subset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">(⊕)</span> <span class="skolem">s</span> <span class="main">`</span> keys <span class="skolem">f0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">⊕</span> lt <span class="skolem">f0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹keys <span class="skolem">f0</span> <span class="main">=</span> <span class="main">{</span>lt <span class="skolem">f0</span><span class="main">}</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">f0</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f0</span> <span class="main">∈</span> <span class="free">F</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f0</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> step<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> image_lt_monomial_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="main">`</span> monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">::</span>zero_neq_one<span class="main">)</span> <span class="main">`</span> lt <span class="main">`</span> <span class="free">F</span> <span class="main">=</span> lt <span class="main">`</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lt_monomial <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> image_eqI<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Reduction›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> red_setE2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"red <span class="free">B</span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">b</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"red <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="free">p</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"red_single <span class="free">p</span> <span class="free">q</span> <span class="skolem">b</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> red_setE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> red_single_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"red <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> red_setI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> red_monomial_keys<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"red <span class="main">{</span><span class="free">r</span><span class="main">}</span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>keys <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span>keys <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"red_single <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> red_singleton <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> cp0<span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="free">p</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">⊕</span> lt <span class="free">r</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q_def0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">-</span> monom_mult <span class="main">(</span>lookup <span class="free">p</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">⊕</span> lt <span class="free">r</span><span class="main">)</span> <span class="main">/</span> lc <span class="free">r</span><span class="main">)</span> <span class="skolem">s</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> red_single_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> monomial <span class="skolem">c</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_monomial_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ltr<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="free">r</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_monomial<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> lcr<span class="main">:</span> <span class="quoted"><span class="quoted">"lc <span class="free">r</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lc_monomial<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">⊕</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> q_def0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">-</span> monom_mult <span class="main">(</span>lookup <span class="free">p</span> <span class="skolem">u</span> <span class="main">/</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">s</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def ltr lcr <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p</span> <span class="main">-</span> monomial <span class="main">(</span><span class="main">(</span>lookup <span class="free">p</span> <span class="skolem">u</span> <span class="main">/</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def r_def monom_mult_monomial <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> q_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">-</span> monomial <span class="main">(</span>lookup <span class="free">p</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> cp0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="free">p</span> <span class="skolem">u</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def ltr <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> keys <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
      
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="free">q</span> <span class="main">=</span> keys <span class="free">p</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> keys <span class="main">(</span><span class="free">p</span> <span class="main">-</span> monomial <span class="main">(</span>lookup <span class="free">p</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span><span class="free">p</span> <span class="main">-</span> monomial <span class="main">(</span>lookup <span class="free">p</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="free">p</span> <span class="skolem">x</span> <span class="main">-</span> lookup <span class="main">(</span>monomial <span class="main">(</span>lookup <span class="free">p</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lookup_minus <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lookup_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="free">p</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lookup_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> keys <span class="free">p</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lookup <span class="free">p</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> keys <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">u</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"keys <span class="free">p</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span> <span class="main">⊆</span> keys <span class="main">(</span><span class="free">p</span> <span class="main">-</span> monomial <span class="main">(</span>lookup <span class="free">p</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> keys <span class="free">p</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> keys <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> keys <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="free">p</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span><span class="free">p</span> <span class="main">-</span> monomial <span class="main">(</span>lookup <span class="free">p</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_minus lookup_single<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> keys <span class="main">(</span><span class="free">p</span> <span class="main">-</span> monomial <span class="main">(</span>lookup <span class="free">p</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
      
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="main">(</span>keys <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>keys <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹keys <span class="free">q</span> <span class="main">=</span> keys <span class="free">p</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_Suc_Diff1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> finite_keys<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> red_monomial_monomial_setD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"red <span class="free">B</span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"red <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> red_setE2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_monomial_setD<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>keys <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span>keys <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> red_monomial_keys<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_monomial_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> is_red_monomial_monomial_setD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_red <span class="free">B</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"red <span class="free">B</span> <span class="free">p</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"red <span class="free">B</span> <span class="free">p</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_redE<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> red_monomial_monomial_setD<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> is_red_monomial_monomial_set_in_pmdl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_monomial <span class="free">p</span> <span class="main">⟹</span> is_monomial_set <span class="free">B</span> <span class="main">⟹</span> is_red <span class="free">B</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">∈</span> pmdl <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> red_rtranclp_0_in_pmdl r_into_rtranclp is_red_monomial_monomial_setD<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> red_rtrancl_monomial_monomial_set_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>red <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtranclp_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> base
  <span class="keyword1"><span class="command">from</span></span> refl <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> base<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> step.hyps<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> step.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"red <span class="free">B</span> <span class="free">p</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> red_monomial_monomial_setD<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> step.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> step.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_red <span class="free">B</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_redI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> irred_0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_red_monomial_lt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_red <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">::</span>field<span class="main">)</span> <span class="main">`</span> lt <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> is_red <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">`</span> lt <span class="main">`</span> <span class="free">B</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_red <span class="var">?B</span> <span class="skolem">p</span> <span class="main">⟷</span> is_red <span class="free">B</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_red <span class="var">?B</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> adds<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">f</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_red_addsE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">f</span> <span class="main">∈</span> lt <span class="main">`</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> lt <span class="main">`</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> image_lt_monomial_lt<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">f</span> <span class="main">=</span> lt <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> keys <span class="skolem">p</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> adds <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_red <span class="free">B</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_red_addsI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_red <span class="free">B</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> adds<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_red_addsE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b</span> <span class="main">∈</span> lt <span class="main">`</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> image_lt_monomial_lt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> lt <span class="main">`</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b</span> <span class="main">=</span> lt <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monomial_0_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> keys <span class="skolem">p</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> adds <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">f</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_red <span class="var">?B</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_red_addsI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* ordered_term *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Gr\"obner Bases›</span></span>

<span class="keyword1"><span class="command">context</span></span> gd_term
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> monomial_set_is_GB<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_Groebner_basis <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> GB_alt_1
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> pmdl <span class="free">G</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>red <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">f</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> poly_mapping_plus_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">f</span> <span class="skolem">c</span> <span class="skolem">t</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="var">?f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_keys_plusI1<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="quoted"><span class="quoted">‹<span class="var">?f</span> <span class="main">∈</span> pmdl <span class="free">G</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> keys_monomial_pmdl<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"red <span class="free">G</span> <span class="var">?f</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> red_setI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">g</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> component_of_term <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lp <span class="skolem">g</span> <span class="keyword1">adds</span> pp_of_term <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adds_term_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>pp_of_term <span class="skolem">t</span> <span class="main">-</span> lp <span class="skolem">g</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adds_minus splus_def term_of_pair_pair<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="var">?f</span> <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_add in_keys_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"red_single <span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">(</span>pp_of_term <span class="skolem">t</span> <span class="main">-</span> lp <span class="skolem">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> red_single_def <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="var">?f</span>›</span></span> 2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lc_not_0<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">=</span> monom_mult <span class="main">(</span><span class="skolem">c</span> <span class="main">/</span> lc <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span>pp_of_term <span class="skolem">t</span> <span class="main">-</span> lp <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span>monomial <span class="main">(</span>lc <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_mult_monomial eq<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_monomial_set_def <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">=</span> monom_mult <span class="main">(</span><span class="skolem">c</span> <span class="main">/</span> lc <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span>pp_of_term <span class="skolem">t</span> <span class="main">-</span> lp <span class="skolem">g</span><span class="main">)</span> <span class="skolem">g</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> monomial_eq_itself<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> pmdl <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pmdl_closed_red<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> subset_refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>red <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">f</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹red <span class="free">G</span> <span class="var">?f</span> <span class="skolem">f</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">d</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dgrad<span class="main">:</span> <span class="quoted"><span class="quoted">"dickson_grading <span class="main">(</span><span class="free">d</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> nat<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="free">m</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin_comps<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>component_of_term <span class="main">`</span> Keys <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> F_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> F_monom<span class="main">:</span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="main">(</span><span class="free">F</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">::</span>field<span class="main">)</span> set<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The proof of the following lemma could be simplified, analogous to homogeneous ideals.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reduced_GB_subset_monic_dgrad_p_set<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_GB <span class="free">F</span> <span class="main">⊆</span> monic <span class="main">`</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> subset_refl <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F'</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">`</span> <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">`</span> <span class="skolem">F'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"inj_on lt <span class="skolem">F'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_imageE_inj<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="skolem">F'</span><span class="main">.</span> <span class="main">∀</span><span class="bound">f'</span><span class="main">∈</span><span class="skolem">F'</span><span class="main">.</span> lt <span class="bound">f'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="bound">f</span> <span class="main">⟶</span> <span class="bound">f'</span> <span class="main">=</span> <span class="bound">f</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">⊆</span> <span class="skolem">F'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F'</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="skolem">thesis</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="skolem">G</span> <span class="main">⟹</span> lt <span class="bound">g</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="skolem">f</span> <span class="main">⟹</span> <span class="skolem">thesis</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">thesis</span> <span class="skolem">f</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?K</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">`</span> Keys <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> pp_of_term <span class="bound">t</span> <span class="main">∈</span> dgrad_set <span class="free">d</span> <span class="free">m</span> <span class="main">∧</span> component_of_term <span class="bound">t</span> <span class="main">∈</span> <span class="var">?K</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f'</span></span> <span class="main">∈</span> <span class="skolem">F'</span><span class="main">.</span> lt <span class="bound">f'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="skolem">f</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> dgrad fin_comps <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"almost_full_on <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Dickson_term<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transp_on <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> transp_onI <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> adds_term_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wfp_on <span class="main">(</span>strict <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span><span class="main">)</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> af_trans_imp_wf<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">f</span> <span class="main">∈</span> lt <span class="main">`</span> <span class="var">?Q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> that<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">f</span> <span class="main">∈</span> lt <span class="main">`</span> <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> lt <span class="main">`</span> <span class="skolem">F'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">f</span> <span class="main">∈</span> lt <span class="main">`</span> <span class="skolem">F'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> adds_term_refl <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">`</span> <span class="var">?Q</span> <span class="main">⊆</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> lt <span class="main">`</span> <span class="var">?Q</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="var">?Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> lt <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="skolem">F'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F'</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> F_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">q</span> <span class="main">∈</span> keys <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_in_keys<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pp_of_term <span class="main">(</span>lt <span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> pp_of_term <span class="main">`</span> keys <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> dgrad_p_set <span class="free">d</span> <span class="free">m</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> dgrad_set <span class="free">d</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_p_set_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"pp_of_term <span class="skolem">s</span> <span class="main">∈</span> dgrad_set <span class="free">d</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> s<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">q</span> <span class="main">∈</span> keys <span class="skolem">q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">q</span> <span class="main">∈</span> Keys <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_KeysI<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">s</span> <span class="main">∈</span> <span class="var">?K</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> lt <span class="main">`</span> <span class="var">?Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t_min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> strict <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="bound">s</span> <span class="skolem">t</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">∉</span> lt <span class="main">`</span> <span class="var">?Q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wfp_onE_min<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="var">?Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> lt <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">F'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> adds<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="skolem">F'</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">f'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="skolem">g</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">f'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> adds <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_term_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="skolem">F'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">f'</span> <span class="main">∈</span> lt <span class="main">`</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> t_min <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> strict <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="main">(</span>lt <span class="skolem">f'</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">f'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="skolem">g</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="skolem">f'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">f'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="skolem">g</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">f'</span> <span class="main">=</span> lt <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_term_antisym<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹inj_on lt <span class="skolem">F'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="skolem">F'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">F'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onD<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">F'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_red <span class="skolem">G</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> pmdl <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">q</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> F_monom that<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">f</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> keys_monomial_pmdl<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_term_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">q</span>›</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_red_addsI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pmdl <span class="skolem">G</span> <span class="main">⊆</span> pmdl <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pmdl.span_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> dgrad fin_comps F_sub
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_reduced_GB <span class="main">(</span>monic <span class="main">`</span> <span class="skolem">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_reduced_GB_def GB_image_monic
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI image_monic_is_auto_reduced image_monic_is_monic_set<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> dgrad <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_Groebner_basis <span class="skolem">G</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> isGB_I_is_red<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊆</span> <span class="free">F</span>›</span></span> F_sub <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">⊆</span> dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> pmdl <span class="skolem">G</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> pmdl <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹pmdl <span class="skolem">G</span> <span class="main">⊆</span> pmdl <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_red <span class="skolem">G</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_auto_reduced <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_auto_reduced_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI notI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊆</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">with</span></span> F_monom <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_monomial_setD<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> keys_g<span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="skolem">g</span> <span class="main">=</span> <span class="main">{</span>lt <span class="skolem">g</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> keys_monomial<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_red <span class="main">(</span><span class="skolem">G</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span> <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> <span class="skolem">G</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> adds<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_red_addsE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> <span class="skolem">F'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">≠</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">g</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> lt <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_g<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g'</span> <span class="main">∈</span> <span class="skolem">F'</span>›</span></span> adds <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g'</span> <span class="main">≠</span> <span class="skolem">g</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> monic <span class="main">`</span> <span class="skolem">G</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> monic <span class="main">`</span> <span class="skolem">G</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> monic <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monic_0_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pmdl <span class="main">(</span>monic <span class="main">`</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> pmdl <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pmdl_image_monic
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pmdl <span class="free">F</span> <span class="main">⊆</span> pmdl <span class="skolem">G</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> pmdl.span_subset_spanI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> pmdl <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pmdl.span_base<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> dgrad
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊆</span> <span class="free">F</span>›</span></span> F_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">⊆</span> dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹pmdl <span class="skolem">G</span> <span class="main">⊆</span> pmdl <span class="free">F</span>›</span></span> 2 <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> pmdl <span class="free">F</span>›</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>›</span></span> F_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>red <span class="skolem">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">f</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_red_implies_0_red_dgrad_p_set<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> pmdl <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> red_rtranclp_0_in_pmdl<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reduced_GB <span class="free">F</span> <span class="main">=</span> monic <span class="main">`</span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_unique_dgrad_p_set<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊆</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> monic <span class="main">`</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> image_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> reduced_GB_is_monomial_set_dgrad_p_set<span class="main">:</span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="main">(</span>reduced_GB <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_monomial_setI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> reduced_GB <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> monic <span class="main">`</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> reduced_GB_subset_monic_dgrad_p_set<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> monic <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> F_monom this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_monomial_setD<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>keys <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> is_monomial_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lc <span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lc_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> lc <span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">g</span> <span class="main">=</span> <span class="main">(⊕)</span> <span class="main">0</span> <span class="main">`</span> keys <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_monom_mult monic_def g<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> keys <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> image_cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> splus_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">(</span>keys <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> is_monomial_def image_ident<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_red_reduced_GB_monomial_dgrad_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>component_of_term <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pp_of_term <span class="main">`</span> <span class="free">S</span> <span class="main">⊆</span> dgrad_set <span class="free">d</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_red <span class="main">(</span>reduced_GB <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> is_red <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">::</span>field<span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>component_of_term <span class="main">`</span> Keys <span class="var">?F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Keys_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?F</span> <span class="main">⊆</span> dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dgrad_p_set_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_monomial_setI monomial_is_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reduced_GB <span class="var">?F</span> <span class="main">⊆</span> monic <span class="main">`</span> <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_subset_monic_dgrad_p_set<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monic_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> image_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_GB <span class="var">?F</span> <span class="main">⊆</span> <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_red <span class="main">(</span>reduced_GB <span class="var">?F</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">⟷</span> is_red <span class="var">?F</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_red <span class="main">(</span>reduced_GB <span class="var">?F</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_red <span class="var">?F</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_red_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_red <span class="var">?F</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="var">?F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> adds1<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">f</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_red_addsE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> pmdl <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pmdl.span_base<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> dgrad 1 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_Groebner_basis <span class="main">(</span>reduced_GB <span class="var">?F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_is_GB_dgrad_p_set<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> pmdl <span class="var">?F</span>›</span></span> dgrad 1 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> pmdl <span class="main">(</span>reduced_GB <span class="var">?F</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> reduced_GB_pmdl_dgrad_p_set<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> reduced_GB <span class="var">?F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> GB_adds_lt<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>3<span class="main">)</span> adds1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_term_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> reduced_GB <span class="var">?F</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> keys <span class="skolem">p</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_red <span class="main">(</span>reduced_GB <span class="var">?F</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_red_addsI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> is_red_reduced_GB_monomial_lt_GB_dgrad_p_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>component_of_term <span class="main">`</span> Keys <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_red <span class="main">(</span>reduced_GB <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">::</span>field<span class="main">)</span> <span class="main">`</span> lt <span class="main">`</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> is_red <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lt <span class="main">`</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">`</span> <span class="var">?S</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">⊆</span> Keys <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> lt_in_keys in_KeysI<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">`</span> <span class="var">?S</span> <span class="main">⊆</span> component_of_term <span class="main">`</span> Keys <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"pp_of_term <span class="main">`</span> <span class="var">?S</span> <span class="main">⊆</span> pp_of_term <span class="main">`</span> Keys <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> image_mono<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>component_of_term <span class="main">`</span> <span class="var">?S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pp_of_term <span class="main">`</span> <span class="var">?S</span> <span class="main">⊆</span> dgrad_set <span class="free">d</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pp_of_term <span class="main">`</span> Keys <span class="free">G</span> <span class="main">⊆</span> dgrad_set <span class="free">d</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dgrad_p_set_def Keys_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_red <span class="main">(</span>reduced_GB <span class="var">?G</span><span class="main">)</span> <span class="main">=</span> is_red <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_red_reduced_GB_monomial_dgrad_set<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> is_red <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_red_monomial_lt<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reduced_GB_monomial_lt_reduced_GB_dgrad_p_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>component_of_term <span class="main">`</span> Keys <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reduced_GB <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> lt <span class="main">`</span> reduced_GB <span class="free">F</span><span class="main">)</span> <span class="main">=</span> monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">::</span>field<span class="main">)</span> <span class="main">`</span> lt <span class="main">`</span> reduced_GB <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"reduced_GB <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">`</span> lt <span class="main">`</span> <span class="var">?G</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> dgrad assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="var">?G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ar<span class="main">:</span> <span class="quoted"><span class="quoted">"is_auto_reduced <span class="var">?G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_nonzero_dgrad_p_set<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> reduced_GB_is_auto_reduced_dgrad_p_set<span class="main"><span class="keyword3">,</span></span>
        <span class="operator">rule</span> finite_reduced_GB_dgrad_p_set<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_imageI<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_reduced_GB <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_reduced_GB_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI monomial_set_is_GB<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_monomial_setI monomial_is_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_monic_set <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_monic_set_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monomial_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_auto_reduced <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_auto_reduced_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI notI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="var">?F</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="var">?G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="main">(</span>lt <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_red <span class="main">(</span><span class="var">?F</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="var">?F</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> adds1<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">f'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_red_addsE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="var">?F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">≠</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> <span class="var">?G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="main">(</span>lt <span class="skolem">g'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> keys <span class="skolem">f</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> lt <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> ar <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="var">?G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_red <span class="main">(</span><span class="var">?G</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_auto_reducedD<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_red <span class="main">(</span><span class="var">?G</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span> <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_red_addsI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g'</span> <span class="main">∈</span> <span class="var">?G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">≠</span> <span class="skolem">f</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> <span class="var">?G</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f f'<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g'</span> <span class="main">∈</span> <span class="var">?G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> <span class="var">?G</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="var">?G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> <span class="var">?G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g</span> <span class="main">∈</span> keys <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_in_keys<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> adds1 <span class="keyword3"><span class="command">show</span></span> adds2<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v f' lt_monomial<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> refl<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* gd_term *)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* theory *)</span>
</pre>
</div><div id="Dube_Prelims">
<div class="head">
<h1>Theory Dube_Prelims</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Alexander Maletzky *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Dube_Prelims
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../Groebner_Bases/General.html">Groebner_Bases.General</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Sets›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_geq_ex_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≥</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">B</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"card <span class="free">B</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">thesis</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> base<span class="main">:</span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> base<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{}</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> ind<span class="main">:</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ind<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">B</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ind<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> card <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> card.infinite<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">-</span> <span class="skolem">B</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">-</span> <span class="skolem">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">=</span> <span class="skolem">B</span>›</span></span> card <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∉</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">c</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ind<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">thm</span></span> card.insert_remove
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">B</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">c</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>insert <span class="skolem">c</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span><span class="skolem">B</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">c</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card.insert_remove<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> finite_subset<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">B</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">c</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">c</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">B</span>›</span></span> card <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">c</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Un_subset_iff
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">c</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_2_E_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">y</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> card_seteq<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> card.infinite <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≤</span> card <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_2_E<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="free">y</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_2_E_1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Sums›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_tail_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> <span class="main">(</span><span class="free">b</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⟹</span> sum <span class="free">f</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="free">f</span> <span class="free">b</span> <span class="main">+</span> sum <span class="free">f</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_pred add.commute not_le sum.cl_ivl_Suc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_atLeast_Suc_shift<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> sum <span class="free">f</span> <span class="main">{</span>Suc <span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="free">a</span><span class="main">..</span><span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_pred' sum.shift_bounds_cl_Suc_ivl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_split_nat_ivl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> Suc <span class="free">j</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> sum <span class="free">f</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">j</span><span class="main">}</span> <span class="main">+</span> sum <span class="free">f</span> <span class="main">{</span>Suc <span class="free">j</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> sum <span class="free">f</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 le_Suc_ex sum.ub_add_nat<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> count_list<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> count_list_eq_0_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"count_list <span class="free">xs</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∉</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> count_list_append<span class="main">:</span> <span class="quoted"><span class="quoted">"count_list <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> count_list <span class="free">xs</span> <span class="free">x</span> <span class="main">+</span> count_list <span class="free">ys</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> count_list_map_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"count_list <span class="free">xs</span> <span class="free">x</span> <span class="main">≤</span> count_list <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> count_list_gr_1_E<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> count_list <span class="free">xs</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">i</span> <span class="free">j</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> <span class="free">j</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count_list <span class="free">xs</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> count_list_eq_0_iff not_not<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="skolem"><span class="skolem">zs</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="free">x</span> <span class="main">#</span> <span class="skolem">zs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> set <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> split_list_first<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"count_list <span class="free">xs</span> <span class="free">x</span> <span class="main">=</span> Suc <span class="main">(</span>count_list <span class="skolem">zs</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_list_append<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count_list <span class="skolem">zs</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="skolem">zs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> count_list_eq_0_iff not_not<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="skolem">zs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">zs</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ys</span> <span class="main">&lt;</span> length <span class="skolem">ys</span> <span class="main">+</span> Suc <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="skolem">zs</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ys</span> <span class="main">+</span> Suc <span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xs<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> length <span class="skolem">ys</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xs<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">ys</span> <span class="main">+</span> Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> xs <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">=</span> <span class="skolem">zs</span> <span class="main">!</span> <span class="skolem">j</span>›</span></span> nth_append_length_plus nth_Cons_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> listset<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> listset_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"listset <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="free">x</span><span class="main">.</span> <span class="main">(#)</span> <span class="bound">y</span> <span class="main">`</span> listset <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_Cons_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> listset_ConsI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">ys'</span> <span class="main">∈</span> listset <span class="free">xs</span> <span class="main">⟹</span> <span class="free">ys</span> <span class="main">=</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys'</span> <span class="main">⟹</span> <span class="free">ys</span> <span class="main">∈</span> listset <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_Cons_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> listset_ConsE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">∈</span> listset <span class="main">(</span><span class="free">x</span><span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">y</span> <span class="free">ys'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys'</span> <span class="main">∈</span> listset <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_Cons_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> listsetI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">=</span> length <span class="free">xs</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span> <span class="free">ys</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">ys</span> <span class="main">∈</span> listset <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
     <span class="main">(</span><span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">smt</span> Suc_mono list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mem_Collect_eq nth_Cons_0 nth_tl set_Cons_def zero_less_Suc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> listsetD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">∈</span> listset <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span> <span class="free">ys</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">=</span> length <span class="free">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="free">ys</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons.prems <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">ys'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys'</span> <span class="main">∈</span> listset <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ys'</span> <span class="main">=</span> length <span class="skolem">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="skolem">xs</span><span class="main">.</span> <span class="skolem">ys'</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ys'</span> <span class="main">=</span> length <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="skolem">xs</span> <span class="main">⟹</span> <span class="skolem">ys'</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">xs</span> <span class="main">!</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI allI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">x</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ys<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys'</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="skolem">xs</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ys <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> Suc <span class="skolem">j</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ys 1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span> <span class="free">ys</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> listset_singletonI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">ys</span> <span class="main">=</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">ys</span> <span class="main">∈</span> listset <span class="main">[</span><span class="free">A</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> listset_singletonE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">∈</span> listset <span class="main">[</span><span class="free">A</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">a</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> listset_doubletonI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">ys</span> <span class="main">=</span> <span class="main">[</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">ys</span> <span class="main">∈</span> listset <span class="main">[</span><span class="free">A</span><span class="main">,</span> <span class="free">B</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_Cons_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> listset_doubletonE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">∈</span> listset <span class="main">[</span><span class="free">A</span><span class="main">,</span> <span class="free">B</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">a</span> <span class="free">b</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> <span class="main">[</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_Cons_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> listset_appendI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ys1</span> <span class="main">∈</span> listset <span class="free">xs1</span> <span class="main">⟹</span> <span class="free">ys2</span> <span class="main">∈</span> listset <span class="free">xs2</span> <span class="main">⟹</span> <span class="free">ys</span> <span class="main">=</span> <span class="free">ys1</span> <span class="main">@</span> <span class="free">ys2</span> <span class="main">⟹</span> <span class="free">ys</span> <span class="main">∈</span> listset <span class="main">(</span><span class="free">xs1</span> <span class="main">@</span> <span class="free">xs2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs1</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">ys1</span></span> <span class="quoted"><span class="free">ys2</span></span><span class="main">)</span>
      <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> listset.simps <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> listset_ConsE <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> listset_ConsI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> listset_appendE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">∈</span> listset <span class="main">(</span><span class="free">xs1</span> <span class="main">@</span> <span class="free">xs2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ys1</span> <span class="free">ys2</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys1</span> <span class="main">∈</span> listset <span class="free">xs1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys2</span> <span class="main">∈</span> listset <span class="free">xs2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> <span class="free">ys1</span> <span class="main">@</span> <span class="free">ys2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs1</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> listset <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> Nil<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">∈</span> listset <span class="free">xs2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Nil<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">∈</span> listset <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">xs1</span> <span class="main">@</span> <span class="free">xs2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">ys'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys'</span> <span class="main">∈</span> listset <span class="main">(</span><span class="skolem">xs1</span> <span class="main">@</span> <span class="free">xs2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> _ this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys1</span></span> <span class="skolem"><span class="skolem">ys2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ys1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys1</span> <span class="main">∈</span> listset <span class="skolem">xs1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys2</span> <span class="main">∈</span> listset <span class="free">xs2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ys'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys'</span> <span class="main">=</span> <span class="skolem">ys1</span> <span class="main">@</span> <span class="skolem">ys2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.hyps<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.prems<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">x</span>›</span></span> ys1 refl <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys1</span> <span class="main">∈</span> listset <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys1</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">ys2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ys ys'<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> listset_map_imageI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ys'</span> <span class="main">∈</span> listset <span class="free">xs</span> <span class="main">⟹</span> <span class="free">ys</span> <span class="main">=</span> map <span class="free">f</span> <span class="free">ys'</span> <span class="main">⟹</span> <span class="free">ys</span> <span class="main">∈</span> listset <span class="main">(</span>map <span class="main">(</span><span class="main">(`)</span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">ys'</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> listset.simps <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> listset_ConsE <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> listset_ConsI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> listset_map_imageE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">∈</span> listset <span class="main">(</span>map <span class="main">(</span><span class="main">(`)</span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ys'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys'</span> <span class="main">∈</span> listset <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> map <span class="free">f</span> <span class="free">ys'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">from</span></span> Nil<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> map <span class="free">f</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> _ <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Nil<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">∈</span> listset <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">x</span> <span class="main">#</span> map <span class="main">(</span><span class="main">(`)</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">ys'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys'</span> <span class="main">∈</span> listset <span class="main">(</span>map <span class="main">(</span><span class="main">(`)</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> _ this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys1</span></span> <span class="keyword2"><span class="keyword">where</span></span> ys1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys1</span> <span class="main">∈</span> listset <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ys'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys'</span> <span class="main">=</span> map <span class="free">f</span> <span class="skolem">ys1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.hyps<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">x</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span> <span class="main">∈</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">y1</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.prems<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y1</span> <span class="main">∈</span> <span class="skolem">x</span>›</span></span> ys1 refl <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span> <span class="main">#</span> <span class="skolem">ys1</span> <span class="main">∈</span> listset <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ys ys' y<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> listset_permE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">∈</span> listset <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="main">{..&lt;</span>length <span class="free">xs</span><span class="main">}</span> <span class="main">{..&lt;</span>length <span class="free">xs'</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span> <span class="free">xs'</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="free">f</span> <span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ys'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys'</span> <span class="main">∈</span> listset <span class="free">xs'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ys'</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">ys</span> <span class="main">⟹</span> <span class="free">ys'</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">!</span> <span class="free">f</span> <span class="bound">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> len_ys<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{..&lt;</span>length <span class="free">xs</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{..&lt;</span>length <span class="free">xs'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> len_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">xs'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ys'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys'</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">ys</span> <span class="main">!</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">ys</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys'</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">!</span> <span class="free">f</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ys</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ys'_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys'</span> <span class="main">∈</span> listset <span class="free">xs'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> listsetI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ys'</span> <span class="main">=</span> length <span class="free">xs'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ys'_def len_ys len_xs<span class="main">)</span>

      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">xs'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> len_xs<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> len_ys<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys'</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">!</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> listsetD<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">xs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span>length <span class="free">xs</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="main">{..&lt;</span>length <span class="free">xs</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{..&lt;</span>length <span class="free">xs'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> len_xs<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">xs'</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys'</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="free">xs'</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ys'</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ys'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> listset_closed_map<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">∈</span> listset <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="free">ys</span> <span class="main">∈</span> listset <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">from</span></span> Nil<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">ys'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys'</span> <span class="main">∈</span> listset <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsE<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">x</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.prems<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="skolem">ys'</span> <span class="main">∈</span> listset <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.hyps<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x0</span> <span class="skolem">y0</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x0</span> <span class="main">∈</span> set <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x0</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y0</span> <span class="main">∈</span> <span class="skolem">x0</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y0</span> <span class="main">∈</span> <span class="skolem">x0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.prems<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ys<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> listset_closed_map2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys1</span> <span class="main">∈</span> listset <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys2</span> <span class="main">∈</span> listset <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y1</span> <span class="bound">y2</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="bound">y1</span> <span class="main">∈</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">y2</span> <span class="main">∈</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">y1</span> <span class="bound">y2</span> <span class="main">∈</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map2 <span class="free">f</span> <span class="free">ys1</span> <span class="free">ys2</span> <span class="main">∈</span> listset <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys1</span></span> <span class="quoted"><span class="free">ys2</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">from</span></span> Nil<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">ys1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span> <span class="main">∈</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys1'</span> <span class="main">∈</span> listset <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ys1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys1</span> <span class="main">=</span> <span class="skolem">y1</span> <span class="main">#</span> <span class="skolem">ys1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="skolem"><span class="skolem">ys2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y2</span> <span class="main">∈</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys2'</span> <span class="main">∈</span> listset <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ys2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys2</span> <span class="main">=</span> <span class="skolem">y2</span> <span class="main">#</span> <span class="skolem">ys2'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsE<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">y1</span> <span class="main">∈</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y2</span> <span class="main">∈</span> <span class="skolem">x</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y1</span> <span class="skolem">y2</span> <span class="main">∈</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.prems<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map2 <span class="free">f</span> <span class="skolem">ys1'</span> <span class="skolem">ys2'</span> <span class="main">∈</span> listset <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.hyps<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x'</span> <span class="skolem">y1'</span> <span class="skolem">y2'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> set <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y1'</span> <span class="main">∈</span> <span class="skolem">x'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y2'</span> <span class="main">∈</span> <span class="skolem">x'</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y1'</span> <span class="skolem">y2'</span> <span class="main">∈</span> <span class="skolem">x'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.prems<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ys1 ys2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> listset_empty_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"listset <span class="free">xs</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟷</span> <span class="main">{}</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> listset_Cons <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> listset.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> listset_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">ys</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">⊆</span> <span class="free">ys</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"listset <span class="free">xs</span> <span class="main">⊆</span> listset <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">zs'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs'</span> <span class="main">∈</span> listset <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="skolem"><span class="skolem">zs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">∈</span> listset <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zs'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zs'</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsE<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">!</span> <span class="main">0</span> <span class="main">⊆</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">!</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.prems<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊆</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> zs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">∈</span> listset <span class="skolem">ys</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"listset <span class="skolem">xs</span> <span class="main">⊆</span> listset <span class="skolem">ys</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.hyps<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">ys</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">!</span> Suc <span class="skolem">i</span> <span class="main">⊆</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">!</span> Suc <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.prems<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">⊆</span> <span class="skolem">ys</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs'</span> <span class="main">∈</span> listset <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zs' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* theory *)</span>
</pre>
</div><div id="Hilbert_Function">
<div class="head">
<h1>Theory Hilbert_Function</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Alexander Maletzky *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Direct Decompositions and Hilbert Functions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Hilbert_Function
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Dube_Prelims.html">Dube_Prelims</a> <a href="Degree_Section.html">Degree_Section</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Permutation.html">HOL-Library.Permutation</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Direct Decompositions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The main reason for defining <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>direct_decomp›</span></span></span></span> in terms of lists rather than sets is that
  lemma <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>direct_decomp_direct_decomp›</span></span></span></span> can be proved easier. At some point one could invest the time
  to re-define <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>direct_decomp›</span></span></span></span> in terms of sets (possibly adding a couple of further assumptions to
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>direct_decomp_direct_decomp›</span></span></span></span>).›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">direct_decomp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>comm_monoid_add set list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">direct_decomp</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="main">⟷</span> bij_betw sum_list <span class="main">(</span>listset <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> direct_decompI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"inj_on sum_list <span class="main">(</span>listset <span class="free">ss</span><span class="main">)</span> <span class="main">⟹</span> sum_list <span class="main">`</span> listset <span class="free">ss</span> <span class="main">=</span> <span class="free">A</span> <span class="main">⟹</span> direct_decomp <span class="free">A</span> <span class="free">ss</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> direct_decomp_def bij_betw_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> direct_decompI_alt<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">qs</span><span class="main">.</span> <span class="bound">qs</span> <span class="main">∈</span> listset <span class="free">ss</span> <span class="main">⟹</span> sum_list <span class="bound">qs</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">∃!</span><span class="bound"><span class="bound">qs</span></span><span class="main">∈</span>listset <span class="free">ss</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> sum_list <span class="bound">qs</span><span class="main">)</span> <span class="main">⟹</span>
    direct_decomp <span class="free">A</span> <span class="free">ss</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> direct_decomp_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bij_betwI'<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> direct_decompD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="free">ss</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">qs</span> <span class="main">∈</span> listset <span class="free">ss</span> <span class="main">⟹</span> sum_list <span class="free">qs</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"inj_on sum_list <span class="main">(</span>listset <span class="free">ss</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">`</span> listset <span class="free">ss</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> direct_decomp_def bij_betw_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> direct_decompE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">qs</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">qs</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> sum_list <span class="free">qs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> direct_decomp_def bij_betw_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> direct_decomp_unique<span class="main">:</span>
  <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="free">ss</span> <span class="main">⟹</span> <span class="free">qs</span> <span class="main">∈</span> listset <span class="free">ss</span> <span class="main">⟹</span> <span class="free">qs'</span> <span class="main">∈</span> listset <span class="free">ss</span> <span class="main">⟹</span> sum_list <span class="free">qs</span> <span class="main">=</span> sum_list <span class="free">qs'</span> <span class="main">⟹</span>
    <span class="free">qs</span> <span class="main">=</span> <span class="free">qs'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> direct_decompD <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> direct_decomp_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="main">[</span><span class="free">A</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompI_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">qs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="main">[</span><span class="free">A</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">q</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_singletonE<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound"><span class="bound">qs</span></span><span class="main">∈</span>listset <span class="main">[</span><span class="free">A</span><span class="main">]</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> sum_list <span class="bound">qs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ex1I conjI allI impI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> refl <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">a</span><span class="main">]</span> <span class="main">∈</span> listset <span class="main">[</span><span class="free">A</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_singletonI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">qs</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="main">[</span><span class="free">A</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="main">[</span><span class="free">A</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">b</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_singletonE<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* TODO: Move. *)</span>
<span class="keyword1"><span class="command">lemma</span></span> mset_bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="main">{..&lt;</span>length <span class="free">xs</span><span class="main">}</span> <span class="main">{..&lt;</span>length <span class="free">ys</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">!</span> <span class="free">f</span> <span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mset <span class="free">xs</span> <span class="main">=</span> mset <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">xs</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">xs</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">ys</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_def lessThan_atLeast0<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(!)</span> <span class="free">ys</span> <span class="main">∘</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> map <span class="var">?f</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">xs</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> list_eq_iff_nth_eq
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">!</span> <span class="free">f</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">xs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> map <span class="main">(</span><span class="main">(!)</span> <span class="free">ys</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">xs</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> map <span class="main">(</span><span class="main">(!)</span> <span class="free">ys</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">xs</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"mset <span class="free">xs</span> <span class="main">=</span> mset <span class="main">(</span>map <span class="var">?f</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">xs</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> image_mset <span class="main">(</span><span class="main">(!)</span> <span class="free">ys</span><span class="main">)</span> <span class="main">(</span>image_mset <span class="free">f</span> <span class="main">(</span>mset_set <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">xs</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> image_mset.comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> image_mset <span class="main">(</span><span class="main">(!)</span> <span class="free">ys</span><span class="main">)</span> <span class="main">(</span>mset_set <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">ys</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_mset_mset_set 2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> mset <span class="main">(</span>map <span class="main">(</span><span class="main">(!)</span> <span class="free">ys</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">ys</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mset <span class="free">xs</span> <span class="main">=</span> mset <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> map_nth<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> direct_decomp_perm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="free">ss1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"perm <span class="free">ss1</span> <span class="free">ss2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="free">ss2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> len_ss1<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ss1</span> <span class="main">=</span> length <span class="free">ss2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> perm_length<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="main">{..&lt;</span>length <span class="free">ss1</span><span class="main">}</span> <span class="main">{..&lt;</span>length <span class="free">ss2</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">ss1</span><span class="main">.</span> <span class="free">ss1</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">ss2</span> <span class="main">!</span> <span class="bound">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> permutation_Ex_bij<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> <span class="main">{..&lt;</span>length <span class="free">ss2</span><span class="main">}</span> <span class="main">{..&lt;</span>length <span class="free">ss1</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">ss2</span> <span class="main">⟹</span> <span class="free">ss1</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">ss2</span> <span class="main">!</span> <span class="skolem">f</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> len_ss1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> inv_into <span class="main">{..&lt;</span>length <span class="free">ss2</span><span class="main">}</span> <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> f_bij <span class="keyword1"><span class="command">have</span></span> g_bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">g</span> <span class="main">{..&lt;</span>length <span class="free">ss1</span><span class="main">}</span> <span class="main">{..&lt;</span>length <span class="free">ss2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> g_def len_ss1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_inv_into<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ss1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that f_bij <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">{..&lt;</span>length <span class="free">ss2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_def len_ss1<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f_inv_into_f g_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> g_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ss2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> f_bij <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="main">{..&lt;</span>length <span class="free">ss2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span>length <span class="free">ss2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss2</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">ss1</span> <span class="main">!</span> <span class="skolem">g</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ss1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span>length <span class="free">ss2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> len_ss1<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">g</span> <span class="main">`</span> <span class="main">{..&lt;</span>length <span class="free">ss2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> g_bij <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{..&lt;</span>length <span class="free">ss2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> len_ss1 bij_betw_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ss2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">ss1</span> <span class="main">!</span> <span class="skolem">g</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">ss2</span> <span class="main">!</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> f<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f_g<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompI_alt<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">qs2</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs2</span> <span class="main">∈</span> listset <span class="free">ss2</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs1</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs1_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs1</span> <span class="main">∈</span> listset <span class="free">ss1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> len_qs1<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">qs1</span> <span class="main">=</span> length <span class="skolem">qs2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="skolem">qs2</span> <span class="main">⟹</span> <span class="skolem">qs1</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">qs2</span> <span class="main">!</span> <span class="skolem">f</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f_bij f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_permE<span class="main">)</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">qs2</span> <span class="main">∈</span> listset <span class="free">ss2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">qs2</span> <span class="main">=</span> length <span class="free">ss2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> f_bij <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> <span class="main">{..&lt;</span>length <span class="skolem">qs1</span><span class="main">}</span> <span class="main">{..&lt;</span>length <span class="skolem">qs2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> len_qs1 len_ss1<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"mset <span class="skolem">qs1</span> <span class="main">=</span> mset <span class="skolem">qs2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mset_bij<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> len_qs1<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs2</span> <span class="main">=</span> sum_list <span class="skolem">qs1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> sum_mset_sum_list<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> qs1_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompD<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs2</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qs_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="free">ss1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> qs_in <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs2_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs2</span> <span class="main">∈</span> listset <span class="free">ss2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> len_qs2<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">qs2</span> <span class="main">=</span> length <span class="skolem">qs</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="skolem">qs</span> <span class="main">⟹</span> <span class="skolem">qs2</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">qs</span> <span class="main">!</span> <span class="skolem">g</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g_bij g <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_permE<span class="main">)</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound"><span class="bound">qs</span></span><span class="main">∈</span>listset <span class="free">ss2</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> sum_list <span class="bound">qs</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ex1I conjI allI impI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> qs_in <span class="keyword1"><span class="command">have</span></span> len_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">qs</span> <span class="main">=</span> length <span class="free">ss1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listsetD<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> g_bij <span class="keyword1"><span class="command">have</span></span> g_bij2<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">g</span> <span class="main">{..&lt;</span>length <span class="skolem">qs2</span><span class="main">}</span> <span class="main">{..&lt;</span>length <span class="skolem">qs</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> len_qs2 len_ss1<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"mset <span class="skolem">qs2</span> <span class="main">=</span> mset <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mset_bij<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> len_qs2<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> a <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> sum_mset_sum_list<span class="main">)</span>

      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">qs'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs'</span> <span class="main">∈</span> listset <span class="free">ss2</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> qs'_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs'</span> <span class="main">∈</span> listset <span class="free">ss2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs1</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs1_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs1</span> <span class="main">∈</span> listset <span class="free">ss1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> len_qs1<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">qs1</span> <span class="main">=</span> length <span class="skolem">qs'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="skolem">qs'</span> <span class="main">⟹</span> <span class="skolem">qs1</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">qs'</span> <span class="main">!</span> <span class="skolem">f</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f_bij f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_permE<span class="main">)</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">qs'</span> <span class="main">∈</span> listset <span class="free">ss2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">qs'</span> <span class="main">=</span> length <span class="free">ss2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listsetD<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> f_bij <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> <span class="main">{..&lt;</span>length <span class="skolem">qs1</span><span class="main">}</span> <span class="main">{..&lt;</span>length <span class="skolem">qs'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> len_qs1 len_ss1<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"mset <span class="skolem">qs1</span> <span class="main">=</span> mset <span class="skolem">qs'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mset_bij<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> len_qs1<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs1</span> <span class="main">=</span> sum_list <span class="skolem">qs'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> sum_mset_sum_list<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs1</span> <span class="main">=</span> sum_list <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> a <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> a'<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> qs1_in qs_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs1</span> <span class="main">=</span> <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_unique<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs'</span> <span class="main">=</span> <span class="skolem">qs2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> list_eq_iff_nth_eq
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI allI impI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> qs'_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">qs'</span> <span class="main">=</span> length <span class="free">ss2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listsetD<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">qs'</span> <span class="main">=</span> length <span class="skolem">qs2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> len_qs2 len_qs len_ss1<span class="main">)</span>

        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">qs'</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">qs2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span>length <span class="skolem">qs2</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ss1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> len_qs2 len_qs<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">g</span> <span class="main">`</span> <span class="main">{..&lt;</span>length <span class="skolem">qs2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> g_bij2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{..&lt;</span>length <span class="skolem">qs</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">qs'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq len_qs2<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">qs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs2</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">qs</span> <span class="main">!</span> <span class="skolem">g</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">qs1</span> <span class="main">!</span> <span class="skolem">g</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">qs1</span> <span class="main">=</span> <span class="skolem">qs</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">qs'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">qs'</span> <span class="main">!</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ss1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">qs'</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f_g<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs'</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">qs2</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> direct_decomp_split_map<span class="main">:</span>
  <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">ss</span><span class="main">)</span> <span class="main">⟹</span> direct_decomp <span class="free">A</span> <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>filter <span class="free">P</span> <span class="free">ss</span><span class="main">)</span> <span class="main">@</span> map <span class="free">f</span> <span class="main">(</span>filter <span class="main">(</span><span class="main">-</span> <span class="free">P</span><span class="main">)</span> <span class="free">ss</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_perm<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"perm <span class="main">(</span>map <span class="free">f</span> <span class="free">ss</span><span class="main">)</span> <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>filter <span class="free">P</span> <span class="free">ss</span><span class="main">)</span> <span class="main">@</span> map <span class="free">f</span> <span class="main">(</span>filter <span class="main">(</span><span class="main">-</span> <span class="free">P</span><span class="main">)</span> <span class="free">ss</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ss</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">s</span> <span class="skolem">ss</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">s</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">#</span> <span class="skolem">ss</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">s</span> <span class="main">#</span> map <span class="free">f</span> <span class="skolem">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perm <span class="main">(</span><span class="free">f</span> <span class="skolem">s</span> <span class="main">#</span> map <span class="free">f</span> <span class="skolem">ss</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">s</span> <span class="main">#</span> map <span class="free">f</span> <span class="main">(</span>filter <span class="free">P</span> <span class="skolem">ss</span><span class="main">)</span> <span class="main">@</span> map <span class="free">f</span> <span class="main">(</span>filter <span class="main">(</span><span class="main">-</span> <span class="free">P</span><span class="main">)</span> <span class="skolem">ss</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> perm.intros<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perm <span class="main">…</span> <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>filter <span class="free">P</span> <span class="skolem">ss</span><span class="main">)</span> <span class="main">@</span> map <span class="free">f</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">#</span> filter <span class="main">(</span><span class="main">-</span> <span class="free">P</span><span class="main">)</span> <span class="skolem">ss</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perm_append_Cons<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span><span class="main">(</span>trans<span class="main">)</span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> map <span class="free">f</span> <span class="main">(</span>filter <span class="free">P</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">#</span> <span class="skolem">ss</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> map <span class="free">f</span> <span class="main">(</span>filter <span class="main">(</span><span class="main">-</span> <span class="free">P</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">#</span> <span class="skolem">ss</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> direct_decomp_split <span class="main">=</span> direct_decomp_split_map<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted">id</span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> direct_decomp_direct_decomp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="main">(</span><span class="free">s</span> <span class="main">#</span> <span class="free">ss</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">s</span> <span class="free">rs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="main">(</span><span class="free">ss</span> <span class="main">@</span> <span class="free">rs</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="var">?ss</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompI_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">qs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="var">?ss</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs1</span></span> <span class="skolem"><span class="skolem">qs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs1</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qs2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs2</span> <span class="main">∈</span> listset <span class="free">rs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> <span class="skolem">qs1</span> <span class="main">@</span> <span class="skolem">qs2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_appendE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs</span> <span class="main">=</span> sum_list <span class="main">(</span><span class="main">(</span>sum_list <span class="skolem">qs2</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">qs1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs add.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompD<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> qs2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs2</span> <span class="main">∈</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompD<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs2</span> <span class="main">#</span> <span class="skolem">qs1</span> <span class="main">∈</span> listset <span class="main">(</span><span class="free">s</span> <span class="main">#</span> <span class="free">ss</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qs1 refl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs1</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs1_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs1</span> <span class="main">∈</span> listset <span class="main">(</span><span class="free">s</span> <span class="main">#</span> <span class="free">ss</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> qs1_in <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs11</span></span> <span class="skolem"><span class="skolem">qs12</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs11</span> <span class="main">∈</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qs12_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs12</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> qs1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs1</span> <span class="main">=</span> <span class="skolem">qs11</span> <span class="main">#</span> <span class="skolem">qs12</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs2_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs2</span> <span class="main">∈</span> listset <span class="free">rs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qs11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs11</span> <span class="main">=</span> sum_list <span class="skolem">qs2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompE<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs12</span> <span class="main">@</span> <span class="skolem">qs2</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound"><span class="bound">qs</span></span><span class="main">∈</span>listset <span class="var">?ss</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> sum_list <span class="bound">qs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ex1I conjI allI impI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> qs12_in qs2_in refl <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?qs</span> <span class="main">∈</span> listset <span class="var">?ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_appendI<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> sum_list <span class="var">?qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a qs1 qs11 add.commute<span class="main">)</span>

    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">qs0</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">∈</span> listset <span class="var">?ss</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> qs0_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">∈</span> listset <span class="var">?ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs01</span></span> <span class="skolem"><span class="skolem">qs02</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs01_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs01</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qs02_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs02</span> <span class="main">∈</span> listset <span class="free">rs</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> qs0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">=</span> <span class="skolem">qs01</span> <span class="main">@</span> <span class="skolem">qs02</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_appendE<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> _ qs01_in refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sum_list <span class="skolem">qs02</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">qs01</span> <span class="main">∈</span> listset <span class="main">(</span><span class="free">s</span> <span class="main">#</span> <span class="free">ss</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?qs'</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> qs02_in <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs02</span> <span class="main">∈</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompD<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> qs1_in
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="var">?qs'</span> <span class="main">=</span> sum_list <span class="skolem">qs1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs0 a add.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?qs'</span> <span class="main">=</span> <span class="skolem">qs11</span> <span class="main">#</span> <span class="skolem">qs12</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> qs1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_unique<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs11</span> <span class="main">=</span> sum_list <span class="skolem">qs02</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs01</span> <span class="main">=</span> <span class="skolem">qs12</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs02</span> <span class="main">=</span> sum_list <span class="skolem">qs2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> qs11<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> qs02_in qs2_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs02</span> <span class="main">=</span> <span class="skolem">qs2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_unique<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">=</span> <span class="skolem">qs12</span> <span class="main">@</span> <span class="skolem">qs2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> 1 qs0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_list_map_times<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">(*)</span> <span class="free">x</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>semiring_0<span class="main">)</span> <span class="main">*</span> sum_list <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> direct_decomp_image_times<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span><span class="free">A</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>semiring_0 set<span class="main">)</span> <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">x</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span><span class="main">(*)</span> <span class="free">x</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">(`)</span> <span class="main">(</span><span class="main">(*)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="free">ss</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="var">?A</span> <span class="var">?ss</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompI_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">qs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="var">?ss</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs0</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs0_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> map <span class="main">(</span><span class="main">(*)</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">qs0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_map_imageE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> sum_list <span class="skolem">qs0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> qs sum_list_map_times<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> qs0_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs0</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs</span> <span class="main">∈</span> <span class="main">(*)</span> <span class="free">x</span> <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> image_eqI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="skolem">a'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs'_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs'</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> sum_list <span class="skolem">qs'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompE<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> map <span class="main">(</span><span class="main">(*)</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">qs'</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound"><span class="bound">qs</span></span><span class="main">∈</span>listset <span class="var">?ss</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> sum_list <span class="bound">qs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ex1I conjI allI impI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> qs'_in qs_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="var">?ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_map_imageI<span class="main">)</span>

    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">qs0</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">∈</span> listset <span class="var">?ss</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">∈</span> listset <span class="var">?ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs1</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs1_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs1</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qs0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">=</span> map <span class="main">(</span><span class="main">(*)</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">qs1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_map_imageE<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">=</span> <span class="skolem">qs</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> qs1_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">qs1</span> <span class="main">=</span> length <span class="free">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listsetD<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> qs'_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">qs'</span> <span class="main">=</span> length <span class="free">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listsetD<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs_def qs0 list_eq_iff_nth_eq True<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> sum_list <span class="skolem">qs1</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> a0 qs0 sum_list_map_times<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> sum_list <span class="skolem">qs'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> a' a<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs1</span> <span class="main">=</span> sum_list <span class="skolem">qs'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> qs1_in qs'_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs1</span> <span class="main">=</span> <span class="skolem">qs'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_unique<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> qs0 qs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> a a' qs_def sum_list_map_times<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> direct_decomp_appendD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="main">(</span><span class="free">ss1</span> <span class="main">@</span> <span class="free">ss2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∉</span> set <span class="free">ss2</span> <span class="main">⟹</span> direct_decomp <span class="main">(</span>sum_list <span class="main">`</span> listset <span class="free">ss1</span><span class="main">)</span> <span class="free">ss1</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="var">?thesis1</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∉</span> set <span class="free">ss1</span> <span class="main">⟹</span> direct_decomp <span class="main">(</span>sum_list <span class="main">`</span> listset <span class="free">ss2</span><span class="main">)</span> <span class="free">ss2</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="var">?thesis2</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="main">[</span>sum_list <span class="main">`</span> listset <span class="free">ss1</span><span class="main">,</span> sum_list <span class="main">`</span> listset <span class="free">ss2</span><span class="main">]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">_</span> <span class="var">?ss</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> rl<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>sum_list <span class="main">`</span> listset <span class="skolem">ts1</span><span class="main">)</span> <span class="skolem">ts1</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="main">(</span><span class="skolem">ts1</span> <span class="main">@</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∉</span> set <span class="skolem">ts2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ts1</span> <span class="skolem">ts2</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> direct_decompI inj_onI refl<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">qs1</span> <span class="skolem">qs2</span>
    <span class="keyword3"><span class="command">assume</span></span> qs1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs1</span> <span class="main">∈</span> listset <span class="skolem">ts1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qs2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs2</span> <span class="main">∈</span> listset <span class="skolem">ts1</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs1</span> <span class="main">=</span> sum_list <span class="skolem">qs2</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"listset <span class="skolem">ts2</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> listset_empty_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs3</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs3</span> <span class="main">∈</span> listset <span class="skolem">ts2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">note</span></span> that<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> qs1 qs3 refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs1</span> <span class="main">@</span> <span class="skolem">qs3</span> <span class="main">∈</span> listset <span class="main">(</span><span class="skolem">ts1</span> <span class="main">@</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_appendI<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> qs2 qs3 refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs2</span> <span class="main">@</span> <span class="skolem">qs3</span> <span class="main">∈</span> listset <span class="main">(</span><span class="skolem">ts1</span> <span class="main">@</span> <span class="skolem">ts2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_appendI<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span><span class="skolem">qs1</span> <span class="main">@</span> <span class="skolem">qs3</span><span class="main">)</span> <span class="main">=</span> sum_list <span class="main">(</span><span class="skolem">qs2</span> <span class="main">@</span> <span class="skolem">qs3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs1</span> <span class="main">@</span> <span class="skolem">qs3</span> <span class="main">=</span> <span class="skolem">qs2</span> <span class="main">@</span> <span class="skolem">qs3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_unique<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs1</span> <span class="main">=</span> <span class="skolem">qs2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∉</span> set <span class="free">ss2</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rl<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms perm_append_swap <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="main">(</span><span class="free">ss2</span> <span class="main">@</span> <span class="free">ss1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_perm<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∉</span> set <span class="free">ss1</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rl<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="var">?ss</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompI_alt<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">qs</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="var">?ss</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q1</span></span> <span class="skolem"><span class="skolem">q2</span></span> <span class="keyword2"><span class="keyword">where</span></span> q1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="free">ss1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="free">ss2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> qs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">q1</span><span class="main">,</span> <span class="skolem">q2</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_doubletonE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> q1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs1</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs1</span> <span class="main">∈</span> listset <span class="free">ss1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">=</span> sum_list <span class="skolem">qs1</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> q2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs2</span> <span class="main">∈</span> listset <span class="free">ss2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">=</span> sum_list <span class="skolem">qs2</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> qs1 qs2 refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs1</span> <span class="main">@</span> <span class="skolem">qs2</span> <span class="main">∈</span> listset <span class="main">(</span><span class="free">ss1</span> <span class="main">@</span> <span class="free">ss2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_appendI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span><span class="skolem">qs1</span> <span class="main">@</span> <span class="skolem">qs2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompD<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs q1 q2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs0</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs0_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">∈</span> listset <span class="main">(</span><span class="free">ss1</span> <span class="main">@</span> <span class="free">ss2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs1</span></span> <span class="skolem"><span class="skolem">qs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs1</span> <span class="main">∈</span> listset <span class="free">ss1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qs2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs2</span> <span class="main">∈</span> listset <span class="free">ss2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> qs0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">=</span> <span class="skolem">qs1</span> <span class="main">@</span> <span class="skolem">qs2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_appendE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> qs1 <span class="keyword1"><span class="command">have</span></span> len_qs1<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">qs1</span> <span class="main">=</span> length <span class="free">ss1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listsetD<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> <span class="main">[</span>sum_list <span class="skolem">qs1</span><span class="main">,</span> sum_list <span class="skolem">qs2</span><span class="main">]</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound"><span class="bound">qs</span></span><span class="main">∈</span>listset <span class="var">?ss</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> sum_list <span class="bound">qs</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ex1I conjI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> qs1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs1</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="free">ss1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> qs2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs2</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="free">ss2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="var">?ss</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_doubletonI<span class="main">)</span>

      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">qs'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs'</span> <span class="main">∈</span> listset <span class="var">?ss</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs'</span> <span class="main">∈</span> listset <span class="var">?ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q1</span></span> <span class="skolem"><span class="skolem">q2</span></span> <span class="keyword2"><span class="keyword">where</span></span> q1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="free">ss1</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> q2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="free">ss2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qs'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs'</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">q1</span><span class="main">,</span> <span class="skolem">q2</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_doubletonE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> q1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs1'</span> <span class="main">∈</span> listset <span class="free">ss1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">=</span> sum_list <span class="skolem">qs1'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">from</span></span> q2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs2'</span> <span class="main">∈</span> listset <span class="free">ss2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">=</span> sum_list <span class="skolem">qs2'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">from</span></span> qs1' <span class="keyword1"><span class="command">have</span></span> len_qs1'<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">qs1'</span> <span class="main">=</span> length <span class="free">ss1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listsetD<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> assms
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> qs1' qs2' refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs1'</span> <span class="main">@</span> <span class="skolem">qs2'</span> <span class="main">∈</span> listset <span class="main">(</span><span class="free">ss1</span> <span class="main">@</span> <span class="free">ss2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_appendI<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> qs0_in
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span><span class="skolem">qs1'</span> <span class="main">@</span> <span class="skolem">qs2'</span><span class="main">)</span> <span class="main">=</span> sum_list <span class="skolem">qs0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a' qs' <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> a q1 q2<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs1'</span> <span class="main">@</span> <span class="skolem">qs2'</span> <span class="main">=</span> <span class="skolem">qs0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_unique<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">qs1</span> <span class="main">@</span> <span class="skolem">qs2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs'</span> <span class="main">=</span> <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs_def qs' q1 q2 len_qs1 len_qs1'<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs_def a qs0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> direct_decomp_Cons_zeroI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="free">ss</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">#</span> <span class="free">ss</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompI_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">qs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">#</span> <span class="free">ss</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">qs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs'</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">#</span> <span class="skolem">qs'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs</span> <span class="main">=</span> sum_list <span class="skolem">qs'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">qs'</span> <span class="main">∈</span> listset <span class="free">ss</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs'</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompE<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> <span class="main">0</span> <span class="main">#</span> <span class="skolem">qs'</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">qs</span><span class="main">.</span> <span class="bound">qs</span> <span class="main">∈</span> listset <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">#</span> <span class="free">ss</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> sum_list <span class="bound">qs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ex1I conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> _ qs' qs_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">#</span> <span class="free">ss</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsI<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">qs0</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">∈</span> listset <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">#</span> <span class="free">ss</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">∈</span> listset <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">#</span> <span class="free">ss</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q0</span></span> <span class="skolem"><span class="skolem">qs0'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q0</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qs0'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0'</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> qs0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">=</span> <span class="skolem">q0</span> <span class="main">#</span> <span class="skolem">qs0'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs0'</span> <span class="main">=</span> sum_list <span class="skolem">qs'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a0 <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms qs0' qs' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0'</span> <span class="main">=</span> <span class="skolem">qs'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_unique<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q0</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">=</span> <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs_def qs0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs_def a<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> direct_decomp_Cons_zeroD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">#</span> <span class="free">ss</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="free">ss</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> direct_decomp_def bij_betw_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="main">(</span><span class="free">ss</span> <span class="main">@</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_direct_decomp<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> direct_decomp_Cons_subsetI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="main">(</span><span class="free">s</span> <span class="main">#</span> <span class="free">ss</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s0</span><span class="main">.</span> <span class="bound">s0</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">∈</span> <span class="bound">s0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="free">ss</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ss</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> listset.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> listset_ConsI<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="free">ss</span><span class="main">)</span> <span class="main">∈</span> listset <span class="main">(</span><span class="free">s</span> <span class="main">#</span> <span class="free">ss</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> refl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="free">ss</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompD<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> direct_decomp_Int_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">∈</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ss</span> <span class="main">!</span> <span class="free">i</span> <span class="main">∩</span> <span class="free">ss</span> <span class="main">!</span> <span class="free">j</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> less_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> i_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span> <span class="main">!</span> <span class="free">i</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> j_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span> <span class="main">!</span> <span class="free">j</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ss</span> <span class="main">!</span> <span class="free">i</span> <span class="main">∩</span> <span class="free">ss</span> <span class="main">!</span> <span class="free">j</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">ss</span> <span class="main">!</span> <span class="free">i</span> <span class="main">∩</span> <span class="free">ss</span> <span class="main">!</span> <span class="free">j</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> x_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">ss</span> <span class="main">!</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">ss</span> <span class="main">!</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="free">ss</span><span class="main">)</span><span class="main">[</span><span class="skolem">k</span> <span class="main">:=</span> <span class="skolem">y</span><span class="main">]</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">ss</span> <span class="main">!</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">y</span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> that
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ss</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil
        <span class="keyword1"><span class="command">from</span></span> Nil<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">s</span> <span class="skolem">ss</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s'</span><span class="main">.</span> <span class="bound">s'</span> <span class="main">∈</span> set <span class="skolem">ss</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">∈</span> <span class="bound">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.prems<span class="main">)</span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> k<span class="main">:</span> 0
          <span class="keyword1"><span class="command">with</span></span> Cons.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">ss</span> <span class="main">∈</span> listset <span class="skolem">ss</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">ss</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> listset.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> listset_ConsI<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">#</span> <span class="skolem">ss</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="skolem">k</span> <span class="main">:=</span> <span class="skolem">y</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> k<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsI<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> k<span class="main">:</span> <span class="main">(</span>Suc <span class="skolem">k'</span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.prems<span class="main">)</span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">ss</span><span class="main">)</span><span class="main">[</span><span class="skolem">k'</span> <span class="main">:=</span> <span class="skolem">y</span><span class="main">]</span> <span class="main">∈</span> listset <span class="skolem">ss</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.hyps<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">&lt;</span> length <span class="skolem">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> k<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">ss</span> <span class="main">!</span> <span class="skolem">k'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> k<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">#</span> <span class="skolem">ss</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="skolem">k</span> <span class="main">:=</span> <span class="skolem">y</span><span class="main">]</span> <span class="main">=</span> <span class="main">0</span> <span class="main">#</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">ss</span><span class="main">)</span><span class="main">[</span><span class="skolem">k'</span> <span class="main">:=</span> <span class="skolem">y</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> k<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsI<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span><span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="free">ss</span><span class="main">)</span><span class="main">[</span><span class="skolem">k</span> <span class="main">:=</span> <span class="skolem">y</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ss</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_ac <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.split<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qs1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs1</span> <span class="main">=</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="free">ss</span><span class="main">)</span><span class="main">[</span><span class="free">i</span> <span class="main">:=</span> <span class="skolem">x</span><span class="main">]</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs2</span> <span class="main">=</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="free">ss</span><span class="main">)</span><span class="main">[</span><span class="free">j</span> <span class="main">:=</span> <span class="skolem">x</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">ss</span>›</span></span> x_i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs1</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> qs1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> x_j <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs2</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> qs2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
      <span class="keyword1"><span class="command">thm</span></span> sum_list_update
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">ss</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs1</span> <span class="main">=</span> sum_list <span class="skolem">qs2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs1_def qs2_def 2<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs1</span> <span class="main">=</span> <span class="skolem">qs2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_unique<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs1</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">qs2</span> <span class="main">!</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">ss</span>›</span></span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs1_def qs2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> i_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="free">ss</span> <span class="main">!</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> j_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="free">ss</span> <span class="main">!</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">ss</span> <span class="main">!</span> <span class="free">i</span> <span class="main">∩</span> <span class="free">ss</span> <span class="main">!</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> direct_decomp_pairwise_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">∈</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pairwise <span class="main">(</span><span class="main">λ</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="bound">s1</span> <span class="main">∩</span> <span class="bound">s2</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>set <span class="free">ss</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> pairwiseI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s1</span> <span class="skolem">s2</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">=</span> <span class="free">ss</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">=</span> <span class="free">ss</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">≠</span> <span class="skolem">s2</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s1 s2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">∩</span> <span class="skolem">s2</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> s1 s2 <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">ss</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_Int_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">∩</span> <span class="skolem">s1</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> s1 s2 <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ss</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_Int_zero<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Int_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> direct_decomp_repeated_eq_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> count_list <span class="free">ss</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">∈</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> count_list_gr_1_E<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> this<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ss</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∩</span> <span class="free">ss</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_Int_zero<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1 2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> direct_decomp_map_Int_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">ss</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s2</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="main">≠</span> <span class="free">s2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">∈</span> <span class="free">f</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">s1</span> <span class="main">∩</span> <span class="free">f</span> <span class="free">s2</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="main">=</span> <span class="free">ss</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>map <span class="free">f</span> <span class="free">ss</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s2</span> <span class="main">=</span> <span class="free">ss</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span>map <span class="free">f</span> <span class="free">ss</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="free">f</span> <span class="free">ss</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_map <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> linorder_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map <span class="free">f</span> <span class="free">ss</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∩</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">ss</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> j * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_Int_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> i j <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s1 s2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map <span class="free">f</span> <span class="free">ss</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∩</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">ss</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_Int_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> i j <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s1 s2 Int_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s1 s2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Direct Decompositions and Vector Spaces›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vector_space<span class="main">)</span> <span class="entity">is_basis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> set <span class="main">⇒</span> <span class="tfree">'b</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_basis</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">∧</span> independent <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">⊆</span> span <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">∧</span> card <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> dim <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vector_space<span class="main">)</span> <span class="entity">some_basis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> set <span class="main">⇒</span> <span class="tfree">'b</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">some_basis</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">=</span> Eps <span class="main">(</span>local.is_basis <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> real_vector.is_basis real_vector.some_basis

<span class="keyword1"><span class="command">context</span></span> vector_space
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dim_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim <span class="main">{}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dim_span_eq_card_independent independent_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> dim_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dim_span_eq_card_independent independent_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> independent_UnI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"independent <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"independent <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"span <span class="free">A</span> <span class="main">∩</span> span <span class="free">B</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"independent <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> span_superset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">⊆</span> span <span class="free">A</span> <span class="main">∩</span> span <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> dependent_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"dependent <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="skolem">T</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">v</span> <span class="keyword1"><span class="free">*s</span></span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="skolem">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dependent_explicit <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">TA</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">TA</span> <span class="main">=</span> <span class="skolem">T</span> <span class="main">∩</span> <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">TB</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">TB</span> <span class="main">=</span> <span class="skolem">T</span> <span class="main">∩</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">T</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> <span class="skolem">TA</span> <span class="main">∪</span> <span class="skolem">TB</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TA_def TB_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">T</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">TA</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">TA</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TA_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">T</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">TB</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">TB</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TB_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">TA</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">TA</span> <span class="main">∩</span> <span class="skolem">TB</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="skolem">TA</span> <span class="main">∪</span> <span class="skolem">TB</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">v</span> <span class="keyword1"><span class="free">*s</span></span> <span class="bound">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> T<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="skolem">TA</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">v</span> <span class="keyword1"><span class="free">*s</span></span> <span class="bound">v</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="skolem">TB</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">v</span> <span class="keyword1"><span class="free">*s</span></span> <span class="bound">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="skolem">TA</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">v</span> <span class="keyword1"><span class="free">*s</span></span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="skolem">TB</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="bound">v</span> <span class="keyword1"><span class="free">*s</span></span> <span class="bound">v</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">=</span> <span class="var">?y</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_negf eq_neg_iff_add_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">TB</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">TB</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∈</span> span <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> span_explicit <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> uminus_apply<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">TA</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">TA</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> span <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> span_explicit<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∈</span> span <span class="free">A</span> <span class="main">∩</span> span <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?x</span> <span class="main">=</span> <span class="var">?y</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?x</span> <span class="main">=</span> <span class="var">?y</span>›</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">T</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">TA</span> <span class="main">∪</span> <span class="skolem">TB</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> T<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">TA</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">TA</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">TA</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?x</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> independentD<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">TB</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">TB</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">TB</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?y</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> independentD<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="skolem">v</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subspace_direct_decomp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">⟹</span> subspace <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subspace <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subspaceI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="free">ss</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?qs</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ss</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> listset.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> subspace_0 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> listset_ConsI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="var">?qs</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompD<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> ps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> sum_list <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompE<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> sum_list <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ps qs <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ps</span> <span class="main">=</span> length <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> listsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ps qs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map2 <span class="main">(+)</span> <span class="skolem">ps</span> <span class="skolem">qs</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?qs</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_closed_map2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subspace_add<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="var">?qs</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompD<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> p q sum_list_map2_plus<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">p</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> sum_list <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="keyword1"><span class="free">(*s)</span></span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">ps</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?qs</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_closed_map<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subspace_scale<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="var">?qs</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="var">?qs</span> <span class="main">=</span> <span class="skolem">c</span> <span class="keyword1"><span class="free">*s</span></span> sum_list <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">ps</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scale_right_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1"><span class="free">*s</span></span> <span class="skolem">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_basis_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"subspace <span class="free">V</span> <span class="main">⟹</span> is_basis <span class="free">V</span> <span class="free">B</span> <span class="main">⟷</span> <span class="main">(</span>independent <span class="free">B</span> <span class="main">∧</span> span <span class="free">B</span> <span class="main">=</span> <span class="free">V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> is_basis_def dim_eq_card span_eq span_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_basis_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="free">V</span> <span class="free">A</span> <span class="main">⟹</span> is_basis <span class="free">V</span> <span class="free">B</span> <span class="main">⟹</span> finite <span class="free">A</span> <span class="main">⟷</span> finite <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_basis_def <span class="keyword1"><span class="command">using</span></span> independent_span_bound <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> some_basis_is_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"is_basis <span class="free">V</span> <span class="main">(</span>some_basis <span class="free">V</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"independent <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> span <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">B</span> <span class="main">=</span> dim <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> basis_exists<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_basis <span class="free">V</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_basis_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> some_basis_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> some_basis_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"some_basis <span class="free">V</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> independent_some_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"independent <span class="main">(</span>some_basis <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> span_some_basis_supset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> span <span class="main">(</span>some_basis <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> card_some_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>some_basis <span class="free">V</span><span class="main">)</span> <span class="main">=</span> dim <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> some_basis_is_basis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">V</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_basis_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> some_basis_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> some_basis <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> independent_some_basis dependent_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> span_some_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"subspace <span class="free">V</span> <span class="main">⟹</span> span <span class="main">(</span>some_basis <span class="free">V</span><span class="main">)</span> <span class="main">=</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> span_subspace some_basis_subset span_some_basis_supset<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> direct_decomp_some_basis_pairwise_disjnt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">⟹</span> subspace <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pairwise <span class="main">(</span><span class="main">λ</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> disjnt <span class="main">(</span>some_basis <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>some_basis <span class="bound">s2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>set <span class="free">ss</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> pairwiseI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s1</span> <span class="skolem">s2</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">≠</span> <span class="skolem">s2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"some_basis <span class="skolem">s1</span> <span class="main">∩</span> some_basis <span class="skolem">s2</span> <span class="main">⊆</span> <span class="skolem">s1</span> <span class="main">∩</span> <span class="skolem">s2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> some_basis_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> direct_decomp_pairwise_zero <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> pairwiseD<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"subspace <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subspace_0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"some_basis <span class="skolem">s1</span> <span class="main">∩</span> some_basis <span class="skolem">s2</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> some_basis_not_zero <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"disjnt <span class="main">(</span>some_basis <span class="skolem">s1</span><span class="main">)</span> <span class="main">(</span>some_basis <span class="skolem">s2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> disjnt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> direct_decomp_span_some_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">⟹</span> subspace <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"span <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>some_basis <span class="main">`</span> set <span class="free">ss</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> eq0<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="main">`</span> listset <span class="free">ss</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompD<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq0 <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ss</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">s</span> <span class="skolem">ss</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subspace <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.prems<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>some_basis <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> span_some_basis<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s'</span><span class="main">.</span> <span class="bound">s'</span> <span class="main">∈</span> set <span class="skolem">ss</span> <span class="main">⟹</span> subspace <span class="bound">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.prems<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>some_basis <span class="main">`</span> set <span class="skolem">ss</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sum_list <span class="main">`</span> listset <span class="skolem">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"span <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>some_basis <span class="main">`</span> set <span class="main">(</span><span class="skolem">s</span> <span class="main">#</span> <span class="skolem">ss</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">s</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="skolem">ss</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> span_Un eq1 eq2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_list <span class="main">`</span> listset <span class="main">(</span><span class="skolem">s</span> <span class="main">#</span> <span class="skolem">ss</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⊆</span> <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="skolem">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="skolem">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> sum_list <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">s</span>›</span></span> this<span class="main">(</span>1<span class="main">)</span> refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">qs</span> <span class="main">∈</span> listset <span class="main">(</span><span class="skolem">s</span> <span class="main">#</span> <span class="skolem">ss</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsI<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">qs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">qs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a y<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊆</span> <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs'</span> <span class="main">∈</span> listset <span class="main">(</span><span class="skolem">s</span> <span class="main">#</span> <span class="skolem">ss</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="skolem">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qs'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs'</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">qs</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsE<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="skolem">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> sum_list <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a qs'<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> direct_decomp_independent_some_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">⟹</span> subspace <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"independent <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>some_basis <span class="main">`</span> set <span class="free">ss</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ss</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">from</span></span> independent_empty <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">s</span> <span class="skolem">ss</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s'</span><span class="main">.</span> <span class="bound">s'</span> <span class="main">∈</span> set <span class="skolem">ss</span> <span class="main">⟹</span> subspace <span class="bound">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.prems<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subspace <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.prems<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>some_basis <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subspace_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> span_some_basis<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="skolem">A</span> <span class="main">(</span><span class="main">[</span><span class="skolem">s</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">ss</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∈</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∉</span> set <span class="main">[</span><span class="skolem">s</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>sum_list <span class="main">`</span> listset <span class="skolem">ss</span><span class="main">)</span> <span class="skolem">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_appendD<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>some_basis <span class="main">`</span> set <span class="skolem">ss</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sum_list <span class="main">`</span> listset <span class="skolem">ss</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_span_some_basis<span class="main">)</span>

  <span class="keyword1"><span class="command">note</span></span> independent_some_basis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 2 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"independent <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>some_basis <span class="main">`</span> set <span class="skolem">ss</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.hyps<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>some_basis <span class="skolem">s</span><span class="main">)</span> <span class="main">∩</span> span <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>some_basis <span class="main">`</span> set <span class="skolem">ss</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="skolem">A</span> <span class="main">[</span>sum_list <span class="main">`</span> listset <span class="main">[</span><span class="skolem">s</span><span class="main">]</span><span class="main">,</span> sum_list <span class="main">`</span> listset <span class="skolem">ss</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_appendD<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="skolem">A</span> <span class="main">[</span><span class="skolem">s</span><span class="main">,</span> sum_list <span class="main">`</span> listset <span class="skolem">ss</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_image<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> length <span class="main">[</span><span class="skolem">s</span><span class="main">,</span> sum_list <span class="main">`</span> listset <span class="skolem">ss</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">s</span><span class="main">,</span> sum_list <span class="main">`</span> listset <span class="skolem">ss</span><span class="main">]</span> <span class="main">!</span> <span class="main">0</span> <span class="main">∩</span> <span class="main">[</span><span class="skolem">s</span><span class="main">,</span> sum_list <span class="main">`</span> listset <span class="skolem">ss</span><span class="main">]</span> <span class="main">!</span> <span class="main">1</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_Int_zero<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∈</span> <span class="skolem">s</span>›</span></span> eq2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> span_zero<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq1 eq2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"independent <span class="main">(</span>some_basis <span class="skolem">s</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>some_basis <span class="main">`</span> set <span class="skolem">ss</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> independent_UnI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> direct_decomp_is_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">⟹</span> subspace <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_basis <span class="free">A</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>some_basis <span class="main">`</span> set <span class="free">ss</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subspace <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subspace_direct_decomp<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"span <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>some_basis <span class="main">`</span> set <span class="free">ss</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_span_some_basis<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"independent <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>some_basis <span class="main">`</span> set <span class="free">ss</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_independent_some_basis<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_basis_alt<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dim_direct_decomp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> span <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">⟹</span> subspace <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dim <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">s</span><span class="main">∈</span>set <span class="free">ss</span><span class="main">.</span> dim <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_basis <span class="free">A</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>some_basis <span class="main">`</span> set <span class="free">ss</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"is_basis <span class="free">A</span> <span class="var">?B</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_is_basis<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dim <span class="free">A</span> <span class="main">=</span> card <span class="var">?B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"independent <span class="var">?B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_basis_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊆</span> span <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹independent <span class="var">?B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> independent_span_bound <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹dim <span class="free">A</span> <span class="main">=</span> card <span class="var">?B</span>›</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> finite_set <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?B</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">s</span><span class="main">∈</span>set <span class="free">ss</span><span class="main">.</span> card <span class="main">(</span>some_basis <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> card_UN_disjoint ballI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?B</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>some_basis <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s1</span> <span class="skolem">s2</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pairwise <span class="main">(</span><span class="main">λ</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> disjnt <span class="main">(</span>some_basis <span class="bound">s</span><span class="main">)</span> <span class="main">(</span>some_basis <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>set <span class="free">ss</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_some_basis_pairwise_disjnt<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">≠</span> <span class="skolem">s2</span>"</span></span>
    <span class="keyword1"><span class="command">thm</span></span> pairwiseD
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"disjnt <span class="main">(</span>some_basis <span class="skolem">s1</span><span class="main">)</span> <span class="main">(</span>some_basis <span class="skolem">s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pairwiseD<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"some_basis <span class="skolem">s1</span> <span class="main">∩</span> some_basis <span class="skolem">s2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> disjnt_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> refl card_some_basis <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">s</span><span class="main">∈</span>set <span class="free">ss</span><span class="main">.</span> dim <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* vector_space *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Homogeneous Sets of Polynomials with Fixed Degree›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> homogeneous_set_direct_decomp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">⟹</span> homogeneous_set <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"homogeneous_set <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> homogeneous_setI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hom_component <span class="skolem">a</span> <span class="skolem">n</span> <span class="main">=</span> hom_component <span class="main">(</span>sum_list <span class="skolem">qs</span><span class="main">)</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> hom_component <span class="bound">q</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">qs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">qs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hom_component_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompD<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> hom_component <span class="bound">q</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">qs</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> listset_closed_map<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">q</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"homogeneous_set <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hom_component <span class="skolem">q</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> homogeneous_setD<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hom_component <span class="skolem">a</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hom_deg_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>zero<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom_deg_set</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> hom_component <span class="bound">a</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_deg_setD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> poly_deg <span class="free">p</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> hom_component <span class="skolem">a</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hom_deg_set_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"homogeneous <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> p homogeneous_hom_component<span class="main">)</span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"keys <span class="free">p</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">=</span> poly_deg <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> homogeneousD_poly_deg<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> keys_hom_componentD<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">p</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zero_in_hom_deg_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> hom_component <span class="main">0</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hom_deg_set_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_deg_set_closed_uminus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">-</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">p</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> hom_component <span class="skolem">a</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hom_deg_set_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">p</span> <span class="main">=</span> hom_component <span class="main">(</span><span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hom_deg_set_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_image_eqI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_deg_set_closed_plus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a1</span> <span class="bound">a2</span><span class="main">.</span> <span class="bound">a1</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">a2</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">a1</span> <span class="main">+</span> <span class="bound">a2</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">+</span> <span class="free">q</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> hom_component <span class="skolem">a1</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hom_deg_set_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a2</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> hom_component <span class="skolem">a2</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hom_deg_set_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a1</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span> <span class="main">+</span> <span class="skolem">a2</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">+</span> <span class="free">q</span> <span class="main">=</span> hom_component <span class="main">(</span><span class="skolem">a1</span> <span class="main">+</span> <span class="skolem">a2</span><span class="main">)</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> p q hom_component_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hom_deg_set_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_image_eqI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_deg_set_closed_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a1</span> <span class="bound">a2</span><span class="main">.</span> <span class="bound">a1</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">a2</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">a1</span> <span class="main">-</span> <span class="bound">a2</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">-</span> <span class="free">q</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> hom_component <span class="skolem">a1</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hom_deg_set_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a2</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> hom_component <span class="skolem">a2</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hom_deg_set_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a1</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span> <span class="main">-</span> <span class="skolem">a2</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">-</span> <span class="free">q</span> <span class="main">=</span> hom_component <span class="main">(</span><span class="skolem">a1</span> <span class="main">-</span> <span class="skolem">a2</span><span class="main">)</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> p q hom_component_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hom_deg_set_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_image_eqI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_deg_set_closed_scalar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">⋅</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>semiring_0<span class="main">)</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> hom_component <span class="skolem">a</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hom_deg_set_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⋅</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">=</span> hom_component <span class="main">(</span><span class="free">c</span> <span class="main">⋅</span> <span class="skolem">a</span><span class="main">)</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p punit.map_scale_eq_monom_mult hom_component_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hom_deg_set_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_image_eqI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_deg_set_closed_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a1</span> <span class="bound">a2</span><span class="main">.</span> <span class="bound">a1</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">a2</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">a1</span> <span class="main">+</span> <span class="bound">a2</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum <span class="free">f</span> <span class="free">I</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>infinite <span class="skolem">I</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_in_hom_deg_set<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_in_hom_deg_set<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">j</span> <span class="skolem">I</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> insert.hyps<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">j</span> <span class="skolem">I</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">j</span> <span class="main">+</span> sum <span class="free">f</span> <span class="skolem">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> hom_deg_set_closed_plus insert.hyps<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">j</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> insert.prems<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> insert <span class="skolem">j</span> <span class="skolem">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> insert.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_deg_set_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"homogeneous_set <span class="free">A</span> <span class="main">⟹</span> hom_deg_set <span class="free">z</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> homogeneous_setD <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hom_deg_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Polys_closed_hom_deg_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hom_deg_set <span class="free">z</span> <span class="free">A</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> hom_component <span class="skolem">p'</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hom_deg_set_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">p</span> <span class="main">⊆</span> keys <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p keys_hom_component<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysD<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_deg_set_alt_homogeneous_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"homogeneous_set <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hom_deg_set <span class="free">z</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> homogeneous <span class="bound">p</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> poly_deg <span class="bound">p</span> <span class="main">=</span> <span class="free">z</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⊆</span> <span class="var">?B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_deg_set_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">∈</span> <span class="var">?A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> hom_deg_setD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊆</span> <span class="var">?A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="skolem">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> poly_deg <span class="skolem">h</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zero_in_hom_deg_set<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹homogeneous <span class="skolem">h</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> hom_component <span class="skolem">h</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hom_component_of_homogeneous<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hom_deg_set_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_image_eqI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_deg_set_sum_list_listset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> sum_list <span class="main">`</span> listset <span class="free">ss</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hom_deg_set <span class="free">z</span> <span class="free">A</span> <span class="main">=</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map <span class="main">(</span>hom_deg_set <span class="free">z</span><span class="main">)</span> <span class="free">ss</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⊆</span> <span class="var">?B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> hom_component <span class="skolem">a</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hom_deg_set_def <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> assms <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> hom_component <span class="main">(</span>sum_list <span class="skolem">qs</span><span class="main">)</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> a h<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> hom_component <span class="bound">q</span> <span class="free">z</span><span class="main">)</span> <span class="skolem">qs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">qs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hom_component_plus<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> hom_component <span class="bound">q</span> <span class="free">z</span><span class="main">)</span> <span class="skolem">qs</span> <span class="main">∈</span> listset <span class="main">(</span>map <span class="main">(</span>hom_deg_set <span class="free">z</span><span class="main">)</span> <span class="free">ss</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> hom_deg_set_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="free">ss</span>›</span></span> refl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_map_imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊆</span> <span class="var">?A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="main">(</span>map <span class="main">(</span>hom_deg_set <span class="free">z</span><span class="main">)</span> <span class="free">ss</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> sum_list <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs'</span> <span class="main">∈</span> listset <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> hom_component <span class="bound">q</span> <span class="free">z</span><span class="main">)</span> <span class="skolem">qs'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> hom_deg_set_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_map_imageE<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> hom_component <span class="bound">q</span> <span class="free">z</span><span class="main">)</span> <span class="skolem">qs'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> h qs<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> hom_component <span class="main">(</span>sum_list <span class="skolem">qs'</span><span class="main">)</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">qs'</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hom_component_plus<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> hom_component <span class="main">(</span>sum_list <span class="skolem">qs'</span><span class="main">)</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs'</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> assms <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">qs'</span> <span class="main">∈</span> listset <span class="free">ss</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hom_deg_set_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> image_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> direct_decomp_hom_deg_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">A</span> <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">⟹</span> homogeneous_set <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>hom_deg_set <span class="free">z</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>hom_deg_set <span class="free">z</span><span class="main">)</span> <span class="free">ss</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">`</span> listset <span class="free">ss</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">`</span> listset <span class="main">(</span>map <span class="main">(</span>hom_deg_set <span class="free">z</span><span class="main">)</span> <span class="free">ss</span><span class="main">)</span> <span class="main">=</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> hom_deg_set_sum_list_listset<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on sum_list <span class="main">(</span>listset <span class="free">ss</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"listset <span class="main">(</span>map <span class="main">(</span>hom_deg_set <span class="free">z</span><span class="main">)</span> <span class="free">ss</span><span class="main">)</span> <span class="main">⊆</span> listset <span class="free">ss</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> listset_mono<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ss</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>hom_deg_set <span class="free">z</span><span class="main">)</span> <span class="free">ss</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> hom_deg_set <span class="free">z</span> <span class="main">(</span><span class="free">ss</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ss</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="free">ss</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> hom_deg_set_subset assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> nth_mem<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>hom_deg_set <span class="free">z</span><span class="main">)</span> <span class="free">ss</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">⊆</span> <span class="free">ss</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on sum_list <span class="main">(</span>listset <span class="main">(</span>map <span class="main">(</span>hom_deg_set <span class="free">z</span><span class="main">)</span> <span class="free">ss</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_on_subset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Interpreting Polynomial Rings as Vector Spaces over the Coefficient Field›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹There is no need to set up any further interpretation, since interpretation <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>phull›</span></span></span></span> is exactly
  what we need.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subspace_ideal<span class="main">:</span> <span class="quoted"><span class="quoted">"phull.subspace <span class="main">(</span>ideal <span class="main">(</span><span class="free">F</span><span class="main">::</span><span class="main">(</span><span class="tfree">'b</span><span class="main">::</span>comm_powerprod <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> set<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ideal.span_zero ideal.span_add
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> phull.subspaceI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">p</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">⋅</span> <span class="skolem">p</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> map_scale_eq_times <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_scale<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subspace_Polys<span class="main">:</span> <span class="quoted"><span class="quoted">"phull.subspace <span class="main">(</span><span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zero_in_Polys Polys_closed_plus Polys_closed_map_scale <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phull.subspaceI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subspace_hom_deg_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"phull.subspace <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"phull.subspace <span class="main">(</span>hom_deg_set <span class="free">z</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"phull.subspace <span class="var">?A</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> phull.subspaceI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phull.subspace_0<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zero_in_hom_deg_set<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> phull.subspace_add <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_deg_set_closed_plus<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">p</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> phull.subspace_scale <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">⋅</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_deg_set_closed_scalar<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_deg_set_Polys_eq_span<span class="main">:</span>
  <span class="quoted"><span class="quoted">"hom_deg_set <span class="free">z</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">=</span> phull.span <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> <span class="main">`</span> deg_sect <span class="free">X</span> <span class="free">z</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⊆</span> <span class="var">?B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">.</span> homogeneous <span class="bound">p</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> poly_deg <span class="bound">p</span> <span class="main">=</span> <span class="free">z</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> hom_deg_set_alt_homogeneous_set<span class="main"><span class="main">[</span></span><span class="operator">OF</span> homogeneous_set_Polys<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> poly_deg <span class="skolem">p</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> poly_mapping_plus_induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">from</span></span> phull.span_zero <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">p</span> <span class="skolem">c</span> <span class="skolem">t</span><span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span><span class="var">?m</span> <span class="main">+</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_keys_plusI1<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">+</span> <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span><span class="var">?m</span> <span class="main">+</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysD<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span><span class="var">?m</span> <span class="main">+</span> <span class="skolem">p</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_monomial<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> deg_sect <span class="free">X</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> deg_sectI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>5<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span><span class="var">?m</span> <span class="main">+</span> <span class="skolem">p</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">=</span> poly_deg <span class="main">(</span><span class="var">?m</span> <span class="main">+</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> homogeneousD_poly_deg<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">1</span> <span class="skolem">t</span> <span class="main">∈</span> monomial <span class="main">1</span> <span class="main">`</span> deg_sect <span class="free">X</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">1</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phull.span_base<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">⋅</span> monomial <span class="main">1</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phull.span_scale<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="var">?m</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?m</span> <span class="main">+</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">-</span> <span class="var">?m</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_minus<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">s</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> keys <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> that 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∉</span> keys <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> keys <span class="main">(</span><span class="var">?m</span> <span class="main">+</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_keys_plusI2<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">s</span> <span class="main">=</span> poly_deg <span class="main">(</span><span class="var">?m</span> <span class="main">+</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> homogeneousD_poly_deg<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> homogeneousI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1<span class="main">)</span>

        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">p</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">p</span> <span class="main">≤</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_deg_leI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">p</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> keys <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> deg_pm <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> 1<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> keys <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> poly_deg <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_deg_max_keys<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≤</span> poly_deg <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phull.span_add<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊆</span> <span class="var">?A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">⊆</span> monomial <span class="main">1</span> <span class="main">`</span> deg_sect <span class="free">X</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="skolem">M</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">m</span> <span class="main">⋅</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phull.span_explicit<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">⊆</span> deg_sect <span class="free">X</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="main">`</span> <span class="skolem">T</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_imageE_inj<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> inj <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">∈</span><span class="skolem">T</span><span class="main">.</span> monomial <span class="main">(</span><span class="skolem">c</span> <span class="bound">t</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p M sum.reindex c_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> hom_deg_set_closed_sum zero_in_Polys Polys_closed_plus<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> deg_sect <span class="free">X</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">T</span> <span class="main">⊆</span> deg_sect <span class="free">X</span> <span class="free">z</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> deg_sectD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="skolem">c</span> <span class="skolem">t</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_monomial<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hom_deg_set_alt_homogeneous_set<span class="main"><span class="main">[</span></span><span class="operator">OF</span> homogeneous_set_Polys<span class="main"><span class="main">]</span></span> poly_deg_monomial
            monomial_0_iff eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹(Projective) Hilbert Function›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> phull<span class="main">:</span> vector_space <span class="quoted">map_scale</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> map_scale_distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> map_scale_distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> map_scale_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> map_scale_one_left<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Hilbert_fun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> set <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Hilbert_fun</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> phull.dim <span class="main">(</span>hom_deg_set <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Hilbert_fun_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="main">{}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hilbert_fun_def hom_deg_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Hilbert_fun_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hilbert_fun_def hom_deg_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Hilbert_fun_direct_decomp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span><span class="free">A</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span><span class="main">::</span>countable <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> set<span class="main">)</span> <span class="free">ps</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> homogeneous_set <span class="bound">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> phull.subspace <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="free">A</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> Hilbert_fun <span class="bound">p</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">,</span> 4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> dd<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>hom_deg_set <span class="free">z</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>hom_deg_set <span class="free">z</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_hom_deg_set<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="free">A</span> <span class="free">z</span> <span class="main">=</span> phull.dim <span class="main">(</span>hom_deg_set <span class="free">z</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> Hilbert_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> dd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum phull.dim <span class="main">(</span>set <span class="main">(</span>map <span class="main">(</span>hom_deg_set <span class="free">z</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> phull.dim_direct_decomp<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>deg_sect <span class="free">X</span> <span class="free">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_deg_sect<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> deg_sect <span class="free">X</span> <span class="free">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hom_deg_set <span class="free">z</span> <span class="free">A</span> <span class="main">⊆</span> hom_deg_set <span class="free">z</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> hom_deg_set_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> image_mono<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"hom_deg_set <span class="free">z</span> <span class="free">A</span> <span class="main">⊆</span> phull.span <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> deg_sect <span class="free">X</span> <span class="free">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> hom_deg_set_Polys_eq_span<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span>hom_deg_set <span class="free">z</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> hom_deg_set <span class="free">z</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_map <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"phull.subspace <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"phull.subspace <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subspace_hom_deg_set<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="main">(</span>phull.dim <span class="main">∘</span> hom_deg_set <span class="free">z</span><span class="main">)</span> <span class="main">(</span>set <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_map <span class="keyword1"><span class="command">using</span></span> finite_set
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_nontrivial<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s1</span> <span class="skolem">s2</span>
    <span class="keyword1"><span class="command">note</span></span> dd
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">≠</span> <span class="skolem">s2</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> zero_in_hom_deg_set<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"phull.subspace <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phull.subspace_0<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hom_deg_set <span class="free">z</span> <span class="skolem">s1</span> <span class="main">∩</span> hom_deg_set <span class="free">z</span> <span class="skolem">s2</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_map_Int_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"hom_deg_set <span class="free">z</span> <span class="skolem">s1</span> <span class="main">=</span> hom_deg_set <span class="free">z</span> <span class="skolem">s2</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"phull.dim <span class="main">(</span>hom_deg_set <span class="free">z</span> <span class="skolem">s1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> Hilbert_fun <span class="bound">p</span> <span class="free">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> o_def Hilbert_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> pm_powerprod
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> image_lt_hom_deg_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"homogeneous_set <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lpp <span class="main">`</span> <span class="main">(</span>hom_deg_set <span class="free">z</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> lpp <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> deg_pm <span class="bound">t</span> <span class="main">=</span> <span class="free">z</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> <span class="var">?A</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_eqI iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> lpp <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg_t<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> lpp <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"hom_component <span class="skolem">p</span> <span class="free">z</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> hom_deg_set_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lpp <span class="var">?p</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t deg_t <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_component_lpp<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 1 <span class="quoted"><span class="quoted">‹<span class="var">?p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> image_eqI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> lpp <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">p</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hom_deg_set_alt_homogeneous_set<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> lpp <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_image_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_in_keys<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹homogeneous <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">=</span> poly_deg <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> homogeneousD_poly_deg<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹poly_deg <span class="skolem">p</span> <span class="main">=</span> <span class="free">z</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Hilbert_fun_alt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"phull.subspace <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="free">A</span> <span class="free">z</span> <span class="main">=</span> card <span class="main">(</span>lpp <span class="main">`</span> <span class="main">(</span>hom_deg_set <span class="free">z</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> card <span class="var">?A</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⊆</span> lpp <span class="main">`</span> <span class="main">(</span>hom_deg_set <span class="free">z</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> hom_deg_set <span class="free">z</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> lpp <span class="main">`</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on lpp <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_imageE_inj<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="free">A</span> <span class="free">z</span> <span class="main">=</span> phull.dim <span class="main">(</span>hom_deg_set <span class="free">z</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> Hilbert_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="skolem">B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> phull.dim_eq_card<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"phull.span <span class="skolem">B</span> <span class="main">=</span> phull.span <span class="main">(</span>hom_deg_set <span class="free">z</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">from</span></span> sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"phull.span <span class="skolem">B</span> <span class="main">⊆</span> phull.span <span class="main">(</span>hom_deg_set <span class="free">z</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phull.span_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"phull.subspace <span class="main">(</span>hom_deg_set <span class="free">z</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subspace_hom_deg_set<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"phull.span <span class="main">(</span>hom_deg_set <span class="free">z</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> phull.span_eq_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> phull.span <span class="skolem">B</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> hom_deg_set <span class="free">z</span> <span class="free">A</span> <span class="main">⊆</span> phull.span <span class="skolem">B</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p0</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span> <span class="main">-</span> phull.span <span class="skolem">B</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span> this
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hom_deg_set <span class="free">z</span> <span class="free">A</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_hom_deg_set<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p_min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span><span class="main">.</span> punit.ord_strict_p <span class="bound">q</span> <span class="skolem">p</span> <span class="main">⟹</span> <span class="bound">q</span> <span class="main">∉</span> <span class="var">?B</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.ord_p_minimum_dgrad_p_set<span class="main"><span class="main">[</span></span><span class="operator">OF</span> dickson_grading_varnum<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">,</span></span>
                    <span class="operator">simplified</span> dgrad_p_set_varnum<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> phull.span <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">from</span></span> phull.span_zero this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">p</span> <span class="main">∈</span> lpp <span class="main">`</span> <span class="main">(</span>hom_deg_set <span class="free">z</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> lpp <span class="main">`</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq1<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">p</span> <span class="main">=</span> lpp <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> lcb<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lc <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lc_not_0<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> lcp<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lc <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lc_not_0<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> phull.span <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phull.span_base<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.lc <span class="skolem">p</span> <span class="main">/</span> punit.lc <span class="skolem">b</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">b</span> <span class="main">∈</span> phull.span <span class="skolem">B</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phull.span_scale<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∉</span> phull.span <span class="skolem">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">-</span> <span class="var">?b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> lcb lcp <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lpp <span class="var">?b</span> <span class="main">=</span> lpp <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.map_scale_eq_monom_mult punit.lt_monom_mult eq2<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> lcb <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="var">?b</span> <span class="main">=</span> punit.lc <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.map_scale_eq_monom_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lpp <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="var">?b</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span> lpp <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_minus_lessI<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.ord_strict_p <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="var">?b</span><span class="main">)</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_ord_p<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">-</span> <span class="var">?b</span> <span class="main">∉</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> p_min<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">-</span> <span class="var">?b</span> <span class="main">∉</span> hom_deg_set <span class="free">z</span> <span class="free">A</span> <span class="main">∨</span> <span class="skolem">p</span> <span class="main">-</span> <span class="var">?b</span> <span class="main">∈</span> phull.span <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">-</span> <span class="var">?b</span> <span class="main">∉</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> phull.subspace_scale <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> hom_deg_set_closed_scalar<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"phull.subspace <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">with</span></span> phull.subspace_diff <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">-</span> <span class="var">?b</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_deg_set_closed_minus<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">-</span> <span class="var">?b</span> <span class="main">∈</span> phull.span <span class="skolem">B</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">-</span> <span class="var">?b</span> <span class="main">+</span> <span class="var">?b</span> <span class="main">∈</span> phull.span <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?b</span> <span class="main">∈</span> phull.span <span class="skolem">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phull.span_add<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> phull.span <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∉</span> phull.span <span class="skolem">B</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"phull.span <span class="main">(</span>hom_deg_set <span class="free">z</span> <span class="free">A</span><span class="main">)</span> <span class="main">⊆</span> phull.span <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"phull.independent <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"phull.dependent <span class="skolem">B</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B'</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">⊆</span> <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="skolem">B'</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">b</span> <span class="main">⋅</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> <span class="skolem">B'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="skolem">b'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> phull.dependent_explicit <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B0</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">b</span></span> <span class="main">∈</span> <span class="skolem">B'</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B0</span> <span class="main">⊆</span> <span class="skolem">B'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B0_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">B'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="skolem">B0</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">b</span> <span class="main">⋅</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="skolem">B'</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">b</span> <span class="main">⋅</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.mono_neutral_left<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B0_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="skolem">B0</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">b</span> <span class="main">⋅</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> ordered_powerprod_lin.Max <span class="main">(</span>lpp <span class="main">`</span> <span class="skolem">B0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">∈</span> <span class="skolem">B'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="skolem">b'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> <span class="skolem">B0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B0_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">b'</span> <span class="main">∈</span> lpp <span class="main">`</span> <span class="skolem">B0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lpp <span class="main">`</span> <span class="skolem">B0</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B0</span> <span class="main">⊆</span> <span class="skolem">B'</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">B'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>lpp <span class="main">`</span> <span class="skolem">B0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> lpp <span class="main">`</span> <span class="skolem">B0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lpp <span class="main">`</span> <span class="skolem">B0</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ordered_powerprod_lin.Max_in<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b0</span> <span class="main">∈</span> <span class="skolem">B0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> lpp <span class="skolem">b0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B0</span> <span class="main">⊆</span> <span class="skolem">B'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B'</span> <span class="main">⊆</span> <span class="skolem">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B0</span> <span class="main">⊆</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> hom_deg_set <span class="free">z</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b0</span> <span class="main">∈</span> hom_deg_set <span class="free">z</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">b0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_in_keys<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="skolem">B0</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">b</span> <span class="main">⋅</span> <span class="bound">b</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="skolem">B0</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">b</span> <span class="main">*</span> lookup <span class="bound">b</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_sum<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">B0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="main">{</span><span class="skolem">b0</span><span class="main">}</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">b</span> <span class="main">*</span> lookup <span class="bound">b</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.mono_neutral_right<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b0</span> <span class="main">∈</span> <span class="skolem">B0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">b0</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">B0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="skolem">B0</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b0</span><span class="main">}</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">b</span> <span class="main">*</span> lookup <span class="bound">b</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">B0</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b0</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">B0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">b0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
          <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">b</span> <span class="main">∈</span> lpp <span class="main">`</span> <span class="skolem">B0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>lpp <span class="main">`</span> <span class="skolem">B0</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">b</span> <span class="main"><span class="free">≼</span></span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ordered_powerprod_lin.Max_ge<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∉</span> keys <span class="skolem">b</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">b</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main"><span class="free">≼</span></span> lpp <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_max_keys<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹lpp <span class="skolem">b</span> <span class="main"><span class="free">≼</span></span> <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">b</span> <span class="main">=</span> lpp <span class="skolem">b0</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ordered_powerprod_lin.antisym<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> inj <span class="quoted"><span class="quoted">‹<span class="skolem">B0</span> <span class="main">⊆</span> <span class="skolem">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on lpp <span class="skolem">B0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_on_subset<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lpp <span class="skolem">b</span> <span class="main">=</span> lpp <span class="skolem">b0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">B0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b0</span> <span class="main">∈</span> <span class="skolem">B0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onD<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">b0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="skolem">b</span> <span class="main">*</span> lookup <span class="skolem">b</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">b0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b0</span> <span class="main">∈</span> <span class="skolem">B0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B0_def in_keys_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq1 <span class="keyword1"><span class="command">using</span></span> inj <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_image<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* pm_powerprod *)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* theory *)</span>
</pre>
</div><div id="Cone_Decomposition">
<div class="head">
<h1>Theory Cone_Decomposition</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Alexander Maletzky *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Cone Decompositions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Cone_Decomposition
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../Groebner_Bases/Groebner_PM.html">Groebner_Bases.Groebner_PM</a> <a href="Monomial_Module.html">Monomial_Module</a> <a href="Hilbert_Function.html">Hilbert_Function</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More Properties of Reduced Gr\"obner Bases›</span></span>

<span class="keyword1"><span class="command">context</span></span> pm_powerprod
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> reduced_GB_subset_monic_Polys <span class="main">=</span>
  punit.reduced_GB_subset_monic_dgrad_p_set<span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> dickson_grading_varnum<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span><span class="main">,</span> <span class="operator">simplified</span> dgrad_p_set_varnum<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> reduced_GB_is_monomial_set_Polys <span class="main">=</span>
  punit.reduced_GB_is_monomial_set_dgrad_p_set<span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> dickson_grading_varnum<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span><span class="main">,</span> <span class="operator">simplified</span> dgrad_p_set_varnum<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> is_red_reduced_GB_monomial_lt_GB_Polys <span class="main">=</span>
  punit.is_red_reduced_GB_monomial_lt_GB_dgrad_p_set<span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> dickson_grading_varnum<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span><span class="main">,</span> <span class="operator">simplified</span> dgrad_p_set_varnum<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> reduced_GB_monomial_lt_reduced_GB_Polys <span class="main">=</span>
  punit.reduced_GB_monomial_lt_reduced_GB_dgrad_p_set<span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> dickson_grading_varnum<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span><span class="main">,</span> <span class="operator">simplified</span> dgrad_p_set_varnum<span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Quotient Ideals›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">quot_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>semigroup_mult set"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">÷</span>"</span> 55<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">quot_set</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(*)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-`</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quot_set_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">÷</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">*</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quot_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> quot_setI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">÷</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> quot_set_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> quot_setD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">÷</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> quot_set_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> quot_set_quot_set <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">÷</span> <span class="free">x</span> <span class="main">÷</span> <span class="free">y</span> <span class="main">=</span> <span class="free">A</span> <span class="main">÷</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quot_set_iff mult.assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> quot_set_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">÷</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="main">_</span><span class="main">::</span>monoid_mult<span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quot_set_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ideal_quot_set_ideal <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>ideal <span class="free">B</span> <span class="main">÷</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ideal <span class="free">B</span><span class="main">)</span> <span class="main">÷</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="main">_</span><span class="main">::</span>comm_ring<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>ideal <span class="free">B</span> <span class="main">÷</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊆</span> ideal <span class="free">B</span> <span class="main">÷</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> ideal <span class="main">(</span>ideal <span class="free">B</span> <span class="main">÷</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> ideal <span class="free">B</span> <span class="main">÷</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ideal.span_induct'<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> base
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quot_set_iff ideal.span_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">b</span> <span class="skolem">q</span> <span class="skolem">p</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">∈</span> ideal <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">∈</span> ideal <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quot_set_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ideal.span_add ideal.span_scale<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">q</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> quot_set_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> ideal.span_superset<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> quot_set_image_times<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">(*)</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(*)</span> <span class="free">x</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">÷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quot_set_def inj_vimage_image_eq<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Direct Decompositions of Polynomial Rings›</span></span>

<span class="keyword1"><span class="command">context</span></span> pm_powerprod
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">normal_form</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">normal_form</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span>punit.red <span class="main">(</span>punit.reduced_GB <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">q</span> <span class="main">∧</span> <span class="main">¬</span> punit.is_red <span class="main">(</span>punit.reduced_GB <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="bound">q</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Of course, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> normal_form<span class="antiquote"><span class="antiquote">}</span></span></span></span> could be defined in a much more general context.›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin_X<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> F_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> normal_form<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.red <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="main">(</span>normal_form <span class="free">F</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> punit.is_red <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span> <span class="main">(</span>normal_form <span class="free">F</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> fin_X F_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_reduced_GB_Polys<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"wfP <span class="main">(</span>punit.red <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">¯¯</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.red_wf_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.red <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> punit.is_red <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> punit.is_red_def not_not
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> relation.wf_imp_nf_ex<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.red <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="skolem">q</span> <span class="main">∧</span> <span class="main">¬</span> punit.is_red <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis1</span> <span class="main">∧</span> <span class="var">?thesis2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> normal_form_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> normal_form_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.red <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> punit.is_red <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> relation.ChurchRosser_unique_final<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> fin_X F_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_is_GB_Polys<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"relation.is_ChurchRosser <span class="main">(</span>punit.red <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> punit.is_Groebner_basis_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.red <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="main">(</span>normal_form <span class="free">F</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> normal_form<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> punit.is_red <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span> <span class="main">(</span>normal_form <span class="free">F</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> normal_form<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"relation.is_final <span class="main">(</span>punit.red <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>normal_form <span class="free">F</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.is_red_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"relation.is_final <span class="main">(</span>punit.red <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.is_red_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>

<span class="keyword1"><span class="command">lemma</span></span> normal_form_id_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">¬</span> punit.is_red <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> normal_form<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> punit.is_red <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> punit.is_red <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> rtranclp.rtrancl_refl <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> normal_form_unique<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> normal_form_normal_form<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="main">(</span>normal_form <span class="free">F</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> normal_form <span class="free">F</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normal_form_id_iff normal_form<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> normal_form_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normal_form_id_iff punit.irred_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> normal_form_map_scale<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="main">(</span><span class="free">c</span> <span class="main">⋅</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">⋅</span> <span class="main">(</span>normal_form <span class="free">F</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> normal_form_unique punit.is_irred_map_scale normal_form<span class="main">)</span>
    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.map_scale_eq_monom_mult punit.red_rtrancl_mult normal_form<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> normal_form_uminus<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="main">(</span><span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> normal_form <span class="free">F</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> normal_form_unique punit.red_rtrancl_uminus normal_form<span class="main">)</span>
      <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.is_red_uminus normal_form<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> normal_form_plus_normal_form<span class="main">:</span>
  <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="main">(</span>normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">+</span> normal_form <span class="free">F</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">+</span> normal_form <span class="free">F</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> normal_form_unique rtranclp.rtrancl_refl punit.is_irred_plus normal_form<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> normal_form_minus_normal_form<span class="main">:</span>
  <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="main">(</span>normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">-</span> normal_form <span class="free">F</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">-</span> normal_form <span class="free">F</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> normal_form_unique rtranclp.rtrancl_refl punit.is_irred_minus normal_form<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> normal_form_ideal_Polys<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_form <span class="main">(</span>ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> normal_form <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> fin_X <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.reduced_GB <span class="var">?F</span> <span class="main">=</span> punit.reduced_GB <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_unique_Polys<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> fin_X F_sub <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.is_reduced_GB <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_is_reduced_GB_Polys<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> fin_X F_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span> <span class="main">=</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_ideal_Polys<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ideal <span class="main">(</span>ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> subset_antisym ideal.span_subset_spanI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> ideal.span_superset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">F</span></span><span class="main">]</span> F_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> ideal <span class="main">(</span>ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ideal.span_superset <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span> <span class="main">=</span> ideal <span class="main">(</span>ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> normal_form_def eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> normal_form_diff_in_ideal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">-</span> normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> normal_form<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">-</span> normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">∈</span> ideal <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.red_rtranclp_diff_in_pmdl<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> fin_X F_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_ideal_Polys<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> normal_form_zero_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> normal_form_diff_in_ideal<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">-</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> normal_form <span class="free">F</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> normal_form_diff_in_ideal
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> fin_X F_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ideal <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_ideal_Polys<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">∈</span> ideal <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> fin_X F_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_is_GB_Polys<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> *
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> punit.reduced_GB <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">g</span> <span class="keyword1">adds</span> lpp <span class="main">(</span>normal_form <span class="free">F</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.GB_adds_lt<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lpp <span class="main">(</span>normal_form <span class="free">F</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>normal_form <span class="free">F</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_in_keys<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.is_red <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span> <span class="main">(</span>normal_form <span class="free">F</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.is_red_addsI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> normal_form<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> normal_form_eq_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">=</span> normal_form <span class="free">F</span> <span class="free">q</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">-</span> <span class="free">q</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">-</span> <span class="free">q</span> <span class="main">-</span> <span class="main">(</span>normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">-</span> normal_form <span class="free">F</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> normal_form <span class="free">F</span> <span class="free">p</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> normal_form <span class="free">F</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> normal_form_diff_in_ideal normal_form_diff_in_ideal <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">-</span> <span class="free">q</span> <span class="main">-</span> <span class="main">(</span>normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">-</span> normal_form <span class="free">F</span> <span class="free">q</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">=</span> normal_form <span class="free">F</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">-</span> <span class="free">q</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">-</span> <span class="free">q</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">-</span> <span class="free">q</span> <span class="main">-</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span> <span class="main">-</span> <span class="main">(</span>normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">-</span> normal_form <span class="free">F</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> *
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="main">(</span>normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">-</span> normal_form <span class="free">F</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normal_form_zero_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">=</span> normal_form <span class="free">F</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normal_form_minus_normal_form<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Polys_closed_normal_form<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> fin_X F_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.reduced_GB <span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_Polys<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> fin_X <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms normal_form<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.dgrad_p_set_closed_red_rtrancl<span class="main"><span class="main">[</span></span><span class="operator">OF</span> dickson_grading_varnum<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> dgrad_p_set_varnum<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> image_normal_form_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∧</span> <span class="main">¬</span> punit.is_red <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> normal_form <span class="free">F</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∧</span> <span class="main">¬</span> punit.is_red <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conjI Polys_closed_normal_form normal_form<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∧</span> <span class="main">¬</span> punit.is_red <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> punit.is_red <span class="main">(</span>punit.reduced_GB <span class="free">F</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normal_form_id_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> image_eqI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> direct_decomp_ideal_insert<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≡</span> ideal <span class="main">(</span>insert <span class="free">f</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">≡</span> <span class="main">(</span>ideal <span class="free">F</span> <span class="main">÷</span> <span class="free">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span><span class="free">I</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">[</span>ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> <span class="main">(*)</span> <span class="free">f</span> <span class="main">`</span> normal_form <span class="free">L</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">]</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">_</span> <span class="var">?ss</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompI_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">qs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="var">?ss</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">(*)</span> <span class="free">f</span> <span class="main">`</span> normal_form <span class="free">L</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> qs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_doubletonE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> I_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> IntI ideal.span_add Polys_closed_plus<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">⊆</span> ideal <span class="main">(</span>insert <span class="free">f</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_mono<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> ideal <span class="main">(</span>insert <span class="free">f</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> y <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">f</span> <span class="main">*</span> normal_form <span class="free">L</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> ideal <span class="main">(</span>insert <span class="free">f</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_base<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="free">L</span> <span class="skolem">p</span> <span class="main">*</span> <span class="free">f</span> <span class="main">∈</span> ideal <span class="main">(</span>insert <span class="free">f</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_scale<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> ideal <span class="main">(</span>insert <span class="free">f</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.commute y<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="free">L</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_normal_form<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_times<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">,</span> 4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="free">f</span> <span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F0</span></span> <span class="skolem"><span class="skolem">q0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F0</span> <span class="main">⊆</span> insert <span class="free">f</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">F0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f0</span><span class="main">.</span> <span class="skolem">q0</span> <span class="bound">f0</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f0</span><span class="main">∈</span><span class="skolem">F0</span><span class="main">.</span> <span class="skolem">q0</span> <span class="bound">f0</span> <span class="main">*</span> <span class="bound">f0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> I_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_idealE_Polys<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> a'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="free">f</span> <span class="main">+</span> <span class="skolem">a'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="skolem">F0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F0</span> <span class="main">⊆</span> insert <span class="free">f</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F0</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">f0</span><span class="main">∈</span><span class="skolem">F0</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span><span class="main">.</span> <span class="skolem">q0</span> <span class="bound">f0</span> <span class="main">*</span> <span class="bound">f0</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="main">(</span><span class="skolem">F0</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.sum_in_spanI<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F0</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">f0</span><span class="main">∈</span><span class="skolem">F0</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span><span class="main">.</span> <span class="skolem">q0</span> <span class="bound">f0</span> <span class="main">*</span> <span class="bound">f0</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">f0</span><span class="main">∈</span><span class="skolem">F0</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span><span class="main">.</span> <span class="skolem">q0</span> <span class="bound">f0</span> <span class="main">*</span> <span class="bound">f0</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> Polys_closed_sum Polys_closed_times q0<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f0</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f0</span> <span class="main">∈</span> <span class="skolem">F0</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="skolem">F0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> insert <span class="free">f</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f0</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">F0</span>›</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">q0</span> <span class="free">f</span> <span class="main">*</span> <span class="free">f</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f0</span><span class="main">∈</span><span class="skolem">F0</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span><span class="main">.</span> <span class="skolem">q0</span> <span class="bound">f0</span> <span class="main">*</span> <span class="bound">f0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> a sum.remove<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F0</span> <span class="main">⊆</span> insert <span class="free">f</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F0</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> ideal <span class="skolem">F0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.sum_in_spanI<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F0</span> <span class="main">⊆</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">*</span> <span class="free">f</span> <span class="main">+</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> zero_in_Polys<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> <span class="main">(</span>normal_form <span class="free">L</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="free">L</span> <span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_normal_form<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_times<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">-</span> normal_form <span class="free">L</span> <span class="skolem">q</span> <span class="main">∈</span> ideal <span class="free">L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> normal_form_diff_in_ideal<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> ideal <span class="main">(</span>ideal <span class="free">F</span> <span class="main">÷</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> L_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_mono<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">-</span> normal_form <span class="free">L</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quot_set_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">∈</span> ideal <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">+</span> <span class="free">f</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">-</span> normal_form <span class="free">L</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_add<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">-</span> <span class="var">?a</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">a</span> <span class="main">-</span> <span class="var">?a</span><span class="main">,</span> <span class="var">?a</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound"><span class="bound">qs</span></span><span class="main">∈</span>listset <span class="var">?ss</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> sum_list <span class="bound">qs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ex1I conjI allI impI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">-</span> <span class="var">?a</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="quoted"><span class="quoted">‹normal_form <span class="free">L</span> <span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">-</span> <span class="var">?a</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Polys_closed_minus Polys_closed_times<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">∈</span> <span class="main">(*)</span> <span class="free">f</span> <span class="main">`</span> normal_form <span class="free">L</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="var">?ss</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_doubletonI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">qs0</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">∈</span> listset <span class="var">?ss</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">∈</span> listset <span class="var">?ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">(*)</span> <span class="free">f</span> <span class="main">`</span> normal_form <span class="free">L</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> qs0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_doubletonE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a0</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">f</span> <span class="main">*</span> normal_form <span class="free">L</span> <span class="skolem">a0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs0</span>›</span></span> qs0<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> <span class="main">(</span>normal_form <span class="free">L</span> <span class="skolem">q</span> <span class="main">-</span> normal_form <span class="free">L</span> <span class="skolem">a0</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="var">?a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x y a <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> ideal <span class="free">F</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">-</span> <span class="var">?a</span> <span class="main">∈</span> ideal <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="free">L</span> <span class="skolem">q</span> <span class="main">-</span> normal_form <span class="free">L</span> <span class="skolem">a0</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">÷</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> quot_setI<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a0</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="free">L</span> <span class="skolem">q</span> <span class="main">-</span> normal_form <span class="free">L</span> <span class="skolem">a0</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Polys_closed_minus Polys_closed_normal_form<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="free">L</span> <span class="skolem">q</span> <span class="main">-</span> normal_form <span class="free">L</span> <span class="skolem">a0</span> <span class="main">∈</span> <span class="free">L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> ideal <span class="free">L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> ideal.span_superset<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="free">L</span> <span class="skolem">q</span> <span class="main">-</span> normal_form <span class="free">L</span> <span class="skolem">a0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">L</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> normal_form_minus_normal_form <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> normal_form_zero_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">=</span> <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs0 qs_def x y<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> direct_decomp_ideal_normal_form<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">[</span>ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms one_in_Polys <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>ideal <span class="main">(</span>insert <span class="main">1</span> <span class="free">F</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">[</span>ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span>
                                                <span class="main">(*)</span> <span class="main">1</span> <span class="main">`</span> normal_form <span class="main">(</span><span class="main">(</span>ideal <span class="free">F</span> <span class="main">÷</span> <span class="main">1</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_ideal_insert<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>insert <span class="main">1</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal_eq_UNIV_iff_contains_one ideal.span_base<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(*)</span> <span class="main">1</span> <span class="main">∘</span> normal_form <span class="free">F</span><span class="main">)</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">=</span> normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> image_cong<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_comp normal_form_ideal_Polys<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Cone Decompositions›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cone</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>comm_semiring_0<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cone</span> <span class="free"><span class="bound"><span class="entity">hU</span></span></span> <span class="main">=</span> <span class="main">(*)</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">hU</span></span></span><span class="main">)</span> <span class="main">`</span> <span class="keyword1">P[</span>snd <span class="free"><span class="bound"><span class="entity">hU</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coneI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cone_def mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> coneE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">a</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cone_def mult.commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cone_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">⋅</span> <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Polys_empty map_scale_eq_times <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> coneI <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> coneE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cone_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cone_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> zero_in_Polys<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cone_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>comm_semiring_1<span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cone_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> zero_in_cone<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> cone <span class="free">hU</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cone_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> image_eqI zero_in_Polys<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> empty_not_in_map_cone<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∉</span> set <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zero_in_cone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> tip_in_cone<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span>comm_semiring_1<span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> _ one_in_Polys <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneI<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> cone_closed_plus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> cone <span class="free">hU</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> cone <span class="free">hU</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">∈</span> cone <span class="free">hU</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> hU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hU</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="skolem">U</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="skolem">U</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="skolem">b'</span> <span class="main">*</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a'</span> <span class="main">+</span> <span class="skolem">b'</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> a b <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="skolem">U</span><span class="main">]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="skolem">U</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">+</span> <span class="skolem">b'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="skolem">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hU <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cone_closed_uminus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span>comm_ring<span class="main">)</span> <span class="main">∈</span> cone <span class="free">hU</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">a</span> <span class="main">∈</span> cone <span class="free">hU</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> hU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hU</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="skolem">U</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">a'</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="skolem">U</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">a'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="skolem">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_uminus<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hU <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cone_closed_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span>comm_ring<span class="main">)</span> <span class="main">∈</span> cone <span class="free">hU</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> cone <span class="free">hU</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">b</span> <span class="main">∈</span> cone <span class="free">hU</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">b</span> <span class="main">∈</span> cone <span class="free">hU</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_closed_uminus<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> cone <span class="free">hU</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_closed_plus<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cone_closed_times<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">*</span> <span class="free">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">*</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="skolem">a'</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> a <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">*</span> <span class="skolem">a'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_times<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> cone_closed_monom_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.monom_mult <span class="free">c</span> <span class="free">t</span> <span class="free">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="free">c</span> <span class="free">t</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="free">c</span> <span class="free">t</span> <span class="main">*</span> <span class="free">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_closed_times<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> times_monomial_left<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coneD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lpp <span class="free">h</span> <span class="keyword1">adds</span> lpp <span class="main">(</span><span class="free">p</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span><span class="main">{</span>comm_semiring_0<span class="main">,</span>semiring_no_zero_divisors<span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneE<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lpp <span class="free">p</span> <span class="main">=</span> lpp <span class="skolem">a</span> <span class="main">+</span> lpp <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lp_times<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> lpp <span class="free">h</span> <span class="main">+</span> lpp <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> addsI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cone_mono_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="free">h'</span> <span class="main">*</span> <span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">⊆</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h'</span> <span class="main">*</span> <span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="main">(</span><span class="free">h'</span> <span class="main">*</span> <span class="free">h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="free">h'</span> <span class="main">*</span> <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>›</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">*</span> <span class="free">h'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_times<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cone_mono_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">U1</span> <span class="main">⊆</span> <span class="free">U2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U1</span><span class="main">)</span> <span class="main">⊆</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">P[</span><span class="free">U1</span><span class="main">]</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">U2</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_mono<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U1</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneE<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U1</span><span class="main">]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">P[</span><span class="free">U1</span><span class="main">]</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">U2</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U2</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cone_subsetD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="free">h1</span><span class="main">,</span> <span class="free">U1</span><span class="main">)</span> <span class="main">⊆</span> cone <span class="main">(</span><span class="free">h2</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">,</span>ring_no_zero_divisors<span class="main">}</span><span class="main">,</span> <span class="free">U2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h2</span> <span class="keyword1">dvd</span> <span class="free">h1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">U1</span> <span class="main">⊆</span> <span class="free">U2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> tip_in_cone assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h1</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h2</span><span class="main">,</span> <span class="free">U2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U2</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h1</span> <span class="main">=</span> <span class="skolem">a1'</span> <span class="main">*</span> <span class="free">h2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h1</span> <span class="main">=</span> <span class="free">h2</span> <span class="main">*</span> <span class="skolem">a1'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">h2</span> <span class="keyword1">dvd</span> <span class="free">h1</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">h1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">U1</span> <span class="main">⊆</span> <span class="free">U2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">U1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span>Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U1</span><span class="main">]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Polys_closed_monomial PPs_closed_single<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">*</span> <span class="free">h1</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h1</span><span class="main">,</span> <span class="free">U1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneI<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">*</span> <span class="free">h1</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h2</span><span class="main">,</span> <span class="free">U2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U2</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">*</span> <span class="free">h1</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="free">h2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?p</span> <span class="main">*</span> <span class="skolem">a1'</span><span class="main">)</span> <span class="main">*</span> <span class="free">h2</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="free">h2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> h1 <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">*</span> <span class="skolem">a1'</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> times_canc_right<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U2</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1'</span> <span class="main">*</span> <span class="var">?p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U2</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U2</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a1'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U2</span><span class="main">]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a1'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> times_in_PolysD<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">U2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Polys_def PPs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cone_subset_PolysD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_semiring_1<span class="main">,</span>semiring_no_zero_divisors<span class="main">}</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> tip_in_cone assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span>Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Polys_closed_monomial PPs_closed_single<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">*</span> <span class="free">h</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneI<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">*</span> <span class="free">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">*</span> <span class="var">?p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> times_in_PolysD<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Polys_def PPs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cone_subset_PolysI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_in_Polys<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_mono<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_times<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cone_image_times<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span> <span class="free">a</span> <span class="main">`</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">=</span> cone <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> image_image <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> image_eqI coneI <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> coneE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cone_image_times'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span> <span class="free">a</span> <span class="main">`</span> cone <span class="free">hU</span> <span class="main">=</span> cone <span class="main">(</span>apfst <span class="main">(</span><span class="main">(*)</span> <span class="free">a</span><span class="main">)</span> <span class="free">hU</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hU</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cone_image_times<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> homogeneous_set_coneI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"homogeneous_set <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> homogeneous_setI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hom_component <span class="skolem">a</span> <span class="skolem">n</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> poly_mapping_plus_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_in_cone<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">p</span> <span class="skolem">c</span> <span class="skolem">t</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> PolysI subsetI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> keys <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>2<span class="main">)</span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∉</span> keys <span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> keys <span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_keys_plusI2<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysD<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"hom_component <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="free">h</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_keys_plusI1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysD<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_monomial<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">*</span> <span class="free">h</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="var">?h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> homogeneous_times<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hom_component <span class="var">?h</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="var">?h</span> <span class="keyword1">when</span> <span class="skolem">n</span> <span class="main">=</span> poly_deg <span class="var">?h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_component_of_homogeneous<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?h</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"hom_component <span class="var">?h</span> <span class="skolem">n</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> when_def zero_in_cone<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hom_component <span class="main">(</span><span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> hom_component <span class="var">?h</span> <span class="skolem">n</span> <span class="main">+</span> hom_component <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="free">h</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> distrib_right hom_component_plus<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> ** * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_closed_plus<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subspace_cone<span class="main">:</span> <span class="quoted"><span class="quoted">"phull.subspace <span class="main">(</span>cone <span class="free">hU</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zero_in_cone cone_closed_plus
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> phull.subspaceI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">a</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> cone <span class="free">hU</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> hU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hU</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">⋅</span> <span class="skolem">a</span> <span class="main">∈</span> cone <span class="free">hU</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hU punit.map_scale_eq_monom_mult <span class="keyword1"><span class="command">using</span></span> zero_in_PPs
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_closed_monom_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> direct_decomp_cone_insert<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">,</span>ring_no_zero_divisors<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> insert <span class="free">x</span> <span class="free">U</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">[</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">,</span> cone <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span><span class="main">,</span> insert <span class="free">x</span> <span class="free">U</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="free">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xx</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">=</span> monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="var">?x</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> insert <span class="free">x</span> <span class="free">U</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">,</span> cone <span class="main">(</span><span class="skolem">xx</span> <span class="main">*</span> <span class="free">h</span><span class="main">,</span> insert <span class="free">x</span> <span class="free">U</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">_</span> <span class="var">?ss</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompI_alt<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">qs</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="var">?ss</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">xx</span> <span class="main">*</span> <span class="free">h</span><span class="main">,</span> insert <span class="free">x</span> <span class="free">U</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> qs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_doubletonE<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">⊆</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> insert <span class="free">x</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_mono_2<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> insert <span class="free">x</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="skolem">xx</span> <span class="main">*</span> <span class="free">h</span><span class="main">,</span> insert <span class="free">x</span> <span class="free">U</span><span class="main">)</span> <span class="main">⊆</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> insert <span class="free">x</span> <span class="free">U</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_mono_1<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xx_def Polys_def PPs_closed_single<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> insert <span class="free">x</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">with</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> insert <span class="free">x</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_closed_plus<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> insert <span class="free">x</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> insert <span class="free">x</span> <span class="free">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneE<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qU</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qU</span> <span class="main">=</span> except <span class="skolem">q</span> <span class="main">(</span><span class="main">-</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qx</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qx</span> <span class="main">=</span> except <span class="skolem">q</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">qU</span> <span class="main">+</span> <span class="skolem">qx</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> qU_def qx_def add.commute <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> except_decomp<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qU</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qU_def keys_except<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> x_adds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="keyword1">adds</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">qx</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span> <span class="keyword1"><span class="command">unfolding</span></span> adds_poly_mapping le_fun_def
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lookup <span class="var">?x</span> <span class="skolem">y</span> <span class="main">≤</span> lookup <span class="skolem">t</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∉</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qx_def keys_except<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">U</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">q</span> <span class="main">⊆</span> <span class="main">.[</span>insert <span class="free">x</span> <span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysD<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span>insert <span class="free">x</span> <span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">t</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPsD<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∉</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> keys <span class="skolem">t</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PPs_def<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> keys <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_single True in_keys_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_single<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qx'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qx'</span> <span class="main">=</span> Poly_Mapping.map_key <span class="main">(</span><span class="main">(+)</span> <span class="var">?x</span><span class="main">)</span> <span class="skolem">qx</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> lookup_qx'<span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">qx'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> lookup <span class="skolem">qx</span> <span class="main">(</span><span class="var">?x</span> <span class="main">+</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qx'_def map_key.rep_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qx'</span> <span class="main">*</span> <span class="skolem">xx</span> <span class="main">=</span> punit.monom_mult <span class="main">1</span> <span class="var">?x</span> <span class="skolem">qx'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> xx_def mult.commute <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> times_monomial_left<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">qx</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> punit.lookup_monom_mult lookup_qx' add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span><span class="main"><span class="main">]</span></span> adds_minus
              <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> not_in_keys_iff_lookup_eq_zero <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> x_adds <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> poly_mapping_eqI<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> qx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qx</span> <span class="main">=</span> <span class="skolem">qx'</span> <span class="main">*</span> <span class="skolem">xx</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qx'</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">U</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> PolysI subsetI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">qx'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">+</span> <span class="var">?x</span> <span class="main">∈</span> keys <span class="skolem">qx</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lookup_qx' in_keys_iff not_False_eq_True add.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> keys <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> qx_def keys_except<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">U</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">.[</span>insert <span class="free">x</span> <span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysD<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="var">?x</span><span class="main">)</span> <span class="main">-</span> <span class="var">?x</span> <span class="main">∈</span> <span class="main">.[</span>insert <span class="free">x</span> <span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_minus<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span>insert <span class="free">x</span> <span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">qU</span> <span class="main">*</span> <span class="free">h</span><span class="main">,</span> <span class="skolem">qx'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">xx</span> <span class="main">*</span> <span class="free">h</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound"><span class="bound">qs</span></span><span class="main">∈</span>listset <span class="var">?ss</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> sum_list <span class="bound">qs</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ex1I conjI allI impI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> refl <span class="quoted"><span class="quoted">‹<span class="skolem">qU</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qU</span> <span class="main">*</span> <span class="free">h</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneI<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> refl <span class="quoted"><span class="quoted">‹<span class="skolem">qx'</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">U</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qx'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">xx</span> <span class="main">*</span> <span class="free">h</span><span class="main">)</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">xx</span> <span class="main">*</span> <span class="free">h</span><span class="main">,</span> insert <span class="free">x</span> <span class="free">U</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneI<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="var">?ss</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_doubletonI<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">qs0</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">∈</span> listset <span class="var">?ss</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">∈</span> listset <span class="var">?ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> sum_list <span class="skolem">qs0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">xx</span> <span class="main">*</span> <span class="free">h</span><span class="main">,</span> insert <span class="free">x</span> <span class="free">U</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> qs0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">p1</span><span class="main">,</span> <span class="skolem">p2</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_doubletonE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qU0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qU0</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">=</span> <span class="skolem">qU0</span> <span class="main">*</span> <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> p2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qx0</span></span> <span class="keyword2"><span class="keyword">where</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span> <span class="main">=</span> <span class="skolem">qx0</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">xx</span> <span class="main">*</span> <span class="free">h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneE<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs0</span> <span class="main">=</span> <span class="skolem">qs</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs_def qs0 p1 p2<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">from</span></span> a0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">qU</span> <span class="main">-</span> <span class="skolem">qU0</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">qx0</span> <span class="main">-</span> <span class="skolem">qx'</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">xx</span> <span class="main">*</span> <span class="free">h</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a qs0 p1 p2 q qx <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qU</span> <span class="main">-</span> <span class="skolem">qU0</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">qx0</span> <span class="main">-</span> <span class="skolem">qx'</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">xx</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> times_canc_right<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qx0</span> <span class="main">=</span> <span class="skolem">qx'</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qx0</span> <span class="main">≠</span> <span class="skolem">qx'</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qx0</span> <span class="main">-</span> <span class="skolem">qx'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xx_def monomial_0_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lpp <span class="main">(</span><span class="main">(</span><span class="skolem">qx0</span> <span class="main">-</span> <span class="skolem">qx'</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">xx</span><span class="main">)</span> <span class="main">=</span> lpp <span class="main">(</span><span class="skolem">qx0</span> <span class="main">-</span> <span class="skolem">qx'</span><span class="main">)</span> <span class="main">+</span> lpp <span class="skolem">xx</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lp_times<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">xx</span> <span class="main">=</span> <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xx_def punit.lt_monomial<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="keyword1">adds</span> lpp <span class="main">(</span><span class="skolem">qU</span> <span class="main">-</span> <span class="skolem">qU0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lookup <span class="var">?x</span> <span class="free">x</span> <span class="main">≤</span> lookup <span class="main">(</span>lpp <span class="main">(</span><span class="skolem">qU</span> <span class="main">-</span> <span class="skolem">qU0</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> adds_poly_mapping le_fun_def<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> keys <span class="main">(</span>lpp <span class="main">(</span><span class="skolem">qU</span> <span class="main">-</span> <span class="skolem">qU0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff lookup_single<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lpp <span class="main">(</span><span class="skolem">qU</span> <span class="main">-</span> <span class="skolem">qU0</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span><span class="skolem">qU</span> <span class="main">-</span> <span class="skolem">qU0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_in_keys<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">qx0</span> <span class="main">-</span> <span class="skolem">qx'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xx</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qU</span> <span class="main">-</span> <span class="skolem">qU0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> times_not_zero<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> indets <span class="main">(</span><span class="skolem">qU</span> <span class="main">-</span> <span class="skolem">qU0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_indetsI<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">qU</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">qU0</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qU</span> <span class="main">-</span> <span class="skolem">qU0</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_minus<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"indets <span class="main">(</span><span class="skolem">qU</span> <span class="main">-</span> <span class="skolem">qU0</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysD<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> indets <span class="main">(</span><span class="skolem">qU</span> <span class="main">-</span> <span class="skolem">qU0</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qU0</span> <span class="main">=</span> <span class="skolem">qU</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> qs_def qs0 p1 p2<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs_def a q qx<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">valid_decomp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> set <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>zero<span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">valid_decomp</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">.</span> <span class="bound">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">]</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">monomial_decomp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>one<span class="main">,</span>zero<span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">monomial_decomp</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">hU</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">.</span> is_monomial <span class="main">(</span>fst <span class="bound">hU</span><span class="main">)</span> <span class="main">∧</span> punit.lc <span class="main">(</span>fst <span class="bound">hU</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hom_decomp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>one<span class="main">,</span>zero<span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom_decomp</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">hU</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">.</span> homogeneous <span class="main">(</span>fst <span class="bound">hU</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cone_decomp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span>
                            <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>comm_semiring_0<span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cone_decomp</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">⟷</span> direct_decomp <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span>map cone <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> valid_decompI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">h</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="bound">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">h</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="bound">h</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">h</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free">X</span><span class="main">)</span> <span class="main">⟹</span> valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_decomp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> valid_decompD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> valid_decomp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> valid_decompD_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> valid_decomp_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_decomp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> valid_decomp_concat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span><span class="main">.</span> <span class="bound">ps</span> <span class="main">∈</span> set <span class="free">pss</span> <span class="main">⟹</span> valid_decomp <span class="free">X</span> <span class="bound">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span>concat <span class="free">pss</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>concat <span class="free">pss</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">∈</span> set <span class="free">pss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_concat <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">ps</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> valid_decomp_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span><span class="free">ps</span> <span class="main">@</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span>concat <span class="main">[</span><span class="free">ps</span><span class="main">,</span> <span class="free">qs</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decomp_concat<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> valid_decomp_map_times<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span>semiring_no_zero_divisors<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span>map <span class="main">(</span>apfst <span class="main">(</span><span class="main">(*)</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span>apfst <span class="main">(</span><span class="main">(*)</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">=</span> apfst <span class="main">(</span><span class="main">(*)</span> <span class="free">s</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_map <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="free">s</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_times<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> times_not_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> monomial_decompI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">h</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> is_monomial <span class="bound">h</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">h</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> punit.lc <span class="bound">h</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟹</span>
    monomial_decomp <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monomial_decomp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> monomial_decompD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="free">h</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monomial_decomp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> monomial_decomp_append_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span><span class="free">ps</span> <span class="main">@</span> <span class="free">qs</span><span class="main">)</span> <span class="main">⟷</span> monomial_decomp <span class="free">ps</span> <span class="main">∧</span> monomial_decomp <span class="free">qs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monomial_decomp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> monomial_decomp_concat<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">ps</span><span class="main">.</span> <span class="bound">ps</span> <span class="main">∈</span> set <span class="free">pss</span> <span class="main">⟹</span> monomial_decomp <span class="bound">ps</span><span class="main">)</span> <span class="main">⟹</span> monomial_decomp <span class="main">(</span>concat <span class="free">pss</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">pss</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monomial_decomp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> monomial_decomp_map_times<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>semiring_1<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span>map <span class="main">(</span>apfst <span class="main">(</span><span class="main">(*)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decompI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span>apfst <span class="main">(</span><span class="main">(*)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">=</span> apfst <span class="main">(</span><span class="main">(*)</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_map <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="free">f</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="skolem">a</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decompD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>punit.lc <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>lpp <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.monomial_eq_itself<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> lpp <span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹punit.lc <span class="skolem">a</span> <span class="main">=</span> <span class="main">1</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>punit.lc <span class="free">f</span><span class="main">)</span> <span class="main">(</span>lpp <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.monomial_eq_itself<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> lpp <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h a f times_monomial_monomial monomial_is_monomial<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="skolem">h</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h a f times_monomial_monomial<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> monomial_decomp_monomial_in_cone<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">hU</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> cone <span class="free">hU</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>lookup <span class="free">a</span> <span class="free">t</span><span class="main">)</span> <span class="free">t</span> <span class="main">∈</span> cone <span class="free">hU</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> keys <span class="free">a</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> hU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hU</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> monomial <span class="skolem">c</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_monomial_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="skolem">U</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hU <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> punit.monom_mult <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> h times_monomial_left<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> punit.monom_mult <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> keys <span class="main">(</span>punit.monom_mult <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">(+)</span> <span class="skolem">s</span> <span class="main">`</span> keys <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> punit.keys_monom_mult_subset<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> keys <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">+</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="skolem">U</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">q</span> <span class="main">⊆</span> <span class="main">.[</span><span class="skolem">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysD<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">.[</span><span class="skolem">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>lookup <span class="free">a</span> <span class="free">t</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> monomial <span class="main">(</span>lookup <span class="skolem">q</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">u</span> <span class="main">*</span> <span class="skolem">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a t punit.lookup_monom_mult h times_monomial_monomial mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="main">.[</span><span class="skolem">U</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>lookup <span class="skolem">q</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">u</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="skolem">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hU <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_in_cone in_keys_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> monomial_decomp_sum_list_monomial_in_cone<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> keys <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c</span> <span class="free">h</span> <span class="free">U</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"monomial <span class="free">c</span> <span class="free">t</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> sum_list <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> keys_sum_list_subset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> Keys <span class="main">(</span>set <span class="skolem">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="skolem">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> keys <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_KeysE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">qs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> qs_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">qs</span> <span class="main">=</span> length <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> qs_in this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>lookup <span class="skolem">q</span> <span class="free">t</span><span class="main">)</span> <span class="free">t</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decomp_monomial_in_cone<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> psi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ps</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> psi<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">∈</span> keys <span class="skolem">q</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">q</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>lookup <span class="skolem">q</span> <span class="free">t</span><span class="main">)</span> <span class="free">t</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> psi<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_decompI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">h</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> homogeneous <span class="bound">h</span><span class="main">)</span> <span class="main">⟹</span> hom_decomp <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hom_decomp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> hom_decompD<span class="main">:</span> <span class="quoted"><span class="quoted">"hom_decomp <span class="free">ps</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> homogeneous <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hom_decomp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> hom_decomp_append_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"hom_decomp <span class="main">(</span><span class="free">ps</span> <span class="main">@</span> <span class="free">qs</span><span class="main">)</span> <span class="main">⟷</span> hom_decomp <span class="free">ps</span> <span class="main">∧</span> hom_decomp <span class="free">qs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hom_decomp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> hom_decomp_concat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">ps</span><span class="main">.</span> <span class="bound">ps</span> <span class="main">∈</span> set <span class="free">pss</span> <span class="main">⟹</span> hom_decomp <span class="bound">ps</span><span class="main">)</span> <span class="main">⟹</span> hom_decomp <span class="main">(</span>concat <span class="free">pss</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">pss</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hom_decomp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> hom_decomp_map_times<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="main">(</span>map <span class="main">(</span>apfst <span class="main">(</span><span class="main">(*)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> hom_decompI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span>apfst <span class="main">(</span><span class="main">(*)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">=</span> apfst <span class="main">(</span><span class="main">(*)</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_map <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="free">f</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> homogeneous_times<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> monomial_decomp_imp_hom_decomp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="free">ps</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> hom_decompI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> monomial <span class="skolem">c</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_monomial_monomial<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> homogeneous_monomial<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cone_decompI<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span> <span class="main">⟹</span> cone_decomp <span class="free">T</span> <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cone_decomp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> cone_decompD<span class="main">:</span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="free">ps</span> <span class="main">⟹</span> direct_decomp <span class="free">T</span> <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cone_decomp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> cone_decomp_cone_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">hU</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone <span class="free">hU</span> <span class="main">⊆</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> cone <span class="free">hU</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hU</span> <span class="main">=</span> <span class="free">ps</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> <span class="main">(</span>map <span class="main">0</span> <span class="free">ps</span><span class="main">)</span><span class="main">[</span><span class="skolem">i</span> <span class="main">:=</span> <span class="skolem">p</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> direct_decompD listsetI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ps</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> cone <span class="free">hU</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> map cone <span class="free">ps</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> qs_def nth_list_update zero_in_cone hU<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs</span> <span class="main">=</span> <span class="skolem">qs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_list_eq_nthI<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs_def <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ps</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cone_decomp_indets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span><span class="main">{</span>comm_semiring_1<span class="main">,</span>semiring_no_zero_divisors<span class="main">}</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decomp_cone_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_subset_PolysD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cone_decomp_closed_plus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> dd<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qsa</span></span> <span class="keyword2"><span class="keyword">where</span></span> qsa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qsa</span> <span class="main">∈</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> sum_list <span class="skolem">qsa</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> dd assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qsb</span></span> <span class="keyword2"><span class="keyword">where</span></span> qsb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qsb</span> <span class="main">∈</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> sum_list <span class="skolem">qsb</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> qsa <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">qsa</span> <span class="main">=</span> length <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> qsb <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">qsb</span> <span class="main">=</span> length <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">=</span> sum_list <span class="main">(</span>map2 <span class="main">(+)</span> <span class="skolem">qsa</span> <span class="skolem">qsb</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sum_list_map2_plus a b<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> dd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>map2 <span class="main">(+)</span> <span class="skolem">qsa</span> <span class="skolem">qsb</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompD<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> qsa qsb <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map2 <span class="main">(+)</span> <span class="skolem">qsa</span> <span class="skolem">qsb</span> <span class="main">∈</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> listset_closed_map2<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">p1</span> <span class="skolem">p2</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> set <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">hU</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> cone <span class="skolem">hU</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">∈</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span> <span class="main">∈</span> <span class="skolem">c</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">+</span> <span class="skolem">p2</span> <span class="main">∈</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_closed_plus<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cone_decomp_closed_uminus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span>comm_ring<span class="main">)</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> dd<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qsa</span></span> <span class="keyword2"><span class="keyword">where</span></span> qsa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qsa</span> <span class="main">∈</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> sum_list <span class="skolem">qsa</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> qsa <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">qsa</span> <span class="main">=</span> length <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">a</span> <span class="main">=</span> sum_list <span class="main">(</span>map uminus <span class="skolem">qsa</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">qsa</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> dd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompD<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> qsa <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map uminus <span class="skolem">qsa</span> <span class="main">∈</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> listset_closed_map<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">p</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> set <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">hU</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> cone <span class="skolem">hU</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">c</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_closed_uminus<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> cone_decomp_closed_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span>comm_ring<span class="main">)</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decomp_closed_uminus<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decomp_closed_plus<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cone_decomp_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cone_decomp_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> direct_decompI_alt<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cone_decomp_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>cone <span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cone_decomp_def direct_decomp_singleton<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cone_decomp_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">[</span><span class="free">S1</span><span class="main">,</span> <span class="free">S2</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">S1</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">S2</span> <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="main">(</span><span class="free">ps</span> <span class="main">@</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decompI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">S1</span> <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">(</span><span class="main">[</span><span class="free">S2</span><span class="main">]</span> <span class="main">@</span> map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_direct_decomp<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">(</span><span class="free">S2</span> <span class="main">#</span> map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">S2</span> <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">(</span>map cone <span class="free">ps</span> <span class="main">@</span> map cone <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> direct_decomp_direct_decomp<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">(</span>map cone <span class="main">(</span><span class="free">ps</span> <span class="main">@</span> <span class="free">qs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cone_decomp_concat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">pss</span> <span class="main">=</span> length <span class="free">ss</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">ss</span> <span class="main">⟹</span> cone_decomp <span class="main">(</span><span class="free">ss</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">pss</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="main">(</span>concat <span class="free">pss</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span> 1<span class="main">,</span> 3<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">pss</span></span> <span class="quoted"><span class="free">ss</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">T</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">from</span></span> Nil<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cone_decomp_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">ps</span> <span class="skolem">pss</span> <span class="skolem">s</span> <span class="skolem">ss</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">s</span> <span class="main">#</span> <span class="skolem">ss</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="main">#</span> <span class="skolem">ss</span><span class="main">)</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ps</span> <span class="main">#</span> <span class="skolem">pss</span><span class="main">)</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="skolem">s</span> <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="skolem">s</span> <span class="main">(</span>map cone <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="skolem">T</span> <span class="main">(</span><span class="skolem">ss</span> <span class="main">@</span> map cone <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_direct_decomp<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="skolem">T</span> <span class="main">[</span>sum_list <span class="main">`</span> listset <span class="skolem">ss</span><span class="main">,</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="skolem">ps</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>sum_list <span class="main">`</span> listset <span class="skolem">ss</span><span class="main">)</span> <span class="skolem">ss</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> direct_decomp_appendD <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> empty_not_in_map_cone<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> 1
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>sum_list <span class="main">`</span> listset <span class="skolem">ss</span><span class="main">)</span> <span class="main">(</span>concat <span class="skolem">pss</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.hyps<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">ss</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">s</span> <span class="main">#</span> <span class="skolem">ss</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="main">#</span> <span class="skolem">ss</span><span class="main">)</span> <span class="main">!</span> Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ps</span> <span class="main">#</span> <span class="skolem">pss</span><span class="main">)</span> <span class="main">!</span> Suc <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.prems<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span><span class="skolem">ss</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pss</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="skolem">ps</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ps</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> cone_decompI direct_decompI refl<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on sum_list <span class="main">(</span>listset <span class="main">(</span>map cone <span class="skolem">ps</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> direct_decomp_def bij_betw_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="skolem">T</span> <span class="main">(</span>concat <span class="skolem">pss</span> <span class="main">@</span> <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decomp_append<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="skolem">T</span> <span class="main">(</span>map cone <span class="main">(</span>concat <span class="skolem">pss</span><span class="main">)</span> <span class="main">@</span> map cone <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cone_decomp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="skolem">T</span> <span class="main">(</span>map cone <span class="skolem">ps</span> <span class="main">@</span> map cone <span class="main">(</span>concat <span class="skolem">pss</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> perm_append_swap <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_perm<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cone_decomp_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cone_decomp_map_times<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span><span class="main">(*)</span> <span class="free">s</span> <span class="main">`</span> <span class="free">T</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>apfst <span class="main">(</span><span class="main">(*)</span> <span class="main">(</span><span class="free">s</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">,</span>ring_no_zero_divisors<span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decompI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span><span class="main">(*)</span> <span class="free">s</span> <span class="main">`</span> <span class="free">T</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">(`)</span> <span class="main">(</span><span class="main">(*)</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_image_times<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> times_canc_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">(`)</span> <span class="main">(</span><span class="main">(*)</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span> <span class="main">=</span> map cone <span class="main">(</span>map <span class="main">(</span>apfst <span class="main">(</span><span class="main">(*)</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cone_image_times'<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span><span class="main">(*)</span> <span class="free">s</span> <span class="main">`</span> <span class="free">T</span><span class="main">)</span> <span class="main">(</span>map cone <span class="main">(</span>map <span class="main">(</span>apfst <span class="main">(</span><span class="main">(*)</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cone_decomp_perm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"perm <span class="free">ps</span> <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="free">qs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> cone_decomp_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_perm<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"perm <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span> <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quoted"><span class="free">qs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> perm.induct<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> valid_cone_decomp_subset_Polys<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> sum_list <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="free">T</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">qs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">from</span></span> Nil<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_in_Polys<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">ps</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cone <span class="skolem">a</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_subset_PolysI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_decomp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="main">(</span>cone <span class="skolem">a</span> <span class="main">#</span> map cone <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">qs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> cone <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qs'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs'</span> <span class="main">∈</span> listset <span class="main">(</span>map cone <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">#</span> <span class="skolem">qs'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_ConsE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹cone <span class="skolem">a</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹valid_decomp <span class="free">X</span> <span class="skolem">ps</span>›</span></span> qs' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">qs'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">+</span> sum_list <span class="skolem">qs'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_plus<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> homogeneous_set_cone_decomp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"homogeneous_set <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> homogeneous_set_direct_decomp<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decompD<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">cn</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cn</span> <span class="main">∈</span> set <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">hU</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hU</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cn</span> <span class="main">=</span> cone <span class="skolem">hU</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_map <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> hU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hU</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_decompD<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"homogeneous_set <span class="skolem">cn</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cn hU <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> homogeneous_set_coneI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subspace_cone_decomp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"phull.subspace <span class="main">(</span><span class="free">T</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span>field<span class="main">)</span> set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> phull.subspace_direct_decomp<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decompD<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">cn</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cn</span> <span class="main">∈</span> set <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">hU</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hU</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cn</span> <span class="main">=</span> cone <span class="skolem">hU</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_map <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"phull.subspace <span class="skolem">cn</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subspace_cone<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pos_decomp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list"</span></span>
    <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇩</span><sub>+</sub></span><span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pos_decomp</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> snd <span class="bound">p</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">standard_decomp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>zero<span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">standard_decomp</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≤</span> poly_deg <span class="bound">h</span> <span class="main">∧</span>
                                      <span class="main">(</span><span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≤</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">≤</span> poly_deg <span class="bound">h</span> <span class="main">⟶</span>
                                        <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">.</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> <span class="bound">d</span> <span class="main">∧</span> card <span class="bound">U</span> <span class="main">≤</span> card <span class="bound">U'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pos_decomp_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pos_decomp_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pos_decomp_append<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ps</span> <span class="main">@</span> <span class="free">qs</span><span class="main">)</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span> <span class="main">=</span> <span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span> <span class="main">@</span> <span class="free">qs</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pos_decomp_concat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>concat <span class="free">pss</span><span class="main">)</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span> <span class="main">=</span> concat <span class="main">(</span>map pos_decomp <span class="free">pss</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> filter_concat map_eq_conv pos_decomp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pos_decomp_map<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map <span class="main">(</span>apfst <span class="free">f</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span> <span class="main">=</span> map <span class="main">(</span>apfst <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> pos_decomp_def filter_cong filter_map o_apply snd_apfst<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> card_Diff_pos_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">h</span></span><span class="main">,</span> <span class="bound"><span class="bound">U</span></span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span> <span class="main">-</span> set <span class="main">(</span><span class="free">qs</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">h</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">h</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">h</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">h</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">h</span><span class="main">}</span> <span class="main">=</span> fst <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">h</span></span><span class="main">,</span> <span class="bound"><span class="bound">U</span></span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span> <span class="main">-</span> set <span class="main">(</span><span class="free">qs</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">h</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pos_decomp_def image_Collect<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">…</span> <span class="main">=</span> card <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">h</span></span><span class="main">,</span> <span class="bound"><span class="bound">U</span></span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span> <span class="main">-</span> set <span class="main">(</span><span class="free">qs</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">h</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_image<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pos_decomp_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inj_onI<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> standard_decompI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">≤</span> poly_deg <span class="bound">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span> <span class="bound">U</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">≤</span> <span class="bound">d</span> <span class="main">⟹</span> <span class="bound">d</span> <span class="main">≤</span> poly_deg <span class="bound">h</span> <span class="main">⟹</span>
          <span class="main">(</span><span class="main">∃</span><span class="bound">h'</span> <span class="bound">U'</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">∧</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> <span class="bound">d</span> <span class="main">∧</span> card <span class="bound">U</span> <span class="main">≤</span> card <span class="bound">U'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> standard_decomp_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> standard_decompD<span class="main">:</span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">ps</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">≤</span> poly_deg <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> standard_decomp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> standard_decompE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> poly_deg <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">h'</span> <span class="free">U'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h'</span><span class="main">,</span> <span class="free">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">h'</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">U</span> <span class="main">≤</span> card <span class="free">U'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> standard_decomp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> standard_decomp_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟹</span> standard_decomp <span class="free">k</span> <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> standard_decomp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> standard_decomp_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>poly_deg <span class="free">h</span><span class="main">)</span> <span class="main">[</span><span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> standard_decomp_def pos_decomp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> standard_decomp_concat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span><span class="main">.</span> <span class="bound">ps</span> <span class="main">∈</span> set <span class="free">pss</span> <span class="main">⟹</span> standard_decomp <span class="free">k</span> <span class="bound">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="main">(</span>concat <span class="free">pss</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="main">(</span>concat <span class="free">pss</span><span class="main">)</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">∈</span> set <span class="free">pss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pos_decomp_concat<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> poly_deg <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompD<span class="main">)</span>

  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≤</span> poly_deg <span class="skolem">h</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹standard_decomp <span class="free">k</span> <span class="skolem">ps</span>›</span></span> * <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="skolem"><span class="skolem">U'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U</span> <span class="main">≤</span> card <span class="skolem">U'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompE<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">ps</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ps</span> <span class="main">∈</span> set <span class="free">pss</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>concat <span class="free">pss</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">h'</span> <span class="bound">U'</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>concat <span class="free">pss</span><span class="main">)</span> <span class="main">∧</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> card <span class="skolem">U</span> <span class="main">≤</span> card <span class="bound">U'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> standard_decomp_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="main">(</span><span class="free">ps</span> <span class="main">@</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="main">(</span>concat <span class="main">[</span><span class="free">ps</span><span class="main">,</span> <span class="free">qs</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decomp_concat<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> standard_decomp_map_times<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>semiring_no_zero_divisors<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span><span class="free">k</span> <span class="main">+</span> poly_deg <span class="free">s</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>apfst <span class="main">(</span><span class="main">(*)</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="main">(</span>map <span class="main">(</span>apfst <span class="main">(</span><span class="main">(*)</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h0</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="free">s</span> <span class="main">*</span> <span class="skolem">h0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pos_decomp_map<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> pos_decomp_subset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> deg_h<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">=</span> poly_deg <span class="free">s</span> <span class="main">+</span> poly_deg <span class="skolem">h0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_deg_times<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> poly_deg <span class="skolem">h0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">+</span> poly_deg <span class="free">s</span> <span class="main">≤</span> poly_deg <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">+</span> poly_deg <span class="free">s</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≤</span> poly_deg <span class="skolem">h</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="skolem">d</span> <span class="main">-</span> poly_deg <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">-</span> poly_deg <span class="free">s</span> <span class="main">≤</span> poly_deg <span class="skolem">h0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_h<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> 1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="skolem"><span class="skolem">U'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">-</span> poly_deg <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U</span> <span class="main">≤</span> card <span class="skolem">U'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> deg_h'<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span><span class="free">s</span> <span class="main">*</span> <span class="skolem">h'</span><span class="main">)</span> <span class="main">=</span> poly_deg <span class="free">s</span> <span class="main">+</span> poly_deg <span class="skolem">h'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_deg_times<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">*</span> <span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span>apfst <span class="main">(</span><span class="main">(*)</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">+</span> poly_deg <span class="free">s</span> <span class="main">≤</span> <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">-</span> poly_deg <span class="free">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span><span class="free">s</span> <span class="main">*</span> <span class="skolem">h'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_h'<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">h'</span> <span class="bound">U'</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span>apfst <span class="main">(</span><span class="main">(*)</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span> <span class="main">∧</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> card <span class="skolem">U</span> <span class="main">≤</span> card <span class="bound">U'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">U</span> <span class="main">≤</span> card <span class="skolem">U'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> standard_decomp_nonempty_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> Min <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> Min <span class="var">?A</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Min_in<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> poly_deg <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> m_min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> poly_deg <span class="skolem">h'</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">h'</span> <span class="skolem">U'</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span>fst <span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> poly_deg <span class="main">(</span>fst <span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Min_le<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> linorder_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> poly_deg <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>›</span></span> le_refl <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="skolem"><span class="skolem">U'</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U</span> <span class="main">≤</span> card <span class="skolem">U'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">&lt;</span> <span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">m</span> <span class="main">≤</span> poly_deg <span class="skolem">h'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> m_min <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U'</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">U</span> <span class="main">≤</span> card <span class="skolem">U'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> infinite <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_eq_0_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">U</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">U</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD_finite<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">k</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompD<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> m_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> standard_decomp_SucE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">,</span>ring_no_zero_divisors<span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ps</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>Suc <span class="main">(</span>poly_deg <span class="free">h</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="free">h</span> <span class="main">⟹</span> punit.lc <span class="free">h</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> monomial_decomp <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="free">h</span> <span class="main">⟹</span> hom_decomp <span class="free">ps</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span> 1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> that
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">U</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">,</span> 4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">[</span><span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_decomp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> cone_decomp_singleton
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>Suc <span class="main">(</span>poly_deg <span class="free">h</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decomp_Nil<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> empty<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monomial_decomp_def hom_decomp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">U</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> insert.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="skolem">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ps</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>Suc <span class="main">(</span>poly_deg <span class="free">h</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ps</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"is_monomial <span class="free">h</span> <span class="main">⟹</span> punit.lc <span class="free">h</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> monomial_decomp <span class="skolem">ps</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"homogeneous <span class="free">h</span> <span class="main">⟹</span> hom_decomp <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> insert.hyps<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span>Poly_Mapping.single <span class="skolem">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monomial_0_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span><span class="var">?x</span> <span class="main">*</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>poly_deg <span class="free">h</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_deg_times poly_deg_monomial deg_pm_single<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="var">?x</span> <span class="main">*</span> <span class="free">h</span><span class="main">,</span> insert <span class="skolem">x</span> <span class="skolem">U</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> insert.prems<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Polys_closed_monomial PPs_closed_single<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">*</span> <span class="free">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_times<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">*</span> <span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> times_not_zero<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert.hyps<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs_def valid_decomp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span><span class="skolem">ps</span> <span class="main">@</span> <span class="skolem">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decomp_append<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> insert <span class="skolem">x</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps</span> <span class="main">@</span> <span class="skolem">qs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decomp_append<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> insert <span class="skolem">x</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">,</span> cone <span class="main">(</span><span class="var">?x</span> <span class="main">*</span> <span class="free">h</span><span class="main">,</span> insert <span class="skolem">x</span> <span class="skolem">U</span><span class="main">)</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> insert.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_cone_insert<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>cone <span class="main">(</span><span class="var">?x</span> <span class="main">*</span> <span class="free">h</span><span class="main">,</span> insert <span class="skolem">x</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="skolem">qs</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qs_def cone_decomp_singleton<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> 1<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> standard_decomp_singleton<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">*</span> <span class="free">h</span>"</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="skolem">U</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>Suc <span class="main">(</span>poly_deg <span class="free">h</span><span class="main">)</span><span class="main">)</span> <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg qs_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>Suc <span class="main">(</span>poly_deg <span class="free">h</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps</span> <span class="main">@</span> <span class="skolem">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decomp_append<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="free">h</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="skolem">qs</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="main">(</span><span class="var">?x</span> <span class="main">*</span> <span class="free">h</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹is_monomial <span class="free">h</span>›</span></span> is_monomial_monomial monomial_is_monomial mult.commute
              mult.right_neutral mult_single<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monomial_decomp_def qs_def lc_times <span class="quoted"><span class="quoted">‹punit.lc <span class="free">h</span> <span class="main">=</span> <span class="main">1</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span><span class="skolem">ps</span> <span class="main">@</span> <span class="skolem">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> monomial_decomp_append_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="free">h</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 4<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹homogeneous <span class="free">h</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="skolem">qs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hom_decomp_def qs_def homogeneous_times<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="main">(</span><span class="skolem">ps</span> <span class="main">@</span> <span class="skolem">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> hom_decomp_append_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> standard_decomp_geE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span><span class="free">T</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">,</span>ring_no_zero_divisors<span class="main">}</span><span class="main">)</span> set<span class="main">)</span> <span class="free">ps</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">qs</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">d</span> <span class="free">qs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="free">ps</span> <span class="main">⟹</span> monomial_decomp <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="free">ps</span> <span class="main">⟹</span> hom_decomp <span class="free">qs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">qs</span><span class="main">.</span> valid_decomp <span class="free">X</span> <span class="bound">qs</span> <span class="main">∧</span> cone_decomp <span class="free">T</span> <span class="bound">qs</span> <span class="main">∧</span> standard_decomp <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span> <span class="bound">qs</span> <span class="main">∧</span>
              <span class="main">(</span>monomial_decomp <span class="free">ps</span> <span class="main">⟶</span> monomial_decomp <span class="bound">qs</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>hom_decomp <span class="free">ps</span> <span class="main">⟶</span> hom_decomp <span class="bound">qs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">,</span> 4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> add_0_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="skolem">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="skolem">qs</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="free">ps</span> <span class="main">⟹</span> monomial_decomp <span class="skolem">qs</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"hom_decomp <span class="free">ps</span> <span class="main">⟹</span> hom_decomp <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">hU</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">hU</span><span class="main">)</span> <span class="main">≠</span> <span class="free">k</span> <span class="main">+</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">-</span> <span class="var">?P</span><span class="main">)</span> <span class="skolem">qs</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ss</span> <span class="main">=</span> filter <span class="var">?P</span> <span class="skolem">qs</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">rs</span> <span class="main">⊆</span> set <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ss</span> <span class="main">⊆</span> set <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ss_def<span class="main">)</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">hU</span><span class="main">.</span> <span class="keyword1">SOME</span> <span class="bound">ps'</span><span class="main">.</span> valid_decomp <span class="free">X</span> <span class="bound">ps'</span> <span class="main">∧</span> cone_decomp <span class="main">(</span>cone <span class="bound">hU</span><span class="main">)</span> <span class="bound">ps'</span> <span class="main">∧</span>
                                        standard_decomp <span class="main">(</span>Suc <span class="main">(</span>poly_deg <span class="main">(</span><span class="main">(</span>fst <span class="bound">hU</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">ps'</span> <span class="main">∧</span>
                                        <span class="main">(</span>monomial_decomp <span class="free">ps</span> <span class="main">⟶</span> monomial_decomp <span class="bound">ps'</span><span class="main">)</span> <span class="main">∧</span>
                                        <span class="main">(</span>hom_decomp <span class="free">ps</span> <span class="main">⟶</span> hom_decomp <span class="bound">ps'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">hU</span><span class="main">)</span> <span class="main">∧</span> cone_decomp <span class="main">(</span>cone <span class="skolem">hU</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">hU</span><span class="main">)</span> <span class="main">∧</span> standard_decomp <span class="main">(</span>Suc <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">hU</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span>monomial_decomp <span class="free">ps</span> <span class="main">⟶</span> monomial_decomp <span class="main">(</span><span class="skolem">f</span> <span class="skolem">hU</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>hom_decomp <span class="free">ps</span> <span class="main">⟶</span> hom_decomp <span class="main">(</span><span class="skolem">f</span> <span class="skolem">hU</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hU</span> <span class="main">∈</span> set <span class="skolem">rs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">hU</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> hU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hU</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> that <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span>fst <span class="skolem">hU</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="main">+</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rs_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> that <span class="quoted"><span class="quoted">‹set <span class="skolem">rs</span> <span class="main">⊆</span> set <span class="skolem">qs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hU <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">with</span></span> 0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="skolem">ps'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ps'</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>Suc <span class="main">(</span>poly_deg <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ps'</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> md<span class="main">:</span> <span class="quoted"><span class="quoted">"is_monomial <span class="skolem">h</span> <span class="main">⟹</span> punit.lc <span class="skolem">h</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> monomial_decomp <span class="skolem">ps'</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> hd<span class="main">:</span> <span class="quoted"><span class="quoted">"homogeneous <span class="skolem">h</span> <span class="main">⟹</span> hom_decomp <span class="skolem">ps'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decomp_SucE<span class="main">)</span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>1-3<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="skolem">ps'</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="free">ps</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="skolem">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="skolem">h</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decompD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> md<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="skolem">ps'</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="free">ps</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 4<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_decompD<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hd<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="skolem">ps'</span> <span class="main">∧</span> cone_decomp <span class="main">(</span>cone <span class="skolem">hU</span><span class="main">)</span> <span class="skolem">ps'</span> <span class="main">∧</span>
          standard_decomp <span class="main">(</span>Suc <span class="main">(</span>poly_deg <span class="main">(</span>fst <span class="skolem">hU</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ps'</span> <span class="main">∧</span> <span class="main">(</span>monomial_decomp <span class="free">ps</span> <span class="main">⟶</span> monomial_decomp <span class="skolem">ps'</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span>hom_decomp <span class="free">ps</span> <span class="main">⟶</span> hom_decomp <span class="skolem">ps'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hU<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span><span class="main">.</span> <span class="bound">ps</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="skolem">f</span> <span class="skolem">rs</span><span class="main">)</span> <span class="main">⟹</span> valid_decomp <span class="free">X</span> <span class="bound">ps</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">hU</span><span class="main">.</span> <span class="bound">hU</span> <span class="main">∈</span> set <span class="skolem">rs</span> <span class="main">⟹</span> cone_decomp <span class="main">(</span>cone <span class="bound">hU</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">hU</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span><span class="main">.</span> <span class="bound">ps</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="skolem">f</span> <span class="skolem">rs</span><span class="main">)</span> <span class="main">⟹</span> standard_decomp <span class="main">(</span>Suc <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">ps</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps'</span><span class="main">.</span> monomial_decomp <span class="free">ps</span> <span class="main">⟹</span> <span class="bound">ps'</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="skolem">f</span> <span class="skolem">rs</span><span class="main">)</span> <span class="main">⟹</span> monomial_decomp <span class="bound">ps'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps'</span><span class="main">.</span> hom_decomp <span class="free">ps</span> <span class="main">⟹</span> <span class="bound">ps'</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="skolem">f</span> <span class="skolem">rs</span><span class="main">)</span> <span class="main">⟹</span> hom_decomp <span class="bound">ps'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs'</span> <span class="main">=</span> concat <span class="main">(</span>map <span class="skolem">f</span> <span class="skolem">rs</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> add_Suc_right
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI impI<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="skolem">ss</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">ss</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">ss</span> <span class="main">⊆</span> set <span class="skolem">qs</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">with</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="skolem">rs'</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> rs'_def <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decomp_concat<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span><span class="skolem">ss</span> <span class="main">@</span> <span class="skolem">rs'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decomp_append<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">(</span>map cone <span class="skolem">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decompD<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">(</span><span class="main">(</span>map cone <span class="skolem">ss</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>map cone <span class="skolem">rs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ss_def rs_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_split_map<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> ss<span class="main">:</span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="skolem">ss</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ss</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="skolem">rs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">rs</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">[</span>sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="skolem">ss</span><span class="main">)</span><span class="main">,</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="skolem">rs</span><span class="main">)</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cone_decomp_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> direct_decomp_appendD <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> empty_not_in_map_cone<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="skolem">rs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map cone <span class="skolem">rs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decompD<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="skolem">rs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">rs'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rs'_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decomp_concat<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
        <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>map cone <span class="skolem">rs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∈</span> set <span class="skolem">rs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>cone <span class="main">(</span><span class="skolem">rs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">rs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> f2<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>map cone <span class="skolem">rs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>map <span class="skolem">f</span> <span class="skolem">rs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> T ss <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="main">(</span><span class="skolem">ss</span> <span class="main">@</span> <span class="skolem">rs'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decomp_append<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>Suc <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ss</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ss</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">qs</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">≠</span> <span class="free">k</span> <span class="main">+</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def ss_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> 2 this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">≤</span> poly_deg <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompD<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹poly_deg <span class="skolem">h</span> <span class="main">≠</span> <span class="free">k</span> <span class="main">+</span> <span class="skolem">i</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> poly_deg <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d'</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">d'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">≤</span> poly_deg <span class="skolem">h</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">d'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">≠</span> <span class="free">k</span> <span class="main">+</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">from</span></span> 2 <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">qs</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>›</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="skolem"><span class="skolem">U'</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="skolem">d'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U</span> <span class="main">≤</span> card <span class="skolem">U'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d'</span> <span class="main">≤</span> poly_deg <span class="skolem">h</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompE<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d'</span> <span class="main">≠</span> <span class="free">k</span> <span class="main">+</span> <span class="skolem">i</span>›</span></span> this<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ss_def<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">h'</span> <span class="bound">U'</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">ss</span> <span class="main">∧</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> <span class="skolem">d'</span> <span class="main">∧</span> card <span class="skolem">U</span> <span class="main">≤</span> card <span class="bound">U'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>Suc <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">rs'</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> rs'_def <span class="keyword1"><span class="command">using</span></span> f3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decomp_concat<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>Suc <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ss</span> <span class="main">@</span> <span class="skolem">rs'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decomp_append<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="free">ps</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="skolem">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monomial_decomp_def ss_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="skolem">rs'</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> rs'_def <span class="keyword1"><span class="command">using</span></span> f4<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decomp_concat<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span><span class="skolem">ss</span> <span class="main">@</span> <span class="skolem">rs'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> monomial_decomp_append_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"hom_decomp <span class="free">ps</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 4<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="skolem">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hom_decomp_def ss_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="skolem">rs'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rs'_def <span class="keyword1"><span class="command">using</span></span> f5<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_decomp_concat<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="main">(</span><span class="skolem">ss</span> <span class="main">@</span> <span class="skolem">rs'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> hom_decomp_append_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="skolem">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="skolem">qs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="free">ps</span> <span class="main">⟹</span> monomial_decomp <span class="skolem">qs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"hom_decomp <span class="free">ps</span> <span class="main">⟹</span> hom_decomp <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">d</span> <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 4 5 <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Splitting w.r.t. Ideals›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">splits_wrt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list<span class="main">)</span> <span class="main">⇒</span>
                          <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>comm_ring_1<span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">splits_wrt</span> <span class="free"><span class="bound"><span class="entity">pqs</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">⟷</span> cone_decomp <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">pqs</span></span></span> <span class="main">@</span> snd <span class="free"><span class="bound"><span class="entity">pqs</span></span></span><span class="main">)</span> <span class="main">∧</span>
                                <span class="main">(</span><span class="main">∀</span><span class="bound">hU</span><span class="main">∈</span>set <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">pqs</span></span></span><span class="main">)</span><span class="main">.</span> cone <span class="bound">hU</span> <span class="main">⊆</span> ideal <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
                                <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">pqs</span></span></span><span class="main">)</span><span class="main">.</span> cone <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∧</span> cone <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∩</span> ideal <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> splits_wrtI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="main">(</span><span class="free">ps</span> <span class="main">@</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> cone <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="bound">h</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span> <span class="main">⟹</span> cone <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span> <span class="bound">U</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"splits_wrt <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">qs</span><span class="main">)</span> <span class="free">T</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> splits_wrt_def fst_conv snd_conv
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI ballI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">hU</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hU</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> hU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hU</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> _ this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cone <span class="skolem">hU</span> <span class="main">⊆</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hU
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Int_greatest<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">⊆</span> ideal <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="skolem">U</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">∈</span> ideal <span class="free">F</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_scale<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">hU</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hU</span> <span class="main">∈</span> set <span class="free">qs</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> hU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hU</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∩</span> ideal <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_in_cone ideal.span_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">case</span> <span class="skolem">hU</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">⇒</span> cone <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∧</span> cone <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∩</span> ideal <span class="free">F</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hU<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> assms<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> splits_wrtI_valid_decomp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="main">(</span><span class="free">ps</span> <span class="main">@</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="bound">h</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span> <span class="bound">U</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"splits_wrt <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">qs</span><span class="main">)</span> <span class="free">T</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> _ _ _ assms<span class="main">(</span>5<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrtI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_subset_PolysI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_subset_PolysI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> splits_wrtD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"splits_wrt <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">qs</span><span class="main">)</span> <span class="free">T</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="main">(</span><span class="free">ps</span> <span class="main">@</span> <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">hU</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> cone <span class="free">hU</span> <span class="main">⊆</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">hU</span> <span class="main">∈</span> set <span class="free">qs</span> <span class="main">⟹</span> cone <span class="free">hU</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">hU</span> <span class="main">∈</span> set <span class="free">qs</span> <span class="main">⟹</span> cone <span class="free">hU</span> <span class="main">∩</span> ideal <span class="free">F</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> splits_wrt_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> splits_wrt_image_sum_list_fst_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"splits_wrt <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">qs</span><span class="main">)</span> <span class="free">T</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span> <span class="main">⊆</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> x_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span> <span class="main">⊆</span> listset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> listset_mono<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⊆</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrtD<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> i <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map cone <span class="free">ps</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">⊆</span> map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="free">ps</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span> <span class="main">⊆</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> image_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> x_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> listset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> sum_list <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> xs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> length <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> xs this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">xs</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_closed_sum_list<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">xs</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_sum_list<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> splits_wrt_image_sum_list_snd_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"splits_wrt <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">qs</span><span class="main">)</span> <span class="free">T</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> x_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"listset <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span> <span class="main">⊆</span> listset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> listset_mono<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">qs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∈</span> set <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="free">qs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrtD<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> i <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map cone <span class="free">qs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">⊆</span> map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="free">qs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span> <span class="main">⊆</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> image_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> x_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> listset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> sum_list <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_sum_list<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> xs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> length <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> xs this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="free">qs</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> splits_wrt_cone_decomp_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"splits_wrt <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">qs</span><span class="main">)</span> <span class="free">T</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="main">(</span><span class="free">F</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> set<span class="main">)</span>"</span></span>
        <span class="comment1">―‹The last two assumptions are missing in the paper.›</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span><span class="free">T</span> <span class="main">∩</span> ideal <span class="free">F</span><span class="main">)</span> <span class="free">ps</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="main">(</span><span class="free">ps</span> <span class="main">@</span> <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrtD<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">(</span>map cone <span class="free">ps</span> <span class="main">@</span> map cone <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cone_decomp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">[</span>sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span><span class="main">,</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> direct_decomp_appendD <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> empty_not_in_map_cone<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ss</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span><span class="main">,</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> cone_decompI direct_decompI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on sum_list <span class="main">(</span>listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> direct_decomp_def bij_betw_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span> <span class="main">⊆</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrt_image_sum_list_fst_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span> <span class="main">⊆</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span> <span class="main">=</span> <span class="free">T</span> <span class="main">∩</span> ideal <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">∩</span> ideal <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> x_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">∩</span> ideal <span class="free">F</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> IntI<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="free">qs</span> <span class="main">∈</span> listset <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ys</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">qs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> listset_ConsI zero_in_cone <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> listset.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="var">?ys</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> x_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">x</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span> <span class="main">∈</span> listset <span class="var">?ss</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> refl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_doubletonI<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">[</span><span class="skolem">x</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompD<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">from</span></span> x_in sub <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">∩</span> ideal <span class="free">F</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">from</span></span> 2 this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> listset <span class="var">?ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> sum_list <span class="skolem">xs</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompE<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">q</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_doubletonE<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> ideal <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x xs<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> p sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_diff<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">q</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> q <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decomp_sum_list_monomial_in_cone<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> ideal <span class="free">F</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.monomial_pmdl_field<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∩</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrtD<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monomial_0_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span> p <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x xs<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Together, Theorems <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>splits_wrt_image_sum_list_fst_subset›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>splits_wrt_cone_decomp_1›</span></span></span></span>
  imply that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ps</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is also a cone decomposition of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">T</span></span> <span class="main"><span class="main">∩</span></span> ideal <span class="free"><span class="free">F</span></span> <span class="main"><span class="main">∩</span></span> <span class="keyword1"><span class="keyword1">P[</span></span><span class="free"><span class="free">X</span></span><span class="main"><span class="main">]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> splits_wrt_cone_decomp_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"splits_wrt <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">qs</span><span class="main">)</span> <span class="free">T</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="free">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span><span class="free">T</span> <span class="main">∩</span> normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="free">qs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="main">(</span><span class="free">ps</span> <span class="main">@</span> <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrtD<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">(</span>map cone <span class="free">ps</span> <span class="main">@</span> map cone <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cone_decomp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">[</span>sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span><span class="main">,</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> direct_decomp_appendD <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> empty_not_in_map_cone<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ss</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span><span class="main">,</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.reduced_GB <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> G_is_GB<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="var">?G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ideal_G<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="var">?G</span> <span class="main">=</span> ideal <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_Polys<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> reduced_GB_is_GB_Polys<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> reduced_GB_ideal_Polys<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> cone_decompI direct_decompI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on sum_list <span class="main">(</span>listset <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> direct_decomp_def bij_betw_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span> <span class="main">⊆</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrt_image_sum_list_fst_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span> <span class="main">⊆</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span> <span class="main">=</span> <span class="free">T</span> <span class="main">∩</span> normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">∩</span> normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> x_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">∩</span> normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> IntI<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="free">ps</span> <span class="main">∈</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ys</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> listset_ConsI zero_in_cone <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> listset.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="var">?ys</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> this x_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> listset <span class="var">?ss</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> refl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_doubletonI<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompD<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrt_image_sum_list_snd_subset<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> x_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> punit.is_red <span class="var">?G</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"punit.is_red <span class="var">?G</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="var">?G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> adds<span class="main">:</span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">g</span> <span class="keyword1">adds</span> <span class="skolem">t</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.is_red_addsE<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> x_in this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decomp_sum_list_monomial_in_cone<span class="main">)</span>
            <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>3<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">∈</span> ideal <span class="var">?G</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> punit.is_red_monomial_monomial_set_in_pmdl<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_is_monomial<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 5<span class="main">,</span> 4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_is_monomial_set_Polys<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="var">?G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.is_red <span class="var">?G</span> <span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> adds
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.is_red_addsI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∩</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal_G<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrtD<span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monomial_0_iff<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_normal_form_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">∩</span> normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>1<span class="main">,</span> 5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> irred<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> punit.is_red <span class="var">?G</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_normal_form_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> 2 <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">T</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> listset <span class="var">?ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> sum_list <span class="skolem">xs</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompE<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">q</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_doubletonE<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x xs<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> p sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">p</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> ideal <span class="free">F</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.monomial_pmdl_field<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∉</span> keys <span class="skolem">q</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">q</span>"</span></span>
            <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> q <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decomp_sum_list_monomial_in_cone<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>3<span class="main">)</span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∩</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrtD<span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monomial_0_iff<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_keys_plusI1<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.is_red <span class="var">?G</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">note</span></span> G_is_GB
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">1</span> <span class="skolem">t</span> <span class="main">∈</span> ideal <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ideal_G<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monomial_0_iff<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="var">?G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">g</span> <span class="keyword1">adds</span> lpp <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.GB_adds_lt<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">g</span> <span class="keyword1">adds</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.lt_monomial<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="var">?G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">x</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.is_red_addsI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">with</span></span> irred <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span> q <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x xs<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quot_monomial_ideal_monomial<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="main">÷</span> monomial <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'x</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    ideal <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>comm_ring_1<span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> Poly_Mapping.single <span class="free">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="free">x</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="main">÷</span> monomial <span class="main">1</span> <span class="var">?x</span> <span class="main">⟷</span> punit.monom_mult <span class="main">1</span> <span class="var">?x</span> <span class="skolem">a</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> quot_set_iff times_monomial_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="skolem">a</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="var">?x</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> poly_mapping_plus_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal.span_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">t</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="var">?x</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.monom_mult <span class="main">1</span> <span class="var">?x</span> <span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_monomial_setI monomial_is_monomial<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 0 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="main">(</span><span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">+</span> punit.monom_mult <span class="main">1</span> <span class="var">?x</span> <span class="skolem">a</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.monom_mult_monomial punit.monom_mult_dist_right<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>monomial <span class="skolem">c</span> <span class="main">(</span><span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">+</span> punit.monom_mult <span class="main">1</span> <span class="var">?x</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> in_keys_plusI1 notI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>monomial <span class="skolem">c</span> <span class="main">(</span><span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>punit.monom_mult <span class="main">1</span> <span class="var">?x</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">(+)</span> <span class="var">?x</span> <span class="main">`</span> keys <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.keys_monom_mult_subset<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> keys <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">=</span> <span class="var">?x</span> <span class="main">+</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> keys <span class="skolem">a</span>›</span></span> 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> adds<span class="main">:</span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">f</span> <span class="keyword1">adds</span> <span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.keys_monomial_pmdl<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">from</span></span> adds <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">adds</span> <span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f punit.lt_monomial<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">-</span> <span class="var">?x</span> <span class="keyword1">adds</span> <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add_minus_2 adds_minus adds_triv_right plus_minus_assoc_pm_nat_1<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="var">?x</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> addsE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">1</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="var">?x</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> imageI<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> ideal <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_superset<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="skolem">s'</span> <span class="main">*</span> monomial <span class="main">1</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="var">?x</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="var">?S</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_scale<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">∈</span> ideal <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_monomial_monomial t add.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> ideal <span class="var">?S</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_base<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.monom_mult <span class="skolem">c</span> <span class="main">(</span><span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.pmdl_closed_monom_mult<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="keyword1">adds</span> <span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="main">(</span><span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f punit.monom_mult_monomial adds_minus<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="main">(</span><span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">+</span> punit.monom_mult <span class="main">1</span> <span class="var">?x</span> <span class="skolem">a</span> <span class="main">-</span> monomial <span class="skolem">c</span> <span class="main">(</span><span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_diff<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">∈</span> ideal <span class="var">?S</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_add<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_monomial_setI monomial_is_monomial<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">∈</span> ideal <span class="var">?S</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> _ 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> in_keys_plusI1<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> adds<span class="main">:</span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">f</span> <span class="keyword1">adds</span> <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.keys_monomial_pmdl<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="var">?x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> adds <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">-</span> <span class="var">?x</span> <span class="keyword1">adds</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f punit.lt_monomial<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">adds</span> <span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adds_poly_mapping le_fun_def lookup_add lookup_minus lookup_single when_def
            <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">+</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> addsE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">1</span> <span class="skolem">s</span> <span class="main">∈</span> monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_superset<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="skolem">s'</span> <span class="main">*</span> monomial <span class="main">1</span> <span class="skolem">s</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_scale<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="main">(</span><span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> t<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_monomial_monomial add.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.monom_mult <span class="main">1</span> <span class="var">?x</span> <span class="skolem">a</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="var">?S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> ideal <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_base<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.monom_mult <span class="skolem">c</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="var">?x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">∈</span> ideal <span class="var">?S</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.pmdl_closed_monom_mult<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">-</span> <span class="var">?x</span> <span class="keyword1">adds</span> <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">∈</span> ideal <span class="var">?S</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f punit.monom_mult_monomial adds_minus<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">-</span> monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">∈</span> ideal <span class="var">?S</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_diff<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="main">(</span><span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">+</span> punit.monom_mult <span class="main">1</span> <span class="var">?x</span> <span class="skolem">a</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_add<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"punit.monom_mult <span class="main">1</span> <span class="var">?x</span> <span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.monom_mult_monomial punit.monom_mult_dist_right<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="main">÷</span> monomial <span class="main">1</span> <span class="var">?x</span> <span class="main">⟷</span> <span class="skolem">a</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="var">?x</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lem_4_2_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">÷</span> monomial <span class="main">1</span> <span class="free">t</span> <span class="main">=</span> ideal <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>comm_ring_1<span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span>monomial <span class="main">1</span> <span class="free">t</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">⊆</span> ideal <span class="free">F</span> <span class="main">⟷</span> <span class="main">0</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">1</span> <span class="free">t</span> <span class="main">∈</span> cone <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="free">t</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tip_in_cone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span>monomial <span class="main">1</span> <span class="free">t</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">⊆</span> ideal <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"monomial <span class="main">1</span> <span class="free">t</span> <span class="main">*</span> <span class="main">1</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_monomial_setI monomial_is_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> quot_set_iff <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> keys <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> adds<span class="main">:</span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">g</span> <span class="keyword1">adds</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.keys_monomial_pmdl<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> adds <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">adds</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g punit.lt_monomial <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> single_one<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> adds_zero<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">1</span> <span class="main">0</span> <span class="main">∈</span> monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> single_one <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_base<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">÷</span> monomial <span class="main">1</span> <span class="free">t</span> <span class="main">=</span> UNIV"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">÷</span> <span class="var">?t</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> assms ideal_eq_UNIV_iff_contains_one<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span>monomial <span class="main">1</span> <span class="free">t</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">⊆</span> ideal <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="var">?t</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="var">?t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneE<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">÷</span> <span class="var">?t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> a quot_set_iff mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lem_4_2_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">÷</span> monomial <span class="main">1</span> <span class="free">t</span> <span class="main">=</span> ideal <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>comm_ring_1<span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span>monomial <span class="main">1</span> <span class="free">t</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∩</span> ideal <span class="free">F</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">⟷</span> <span class="free">S</span> <span class="main">∩</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="free">t</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="var">?t</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∩</span> ideal <span class="free">F</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">1</span> <span class="skolem">s</span> <span class="main">∈</span> monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_base<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ideal <span class="free">F</span> <span class="main">÷</span> <span class="var">?t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">*</span> <span class="var">?t</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> quot_set_iff mult.commute<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_monomial<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">*</span> <span class="var">?t</span> <span class="main">∈</span> cone <span class="main">(</span><span class="var">?t</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">*</span> <span class="var">?t</span> <span class="main">∈</span> cone <span class="main">(</span><span class="var">?t</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∩</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq times_monomial_monomial monomial_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∩</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="free">t</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∩</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="var">?t</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="var">?t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> ideal <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">÷</span> <span class="var">?t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> quot_set_iff a mult.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_monomial_setI monomial_is_monomial<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> q_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">q</span> <span class="main">∈</span> keys <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_in_keys<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> adds<span class="main">:</span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">g</span> <span class="keyword1">adds</span> lpp <span class="skolem">q</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.keys_monomial_pmdl<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">q</span> <span class="main">∈</span> keys <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_in_keys<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysD<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">q</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> adds <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">adds</span> lpp <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g punit.lt_monomial<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_adds<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> eq <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="var">?t</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∩</span> ideal <span class="free">F</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_in_cone ideal.span_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>split›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">max_subset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">max_subset</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ARG_MAX</span> card <span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">B</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> max_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"max_subset <span class="free">A</span> <span class="free">P</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>max_subset <span class="free">A</span> <span class="free">P</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">B</span> <span class="main">≤</span> card <span class="main">(</span>max_subset <span class="free">A</span> <span class="free">P</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis3</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">P</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span><span class="main">.</span> <span class="bound">C</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">C</span> <span class="main">⟶</span> card <span class="bound">C</span> <span class="main">&lt;</span> Suc <span class="main">(</span>card <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">C</span> <span class="main">≤</span> card <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_mono<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">C</span> <span class="main">&lt;</span> Suc <span class="main">(</span>card <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis1</span> <span class="main">∧</span> <span class="var">?thesis2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis3</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> max_subset_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_max_natI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> arg_max_nat_le<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis3</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="main">(</span>domintros<span class="main">)</span> <span class="entity">split</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'x</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> set <span class="main">⇒</span>
                                <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'x</span> set<span class="main">)</span><span class="main">)</span> list<span class="main">)</span> <span class="main">×</span>
                                 <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">,</span>one<span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'x</span> set<span class="main">)</span><span class="main">)</span> list<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">split</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="main">0</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1">then</span>
        <span class="main">(</span><span class="main">[</span><span class="main">(</span>monomial <span class="main">1</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∩</span> <span class="main">.[</span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span>
        <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span>monomial <span class="main">1</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">)</span>
      <span class="keyword1">else</span>
        <span class="keyword1">let</span> <span class="bound">x</span> <span class="main">=</span> <span class="keyword1">SOME</span> <span class="bound">x'</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">-</span> <span class="main">(</span>max_subset <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∩</span> <span class="main">.[</span><span class="bound">V</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
            <span class="main">(</span><span class="bound">ps0</span><span class="main">,</span> <span class="bound">qs0</span><span class="main">)</span> <span class="main">=</span> <span class="free">split</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">;</span>
            <span class="main">(</span><span class="bound">ps1</span><span class="main">,</span> <span class="bound">qs1</span><span class="main">)</span> <span class="main">=</span> <span class="free">split</span> <span class="main">(</span>Poly_Mapping.single <span class="bound">x</span> <span class="main">1</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> Poly_Mapping.single <span class="bound">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="keyword1">in</span>
          <span class="main">(</span><span class="bound">ps0</span> <span class="main">@</span> <span class="bound">ps1</span><span class="main">,</span> <span class="bound">qs0</span> <span class="main">@</span> <span class="bound">qs1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> split<span class="antiquote"><span class="antiquote">}</span></span></span></span> is not executable, because this is not necessary.
  With some effort, it could be made executable, though.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> split_domI'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="free">args</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>snd <span class="main">(</span>snd <span class="free">args</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"split_dom <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">,</span>one<span class="main">}</span><span class="main">)</span> <span class="free">args</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">args'</span><span class="main">.</span> card <span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">args'</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> sum deg_pm <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">args'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> wf_measure<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">args</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">args</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> args<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">args</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span><span class="main">,</span> <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> less.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> args fst_conv snd_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"split_dom <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span><span class="skolem">t'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">,</span> <span class="skolem">F'</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U'</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">F'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U'</span> <span class="main">+</span> sum deg_pm <span class="skolem">F'</span> <span class="main">&lt;</span> card <span class="skolem">U</span> <span class="main">+</span> sum deg_pm <span class="skolem">F</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t'</span> <span class="skolem">U'</span> <span class="skolem">F'</span>
      <span class="keyword1"><span class="command">using</span></span> less.hyps that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> args<span class="main">)</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> max_subset <span class="skolem">U</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="skolem">F</span> <span class="main">∩</span> <span class="main">.[</span><span class="bound">V</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x'</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">∈</span> <span class="skolem">U</span> <span class="main">∧</span> <span class="bound">x'</span> <span class="main">∉</span> <span class="skolem">S</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> args
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> split.domintros<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> x_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> S_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">.[</span><span class="skolem">U</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∩</span> <span class="main">.[</span><span class="main">{}</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">U</span>›</span></span> empty_subsetI <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∩</span> <span class="main">.[</span><span class="skolem">S</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> max_subset<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="main">.[</span><span class="skolem">U</span><span class="main">]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∩</span> <span class="main">.[</span><span class="skolem">S</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">≠</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">U</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">U</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∉</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> split_dom <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">,</span> <span class="skolem">F</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> _ <span class="quoted"><span class="quoted">‹finite <span class="skolem">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"split_dom <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">,</span> <span class="skolem">F</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">U</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_Diff1_less<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">U</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum deg_pm <span class="skolem">F</span> <span class="main">&lt;</span> card <span class="skolem">U</span> <span class="main">+</span> sum deg_pm <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?args</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Poly_Mapping.single <span class="skolem">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span><span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> split_dom <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="var">?args</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"split_dom <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="var">?args</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">F</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum deg_pm <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">≤</span>
                sum <span class="main">(</span>deg_pm <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">F</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">F</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_image_le<span class="main">)</span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> sum deg_pm <span class="skolem">F</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_strict_mono_ex1<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> <span class="main">(</span>deg_pm <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">f</span> <span class="main">≤</span> deg_pm <span class="bound">f</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_pm_minus_le<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> <span class="main">(</span>deg_pm <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">f</span> <span class="main">&lt;</span> deg_pm <span class="bound">f</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
              <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> <span class="main">(</span>deg_pm <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">f</span> <span class="main">&lt;</span> deg_pm <span class="bound">f</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">U</span>›</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">U</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> insert_subsetI<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∩</span> <span class="main">.[</span>insert <span class="skolem">x</span> <span class="skolem">S</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
                  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span>
                  <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> deg_pm <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> deg_pm <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> deg_pm_minus_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="skolem">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">]</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> deg_pm <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">s</span> <span class="main">∩</span> keys <span class="main">(</span>Poly_Mapping.single <span class="skolem">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> deg_pm_minus_id_iff<span class="main">)</span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> keys <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">.[</span>insert <span class="skolem">x</span> <span class="skolem">S</span><span class="main">]</span>"</span></span>
                  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">.[</span><span class="skolem">S</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PPs_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="skolem">F</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∩</span> <span class="main">.[</span><span class="skolem">S</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">≤</span> card <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> max_subset<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">U</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">U</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U</span> <span class="main">+</span> sum deg_pm <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> monomial <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="skolem">U</span> <span class="main">+</span> sum deg_pm <span class="skolem">F</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> split_domI<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟹</span> <span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">⟹</span> finite <span class="free">S</span> <span class="main">⟹</span> split_dom <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">,</span>one<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">U</span><span class="main">,</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> split_domI'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">U</span><span class="main">,</span> <span class="free">S</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> split_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"split <span class="free">t</span> <span class="free">U</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">,</span>one<span class="main">}</span><span class="main">)</span> <span class="free">t</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"split_dom <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">U</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> split_domI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split.psimps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> split_induct <span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> base1 base2 step<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">_</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">U</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">⟹</span> finite <span class="bound">S</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">t</span> <span class="bound">U</span> <span class="bound">S</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">,</span>one<span class="main">}</span><span class="main">)</span> <span class="bound">t</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">U</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">⟹</span> finite <span class="bound">S</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">∉</span> <span class="bound">S</span> <span class="main">⟹</span> <span class="bound">S</span> <span class="main">∩</span> <span class="main">.[</span><span class="bound">U</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">t</span> <span class="bound">U</span> <span class="bound">S</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span>monomial <span class="main">1</span> <span class="bound">t</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">U</span> <span class="bound">S</span> <span class="bound">V</span> <span class="bound">x</span> <span class="bound">ps0</span> <span class="bound">ps1</span> <span class="bound">qs0</span> <span class="bound">qs1</span><span class="main">.</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">⟹</span> finite <span class="bound">S</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">∉</span> <span class="bound">S</span> <span class="main">⟹</span> <span class="bound">S</span> <span class="main">∩</span> <span class="main">.[</span><span class="bound">U</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="bound">V</span> <span class="main">⊆</span> <span class="bound">U</span> <span class="main">⟹</span>
              <span class="bound">S</span> <span class="main">∩</span> <span class="main">.[</span><span class="bound">V</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">V'</span><span class="main">.</span> <span class="bound">V'</span> <span class="main">⊆</span> <span class="bound">U</span> <span class="main">⟹</span> <span class="bound">S</span> <span class="main">∩</span> <span class="main">.[</span><span class="bound">V'</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> card <span class="bound">V'</span> <span class="main">≤</span> card <span class="bound">V</span><span class="main">)</span> <span class="main">⟹</span>
              <span class="bound">x</span> <span class="main">∈</span> <span class="bound">U</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∉</span> <span class="bound">V</span> <span class="main">⟹</span> <span class="bound">V</span> <span class="main">=</span> max_subset <span class="bound">U</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V'</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∩</span> <span class="main">.[</span><span class="bound">V'</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x'</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">∈</span> <span class="bound">U</span> <span class="main">-</span> <span class="bound">V</span><span class="main">)</span> <span class="main">⟹</span>
              <span class="main">(</span><span class="bound">ps0</span><span class="main">,</span> <span class="bound">qs0</span><span class="main">)</span> <span class="main">=</span> split <span class="bound">t</span> <span class="main">(</span><span class="bound">U</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="bound">S</span> <span class="main">⟹</span>
              <span class="main">(</span><span class="bound">ps1</span><span class="main">,</span> <span class="bound">qs1</span><span class="main">)</span> <span class="main">=</span> split <span class="main">(</span>Poly_Mapping.single <span class="bound">x</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">t</span><span class="main">)</span> <span class="bound">U</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> Poly_Mapping.single <span class="bound">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="bound">S</span><span class="main">)</span> <span class="main">⟹</span>
              split <span class="bound">t</span> <span class="bound">U</span> <span class="bound">S</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ps0</span> <span class="main">@</span> <span class="bound">ps1</span><span class="main">,</span> <span class="bound">qs0</span> <span class="main">@</span> <span class="bound">qs1</span><span class="main">)</span> <span class="main">⟹</span>
              <span class="free">P</span> <span class="bound">t</span> <span class="main">(</span><span class="bound">U</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="bound">S</span> <span class="main">(</span><span class="bound">ps0</span><span class="main">,</span> <span class="bound">qs0</span><span class="main">)</span> <span class="main">⟹</span>
              <span class="free">P</span> <span class="main">(</span>Poly_Mapping.single <span class="bound">x</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">t</span><span class="main">)</span> <span class="bound">U</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> Poly_Mapping.single <span class="bound">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="bound">S</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps1</span><span class="main">,</span> <span class="bound">qs1</span><span class="main">)</span> <span class="main">⟹</span>
              <span class="free">P</span> <span class="bound">t</span> <span class="bound">U</span> <span class="bound">S</span> <span class="main">(</span><span class="bound">ps0</span> <span class="main">@</span> <span class="bound">ps1</span><span class="main">,</span> <span class="bound">qs0</span> <span class="main">@</span> <span class="bound">qs1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">t</span> <span class="free">U</span> <span class="free">S</span> <span class="main">(</span>split <span class="free">t</span> <span class="free">U</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"split_dom <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">U</span><span class="main">,</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> split_domI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">U</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> split.pinduct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">F</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> step<span class="main">(</span>4<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> max_subset <span class="skolem">U</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="skolem">F</span> <span class="main">∩</span> <span class="main">.[</span><span class="bound">V</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x'</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">∈</span> <span class="skolem">U</span> <span class="main">∧</span> <span class="bound">x'</span> <span class="main">∉</span> <span class="skolem">S</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split.psimps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> step<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> S_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> x_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI conjI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> step<span class="main">(</span>4<span class="main">,</span> 5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">F</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">F</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∩</span> <span class="main">.[</span><span class="skolem">U</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> step<span class="main">(</span>4<span class="main">,</span> 5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">F</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps0</span> <span class="skolem">qs0</span> <span class="skolem">ps1</span> <span class="skolem">qs1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="main">_</span><span class="main">)</span> list"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"split <span class="main">(</span>Poly_Mapping.single <span class="skolem">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="skolem">U</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ps1</span><span class="main">,</span> <span class="skolem">qs1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> PQ1<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"split <span class="main">(</span>Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="skolem">U</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ps1</span><span class="main">,</span> <span class="skolem">qs1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">assume</span></span> PQ0<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"split <span class="skolem">t</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">F</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ps0</span><span class="main">,</span> <span class="skolem">qs0</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∩</span> <span class="main">.[</span><span class="skolem">U</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="skolem">F</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∩</span> <span class="main">.[</span><span class="main">{}</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">U</span>›</span></span> empty_subsetI <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∩</span> <span class="main">.[</span><span class="skolem">S</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> max_subset<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">have</span></span> S_max<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">S'</span> <span class="main">≤</span> card <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S'</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∩</span> <span class="main">.[</span><span class="skolem">S'</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">S'</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">U</span>›</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> max_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∩</span> <span class="main">.[</span><span class="skolem">U</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∩</span> <span class="main">.[</span><span class="skolem">S</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">≠</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">U</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">U</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∉</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> step<span class="main">(</span>4<span class="main">,</span> 5<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> <span class="skolem">F</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∩</span> <span class="main">.[</span><span class="skolem">U</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∩</span> <span class="main">.[</span><span class="skolem">S</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> S_max <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">S</span>›</span></span> S_def _ PQ0 PQ1
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">F</span> <span class="main">(</span><span class="skolem">ps0</span> <span class="main">@</span> <span class="skolem">ps1</span><span class="main">,</span> <span class="skolem">qs0</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">t</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">F</span> <span class="main">(</span><span class="skolem">ps0</span><span class="main">,</span> <span class="skolem">qs0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> PQ0 <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> <span class="skolem">F</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∩</span> <span class="main">.[</span><span class="skolem">U</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> _ _ step<span class="main">(</span>5<span class="main">)</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> step<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_def S_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="skolem">U</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps1</span><span class="main">,</span> <span class="skolem">qs1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> PQ1 <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> <span class="skolem">F</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∩</span> <span class="main">.[</span><span class="skolem">U</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> _ refl PQ0 <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> step<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">F</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_def S_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"split <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">F</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ps0</span> <span class="main">@</span> <span class="skolem">ps1</span><span class="main">,</span> <span class="skolem">qs0</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> <span class="skolem">F</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∩</span> <span class="main">.[</span><span class="skolem">U</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split.psimps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> step<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> Let_def <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> S_def x_def PQ0 PQ1 <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_def S_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> valid_decomp_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span>split <span class="free">t</span> <span class="free">U</span> <span class="free">S</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>zero_neq_one<span class="main">)</span> <span class="main">×</span> <span class="main">_</span><span class="main">)</span> list<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span>snd <span class="main">(</span><span class="main">(</span>split <span class="free">t</span> <span class="free">U</span> <span class="free">S</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>zero_neq_one<span class="main">)</span> <span class="main">×</span> <span class="main">_</span><span class="main">)</span> list<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="main">_</span> <span class="main">(</span>snd <span class="var">?s</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span>fst <span class="var">?s</span><span class="main">)</span> <span class="main">∧</span> valid_decomp <span class="free">X</span> <span class="main">(</span>snd <span class="var">?s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">U</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> split_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base1 <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> base1<span class="main">(</span>1<span class="main">,</span> 4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_decomp_def monomial_0_iff Polys_closed_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base2 <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> base2<span class="main">(</span>1<span class="main">,</span> 5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_decomp_def monomial_0_iff Polys_closed_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span> <span class="skolem">V</span> <span class="skolem">x</span> <span class="skolem">ps0</span> <span class="skolem">ps1</span> <span class="skolem">qs0</span> <span class="skolem">qs1</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> step.hyps<span class="main">(</span>8<span class="main">,</span> 1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_single<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> step.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_plus<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> step.hyps<span class="main">(</span>15<span class="main">,</span> 16<span class="main">)</span> step.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_decomp_append<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span>fst <span class="var">?s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span>snd <span class="var">?s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> monomial_decomp_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span>split <span class="free">t</span> <span class="free">U</span> <span class="free">S</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>zero_neq_one<span class="main">)</span> <span class="main">×</span> <span class="main">_</span><span class="main">)</span> list<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span>snd <span class="main">(</span><span class="main">(</span>split <span class="free">t</span> <span class="free">U</span> <span class="free">S</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>zero_neq_one<span class="main">)</span> <span class="main">×</span> <span class="main">_</span><span class="main">)</span> list<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span>snd <span class="var">?s</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span>fst <span class="var">?s</span><span class="main">)</span> <span class="main">∧</span> monomial_decomp <span class="main">(</span>snd <span class="var">?s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">U</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> split_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base1 <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> base1<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monomial_decomp_def monomial_is_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base2 <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> base2<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monomial_decomp_def monomial_is_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span> <span class="skolem">V</span> <span class="skolem">x</span> <span class="skolem">ps0</span> <span class="skolem">ps1</span> <span class="skolem">qs0</span> <span class="skolem">qs1</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> step.hyps<span class="main">(</span>15<span class="main">,</span> 16<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monomial_decomp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span>fst <span class="var">?s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span>snd <span class="var">?s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> split_splits_wrt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">÷</span> monomial <span class="main">1</span> <span class="free">t</span> <span class="main">=</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"splits_wrt <span class="main">(</span>split <span class="free">t</span> <span class="free">U</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>cone <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">,</span>ring_no_zero_divisors<span class="main">}</span><span class="main">)</span> <span class="free">t</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">U</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> split_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base1 <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> base1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">⊆</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lem_4_2_1 base1<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrtI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h0</span> <span class="skolem">U0</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">[</span><span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> h0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h0</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U0</span> <span class="main">=</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">1</span> <span class="skolem">t</span> <span class="main">∈</span> cone <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> tip_in_cone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h0</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    
    <span class="keyword1"><span class="command">from</span></span> base1<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h0</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_monomial<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> base1<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U0</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U0</span> <span class="main">=</span> <span class="skolem">U</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_subset_PolysI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cone_decomp_singleton <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base2 <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> base2<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∩</span> ideal <span class="free">F</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lem_4_2_2 base2<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrtI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h0</span> <span class="skolem">U0</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">[</span><span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> h0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h0</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U0</span> <span class="main">=</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> base2<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">1</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_monomial<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h0</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> base2<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U0</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U0</span> <span class="main">=</span> <span class="skolem">U</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_subset_PolysI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h0</span> <span class="skolem">U0</span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">[</span><span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> cone <span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> cone <span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∩</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IntI<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cone_decomp_singleton <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span> <span class="skolem">V</span> <span class="skolem">x</span> <span class="skolem">ps0</span> <span class="skolem">ps1</span> <span class="skolem">qs0</span> <span class="skolem">qs1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> step.prems <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"splits_wrt <span class="main">(</span><span class="skolem">ps0</span><span class="main">,</span> <span class="skolem">qs0</span><span class="main">)</span> <span class="main">(</span>cone <span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> step.hyps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"splits_wrt <span class="main">(</span><span class="skolem">ps1</span><span class="main">,</span> <span class="skolem">qs1</span><span class="main">)</span> <span class="main">(</span>cone <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> step.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> step.hyps<span class="main">(</span>8<span class="main">,</span> 1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_single<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> step.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">÷</span> monomial <span class="main">1</span> <span class="main">(</span><span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ideal <span class="free">F</span> <span class="main">÷</span> monomial <span class="main">1</span> <span class="skolem">t</span> <span class="main">÷</span> monomial <span class="main">1</span> <span class="var">?x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_monomial_monomial add.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">÷</span> monomial <span class="main">1</span> <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> step.prems<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">÷</span> monomial <span class="main">1</span> <span class="main">(</span><span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="var">?x</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> quot_monomial_ideal_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrtI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> step.hyps<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="skolem">U</span> <span class="main">=</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>cone <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">t</span><span class="main">,</span> insert <span class="skolem">x</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">[</span>cone <span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">,</span>
                       cone <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span>monomial <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">,</span> insert <span class="skolem">x</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_cone_insert<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>cone <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">[</span>cone <span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> cone <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> U times_monomial_monomial<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>cone <span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps0</span> <span class="main">@</span> <span class="skolem">qs0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrtD<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>cone <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="var">?x</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps1</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrtD<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>cone <span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ps0</span> <span class="main">@</span> <span class="skolem">qs0</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">ps1</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decomp_append<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>cone <span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ps0</span> <span class="main">@</span> <span class="skolem">ps1</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">qs0</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decomp_perm<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> append.assoc perm_append1 perm_append2 perm_append_swap<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h0</span> <span class="skolem">U0</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ps0</span> <span class="main">@</span> <span class="skolem">ps1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">ps0</span> <span class="main">∪</span> set <span class="skolem">ps1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">⊆</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">ps0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrtD<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">ps1</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrtD<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">⊆</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">from</span></span> tip_in_cone * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h0</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h0</span> <span class="skolem">U0</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">qs0</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qs0</span> <span class="main">∪</span> set <span class="skolem">qs1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qs0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrtD<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qs1</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrtD<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qs0</span> <span class="main">∪</span> set <span class="skolem">qs1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∩</span> ideal <span class="free">F</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qs0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrtD<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qs1</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrtD<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lem_4_5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">÷</span> monomial <span class="main">1</span> <span class="free">t</span> <span class="main">=</span> ideal <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> <span class="free">t'</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span> <span class="main">⊆</span> cone <span class="main">(</span>monomial <span class="main">1</span> <span class="free">t</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∩</span> normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∩</span> <span class="main">.[</span><span class="free">V</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="free">t'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="var">?t'</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span> <span class="main">⊆</span> cone <span class="main">(</span><span class="var">?t</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="var">?t'</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span> <span class="main">⊆</span> normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_subsetD<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monomial_0_iff<span class="main">)</span>
  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∩</span> <span class="main">.[</span><span class="free">V</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="free">t'</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∩</span> <span class="main">.[</span><span class="free">V</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∩</span> <span class="main">.[</span><span class="free">V</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">V</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">V</span><span class="main">]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_monomial<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">*</span> <span class="var">?t</span> <span class="main">∈</span> cone <span class="main">(</span><span class="var">?t</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> tip_in_cone 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t'</span> <span class="main">∈</span> cone <span class="main">(</span><span class="var">?t</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t'</span> <span class="main">=</span> <span class="skolem">s'</span> <span class="main">*</span> <span class="var">?t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneE<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">*</span> <span class="var">?s</span> <span class="main">*</span> <span class="var">?t</span> <span class="main">=</span> <span class="var">?s</span> <span class="main">*</span> <span class="var">?t'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t'<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> refl <span class="quoted"><span class="quoted">‹<span class="var">?s</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">V</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> cone <span class="main">(</span><span class="var">?t'</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneI<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">*</span> <span class="var">?s</span> <span class="main">*</span> <span class="var">?t</span> <span class="main">∈</span> cone <span class="main">(</span><span class="var">?t'</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">*</span> <span class="var">?s</span> <span class="main">*</span> <span class="var">?t</span> <span class="main">∈</span> normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">∈</span> monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_base<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">*</span> <span class="var">?s</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_scale<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">*</span> <span class="var">?s</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">÷</span> <span class="var">?t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">*</span> <span class="var">?s</span> <span class="main">*</span> <span class="var">?t</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> quot_set_iff mult.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">*</span> <span class="var">?s</span> <span class="main">*</span> <span class="var">?t</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">∩</span> normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IntI<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> normal_form_normal_form <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> normal_form_zero_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">*</span> <span class="var">?t'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t' <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_monomial_monomial monomial_0_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> empty_subsetI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lem_4_6<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">÷</span> monomial <span class="main">1</span> <span class="free">t</span> <span class="main">=</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span>monomial <span class="main">1</span> <span class="free">t'</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span> <span class="main">⊆</span> cone <span class="main">(</span>monomial <span class="main">1</span> <span class="free">t</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∩</span> normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">V'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">1</span> <span class="free">t</span><span class="main">,</span> <span class="free">V'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>snd <span class="main">(</span>split <span class="free">t</span> <span class="free">U</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">V</span> <span class="main">≤</span> card <span class="free">V'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="free">t'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="var">?t'</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span> <span class="main">⊆</span> cone <span class="main">(</span><span class="var">?t</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="var">?t'</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span> <span class="main">⊆</span> normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 4<span class="main">,</span> 5<span class="main">,</span> 6<span class="main">,</span> 7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∩</span> <span class="main">.[</span><span class="free">V</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lem_4_5<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">U</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> split_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base1 <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> base1.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∩</span> <span class="main">.[</span><span class="skolem">V</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_in_PPs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IntI<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> base1.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base2 <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> base2.prems<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> base2.hyps<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">V</span> <span class="main">≤</span> card <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> base2.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span> <span class="skolem">V0</span> <span class="skolem">x</span> <span class="skolem">ps0</span> <span class="skolem">ps1</span> <span class="skolem">qs0</span> <span class="skolem">qs1</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> step.prems<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">V</span> <span class="main">≤</span> card <span class="skolem">V0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> step.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> step.hyps<span class="main">(</span>5<span class="main">,</span> 9<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V0</span> <span class="main">⊆</span> <span class="skolem">U</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>snd <span class="main">(</span><span class="skolem">ps0</span><span class="main">,</span> <span class="skolem">qs0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">V0</span> <span class="main">≤</span> card <span class="skolem">V'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> step.hyps<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> step.hyps<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> step.prems<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>snd <span class="main">(</span><span class="skolem">ps0</span> <span class="main">@</span> <span class="skolem">ps1</span><span class="main">,</span> <span class="skolem">qs0</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> 0 2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">V</span> <span class="main">≤</span> card <span class="skolem">V'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lem_4_7<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> punit.reduced_GB <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span><span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∩</span> ideal <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">U</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.reduced_GB <span class="var">?S</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Polys_closed_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="var">?S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_monomial_setI monomial_is_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_is_monomial_set_Polys<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_monomial_setD<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="var">?S</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.is_monic_set <span class="var">?G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_is_monic_set_Polys<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="free">g</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.is_monic_set_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> lpp <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_monomial <span class="free">g</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>punit.lc <span class="free">g</span><span class="main">)</span> <span class="main">(</span>lpp <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.monomial_eq_itself<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> ideal <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_base<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="var">?S</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> ideal_G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ideal <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_ideal_Polys<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> ideal <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">rule</span> <span class="main">(</span><span class="operator">intro</span> reduced_GB_Polys assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∩</span> ideal <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> sum_list <span class="main">`</span> listset <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> cone_decomp_def direct_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="free">g</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decomp_sum_list_monomial_in_cone<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>3<span class="main">)</span> zero_in_PPs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>monomial <span class="skolem">d</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_closed_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g punit.monom_mult_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="skolem">U</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g'<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> lt_g'<span class="main">:</span> <span class="quoted"><span class="quoted">"lpp <span class="free">g</span> <span class="main">=</span> lpp <span class="skolem">q</span> <span class="main">+</span> lpp <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lp_times<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> adds1<span class="main">:</span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">h</span> <span class="keyword1">adds</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>5<span class="main">)</span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="skolem">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="skolem">h</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decompD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>punit.lc <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span>lpp <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.monomial_eq_itself<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> lpp <span class="skolem">h</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="skolem">q</span> <span class="main">=</span> punit.lc <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g' lc_times <span class="quoted"><span class="quoted">‹punit.lc <span class="skolem">h</span> <span class="main">=</span> <span class="main">1</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="skolem">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹punit.lc <span class="free">g</span> <span class="main">=</span> <span class="main">1</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> tip_in_cone
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∩</span> ideal <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decomp_cone_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> ideal <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal_G<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> ideal <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="var">?S</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_is_GB_Polys<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> <span class="var">?G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> adds2<span class="main">:</span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">g'</span> <span class="keyword1">adds</span> lpp <span class="skolem">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">∈</span> ideal <span class="var">?G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.GB_adds_lt<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>3<span class="main">)</span> adds1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">g'</span> <span class="keyword1">adds</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">g'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="free">g</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.is_red <span class="main">{</span><span class="skolem">g'</span><span class="main">}</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.is_red_addsI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">≠</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g'</span> <span class="main">∈</span> <span class="var">?G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">g'</span><span class="main">}</span> <span class="main">⊆</span> <span class="var">?G</span> <span class="main">-</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹punit.is_red <span class="main">{</span><span class="skolem">g'</span><span class="main">}</span> <span class="free">g</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> red<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.is_red <span class="main">(</span><span class="var">?G</span> <span class="main">-</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.is_red_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="var">?S</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.is_auto_reduced <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_is_auto_reduced_Polys<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> punit.is_red <span class="main">(</span><span class="var">?G</span> <span class="main">-</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.is_auto_reducedD<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> red <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> adds2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="keyword1">adds</span> lpp <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> t_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> adds1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">h</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lt_g' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>punit.lc <span class="skolem">q</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_eq_min_term_monomial<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">=</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹punit.lc <span class="skolem">q</span> <span class="main">=</span> <span class="main">1</span>›</span></span> g'<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> snd_splitI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">V</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">1</span> <span class="free">t</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>snd <span class="main">(</span>split <span class="free">t</span> <span class="free">U</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">U</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> split_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base1 <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> base1.prems<span class="main">(</span>2<span class="main">)</span> base1.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base2 <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> subset_refl <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> base2.prems<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span> <span class="skolem">V0</span> <span class="skolem">x</span> <span class="skolem">ps0</span> <span class="skolem">ps1</span> <span class="skolem">qs0</span> <span class="skolem">qs1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> step.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> <span class="skolem">U</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>snd <span class="main">(</span><span class="skolem">ps0</span><span class="main">,</span> <span class="skolem">qs0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> step.hyps<span class="main">(</span>15<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> step.prems<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>snd <span class="main">(</span><span class="skolem">ps0</span> <span class="main">@</span> <span class="skolem">ps1</span><span class="main">,</span> <span class="skolem">qs0</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fst_splitE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="free">s</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>split <span class="free">t</span> <span class="free">U</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">t'</span> <span class="free">x</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">t'</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="free">t'</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">t'</span> <span class="main">+</span> <span class="free">t</span> <span class="main">+</span> Poly_Mapping.single <span class="free">x</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>zero_neq_one<span class="main">)</span> <span class="free">s</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>split <span class="main">(</span><span class="free">t'</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="free">t'</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>snd <span class="main">(</span>split <span class="main">(</span><span class="free">t'</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="free">t'</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>set <span class="main">(</span>snd <span class="main">(</span>split <span class="free">t</span> <span class="free">U</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="main">_</span><span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">U</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> split_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base1 <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> base1.prems<span class="main">(</span>2<span class="main">)</span> base1.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base2 <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> base2.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span> <span class="skolem">V0</span> <span class="skolem">x</span> <span class="skolem">ps0</span> <span class="skolem">ps1</span> <span class="skolem">qs0</span> <span class="skolem">qs1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> step.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">1</span> <span class="free">s</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">ps0</span> <span class="main">∪</span> set <span class="skolem">ps1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">1</span> <span class="free">s</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">ps0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="free">s</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span><span class="skolem">ps0</span><span class="main">,</span> <span class="skolem">qs0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> step.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> <span class="skolem">U</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="skolem">t'</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">+</span> Poly_Mapping.single <span class="skolem">x'</span> <span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="free">s</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>split <span class="main">(</span><span class="skolem">t'</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>snd <span class="main">(</span>split <span class="main">(</span><span class="skolem">t'</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>snd <span class="main">(</span><span class="skolem">ps0</span><span class="main">,</span> <span class="skolem">qs0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> step.hyps<span class="main">(</span>15<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>7<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>snd <span class="main">(</span><span class="skolem">ps0</span><span class="main">,</span> <span class="skolem">qs0</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>snd <span class="main">(</span><span class="skolem">ps0</span> <span class="main">@</span> <span class="skolem">ps1</span><span class="main">,</span> <span class="skolem">qs0</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>snd <span class="main">(</span>split <span class="main">(</span><span class="skolem">t'</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>snd <span class="main">(</span><span class="skolem">ps0</span> <span class="main">@</span> <span class="skolem">ps1</span><span class="main">,</span> <span class="skolem">qs0</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">V</span> <span class="main">⊆</span> <span class="skolem">U</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> step.prems<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">1</span> <span class="free">s</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">ps1</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> step.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"split <span class="main">(</span>Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="skolem">U</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">[</span><span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span>Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> split.psimps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> split_domI<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span> step.hyps<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span> fin<span class="main"><span class="main">]</span></span> True if_True<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps1</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> step.hyps<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> prod.inject<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>monomial <span class="main">1</span> <span class="free">s</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">ps1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> <span class="skolem">U</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> monomial_inj<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> step.prems<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> zero_in_PPs<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> step.hyps<span class="main">(</span>8<span class="main">,</span> 1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">V</span> <span class="main">=</span> <span class="skolem">U</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> step.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">+</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s add.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="free">s</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>split <span class="main">(</span><span class="main">0</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>monomial <span class="main">1</span> <span class="free">s</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">ps1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step.hyps<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">V</span> <span class="main">=</span> <span class="skolem">U</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>snd <span class="main">(</span>split <span class="main">(</span><span class="main">0</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>snd <span class="main">(</span><span class="skolem">ps0</span> <span class="main">@</span> <span class="skolem">ps1</span><span class="main">,</span> <span class="skolem">qs0</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step.hyps<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">V</span> <span class="main">=</span> <span class="skolem">U</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>monomial <span class="main">1</span> <span class="free">s</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">ps1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">1</span> <span class="free">s</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span><span class="skolem">ps1</span><span class="main">,</span> <span class="skolem">qs1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="skolem">t'</span> <span class="main">+</span> <span class="main">(</span>Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">+</span> Poly_Mapping.single <span class="skolem">x'</span> <span class="main">1</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="free">s</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>split <span class="main">(</span><span class="skolem">t'</span> <span class="main">+</span> <span class="main">(</span>Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="free">V</span>
                                            <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>snd <span class="main">(</span>split <span class="main">(</span><span class="skolem">t'</span> <span class="main">+</span> <span class="main">(</span>Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> monomial <span class="main">1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span>
                  set <span class="main">(</span>snd <span class="main">(</span><span class="skolem">ps1</span><span class="main">,</span> <span class="skolem">qs1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> step.hyps<span class="main">(</span>16<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span> <span class="main">=</span>
                <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">+</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_image add.commute diff_diff_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> step.prems<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> step.hyps<span class="main">(</span>8<span class="main">,</span> 1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_single<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t'</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">+</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_plus<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">+</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq not_False_eq_True<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="skolem">t'</span> <span class="main">+</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">+</span> Poly_Mapping.single <span class="skolem">x'</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> s <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="free">s</span><span class="main">,</span> <span class="free">V</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>split <span class="main">(</span><span class="skolem">t'</span> <span class="main">+</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="free">V</span>
                                                <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">+</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq add.assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>snd <span class="main">(</span>split <span class="main">(</span><span class="skolem">t'</span> <span class="main">+</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">+</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span>
              set <span class="main">(</span>snd <span class="main">(</span><span class="skolem">ps1</span><span class="main">,</span> <span class="skolem">qs1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">⊆</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq add.assoc<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> set <span class="main">(</span>snd <span class="main">(</span><span class="skolem">ps0</span> <span class="main">@</span> <span class="skolem">ps1</span><span class="main">,</span> <span class="skolem">qs0</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">⊆</span> set <span class="main">(</span>snd <span class="main">(</span><span class="skolem">ps0</span> <span class="main">@</span> <span class="skolem">ps1</span><span class="main">,</span> <span class="skolem">qs0</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lem_4_8<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> punit.reduced_GB <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">t</span> <span class="free">U</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> <span class="free">t</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>snd <span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">g</span> <span class="main">=</span> Suc <span class="main">(</span>deg_pm <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.reduced_GB <span class="var">?S</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> md1<span class="main">:</span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="free">S</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="main">_</span><span class="main">)</span> list<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> md2<span class="main">:</span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span>snd <span class="main">(</span><span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="free">S</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="main">_</span><span class="main">)</span> list<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> subset_refl assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decomp_split<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Polys_closed_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.is_auto_reduced <span class="var">?G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.is_monic_set <span class="var">?G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ideal_G<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="var">?G</span> <span class="main">=</span> ideal <span class="var">?S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="var">?G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_is_auto_reduced_Polys<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> reduced_GB_is_monic_set_Polys<span class="main"><span class="keyword3">,</span></span>
        <span class="operator">rule</span> reduced_GB_ideal_Polys<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> reduced_GB_nonzero_Polys<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">,</span> 4<span class="main">)</span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="free">g</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> punit.is_monic_set_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_monomial_setI monomial_is_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> 0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_monomial_set <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_is_monomial_set_Polys<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_monomial_setD<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> lpp <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹punit.lc <span class="free">g</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> punit.monomial_eq_itself<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span> subset_refl assms<span class="main">(</span>2<span class="main">)</span> zero_in_PPs
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="var">?G</span> <span class="main">÷</span> monomial <span class="main">1</span> <span class="main">0</span> <span class="main">=</span> ideal <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal_G<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"splits_wrt <span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>cone <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">0</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> split_splits_wrt<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"splits_wrt <span class="main">(</span>fst <span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="free">S</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span><span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∩</span> ideal <span class="var">?G</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> md2 <span class="quoted"><span class="quoted">‹is_monomial_set <span class="var">?G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrt_cone_decomp_1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span><span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∩</span> ideal <span class="var">?S</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ideal_G<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">,</span> 5<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> md1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lem_4_7<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> subset_refl assms<span class="main">(</span>2<span class="main">,</span> 4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">t'</span> <span class="main">+</span> <span class="main">0</span> <span class="main">+</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>split <span class="main">(</span><span class="skolem">t'</span> <span class="main">+</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">U</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>snd <span class="main">(</span>split <span class="main">(</span><span class="skolem">t'</span> <span class="main">+</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">U</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>set <span class="main">(</span>snd <span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="main">_</span><span class="main">)</span> set<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fst_splitE<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span><span class="skolem">t'</span> <span class="main">+</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>snd <span class="main">(</span>split <span class="main">(</span><span class="skolem">t'</span> <span class="main">+</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">U</span> <span class="var">?S</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> <span class="var">?S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> snd_splitI<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> set <span class="main">(</span>snd <span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">t'</span><span class="main">,</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>snd <span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">g</span> <span class="main">=</span> Suc <span class="main">(</span>deg_pm <span class="skolem">t'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g s deg_pm_plus deg_pm_single poly_deg_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V</span> <span class="main">⊆</span> <span class="skolem">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">rule</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> cor_4_9<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> punit.reduced_GB <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">g</span> <span class="main">≤</span> Suc <span class="main">(</span>Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="main">(</span>snd <span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="main">_</span><span class="main">)</span> set<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">≤</span> Suc <span class="main">(</span>Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> <span class="var">?S</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="free">S</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_image_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> single_one<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_base<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ideal_eq_UNIV_iff_contains_one<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Polys_closed_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.reduced_GB <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ideal_eq_UNIV_iff_reduced_GB_eq_one_Polys<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> finite_set <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> <span class="var">?S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_imageI<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">g</span> <span class="main">=</span> Suc <span class="main">(</span>deg_pm <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> False assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lem_4_8<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span>fst <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> poly_deg <span class="main">`</span> fst <span class="main">`</span> <span class="var">?S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">∈</span> poly_deg <span class="main">`</span> fst <span class="main">`</span> <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_deg_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> fin <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">≤</span> Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> <span class="var">?S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Max_ge<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">g</span> <span class="main">≤</span> Suc <span class="main">(</span>Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> <span class="var">?S</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> standard_decomp_snd_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>deg_pm <span class="free">t</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>split <span class="free">t</span> <span class="free">U</span> <span class="free">S</span><span class="main">)</span> <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> <span class="main">×</span> <span class="main">_</span><span class="main">)</span> list<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">U</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> split_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base1 <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> standard_decomp_Nil<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base2 <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">=</span> poly_deg <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_deg_monomial<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> standard_decomp_singleton<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span> <span class="skolem">V</span> <span class="skolem">x</span> <span class="skolem">ps0</span> <span class="skolem">ps1</span> <span class="skolem">qs0</span> <span class="skolem">qs1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> step.hyps<span class="main">(</span>15<span class="main">)</span> step.prems <span class="keyword1"><span class="command">have</span></span> qs0<span class="main">:</span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>deg_pm <span class="skolem">t</span><span class="main">)</span> <span class="skolem">qs0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> snd_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span> <span class="main">⊆</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">-</span> Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> step.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> _ step.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_plus<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> step.hyps<span class="main">(</span>8<span class="main">,</span> 1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_single<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> qs1<span class="main">:</span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>Suc <span class="main">(</span>deg_pm <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="skolem">qs1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> step.hyps<span class="main">(</span>16<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_pm_plus deg_pm_single<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> snd_conv
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U0</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="main">(</span><span class="skolem">qs0</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">qs0</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span><span class="skolem">qs1</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_append<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">≤</span> poly_deg <span class="skolem">h</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">qs0</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> qs0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompD<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">qs1</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> qs1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>deg_pm <span class="skolem">t</span><span class="main">)</span> <span class="main">≤</span> poly_deg <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompD<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≤</span> poly_deg <span class="skolem">h</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span> <span class="bound">U'</span><span class="main">.</span> <span class="main">(</span><span class="bound">t'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">qs0</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span> <span class="main">∧</span> poly_deg <span class="bound">t'</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> card <span class="skolem">U0</span> <span class="main">≤</span> card <span class="bound">U'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">qs0</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> qs0 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="skolem"><span class="skolem">U'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qs0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U0</span> <span class="main">≤</span> card <span class="skolem">U'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> d1 d2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompE<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">qs0</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">qs1</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qs1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> step.hyps<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span>snd <span class="main">(</span>split <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="main">_</span><span class="main">)</span> list<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decomp_split<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> md<span class="main">:</span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span><span class="skolem">qs0</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step.hyps<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qs1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">qs0</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="skolem">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="skolem">h</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decompD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>punit.lc <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span>lpp <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.monomial_eq_itself<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> lpp <span class="skolem">h</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> d1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∨</span> Suc <span class="main">(</span>deg_pm <span class="skolem">t</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">(*)</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">`</span> monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> F_def times_monomial_monomial<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> step.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">with</span></span> step.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">+</span> <span class="skolem">u</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_plus<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_monomial<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="skolem">F</span> <span class="main">=</span> <span class="main">(*)</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">`</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ideal.span_image_scale_eq_image_scale F_def<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">(*)</span> <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> injI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> times_monomial_left monomial_0_iff <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> punit.monom_mult_inj_3<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="skolem">F</span> <span class="main">÷</span> monomial <span class="main">1</span> <span class="skolem">t</span> <span class="main">=</span> ideal <span class="main">(</span>monomial <span class="main">1</span> <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> quot_set_image_times<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> step.hyps<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> step.prems<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"splits_wrt <span class="main">(</span>split <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">(</span>cone <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> split_splits_wrt<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"splits_wrt <span class="main">(</span><span class="skolem">ps0</span> <span class="main">@</span> <span class="skolem">ps1</span><span class="main">,</span> <span class="skolem">qs0</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span> <span class="main">(</span>cone <span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> step.hyps<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>cone <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∩</span> normal_form <span class="skolem">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">qs0</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> md _ <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrt_cone_decomp_2<span class="main">)</span>
              <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_monomial_setI monomial_is_monomial <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> F_def times_monomial_monomial<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">⊆</span> cone <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∩</span> normal_form <span class="skolem">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">qs0</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decomp_cone_subset<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> step.hyps<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> step.prems<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> eq
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">U'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>snd <span class="main">(</span>split <span class="skolem">t</span> <span class="skolem">U</span> <span class="skolem">S</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U0</span> <span class="main">≤</span> card <span class="skolem">U'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lem_4_6<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">qs0</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step.hyps<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_deg_monomial <span class="quoted"><span class="quoted">‹deg_pm <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">d</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>deg_pm <span class="skolem">t</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> qs1 <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">qs1</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="skolem"><span class="skolem">U'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qs1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U0</span> <span class="main">≤</span> card <span class="skolem">U'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompE<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">qs0</span> <span class="main">@</span> <span class="skolem">qs1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> standard_cone_decomp_snd_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">≡</span> punit.reduced_GB <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">ss</span> <span class="main">≡</span> <span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="main">(</span>lpp <span class="main">`</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> <span class="main">×</span> <span class="main">_</span><span class="main">)</span> list <span class="main">×</span> <span class="main">_</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≡</span> Suc <span class="main">(</span>Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span>snd <span class="free">ss</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">0</span> <span class="main">(</span>snd <span class="free">ss</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">ss</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> homogeneous <span class="bound">f</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> poly_deg <span class="free">g</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">G</span> <span class="main">=</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.is_reduced_GB <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">,</span> 5<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> G_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_ideal_Polys<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> reduced_GB_is_GB_Polys<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> finite_reduced_GB_Polys<span class="main"><span class="keyword3">,</span></span>
        <span class="operator">rule</span> reduced_GB_nonzero_Polys<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> reduced_GB_Polys<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> reduced_GB_is_reduced_GB_Polys<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> lpp <span class="main">`</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>4<span class="main">)</span> subset_refl
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">G</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_image_lpp<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>deg_pm <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">ss</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zero_in_PPs <span class="keyword1"><span class="command">unfolding</span></span> ss_def S_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decomp_snd_split<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Polys_closed_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"splits_wrt <span class="free">ss</span> <span class="main">(</span>cone <span class="main">(</span>monomial <span class="main">1</span> <span class="main">0</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="var">?S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> subset_refl <span class="quoted"><span class="quoted">‹finite <span class="skolem">S</span>›</span></span> zero_in_PPs <span class="keyword1"><span class="command">unfolding</span></span> ss_def S_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> split_splits_wrt<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"splits_wrt <span class="main">(</span>fst <span class="free">ss</span><span class="main">,</span> snd <span class="free">ss</span><span class="main">)</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span><span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∩</span> normal_form <span class="var">?S</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">ss</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> _ _ <span class="quoted"><span class="quoted">‹<span class="var">?S</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> splits_wrt_cone_decomp_2<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> subset_refl <span class="quoted"><span class="quoted">‹finite <span class="skolem">S</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span>snd <span class="free">ss</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ss_def S_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decomp_split<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_monomial_setI monomial_is_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="var">?S</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">=</span> normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
        <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_normal_form_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span><span class="main"><span class="keyword3">,</span></span>
         <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S_def is_red_reduced_GB_monomial_lt_GB_Polys<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹<span class="free">G</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> <span class="free">G</span>›</span></span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> G_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">,</span> 5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Polys_closed_normal_form<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Int_absorb1<span class="main">)</span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> homogeneous <span class="bound">f</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹punit.is_reduced_GB <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹ideal <span class="free">G</span> <span class="main">=</span> ideal <span class="free">F</span>›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_reduced_GB_homogeneous<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lpp <span class="free">g</span> <span class="main">∈</span> keys <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_in_keys<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> <span class="free">G</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> deg_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"deg_pm <span class="main">(</span>lpp <span class="free">g</span><span class="main">)</span> <span class="main">=</span> poly_deg <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> homogeneousD_poly_deg<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">1</span> <span class="main">(</span>lpp <span class="free">g</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> punit.reduced_GB <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def G_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">,</span> 5<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reduced_GB_monomial_lt_reduced_GB_Polys<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">1</span> <span class="main">(</span>lpp <span class="free">g</span><span class="main">)</span> <span class="main">∈</span> punit.reduced_GB <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span>lpp <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> d_def ss_def S_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cor_4_9<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">g</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_deg_monomial deg_lt<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Splitting Ideals›</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">ideal_decomp_aux</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span>
                                          <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> set <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ideal_decomp_aux</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span>
              <span class="main">(</span><span class="keyword1">let</span> <span class="bound">J</span> <span class="main">=</span> ideal <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">;</span> <span class="bound">L</span> <span class="main">=</span> <span class="main">(</span><span class="bound">J</span> <span class="main">÷</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">;</span> <span class="bound">L'</span> <span class="main">=</span> lpp <span class="main">`</span> punit.reduced_GB <span class="bound">L</span> <span class="keyword1">in</span>
                 <span class="main">(</span><span class="main">(*)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">`</span> normal_form <span class="bound">L</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> map <span class="main">(</span>apfst <span class="main">(</span><span class="main">(*)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="bound">L'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin_X<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ideal_decomp_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>ideal_decomp_aux <span class="free">F</span> <span class="free">f</span><span class="main">)</span> <span class="main">⊆</span> ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">∩</span> fst <span class="main">(</span>ideal_decomp_aux <span class="free">F</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>ideal <span class="main">(</span>insert <span class="free">f</span> <span class="free">F</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">[</span>fst <span class="main">(</span>ideal_decomp_aux <span class="free">F</span> <span class="free">f</span><span class="main">)</span><span class="main">,</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis3</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>fst <span class="main">(</span>ideal_decomp_aux <span class="free">F</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>ideal_decomp_aux <span class="free">F</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis4</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> valid_decomp <span class="free">X</span> <span class="main">(</span>snd <span class="main">(</span>ideal_decomp_aux <span class="free">F</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="var">?thesis5</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> standard_decomp <span class="main">(</span>poly_deg <span class="free">f</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>ideal_decomp_aux <span class="free">F</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="var">?thesis6</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="free">f</span> <span class="main">⟹</span> hom_decomp <span class="main">(</span>snd <span class="main">(</span>ideal_decomp_aux <span class="free">F</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="var">?thesis7</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="main">=</span> ideal <span class="free">F</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">J</span> <span class="main">÷</span> <span class="free">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">(*)</span> <span class="free">f</span> <span class="main">`</span> normal_form <span class="skolem">L</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">L'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L'</span> <span class="main">=</span> lpp <span class="main">`</span> punit.reduced_GB <span class="skolem">L</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal_decomp_aux <span class="free">F</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">S</span><span class="main">,</span> map <span class="main">(</span>apfst <span class="main">(</span><span class="main">(*)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="skolem">L'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> J_def ideal_decomp_aux_def Let_def L_def L'_def S_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> L_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L_def<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq fst_conv
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> normal_form <span class="skolem">L</span> <span class="skolem">q</span> <span class="main">*</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> imageE<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ideal.span_scale ideal.span_base singletonI<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">∩</span> fst <span class="main">(</span>ideal_decomp_aux <span class="free">F</span> <span class="free">f</span><span class="main">)</span> <span class="main">⟷</span> <span class="skolem">h</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">∩</span> fst <span class="main">(</span>ideal_decomp_aux <span class="free">F</span> <span class="free">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="skolem">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> J_def S_def eq<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="free">f</span> <span class="main">*</span> normal_form <span class="skolem">L</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> fin_X L_sub this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="skolem">L</span> <span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_normal_form<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">∈</span> <span class="skolem">J</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> normal_form <span class="skolem">L</span> <span class="skolem">q</span> <span class="main">∈</span> <span class="skolem">J</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="skolem">L</span> <span class="skolem">q</span> <span class="main">∈</span> <span class="skolem">L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L_def quot_set_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="skolem">L</span> <span class="skolem">q</span> <span class="main">∈</span> ideal <span class="skolem">L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_base<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> normal_form_diff_in_ideal<span class="main">[</span><span class="operator">OF</span> fin_X L_sub<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">q</span> <span class="main">-</span> normal_form <span class="skolem">L</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> normal_form <span class="skolem">L</span> <span class="skolem">q</span> <span class="main">∈</span> ideal <span class="skolem">L</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_add<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="skolem">L</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_X L_sub <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normal_form_zero_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="main">(*)</span> <span class="free">f</span> <span class="main">`</span> normal_form <span class="skolem">L</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> image_eqI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> fin_X L_sub <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> normal_form <span class="skolem">L</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> normal_form_zero<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_in_Polys<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">∩</span> fst <span class="main">(</span>ideal_decomp_aux <span class="free">F</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal.span_zero eq S_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>ideal <span class="main">(</span>insert <span class="free">f</span> <span class="free">F</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">[</span>ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> fst <span class="main">(</span>ideal_decomp_aux <span class="free">F</span> <span class="free">f</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq fst_conv S_def L_def J_def <span class="keyword1"><span class="command">using</span></span> fin_X assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_ideal_insert<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis3</span></span></span> <span class="keyword1"><span class="command">using</span></span> perm.swap <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_perm<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> std<span class="main">:</span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">0</span> <span class="main">(</span>snd <span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="skolem">L'</span><span class="main">)</span> <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="main">_</span><span class="main">)</span> list<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>normal_form <span class="skolem">L</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="skolem">L'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> L'_def <span class="keyword1"><span class="command">using</span></span> fin_X <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_cone_decomp_snd_split<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis4</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq fst_conv snd_conv S_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decomp_map_times<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> fin_X <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>punit.reduced_GB <span class="skolem">L</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_reduced_GB_Polys<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">L'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> L'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span>snd <span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="skolem">L'</span><span class="main">)</span> <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="main">_</span><span class="main">)</span> list<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fin_X subset_refl <span class="quoted"><span class="quoted">‹finite <span class="skolem">L'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decomp_split<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="main">(</span>snd <span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="skolem">L'</span><span class="main">)</span> <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="main">_</span><span class="main">)</span> list<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decomp_imp_hom_decomp<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis7</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq snd_conv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_decomp_map_times<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">have</span></span> vd<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span>snd <span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="skolem">L'</span><span class="main">)</span> <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="main">_</span><span class="main">)</span> list<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin_X subset_refl <span class="quoted"><span class="quoted">‹finite <span class="skolem">L'</span>›</span></span> zero_in_PPs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decomp_split<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis5</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq snd_conv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decomp_map_times<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> std vd <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span><span class="main">0</span> <span class="main">+</span> poly_deg <span class="free">f</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>apfst <span class="main">(</span><span class="main">(*)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="skolem">L'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decomp_map_times<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis6</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ideal_decompE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f0</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>field"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f0</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> poly_deg <span class="bound">f</span> <span class="main">≤</span> poly_deg <span class="free">f0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">T</span> <span class="free">ps</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>poly_deg <span class="free">f0</span><span class="main">)</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="free">ps</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> homogeneous <span class="bound">f</span><span class="main">)</span> <span class="main">⟹</span> hom_decomp <span class="free">ps</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>ideal <span class="main">(</span>insert <span class="free">f0</span> <span class="free">F</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">[</span>ideal <span class="main">{</span><span class="free">f0</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> <span class="free">T</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 4<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">thesis</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> empty.prems<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompI<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>poly_deg <span class="free">f0</span><span class="main">)</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompI<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decompI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> direct_decomp_def bij_betw_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>ideal <span class="main">{</span><span class="free">f0</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">[</span>ideal <span class="main">{</span><span class="free">f0</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> direct_decomp_singleton<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>ideal <span class="main">{</span><span class="free">f0</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">[</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">,</span> ideal <span class="main">{</span><span class="free">f0</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_Cons_zeroI<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>ideal <span class="main">{</span><span class="free">f0</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">[</span>ideal <span class="main">{</span><span class="free">f0</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> perm.swap <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_perm<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hom_decomp_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">f</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> insert.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">f'</span> <span class="main">≤</span> poly_deg <span class="free">f0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f'</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> insert <span class="skolem">f</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> insert.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> valid_ps<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="skolem">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> std_ps<span class="main">:</span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>poly_deg <span class="free">f0</span><span class="main">)</span> <span class="skolem">ps</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cn_ps<span class="main">:</span> <span class="quoted"><span class="quoted">"cone_decomp <span class="skolem">T</span> <span class="skolem">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dd<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>ideal <span class="main">(</span>insert <span class="free">f0</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">[</span>ideal <span class="main">{</span><span class="free">f0</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> <span class="skolem">T</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> hom_ps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">⟹</span> homogeneous <span class="bound">f</span><span class="main">)</span> <span class="main">⟹</span> hom_decomp <span class="skolem">ps</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> insert.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> insert.prems<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> dd <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>ideal <span class="main">(</span>insert <span class="free">f0</span> <span class="main">(</span>insert <span class="skolem">f</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">[</span>ideal <span class="main">{</span><span class="free">f0</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> <span class="skolem">T</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> insert_commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">f0</span></span><span class="main"><span class="main">]</span></span> True ideal.span_insert_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f'</span><span class="main">.</span> <span class="bound">f'</span> <span class="main">∈</span> insert <span class="skolem">f</span> <span class="skolem">F</span> <span class="main">⟹</span> homogeneous <span class="bound">f'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">⟹</span> homogeneous <span class="bound">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_ps<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ideal_decomp_aux <span class="main">(</span>insert <span class="free">f0</span> <span class="skolem">F</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> insert.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> f0F_fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>insert <span class="free">f0</span> <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> f0F_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="free">f0</span> <span class="skolem">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> insert.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>insert <span class="free">f0</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">∩</span> fst <span class="var">?D</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span>snd <span class="var">?D</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> cn_D<span class="main">:</span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>fst <span class="var">?D</span><span class="main">)</span> <span class="main">(</span>snd <span class="var">?D</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>poly_deg <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>snd <span class="var">?D</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> dd'<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>ideal <span class="main">(</span>insert <span class="skolem">f</span> <span class="main">(</span>insert <span class="free">f0</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span>
                  <span class="main">[</span>fst <span class="var">?D</span><span class="main">,</span> ideal <span class="main">(</span>insert <span class="free">f0</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> hom_D<span class="main">:</span> <span class="quoted"><span class="quoted">"homogeneous <span class="skolem">f</span> <span class="main">⟹</span> hom_decomp <span class="main">(</span>snd <span class="var">?D</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal_decomp_aux<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ideal_decomp_aux <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> fin_X this<span class="main">(</span>2-4<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">f</span> <span class="main">≤</span> poly_deg <span class="free">f0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> insert.prems<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> valid_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="skolem">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cn_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>fst <span class="var">?D</span><span class="main">)</span> <span class="skolem">qs</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> std_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>poly_deg <span class="free">f0</span><span class="main">)</span> <span class="skolem">qs</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> hom_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"hom_decomp <span class="main">(</span>snd <span class="var">?D</span><span class="main">)</span> <span class="main">⟹</span> hom_decomp <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decomp_geE<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sum_list <span class="main">`</span> listset <span class="main">[</span><span class="skolem">T</span><span class="main">,</span> fst <span class="var">?D</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ps</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">@</span> <span class="skolem">qs</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> insert.prems<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> valid_ps valid_qs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="var">?ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decomp_append<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> std_ps std_qs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>poly_deg <span class="free">f0</span><span class="main">)</span> <span class="var">?ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decomp_append<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> dd perm.swap <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>ideal <span class="main">(</span>insert <span class="free">f0</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">[</span><span class="skolem">T</span><span class="main">,</span> ideal <span class="main">{</span><span class="free">f0</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_perm<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">⊆</span> ideal <span class="main">(</span>insert <span class="free">f0</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_Cons_subsetI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal.span_zero zero_in_Polys<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∩</span> fst <span class="var">?D</span> <span class="main">⊆</span> ideal <span class="main">(</span>insert <span class="free">f0</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">∩</span> fst <span class="var">?D</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∩</span> fst <span class="var">?D</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="var">?T</span> <span class="main">[</span><span class="skolem">T</span><span class="main">,</span> fst <span class="var">?D</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> direct_decompI inj_onI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">ys</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> listset <span class="main">[</span><span class="skolem">T</span><span class="main">,</span> fst <span class="var">?D</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">∈</span> fst <span class="var">?D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">x1</span><span class="main">,</span> <span class="skolem">x2</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_doubletonE<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">∈</span> listset <span class="main">[</span><span class="skolem">T</span><span class="main">,</span> fst <span class="var">?D</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y2</span> <span class="main">∈</span> fst <span class="var">?D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">y1</span><span class="main">,</span> <span class="skolem">y2</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_doubletonE<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">xs</span> <span class="main">=</span> sum_list <span class="skolem">ys</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">-</span> <span class="skolem">y1</span> <span class="main">=</span> <span class="skolem">y2</span> <span class="main">-</span> <span class="skolem">x2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xs ys<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> add_diff_cancel_left add_diff_cancel_right<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> cn_ps <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">∈</span> <span class="skolem">T</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y1</span> <span class="main">∈</span> <span class="skolem">T</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">-</span> <span class="skolem">y1</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decomp_closed_minus<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> cn_D <span class="quoted"><span class="quoted">‹<span class="skolem">y2</span> <span class="main">∈</span> fst <span class="var">?D</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x2</span> <span class="main">∈</span> fst <span class="var">?D</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y2</span> <span class="main">-</span> <span class="skolem">x2</span> <span class="main">∈</span> fst <span class="var">?D</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decomp_closed_minus<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y2</span> <span class="main">-</span> <span class="skolem">x2</span> <span class="main">∈</span> <span class="skolem">T</span> <span class="main">∩</span> fst <span class="var">?D</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">=</span> <span class="skolem">y2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">-</span> <span class="skolem">y1</span> <span class="main">=</span> <span class="skolem">y2</span> <span class="main">-</span> <span class="skolem">x2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xs ys<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="var">?T</span> <span class="var">?ps</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cn_ps cn_qs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decomp_append<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f'</span><span class="main">.</span> <span class="bound">f'</span> <span class="main">∈</span> insert <span class="skolem">f</span> <span class="skolem">F</span> <span class="main">⟹</span> homogeneous <span class="bound">f'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f'</span><span class="main">.</span> <span class="bound">f'</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">⟹</span> homogeneous <span class="bound">f'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_ps<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹homogeneous <span class="skolem">f</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> hom_qs hom_D<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="main">(</span><span class="skolem">ps</span> <span class="main">@</span> <span class="skolem">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> hom_decomp_append_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> dd' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>ideal <span class="main">(</span>insert <span class="free">f0</span> <span class="main">(</span>insert <span class="skolem">f</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span>
                      <span class="main">[</span>ideal <span class="main">(</span>insert <span class="free">f0</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> fst <span class="var">?D</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute direct_decomp_perm perm.swap<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>ideal <span class="main">(</span>insert <span class="free">f0</span> <span class="main">(</span>insert <span class="skolem">f</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span>
                      <span class="main">(</span><span class="main">[</span>fst <span class="var">?D</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span>ideal <span class="main">{</span><span class="free">f0</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> <span class="skolem">T</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dd <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_direct_decomp<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>ideal <span class="main">(</span>insert <span class="free">f0</span> <span class="main">(</span>insert <span class="skolem">f</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="main">[</span>ideal <span class="main">{</span><span class="free">f0</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">T</span><span class="main">,</span> fst <span class="var">?D</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_perm<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>ideal <span class="main">(</span>insert <span class="free">f0</span> <span class="main">(</span>insert <span class="skolem">f</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">[</span>sum_list <span class="main">`</span> listset <span class="main">[</span>ideal <span class="main">{</span><span class="free">f0</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">]</span><span class="main">,</span> <span class="var">?T</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_appendD<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>ideal <span class="main">(</span>insert <span class="free">f0</span> <span class="main">(</span>insert <span class="skolem">f</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">[</span>ideal <span class="main">{</span><span class="free">f0</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> <span class="var">?T</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_image<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Exact Cone Decompositions›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">exact_decomp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>zero<span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">exact_decomp</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">.</span> <span class="bound">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∧</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free">X</span><span class="main">)</span> <span class="main">∧</span>
                              <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">.</span> poly_deg <span class="bound">h</span> <span class="main">=</span> poly_deg <span class="bound">h'</span> <span class="main">⟶</span>
                                          <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">&lt;</span> card <span class="bound">U</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">&lt;</span> card <span class="bound">U'</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> exact_decompI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">h</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="bound">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">h</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free">X</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">h</span> <span class="bound">h'</span> <span class="bound">U</span> <span class="bound">U'</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> poly_deg <span class="bound">h</span> <span class="main">=</span> poly_deg <span class="bound">h'</span> <span class="main">⟹</span>
            <span class="free">m</span> <span class="main">&lt;</span> card <span class="bound">U</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="bound">U'</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    exact_decomp <span class="free">m</span> <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> exact_decomp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> exact_decompD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="free">m</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h'</span><span class="main">,</span> <span class="free">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> poly_deg <span class="free">h</span> <span class="main">=</span> poly_deg <span class="free">h'</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="free">U</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="free">U'</span> <span class="main">⟹</span>
            <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">h'</span><span class="main">,</span> <span class="free">U'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> exact_decomp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> exact_decompI_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="bound">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span> <span class="bound">h'</span> <span class="bound">U</span> <span class="bound">U'</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">⟹</span> poly_deg <span class="bound">h</span> <span class="main">=</span> poly_deg <span class="bound">h'</span> <span class="main">⟹</span>
              <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">0</span> <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decompI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">h'</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">U</span> <span class="skolem">U'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> card <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> card <span class="skolem">U'</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U'</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">=</span> poly_deg <span class="skolem">h'</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> exact_decompD_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">0</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h'</span><span class="main">,</span> <span class="free">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">h</span> <span class="main">=</span> poly_deg <span class="free">h'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">h'</span><span class="main">,</span> <span class="free">U'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> card <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_gt_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h'</span><span class="main">,</span> <span class="free">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U'</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">U'</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">U'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">U'</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> card <span class="free">U'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_gt_0_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decompD<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> exact_decomp_imp_valid_decomp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="free">m</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="bound">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U</span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decompD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> exact_decomp_card_X<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≤</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="free">m</span> <span class="free">ps</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decompI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h1</span> <span class="skolem">h2</span> <span class="skolem">U1</span> <span class="skolem">U2</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h1</span><span class="main">,</span> <span class="skolem">U1</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U1</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> fin_X <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U1</span> <span class="main">≤</span> card <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> card <span class="skolem">U1</span>"</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h1</span><span class="main">,</span> <span class="skolem">U1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h2</span><span class="main">,</span> <span class="skolem">U2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">𝖺</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>zero<span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝖺</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> standard_decomp <span class="bound">k</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">𝖻</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>zero<span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝖻</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">d</span><span class="main">.</span> 𝖺 <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">≤</span> <span class="bound">d</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≤</span> card <span class="bound">U</span> <span class="main">⟶</span> poly_deg <span class="bound">h</span> <span class="main">&lt;</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 𝖺<span class="main">:</span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">ps</span> <span class="main">⟹</span> standard_decomp <span class="main">(</span>𝖺 <span class="free">ps</span><span class="main">)</span> <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> 𝖺_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> LeastI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> 𝖺_Nil<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">0</span> <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decomp_Nil<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> 𝖺_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_eq_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 𝖺_nonempty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">=</span> Min <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fin_X assms<span class="main">(</span>1<span class="main">)</span> _ assms<span class="main">(</span>3<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decomp_nonempty_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>𝖺 <span class="free">ps</span><span class="main">)</span> <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖺<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 𝖺_nonempty_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">=</span> Min <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖺_nonempty<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> fin_X assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> Min <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decomp_nonempty_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 𝖻<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">≤</span> 𝖻 <span class="free">ps</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≤</span> card <span class="free">U</span> <span class="main">⟹</span> poly_deg <span class="free">h</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> insert <span class="main">(</span>𝖺 <span class="free">ps</span><span class="main">)</span> <span class="var">?A</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> Suc <span class="main">(</span>Max <span class="skolem">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> finite_set <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">≤</span> 𝖻 <span class="free">ps</span> <span class="free">i</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> <span class="free">i</span> <span class="main">≤</span> card <span class="bound">U'</span> <span class="main">⟶</span> poly_deg <span class="bound">h'</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> 𝖻_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> LeastI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">≤</span> Max <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Max_ge<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span>fst <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> imageI<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">≤</span> Max <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Max_ge<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">≤</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> <span class="free">i</span> <span class="main">≤</span> card <span class="bound">U</span> <span class="main">⟶</span> poly_deg <span class="bound">h</span> <span class="main">&lt;</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">≤</span> 𝖻 <span class="free">ps</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≤</span> card <span class="free">U</span> <span class="main">⟹</span> poly_deg <span class="free">h</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 𝖻_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">h'</span> <span class="bound">U'</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≤</span> card <span class="bound">U'</span> <span class="main">⟹</span> poly_deg <span class="bound">h'</span> <span class="main">&lt;</span> <span class="free">d</span><span class="main">)</span> <span class="main">⟹</span> 𝖻 <span class="free">ps</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> 𝖻_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Least_le<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> 𝖻_decreasing<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="free">j</span> <span class="main">≤</span> 𝖻 <span class="free">ps</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻_le<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> card <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> card <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> 𝖻<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> 𝖻_Nil<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> 𝖻_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖺_Nil<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">U</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'x</span> set"</span></span>
    <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> card <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> <span class="free">i</span> <span class="main">≤</span> card <span class="bound">U</span> <span class="main">⟶</span> poly_deg <span class="bound">h</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 𝖻_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="free">ps</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> 𝖻 <span class="free">ps</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> finite_set <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="free">ps</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="free">ps</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="free">ps</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> poly_deg <span class="main">(</span>fst <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> poly_deg <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> le0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="free">ps</span><span class="main">)</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> 𝖻_zero_gr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">h</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">h</span> <span class="main">≤</span> Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Max_ge<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> finite_set <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span>fst <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> imageI<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">h</span> <span class="main">∈</span> poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> Suc <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> 𝖻 <span class="free">ps</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 𝖻_one<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">(</span>Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_refl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻_Nil<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> aP<span class="main">:</span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">=</span> Min <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> Min <span class="var">?A</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖺_nonempty<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> pos_decomp_subset finite_set <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>Max <span class="var">?A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> 𝖻_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?A</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> aP <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Min_in<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">≤</span> Max <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Max_ge<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">≤</span> Suc <span class="main">(</span>Max <span class="var">?A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> fin_X assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD_finite<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> card <span class="skolem">U</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span>fst <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> imageI<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">≤</span> Max <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Max_ge<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Max <span class="var">?A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">≤</span> Suc <span class="main">(</span>Max <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> Suc <span class="main">0</span> <span class="main">≤</span> card <span class="bound">U</span> <span class="main">⟶</span> poly_deg <span class="bound">h</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Max <span class="var">?A</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">≤</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> Suc <span class="main">0</span> <span class="main">≤</span> card <span class="bound">U</span> <span class="main">⟶</span> poly_deg <span class="bound">h</span> <span class="main">&lt;</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> rl<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">&lt;</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> card <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">h</span> <span class="skolem">U</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Max <span class="var">?A</span> <span class="main">&lt;</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Max_less_iff<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="var">?A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?A</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d0</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d0</span> <span class="main">∈</span> poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d0</span> <span class="main">=</span> poly_deg <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> fin_X assms<span class="main">(</span>1<span class="main">)</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD_finite<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> card <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_gt_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d0</span> <span class="main">&lt;</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rl<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Max <span class="var">?A</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> 𝖻_one_gr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">h</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 𝖻_one<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">h</span> <span class="main">≤</span> Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Max_ge<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> finite_set <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span>fst <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> imageI<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">h</span> <span class="main">∈</span> poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 𝖻_card_X<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="free">m</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="free">X</span><span class="main">)</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="free">i</span> <span class="main">=</span> 𝖺 <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> 𝖻_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decompD<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> card <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">&lt;</span> card <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> fin_X <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> card_mono leD<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">≤</span> 𝖺 <span class="free">ps</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> <span class="free">i</span> <span class="main">≤</span> card <span class="bound">U</span> <span class="main">⟶</span> poly_deg <span class="bound">h</span> <span class="main">&lt;</span> 𝖺 <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> lem_6_1_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="free">m</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> card <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">h</span> <span class="free">U</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">h</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">U</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻_Nil<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="main">(</span>card <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 𝖺 <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> le_refl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻_card_X<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> std<span class="main">:</span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="main">(</span>card <span class="free">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖺<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">i</span> <span class="main">≤</span> Suc <span class="main">(</span>card <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="main">(</span>card <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> 𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻_decreasing<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">≤</span> 𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">h</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> card <span class="bound">U</span> <span class="main">∧</span> 𝖻 <span class="free">ps</span> <span class="free">i</span> <span class="main">≤</span> Suc <span class="main">(</span>poly_deg <span class="bound">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">h</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> card <span class="bound">U</span> <span class="main">∧</span> 𝖻 <span class="free">ps</span> <span class="free">i</span> <span class="main">≤</span> Suc <span class="main">(</span>poly_deg <span class="bound">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹𝖺 <span class="free">ps</span> <span class="main">≤</span> 𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>5<span class="main">,</span> 6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_less_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"𝖺 <span class="free">ps</span> <span class="main">≤</span> 𝖻 <span class="free">ps</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="free">i</span> <span class="main">≤</span> 𝖻 <span class="free">ps</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻_le<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> card <span class="skolem">U</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poly_deg <span class="skolem">h</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="free">i</span> <span class="main">≤</span> Suc <span class="main">(</span>poly_deg <span class="skolem">h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> * <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">≤</span> card <span class="skolem">U</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹𝖺 <span class="free">ps</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="free">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> card <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="free">i</span> <span class="main">≤</span> Suc <span class="main">(</span>poly_deg <span class="skolem">h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> std this
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="main">(</span>card <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq1 <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹𝖺 <span class="free">ps</span> <span class="main">≤</span> 𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> poly_deg <span class="skolem">h</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="quoted"><span class="quoted">‹𝖻 <span class="free">ps</span> <span class="free">i</span> <span class="main">≤</span> Suc <span class="main">(</span>poly_deg <span class="skolem">h</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&lt;</span> Suc <span class="main">(</span>poly_deg <span class="skolem">h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> less_le_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="skolem"><span class="skolem">U'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U</span> <span class="main">≤</span> card <span class="skolem">U'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">≤</span> card <span class="skolem">U</span>›</span></span> this<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> card <span class="skolem">U'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U'</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="free">d</span>›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U'</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U'</span> <span class="main">≠</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">≤</span> card <span class="skolem">U'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">i</span> <span class="main">≤</span> card <span class="skolem">U'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h'</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> lem_6_1_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">0</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> card <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">h</span> <span class="free">U</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">h'</span></span><span class="main">,</span> <span class="bound"><span class="bound">U'</span></span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> <span class="free">d</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">U</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lem_6_1_1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">h'</span></span><span class="main">,</span> <span class="bound"><span class="bound">U'</span></span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> <span class="free">d</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⊆</span> <span class="var">?A</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="skolem"><span class="skolem">U'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>›</span></span> this<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">=</span> poly_deg <span class="skolem">h'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹poly_deg <span class="skolem">h</span> <span class="main">=</span> <span class="free">d</span>›</span></span> <span class="quoted"><span class="quoted">‹poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="free">d</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decompD_zero<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">U</span> <span class="main">=</span> <span class="free">i</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> lem_6_1_2'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">0</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> card <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">h'</span></span><span class="main">,</span> <span class="bound"><span class="bound">U'</span></span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> <span class="free">d</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?A</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">h'</span></span><span class="main">,</span> <span class="bound"><span class="bound">U'</span></span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> card <span class="bound">U'</span> <span class="main">=</span> <span class="free">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">h'</span></span><span class="main">,</span> <span class="bound"><span class="bound">U'</span></span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> <span class="free">d</span><span class="main">}</span>"</span></span>
            <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">h'</span></span><span class="main">,</span> <span class="bound"><span class="bound">U'</span></span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> card <span class="bound">U'</span> <span class="main">=</span> <span class="free">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U</span> <span class="main">=</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lem_6_1_2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?A</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> <span class="var">?A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?A</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">}</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?A</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">U</span> <span class="main">=</span> <span class="free">i</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⊆</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?B</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> lem_6_1_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">0</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> card <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">U</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> poly_deg <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">j'</span><span class="main">.</span> 𝖻 <span class="free">ps</span> <span class="bound">j'</span> <span class="main">≤</span> poly_deg <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> 𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> poly_deg <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">h</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> le_refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="main">(</span>card <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 𝖺 <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻_card_X<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> _ assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> poly_deg <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompD<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">(</span>𝖺 <span class="free">ps</span><span class="main">)</span> <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖺<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="main">(</span>card <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> poly_deg <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="skolem">j</span> <span class="main">≤</span> poly_deg <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> j_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> LeastI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Suc <span class="free">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> Suc <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> 𝖻 <span class="free">ps</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻_decreasing<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> poly_deg <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly_deg <span class="free">h</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="free">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> card <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> Suc <span class="main">(</span>card <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> j_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main">)</span> <span class="operator">fact</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> poly_deg <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">h</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poly_deg <span class="free">h</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> poly_deg <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> j_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> Suc <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h0</span></span> <span class="skolem"><span class="skolem">U0</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> poly_deg <span class="free">h</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U0</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lem_6_1_2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> poly_deg <span class="free">h</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="skolem">h0</span><span class="main">,</span> <span class="skolem">U0</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">=</span> <span class="skolem">U0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="free">U</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">U0</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">i</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="free">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">fun</span></span> <span class="entity">shift_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">,</span>ring_no_zero_divisors<span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> <span class="main">⇒</span>
                              <span class="tfree">'x</span> <span class="main">⇒</span> <span class="main">_</span> list <span class="main">⇒</span> <span class="main">_</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">shift_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">=</span>
        <span class="main">(</span><span class="main">(</span>punit.monom_mult <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">1</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span><span class="main">)</span> <span class="main">#</span> removeAll <span class="main">(</span><span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> shift_list.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> monomial_decomp_shift_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">hU</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span>shift_list <span class="free">hU</span> <span class="free">x</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="free">x</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> hU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hU</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_monomial <span class="skolem">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"lcf <span class="skolem">h</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decompD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>lcf <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span>lpp <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.monomial_eq_itself<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> lpp <span class="skolem">h</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> 2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_monomial <span class="main">(</span>punit.monom_mult <span class="main">1</span> <span class="var">?x</span> <span class="skolem">h</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lcf <span class="main">(</span>punit.monom_mult <span class="main">1</span> <span class="var">?x</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.monom_mult_monomial monomial_is_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift_list.simps monomial_decomp_def hU<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_decomp_shift_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">hU</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="main">(</span>shift_list <span class="free">hU</span> <span class="free">x</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="free">x</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> hU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hU</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"homogeneous <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="main">(</span>punit.monom_mult <span class="main">1</span> <span class="var">?x</span> <span class="skolem">h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> homogeneous_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift_list.simps hom_decomp_def hU<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> valid_decomp_shift_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span>shift_list <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="free">x</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="free">x</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.monom_mult <span class="main">1</span> <span class="var">?x</span> <span class="free">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> Polys_closed_monom_mult PPs_closed_single<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_decomp_def punit.monom_mult_eq_zero_iff shift_list.simps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> standard_decomp_shift_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span> <span class="free">U1</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h2</span><span class="main">,</span> <span class="free">U2</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">h1</span> <span class="main">=</span> poly_deg <span class="free">h2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">U2</span> <span class="main">≤</span> card <span class="free">U1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span> <span class="free">U1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="free">h2</span><span class="main">,</span> <span class="free">U2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">U2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="main">(</span>shift_list <span class="main">(</span><span class="free">h2</span><span class="main">,</span> <span class="free">U2</span><span class="main">)</span> <span class="free">x</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.monom_mult <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">1</span><span class="main">)</span> <span class="free">h2</span><span class="main">,</span> <span class="free">U2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h2</span><span class="main">,</span> <span class="free">U2</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"removeAll <span class="main">(</span><span class="free">h2</span><span class="main">,</span> <span class="free">U2</span><span class="main">)</span> <span class="free">ps</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="main">(</span>shift_list <span class="main">(</span><span class="free">h2</span><span class="main">,</span> <span class="free">U2</span><span class="main">)</span> <span class="free">x</span> <span class="free">ps</span><span class="main">)</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">=</span> <span class="var">?p1</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">=</span> <span class="var">?p2</span> <span class="main">∧</span> <span class="free">U2</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pos_decomp_def shift_list.simps <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">U2</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h2</span><span class="main">,</span> <span class="free">U2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> k_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> poly_deg <span class="free">h2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompD<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="free">x</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> disj <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> poly_deg <span class="skolem">h</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">=</span> <span class="var">?p1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> punit.monom_mult <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="var">?x</span> <span class="free">h2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">note</span></span> k_le
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">h2</span> <span class="main">≤</span> poly_deg <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">h2</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h poly_deg_monom_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">=</span> <span class="var">?p2</span> <span class="main">∧</span> <span class="free">U2</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> k_le <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≤</span> poly_deg <span class="skolem">h</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> disj <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="skolem"><span class="skolem">U'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="var">?p1</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U</span> <span class="main">≤</span> card <span class="skolem">U'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">=</span> <span class="var">?p1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> punit.monom_mult <span class="main">1</span> <span class="var">?x</span> <span class="free">h2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="free">U2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">≤</span> poly_deg <span class="skolem">h</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≤</span> poly_deg <span class="free">h2</span> <span class="main">∨</span> poly_deg <span class="skolem">h</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">h2</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h poly_deg_monom_mult deg_pm_single<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≤</span> poly_deg <span class="free">h2</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">h2</span><span class="main">,</span> <span class="free">U2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≤</span> <span class="skolem">d</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="skolem"><span class="skolem">U'</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">U2</span> <span class="main">≤</span> card <span class="skolem">U'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="var">?p1</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="skolem">d</span>›</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">U2</span> <span class="main">≤</span> card <span class="skolem">U'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U</span> <span class="main">≤</span> card <span class="skolem">U'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">=</span> <span class="free">U2</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="var">?p1</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">=</span> <span class="var">?p1</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> le_refl <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">=</span> <span class="var">?p2</span> <span class="main">∧</span> <span class="free">U2</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="free">h2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="free">U2</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">≤</span> poly_deg <span class="skolem">h</span>›</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≤</span> poly_deg <span class="free">h2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">h2</span><span class="main">,</span> <span class="free">U2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≤</span> <span class="skolem">d</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="skolem"><span class="skolem">U'</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">U2</span> <span class="main">≤</span> card <span class="skolem">U'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="var">?p1</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="skolem">d</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> _ <span class="quoted"><span class="quoted">‹card <span class="free">U2</span> <span class="main">≤</span> card <span class="skolem">U'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U</span> <span class="main">≤</span> card <span class="skolem">U'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> U
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> Diff_empty card_Diff1_le card.infinite finite_Diff_insert order_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> this <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≤</span> <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">≤</span> poly_deg <span class="skolem">h</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="skolem"><span class="skolem">U'</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U</span> <span class="main">≤</span> card <span class="skolem">U'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="var">?p1</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">U</span> <span class="main">≤</span> card <span class="skolem">U'</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">h'</span> <span class="bound">U'</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>shift_list <span class="main">(</span><span class="free">h2</span><span class="main">,</span> <span class="free">U2</span><span class="main">)</span> <span class="free">x</span> <span class="free">ps</span><span class="main">)</span> <span class="main">∧</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> card <span class="skolem">U</span> <span class="main">≤</span> card <span class="bound">U'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">h2</span><span class="main">,</span> <span class="free">U2</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h'</span> <span class="main">=</span> <span class="free">h2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U'</span> <span class="main">=</span> <span class="free">U2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span> 6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span> <span class="free">U1</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>shift_list <span class="main">(</span><span class="free">h2</span><span class="main">,</span> <span class="free">U2</span><span class="main">)</span> <span class="free">x</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift_list.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="skolem">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">h1</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h'</span> <span class="main">=</span> <span class="free">h2</span>›</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">U</span> <span class="main">≤</span> card <span class="skolem">U'</span>›</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U</span> <span class="main">≤</span> card <span class="free">U1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U'</span> <span class="main">=</span> <span class="free">U2</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>shift_list <span class="main">(</span><span class="free">h2</span><span class="main">,</span> <span class="free">U2</span><span class="main">)</span> <span class="free">x</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> shift_list.simps<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">U</span> <span class="main">≤</span> card <span class="skolem">U'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cone_decomp_shift_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="main">(</span>shift_list <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="free">x</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.monom_mult <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">1</span><span class="main">)</span> <span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"removeAll <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps1</span></span> <span class="skolem"><span class="skolem">ps2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">=</span> <span class="skolem">ps1</span> <span class="main">@</span> <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ps2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">ps1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> split_list_first<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count_list <span class="skolem">ps2</span> <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"count_list <span class="skolem">ps2</span> <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> count_list <span class="free">ps</span> <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ps count_list_append<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> count_list <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span> <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> count_list_map_ge<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> count_list <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span> <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> cone_decompD <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_repeated_eq_zero<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> zero_in_cone<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> tip_in_cone<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">h</span></span> <span class="quoted"><span class="free">U</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">ps2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_list_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perm <span class="free">ps</span> <span class="main">(</span><span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ps1</span> <span class="main">@</span> <span class="skolem">ps2</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"perm <span class="main">_</span> <span class="var">?ps</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> perm_sym<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> perm_append_Cons ps<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="var">?ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decomp_perm<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">(</span>map cone <span class="var">?ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">#</span> map cone <span class="main">(</span><span class="skolem">ps1</span> <span class="main">@</span> <span class="skolem">ps2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">(</span><span class="main">(</span>map cone <span class="main">(</span><span class="skolem">ps1</span> <span class="main">@</span> <span class="skolem">ps2</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>cone <span class="var">?p1</span><span class="main">,</span> cone <span class="var">?p2</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_direct_decomp<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="free">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> insert <span class="free">x</span> <span class="main">(</span><span class="free">U</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">[</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> cone <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="var">?x</span> <span class="main">*</span> <span class="free">h</span><span class="main">,</span> insert <span class="free">x</span> <span class="main">(</span><span class="free">U</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_cone_insert<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>cone <span class="var">?p1</span><span class="main">,</span> cone <span class="var">?p2</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_absorb times_monomial_left direct_decomp_perm perm.swap<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">(</span>map cone <span class="main">(</span><span class="skolem">ps1</span> <span class="main">@</span> <span class="skolem">ps2</span> <span class="main">@</span> <span class="main">[</span><span class="var">?p1</span><span class="main">,</span> <span class="var">?p2</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="main">(</span><span class="skolem">ps1</span> <span class="main">@</span> <span class="skolem">ps2</span> <span class="main">@</span> <span class="main">[</span><span class="var">?p1</span><span class="main">,</span> <span class="var">?p2</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decompI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perm <span class="main">(</span><span class="skolem">ps1</span> <span class="main">@</span> <span class="skolem">ps2</span> <span class="main">@</span> <span class="main">[</span><span class="var">?p1</span><span class="main">,</span> <span class="var">?p2</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="var">?p1</span> <span class="main">#</span> <span class="var">?p2</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">ps1</span> <span class="main">@</span> <span class="skolem">ps2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps1</span> <span class="main">@</span> <span class="skolem">ps2</span> <span class="main">@</span> <span class="main">[</span><span class="var">?p1</span><span class="main">,</span> <span class="var">?p2</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ps1</span> <span class="main">@</span> <span class="skolem">ps2</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="var">?p1</span><span class="main">,</span> <span class="var">?p2</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perm <span class="main">…</span> <span class="main">(</span><span class="main">[</span><span class="var">?p1</span><span class="main">,</span> <span class="var">?p2</span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">ps1</span> <span class="main">@</span> <span class="skolem">ps2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> perm_append_swap<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?p1</span> <span class="main">#</span> <span class="var">?p2</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">ps1</span> <span class="main">@</span> <span class="skolem">ps2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="main">(</span><span class="var">?p1</span> <span class="main">#</span> <span class="var">?p2</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">ps1</span> <span class="main">@</span> <span class="skolem">ps2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decomp_perm<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> * ** <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps1</span> <span class="main">@</span> <span class="skolem">ps2</span> <span class="main">=</span> removeAll <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> remove1_append ps<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> shift_list.simps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Functions <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>shift›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>exact›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span> <span class="free">m</span> <span class="main">::</span> <span class="quoted">nat</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">d</span> <span class="main">::</span> <span class="quoted">nat</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">shift2_inv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>zero<span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">shift2_inv</span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span> <span class="main">⟷</span> valid_decomp <span class="free">X</span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span> <span class="main">∧</span> standard_decomp <span class="free">k</span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span> <span class="main">∧</span> exact_decomp <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span> <span class="main">∧</span>
                         <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">d0</span></span><span class="main">&lt;</span><span class="free">d</span><span class="main">.</span> card <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">qs</span></span></span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">d0</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">shift1_inv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>zero<span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> set<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">shift1_inv</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">qs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">qs</span></span></span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span> shift2_inv <span class="free"><span class="bound"><span class="entity">qs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shift2_invI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span> <span class="main">⟹</span> standard_decomp <span class="free">k</span> <span class="free">qs</span> <span class="main">⟹</span> exact_decomp <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="free">qs</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">d0</span><span class="main">.</span> <span class="bound">d0</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟹</span> card <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">d0</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟹</span>
    shift2_inv <span class="free">qs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift2_inv_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> shift2_invD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="free">qs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d0</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟹</span> card <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">d0</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift2_inv_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> shift1_invI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span> <span class="main">⟹</span> shift2_inv <span class="free">qs</span> <span class="main">⟹</span> shift1_inv <span class="main">(</span><span class="free">qs</span><span class="main">,</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> shift1_invD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"shift1_inv <span class="main">(</span><span class="free">qs</span><span class="main">,</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="free">qs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">declare</span></span> shift1_inv.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> shift1_inv_finite_snd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"shift1_inv <span class="main">(</span><span class="free">qs</span><span class="main">,</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_invD<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> set <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> set <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> finite_set<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> shift1_inv_some_snd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"shift1_inv <span class="main">(</span><span class="free">qs</span><span class="main">,</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> card <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">∧</span> card <span class="main">(</span>snd <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">h</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">U</span> <span class="main">=</span> Suc <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">m</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> Suc <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> inv2<span class="main">:</span> <span class="quoted"><span class="quoted">"shift2_inv <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_invD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> B'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">∪</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B A_def Y_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_inv_finite_snd<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> set <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> finite_set<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A_def Y_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">=</span> card <span class="skolem">A</span> <span class="main">+</span> card <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_Un_disjoint<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> card <span class="skolem">A</span> <span class="main">+</span> card <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> B'<span class="main">)</span>
  <span class="keyword1"><span class="command">thm</span></span> card_le_Suc0_iff_eq<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y</span>›</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">Y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> One_nat_def card_le_Suc0_iff_eq<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y</span>›</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q1</span> <span class="skolem">q2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h1</span></span> <span class="skolem"><span class="skolem">U1</span></span> <span class="keyword2"><span class="keyword">where</span></span> q1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h1</span><span class="main">,</span> <span class="skolem">U1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h2</span></span> <span class="skolem"><span class="skolem">U2</span></span> <span class="keyword2"><span class="keyword">where</span></span> q2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h2</span><span class="main">,</span> <span class="skolem">U2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h1</span><span class="main">,</span> <span class="skolem">U1</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h1</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">m</span> <span class="main">&lt;</span> card <span class="skolem">U1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q1 Y_def<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h2</span><span class="main">,</span> <span class="skolem">U2</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h2</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">m</span> <span class="main">&lt;</span> card <span class="skolem">U2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q2 Y_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h1</span> <span class="main">=</span> poly_deg <span class="skolem">h2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹poly_deg <span class="skolem">h1</span> <span class="main">=</span> <span class="free">d</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> inv2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_invD<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">=</span> <span class="skolem">q2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q1 q2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decompD<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> card <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">∧</span> card <span class="main">(</span>snd <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> assms<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> someI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">∧</span> card <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">U</span> <span class="main">=</span> Suc <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">h</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shift1_inv_preserved<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"shift1_inv <span class="main">(</span><span class="free">qs</span><span class="main">,</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> card <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">∧</span> card <span class="main">(</span>snd <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">U</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"shift1_inv <span class="main">(</span>shift_list <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="free">x</span> <span class="free">qs</span><span class="main">,</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.monom_mult <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">1</span><span class="main">)</span> <span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"removeAll <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="free">qs</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg_h<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">h</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> card_U<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">U</span> <span class="main">=</span> Suc <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_inv_some_snd<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> card_U <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> card_U <span class="keyword1"><span class="command">have</span></span> card_Ux<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">U</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_Diff_singleton card.infinite diff_Suc_1 nat.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> inv2<span class="main">:</span> <span class="quoted"><span class="quoted">"shift2_inv <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_invD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> inv2 <span class="keyword1"><span class="command">have</span></span> valid_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_invD<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> shift1_invI shift2_invI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="main">(</span>shift_list <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="free">x</span> <span class="free">qs</span><span class="main">)</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?C</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Set.set_eqI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="var">?B</span> <span class="main">⟷</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="var">?C</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="var">?C</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> insert <span class="var">?p1</span> <span class="main">(</span>insert <span class="var">?p2</span> <span class="main">(</span>set <span class="var">?qs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span>fst <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift_list.simps<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> insertE<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="var">?p1</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span>fst <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">d</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_deg_monom_mult deg_pm_single deg_h<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b1<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="var">?p2</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>snd <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_Ux<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> b2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="var">?qs</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> b1 b2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B shift_list.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> valid_qs <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">U</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span>shift_list <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="free">x</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decomp_shift_list<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> inv2 <span class="keyword1"><span class="command">have</span></span> std<span class="main">:</span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_invD<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> _ <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">B</span> <span class="main">≤</span> card <span class="main">{</span><span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_mono<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="skolem"><span class="skolem">U'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">m</span> <span class="main">≤</span> card <span class="skolem">U'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> std this<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h'</span> <span class="main">=</span> poly_deg <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> deg_h<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="free">m</span> <span class="main">≤</span> card <span class="skolem">U'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">U</span> <span class="main">≤</span> card <span class="skolem">U'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> card_U<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="main">(</span>shift_list <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="free">x</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decomp_shift_list<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> inv2 <span class="keyword1"><span class="command">have</span></span> exct<span class="main">:</span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_invD<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="main">(</span>shift_list <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="free">x</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decompI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h'</span> <span class="skolem">U'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>shift_list <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="free">x</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> insert <span class="var">?p1</span> <span class="main">(</span>insert <span class="var">?p2</span> <span class="main">(</span>set <span class="var">?qs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift_list.simps<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> insertE<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">=</span> <span class="var">?p1</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> h'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h'</span> <span class="main">=</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">1</span><span class="main">)</span> <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> exct <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decompD<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">U</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="free">x</span> <span class="main">1</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_single<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> exct <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decompD<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> h' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_monom_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">=</span> <span class="var">?p2</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h'</span> <span class="main">=</span> <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> exct <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decompD<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> exct <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decompD<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U'</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> insertE<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">=</span> <span class="var">?p1</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U'</span> <span class="main">=</span> <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> exct <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decompD<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">=</span> <span class="var">?p2</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U'</span> <span class="main">=</span> <span class="free">U</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> exct <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decompD<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> exct <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decompD<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h1</span> <span class="skolem">h2</span> <span class="skolem">U1</span> <span class="skolem">U2</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h1</span><span class="main">,</span> <span class="skolem">U1</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>shift_list <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="free">x</span> <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">m</span> <span class="main">&lt;</span> card <span class="skolem">U1</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h1</span><span class="main">,</span> <span class="skolem">U1</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> card_U card_Ux <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> shift_list.simps<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h2</span><span class="main">,</span> <span class="skolem">U2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>shift_list <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="free">x</span> <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">m</span> <span class="main">&lt;</span> card <span class="skolem">U2</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h2</span><span class="main">,</span> <span class="skolem">U2</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> card_U card_Ux <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> shift_list.simps<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h1</span> <span class="main">=</span> poly_deg <span class="skolem">h2</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> exct <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h1</span><span class="main">,</span> <span class="skolem">U1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h2</span><span class="main">,</span> <span class="skolem">U2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decompD<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d0</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d0</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d0</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?A</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="main">(</span>shift_list <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="free">x</span> <span class="free">qs</span><span class="main">)</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d0</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="var">?A</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">⊆</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="var">?C</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="var">?p1</span> <span class="main">∨</span> <span class="skolem">q</span> <span class="main">=</span> <span class="var">?p2</span> <span class="main">∨</span> <span class="skolem">q</span> <span class="main">∈</span> set <span class="var">?qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span>fst <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="skolem">q</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift_list.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="var">?p1</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> poly_deg <span class="main">(</span>fst <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_deg_monom_mult deg_h<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d0</span> <span class="main">&lt;</span> <span class="free">d</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> 1<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="var">?p2</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> poly_deg <span class="main">(</span>fst <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_h<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d0</span> <span class="main">&lt;</span> <span class="free">d</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> 1<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="var">?qs</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?C</span> <span class="main">≤</span> card <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> inv2 <span class="quoted"><span class="quoted">‹<span class="skolem">d0</span> <span class="main">&lt;</span> <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_invD<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?C</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="main">(</span>domintros<span class="main">)</span> <span class="entity">shift1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> set<span class="main">)</span> <span class="main">⇒</span>
                                <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list <span class="main">×</span>
                                  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">,</span>ring_no_zero_divisors<span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">shift1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">qs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="main">1</span> <span class="main">&lt;</span> card <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="keyword1">then</span>
        <span class="keyword1">let</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">SOME</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">∧</span> card <span class="main">(</span>snd <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">m</span><span class="main">;</span> <span class="bound">x</span> <span class="main">=</span> <span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">U</span> <span class="keyword1">in</span>
          <span class="free">shift1</span> <span class="main">(</span>shift_list <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">qs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> shift1_domI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"shift1_inv <span class="free">args</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"shift1_dom <span class="free">args</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> wf_measure<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"card <span class="main">∘</span> snd"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">args</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> args<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">args</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"shift1_dom <span class="main">(</span><span class="skolem">qs0</span><span class="main">,</span> <span class="skolem">B0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">B0</span> <span class="main">&lt;</span> card <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"shift1_inv <span class="main">(</span><span class="skolem">qs0</span><span class="main">,</span> <span class="skolem">B0</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">qs0</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">B0</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="main">_</span><span class="main">)</span> set"</span></span>
      <span class="keyword1"><span class="command">using</span></span> _ that<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> less<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">qs0</span><span class="main">,</span> <span class="skolem">B0</span><span class="main">)</span><span class="main">,</span> <span class="skolem">args</span><span class="main">)</span> <span class="main">∈</span> measure <span class="main">(</span>card <span class="main">∘</span> snd<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> args<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"shift1_inv <span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> args<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> args
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> shift1.domintros<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U</span>
      <span class="keyword3"><span class="command">assume</span></span> hU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">∧</span> card <span class="main">(</span>snd <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">m</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">U</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">&lt;</span> card <span class="skolem">B</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> card <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shift1_dom <span class="main">(</span>shift_list <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">qs</span><span class="main">,</span> <span class="skolem">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> inv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_inv_finite_snd<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> inv <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> card <span class="skolem">B</span>›</span></span> hU <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_inv_some_snd<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_Diff1_less<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> inv <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> card <span class="skolem">B</span>›</span></span> hU x_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"shift1_inv <span class="main">(</span>shift_list <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">qs</span><span class="main">,</span> <span class="main">(</span><span class="skolem">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_inv_preserved<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"shift1_dom <span class="main">(</span>shift_list <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">∧</span> card <span class="main">(</span>snd <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">U</span><span class="main">)</span> <span class="skolem">qs</span><span class="main">,</span>
                    <span class="skolem">B</span> <span class="main">-</span> <span class="main">{</span><span class="keyword1">SOME</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">∧</span> card <span class="main">(</span>snd <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">m</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hU x_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shift1_induct <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> base step<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"shift1_inv <span class="free">args</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">qs</span> <span class="bound">B</span><span class="main">.</span> shift1_inv <span class="main">(</span><span class="bound">qs</span><span class="main">,</span> <span class="bound">B</span><span class="main">)</span> <span class="main">⟹</span> card <span class="bound">B</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">qs</span><span class="main">,</span> <span class="bound">B</span><span class="main">)</span> <span class="main">(</span><span class="bound">qs</span><span class="main">,</span> <span class="bound">B</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">qs</span> <span class="bound">B</span> <span class="bound">h</span> <span class="bound">U</span> <span class="bound">x</span><span class="main">.</span> shift1_inv <span class="main">(</span><span class="bound">qs</span><span class="main">,</span> <span class="bound">B</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">1</span> <span class="main">&lt;</span> card <span class="bound">B</span> <span class="main">⟹</span>
            <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span> <span class="main">∧</span> card <span class="main">(</span>snd <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">m</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">U</span><span class="main">)</span> <span class="main">⟹</span>
            finite <span class="bound">U</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">U</span> <span class="main">⟹</span> card <span class="main">(</span><span class="bound">U</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="main">⟹</span>
            <span class="free">P</span> <span class="main">(</span>shift_list <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">qs</span><span class="main">,</span> <span class="bound">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>shift1 <span class="main">(</span>shift_list <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">qs</span><span class="main">,</span> <span class="bound">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
            <span class="free">P</span> <span class="main">(</span><span class="bound">qs</span><span class="main">,</span> <span class="bound">B</span><span class="main">)</span> <span class="main">(</span>shift1 <span class="main">(</span>shift_list <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">qs</span><span class="main">,</span> <span class="bound">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">args</span> <span class="main">(</span>shift1 <span class="free">args</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shift1_dom <span class="free">args</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_domI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">args</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> shift1.pinduct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">qs</span> <span class="skolem">B</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> hU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">∧</span> card <span class="main">(</span>snd <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> prod.exhaust<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">U</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift1.psimps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> step.hyps<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> hU x_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main"><span class="keyword3">,</span></span>
          <span class="operator">intro</span> conjI impI<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?args</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>shift_list <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">qs</span><span class="main">,</span> <span class="skolem">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> card <span class="skolem">B</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> step.prems <span class="keyword1"><span class="command">have</span></span> card_U<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">U</span> <span class="main">=</span> Suc <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hU <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_inv_some_snd<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> card_U <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> card.infinite <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> card_U <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> step.prems <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> card <span class="skolem">B</span>›</span></span> hU x_def <span class="quoted"><span class="quoted">‹finite <span class="skolem">U</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">(</span>shift1 <span class="var">?args</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">U</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_U<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> card <span class="skolem">B</span>›</span></span> refl hU x_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="var">?args</span> <span class="main">(</span>shift1 <span class="var">?args</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> step.hyps<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> step.prems <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> card <span class="skolem">B</span>›</span></span> hU x_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"shift1_inv <span class="var">?args</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_inv_preserved<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">1</span> <span class="main">&lt;</span> card <span class="skolem">B</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">B</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> step.prems <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shift1_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"shift1_inv <span class="free">args</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d0</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="free">args</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">d0</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">args</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> shift1_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base <span class="skolem">qs</span> <span class="skolem">B</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d0</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">∨</span> <span class="free">d0</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> base<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_invD<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">d0</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> fst_conv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_invD<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">d0</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> base<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">d0</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> fst_conv <span class="quoted"><span class="quoted">‹<span class="free">d0</span> <span class="main">=</span> <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_invD<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> base<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shift1_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"shift1_inv <span class="free">args</span> <span class="main">⟹</span>
    card <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="free">args</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span> <span class="main">≤</span> card <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="free">args</span><span class="main">)</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">args</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> shift1_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base <span class="skolem">qs</span> <span class="skolem">B</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">qs</span> <span class="skolem">B</span> <span class="skolem">h</span> <span class="skolem">U</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="skolem">x</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.monom_mult <span class="main">1</span> <span class="var">?x</span> <span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="skolem">qs</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> step<span class="main">(</span>1-3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> card_U<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">U</span> <span class="main">=</span> Suc <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_inv_some_snd<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> step<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_invD<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_invD<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> fin1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> fin2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>insert <span class="var">?p1</span> <span class="var">?A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> hU_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> insert <span class="var">?p1</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_U<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p1</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lpp <span class="main">(</span>punit.monom_mult <span class="main">1</span> <span class="var">?x</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> lpp <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.lt_monom_mult monomial_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"shift_list <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">qs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span><span class="var">?qs</span><span class="main">,</span> <span class="skolem">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span>insert <span class="var">?p1</span> <span class="var">?A</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>7<span class="main">)</span> card_U <span class="quoted"><span class="quoted">‹<span class="var">?p1</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> shift_list.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> fin2 hU_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">…</span> <span class="main">=</span> card <span class="main">(</span>insert <span class="var">?p1</span> <span class="var">?A</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_Diff_singleton_if<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> fin1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> Suc <span class="main">(</span>card <span class="var">?A</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_insert_if<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span><span class="var">?qs</span><span class="main">,</span> <span class="skolem">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span> <span class="main">≤</span>
                  card <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> step<span class="main">(</span>8<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shift1_3<span class="main">:</span> <span class="quoted"><span class="quoted">"shift1_inv <span class="free">args</span> <span class="main">⟹</span> cone_decomp <span class="free">T</span> <span class="main">(</span>fst <span class="free">args</span><span class="main">)</span> <span class="main">⟹</span> cone_decomp <span class="free">T</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="free">args</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">args</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> shift1_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base <span class="skolem">qs</span> <span class="skolem">B</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> base<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">qs</span> <span class="skolem">B</span> <span class="skolem">h</span> <span class="skolem">U</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> step.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_invD<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_invD<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> step.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> step.hyps<span class="main">(</span>1-3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_inv_some_snd<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="main">(</span>fst <span class="main">(</span>shift_list <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">qs</span><span class="main">,</span> <span class="skolem">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fst_conv <span class="keyword1"><span class="command">using</span></span> step.hyps<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decomp_shift_list<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> step.hyps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shift1_4<span class="main">:</span>
  <span class="quoted"><span class="quoted">"shift1_inv <span class="free">args</span> <span class="main">⟹</span>
    Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span>fst <span class="free">args</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="free">args</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">args</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> shift1_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base <span class="skolem">qs</span> <span class="skolem">B</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">qs</span> <span class="skolem">B</span> <span class="skolem">h</span> <span class="skolem">U</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.monom_mult <span class="main">1</span> <span class="var">?x</span> <span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"shift_list <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">qs</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> step<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="skolem">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> inv2<span class="main">:</span> <span class="quoted"><span class="quoted">"shift2_inv <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_invD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> set <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> step<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">qs</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> finite_set <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="var">?qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span>fst <span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span>fst <span class="main">(</span><span class="var">?qs</span><span class="main">,</span> <span class="skolem">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fst_conv
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Max.boundedI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> finite_set <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="skolem">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">qs</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="skolem">qs</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="skolem">qs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="skolem">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> poly_deg <span class="main">(</span>fst <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="var">?qs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> poly_deg <span class="main">(</span>fst <span class="var">?p1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a poly_deg_monom_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> fin <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="var">?qs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Max_ge<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p1</span> <span class="main">∈</span> set <span class="var">?qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift_list.simps<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span>fst <span class="var">?p1</span><span class="main">)</span> <span class="main">∈</span> poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="var">?qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> imageI<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> set <span class="skolem">qs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="var">?qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift_list.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="var">?qs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> imageI<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> fin <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Max_ge<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shift1_5<span class="main">:</span> <span class="quoted"><span class="quoted">"shift1_inv <span class="free">args</span> <span class="main">⟹</span> fst <span class="main">(</span>shift1 <span class="free">args</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> fst <span class="free">args</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">args</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> shift1_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base <span class="skolem">qs</span> <span class="skolem">B</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">qs</span> <span class="skolem">B</span> <span class="skolem">h</span> <span class="skolem">U</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.monom_mult <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"shift_list <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">qs</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> step<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="skolem">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> inv2<span class="main">:</span> <span class="quoted"><span class="quoted">"shift2_inv <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_invD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> set <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> step<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>shift1 <span class="main">(</span><span class="var">?qs</span><span class="main">,</span> <span class="skolem">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step.hyps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift_list.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shift1_6<span class="main">:</span> <span class="quoted"><span class="quoted">"shift1_inv <span class="free">args</span> <span class="main">⟹</span> monomial_decomp <span class="main">(</span>fst <span class="free">args</span><span class="main">)</span> <span class="main">⟹</span> monomial_decomp <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="free">args</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">args</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> shift1_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base <span class="skolem">qs</span> <span class="skolem">B</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> base<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">qs</span> <span class="skolem">B</span> <span class="skolem">h</span> <span class="skolem">U</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> step<span class="main">(</span>1-3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_inv_some_snd<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> step.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span>fst <span class="main">(</span>shift_list <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">qs</span><span class="main">,</span> <span class="skolem">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fst_conv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decomp_shift_list<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> step.hyps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shift1_7<span class="main">:</span> <span class="quoted"><span class="quoted">"shift1_inv <span class="free">args</span> <span class="main">⟹</span> hom_decomp <span class="main">(</span>fst <span class="free">args</span><span class="main">)</span> <span class="main">⟹</span> hom_decomp <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="free">args</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">args</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> shift1_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base <span class="skolem">qs</span> <span class="skolem">B</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> base<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">qs</span> <span class="skolem">B</span> <span class="skolem">h</span> <span class="skolem">U</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> step<span class="main">(</span>1-3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_inv_some_snd<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> step.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="main">(</span>fst <span class="main">(</span>shift_list <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">qs</span><span class="main">,</span> <span class="skolem">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fst_conv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_decomp_shift_list<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> step.hyps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shift2_inv_preserved<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="free">d</span> <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="main">(</span>Suc <span class="free">d</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="main">(</span><span class="free">qs</span><span class="main">,</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">args</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">args</span> <span class="main">=</span> <span class="main">(</span><span class="free">qs</span><span class="main">,</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> refl assms <span class="keyword1"><span class="command">have</span></span> inv1<span class="main">:</span> <span class="quoted"><span class="quoted">"shift1_inv <span class="free">d</span> <span class="skolem">args</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> args_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_invI<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"shift1_inv <span class="free">d</span> <span class="main">(</span>shift1 <span class="skolem">args</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">args</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> shift1_induct<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"shift1_inv <span class="free">d</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="skolem">args</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>shift1 <span class="skolem">args</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="free">d</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="skolem">args</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_invD<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="skolem">args</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="skolem">args</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="skolem">args</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_invD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="main">(</span>Suc <span class="free">d</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="skolem">args</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_invI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d0</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d0</span> <span class="main">&lt;</span> Suc <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d0</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> inv1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="skolem">args</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d0</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">shift2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list <span class="main">⇒</span>
                      <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">,</span>ring_no_zero_divisors<span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">shift2</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span>
      <span class="keyword1">else</span> <span class="free">shift2</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">qs</span></span></span><span class="main">,</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">qs</span></span></span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">(</span>measure <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span> <span class="bound">d</span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">.</span> <span class="bound">c</span> <span class="main">-</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> wf_measure<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> shift2_1<span class="main">:</span> <span class="quoted"><span class="quoted">"shift2_inv <span class="free">d</span> <span class="free">qs</span> <span class="main">⟹</span> shift2_inv <span class="free">c</span> <span class="main">(</span>shift2 <span class="free">c</span> <span class="free">d</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">qs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> shift2.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> IH<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">qs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> shift2.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> shift2.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="skolem">c</span> <span class="skolem">qs</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_invI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="skolem">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="skolem">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="skolem">qs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_invD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d0</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d0</span> <span class="main">&lt;</span> <span class="skolem">c</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d0</span> <span class="main">&lt;</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≤</span> <span class="skolem">d</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> less_le_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="skolem">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d0</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_invD<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">c</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="skolem">c</span> <span class="main">(</span>shift2 <span class="skolem">c</span> <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="skolem">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="skolem">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_inv_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shift2_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"shift2_inv <span class="free">d</span> <span class="free">qs</span> <span class="main">⟹</span>
    card <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="main">(</span>shift2 <span class="free">c</span> <span class="free">d</span> <span class="free">qs</span><span class="main">)</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span> <span class="main">≤</span> card <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">qs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> shift2.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> IH<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">qs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="main">(</span>shift2 <span class="skolem">c</span> <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="skolem">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> shift2.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> shift2.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">c</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?A</span> <span class="main">≤</span> card <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="skolem">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="skolem">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_inv_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> card <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="skolem">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> refl IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> shift1_2 shift1_invI<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?A</span> <span class="main">≤</span> card <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="skolem">qs</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shift2_3<span class="main">:</span> <span class="quoted"><span class="quoted">"shift2_inv <span class="free">d</span> <span class="free">qs</span> <span class="main">⟹</span> cone_decomp <span class="free">T</span> <span class="free">qs</span> <span class="main">⟹</span> cone_decomp <span class="free">T</span> <span class="main">(</span>shift2 <span class="free">c</span> <span class="free">d</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">qs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> shift2.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> IH<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">qs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> inv2<span class="main">:</span> <span class="quoted"><span class="quoted">"shift2_inv <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="skolem">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_inv_preserved<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> shift2.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IH.prems <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> shift2.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">c</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> inv2
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="skolem">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_3<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> refl IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"shift1_inv <span class="skolem">d</span> <span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="skolem">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_invI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IH.prems<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="main">(</span>shift2 <span class="skolem">c</span> <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="skolem">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shift2_4<span class="main">:</span>
  <span class="quoted"><span class="quoted">"shift2_inv <span class="free">d</span> <span class="free">qs</span> <span class="main">⟹</span> Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="free">qs</span><span class="main">)</span> <span class="main">≤</span> Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span>shift2 <span class="free">c</span> <span class="free">d</span> <span class="free">qs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">qs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> shift2.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> IH<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">qs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?args</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="skolem">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> shift2.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> shift2.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">c</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span>fst <span class="var">?args</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="var">?args</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> refl IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> shift1_4 shift1_invI<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">c</span> <span class="main">≤</span> <span class="skolem">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span>shift2 <span class="skolem">c</span> <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="var">?args</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="var">?args</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_inv_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="skolem">qs</span><span class="main">)</span> <span class="main">≤</span> Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span>shift2 <span class="skolem">c</span> <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="var">?args</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shift2_5<span class="main">:</span>
  <span class="quoted"><span class="quoted">"shift2_inv <span class="free">d</span> <span class="free">qs</span> <span class="main">⟹</span> shift2 <span class="free">c</span> <span class="free">d</span> <span class="free">qs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="free">qs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">qs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> shift2.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> IH<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">qs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?args</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="skolem">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> shift2.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> shift2.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">c</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"shift2 <span class="skolem">c</span> <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="var">?args</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> fst <span class="main">(</span>shift1 <span class="var">?args</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="var">?args</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_inv_preserved<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> refl IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> fst <span class="var">?args</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> shift1_5 shift1_invI<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"shift2 <span class="skolem">c</span> <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="var">?args</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="skolem">qs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shift2_6<span class="main">:</span>
  <span class="quoted"><span class="quoted">"shift2_inv <span class="free">d</span> <span class="free">qs</span> <span class="main">⟹</span> monomial_decomp <span class="free">qs</span> <span class="main">⟹</span> monomial_decomp <span class="main">(</span>shift2 <span class="free">c</span> <span class="free">d</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">qs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> shift2.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> IH<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">qs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?args</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="skolem">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> shift2.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> shift2.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI IH<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="var">?args</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_inv_preserved<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> refl IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shift1_inv <span class="skolem">d</span> <span class="var">?args</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_invI<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> IH<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span>fst <span class="var">?args</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="var">?args</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_6<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shift2_7<span class="main">:</span>
  <span class="quoted"><span class="quoted">"shift2_inv <span class="free">d</span> <span class="free">qs</span> <span class="main">⟹</span> hom_decomp <span class="free">qs</span> <span class="main">⟹</span> hom_decomp <span class="main">(</span>shift2 <span class="free">c</span> <span class="free">d</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">qs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> shift2.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> IH<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">qs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?args</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">qs</span><span class="main">,</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="skolem">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> shift2.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> shift2.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI IH<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="var">?args</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_inv_preserved<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> refl IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shift1_inv <span class="skolem">d</span> <span class="var">?args</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_invI<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> IH<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="main">(</span>fst <span class="var">?args</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="main">(</span>fst <span class="main">(</span>shift1 <span class="var">?args</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift1_7<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">shift</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list <span class="main">⇒</span>
                        <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">,</span>ring_no_zero_divisors<span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">shift</span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span> <span class="main">=</span> shift2 <span class="main">(</span><span class="free">k</span> <span class="main">+</span> card <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">qs</span></span></span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="free">k</span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shift2_inv_init<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="free">k</span> <span class="free">qs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_invI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d0</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d0</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d0</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="free">qs</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span>fst <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="skolem">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> card <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d0</span> <span class="main">&lt;</span> <span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> set <span class="free">qs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">qs</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q pos_decomp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> poly_deg <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompD<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹poly_deg <span class="skolem">h</span> <span class="main">&lt;</span> <span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d0</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> card.empty<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shift<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="free">m</span> <span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> card <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_inv_init<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> inv2<span class="main">:</span> <span class="quoted"><span class="quoted">"shift2_inv <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">A</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> shift_def c_def A_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> shift2_2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> inv2 <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> std<span class="main">:</span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> exct<span class="main">:</span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_invD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A_def<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="free">m</span> <span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decompI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> exct <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decompD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h1</span> <span class="skolem">h2</span> <span class="skolem">U1</span> <span class="skolem">U2</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h1</span><span class="main">,</span> <span class="skolem">U1</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h2</span><span class="main">,</span> <span class="skolem">U2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h1</span> <span class="main">=</span> poly_deg <span class="skolem">h2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> card <span class="skolem">U1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> card <span class="skolem">U2</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> 5 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U2</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h2</span><span class="main">,</span> <span class="skolem">U2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> poly_deg <span class="skolem">h2</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="free">k</span> <span class="main">≤</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">∧</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">≤</span> poly_deg <span class="skolem">h2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>poly_deg <span class="skolem">h2</span><span class="main">)</span> <span class="main">-</span> <span class="free">k</span> <span class="main">≤</span> card <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">d0</span><span class="main">∈</span><span class="main">{</span><span class="free">k</span><span class="main">..</span>poly_deg <span class="skolem">h2</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">d0</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">d0</span><span class="main">=</span><span class="free">k</span><span class="main">..</span>poly_deg <span class="skolem">h2</span><span class="main">.</span> card <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">d0</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> card_UN_disjoint ballI impI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d0</span>
        <span class="keyword1"><span class="command">from</span></span> _ <span class="quoted"><span class="quoted">‹finite <span class="skolem">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d0</span> <span class="skolem">d1</span> <span class="main">::</span> <span class="quoted">nat</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d0</span> <span class="main">≠</span> <span class="skolem">d1</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d0</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> finite_atLeastAtMost<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≥</span> <span class="main">(</span><span class="main">∑</span><span class="bound">d0</span><span class="main">=</span><span class="free">k</span><span class="main">..</span>poly_deg <span class="skolem">h2</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_mono<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d0</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d0</span> <span class="main">∈</span> <span class="main">{</span><span class="free">k</span><span class="main">..</span>poly_deg <span class="skolem">h2</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="skolem">d0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d0</span> <span class="main">≤</span> poly_deg <span class="skolem">h2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">with</span></span> std <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h2</span><span class="main">,</span> <span class="skolem">U2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="skolem"><span class="skolem">U'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="skolem">d0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U2</span> <span class="main">≤</span> card <span class="skolem">U'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_decompE<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> 5 this<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> card <span class="skolem">U'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> less_le_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h'</span><span class="main">,</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d0</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_def <span class="quoted"><span class="quoted">‹poly_deg <span class="skolem">h'</span> <span class="main">=</span> <span class="skolem">d0</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d0</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> _ <span class="quoted"><span class="quoted">‹finite <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d0</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> card <span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> poly_deg <span class="main">(</span>fst <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d0</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_gt_0_iff Suc_le_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">d0</span><span class="main">=</span><span class="free">k</span><span class="main">..</span>poly_deg <span class="skolem">h2</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>poly_deg <span class="skolem">h2</span><span class="main">)</span> <span class="main">-</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">A</span>›</span></span> _ <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> card <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h2</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">+</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> inv2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?C</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_invD<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹card <span class="var">?C</span> <span class="main">≤</span> <span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 1 3 4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h1</span><span class="main">,</span> <span class="skolem">U1</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 2 5 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h2</span><span class="main">,</span> <span class="skolem">U2</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h1</span><span class="main">,</span> <span class="skolem">U1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h2</span><span class="main">,</span> <span class="skolem">U2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_le_Suc0_iff_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> monomial_decomp_shift<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="free">qs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_inv_init<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> shift_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_6<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_decomp_shift<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="free">qs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_inv_init<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> shift_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_7<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cone_decomp_shift<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="free">qs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_inv_init<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> shift_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Max_shift_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="free">qs</span><span class="main">)</span> <span class="main">≤</span> Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span>shift <span class="free">qs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_inv_init<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> shift_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_4<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shift_Nil_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"shift <span class="free">qs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="free">qs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shift2_inv <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_inv_init<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> shift_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift2_5<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">exact_aux</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list <span class="main">⇒</span>
                      <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">,</span>ring_no_zero_divisors<span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">exact_aux</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">exact_aux</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span> <span class="main">=</span> <span class="free">exact_aux</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>shift <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> exact_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="free">m</span> <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span>exact_aux <span class="free">k</span> <span class="free">m</span> <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="main">(</span>exact_aux <span class="free">k</span> <span class="free">m</span> <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">0</span> <span class="main">(</span>exact_aux <span class="free">k</span> <span class="free">m</span> <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis3</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis1</span> <span class="main">∧</span> <span class="var">?thesis2</span> <span class="main">∧</span> <span class="var">?thesis3</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">qs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"shift <span class="free">k</span> <span class="skolem">m</span> <span class="skolem">qs</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span>exact_aux <span class="free">k</span> <span class="skolem">m</span> <span class="var">?qs</span><span class="main">)</span> <span class="main">∧</span> standard_decomp <span class="free">k</span> <span class="main">(</span>exact_aux <span class="free">k</span> <span class="skolem">m</span> <span class="var">?qs</span><span class="main">)</span> <span class="main">∧</span>
          exact_decomp <span class="main">0</span> <span class="main">(</span>exact_aux <span class="free">k</span> <span class="skolem">m</span> <span class="var">?qs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Suc<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Suc.prems <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="var">?qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="var">?qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="skolem">m</span> <span class="var">?qs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis3</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> monomial_decomp_exact_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="free">m</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span>exact_aux <span class="free">k</span> <span class="free">m</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">qs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"shift <span class="free">k</span> <span class="skolem">m</span> <span class="skolem">qs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span>exact_aux <span class="free">k</span> <span class="skolem">m</span> <span class="var">?qs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Suc<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="var">?qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="var">?qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="skolem">m</span> <span class="var">?qs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> Suc.prems <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="var">?qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decomp_shift<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_decomp_exact_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="free">m</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="main">(</span>exact_aux <span class="free">k</span> <span class="free">m</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">qs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"shift <span class="free">k</span> <span class="skolem">m</span> <span class="skolem">qs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="main">(</span>exact_aux <span class="free">k</span> <span class="skolem">m</span> <span class="var">?qs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Suc<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="var">?qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="var">?qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="skolem">m</span> <span class="var">?qs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> Suc.prems <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="var">?qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_decomp_shift<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cone_decomp_exact_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="free">m</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="main">(</span>exact_aux <span class="free">k</span> <span class="free">m</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">qs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"shift <span class="free">k</span> <span class="skolem">m</span> <span class="skolem">qs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="main">(</span>exact_aux <span class="free">k</span> <span class="skolem">m</span> <span class="var">?qs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Suc<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="var">?qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="var">?qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="skolem">m</span> <span class="var">?qs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> Suc.prems <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="var">?qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decomp_shift<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Max_exact_aux_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="free">m</span> <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="free">qs</span><span class="main">)</span> <span class="main">≤</span> Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span>exact_aux <span class="free">k</span> <span class="free">m</span> <span class="free">qs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">qs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"shift <span class="free">k</span> <span class="skolem">m</span> <span class="skolem">qs</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> Suc.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="skolem">qs</span><span class="main">)</span> <span class="main">≤</span> Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="var">?qs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Max_shift_ge<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span>exact_aux <span class="free">k</span> <span class="skolem">m</span> <span class="var">?qs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Suc.prems <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="var">?qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="var">?qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="skolem">m</span> <span class="var">?qs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> exact_aux_Nil_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="free">m</span> <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exact_aux <span class="free">k</span> <span class="free">m</span> <span class="free">qs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="free">qs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">qs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"shift <span class="free">k</span> <span class="skolem">m</span> <span class="skolem">qs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exact_aux <span class="free">k</span> <span class="skolem">m</span> <span class="var">?qs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="var">?qs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Suc.prems <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="var">?qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="var">?qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="skolem">m</span> <span class="var">?qs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> Suc.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="skolem">qs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shift_Nil_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">exact</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list <span class="main">⇒</span>
                        <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">,</span>ring_no_zero_divisors<span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">exact</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span> <span class="main">=</span> exact_aux <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>card <span class="free">X</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> exact<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span>exact <span class="free">k</span> <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="main">(</span>exact <span class="free">k</span> <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">0</span> <span class="main">(</span>exact <span class="free">k</span> <span class="free">qs</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis3</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> le_refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">(</span>card <span class="free">X</span><span class="main">)</span> <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decomp_card_X<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis3</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> exact_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_aux<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> monomial_decomp_exact<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="main">(</span>exact <span class="free">k</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> le_refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">(</span>card <span class="free">X</span><span class="main">)</span> <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decomp_card_X<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> exact_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decomp_exact_aux<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_decomp_exact<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="main">(</span>exact <span class="free">k</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> le_refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">(</span>card <span class="free">X</span><span class="main">)</span> <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decomp_card_X<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> exact_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_decomp_exact_aux<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cone_decomp_exact<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="main">(</span>exact <span class="free">k</span> <span class="free">qs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> le_refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">(</span>card <span class="free">X</span><span class="main">)</span> <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decomp_card_X<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> exact_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decomp_exact_aux<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Max_exact_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="free">qs</span><span class="main">)</span> <span class="main">≤</span> Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span>exact <span class="free">k</span> <span class="free">qs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> le_refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">(</span>card <span class="free">X</span><span class="main">)</span> <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decomp_card_X<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> exact_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Max_exact_aux_ge<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> exact_Nil_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exact <span class="free">k</span> <span class="free">qs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="free">qs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> le_refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">(</span>card <span class="free">X</span><span class="main">)</span> <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decomp_card_X<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> exact_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_aux_Nil_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> 𝖻_zero_exact<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">qs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="free">qs</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> 𝖻 <span class="main">(</span>exact <span class="free">k</span> <span class="free">qs</span><span class="main">)</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="free">qs</span><span class="main">)</span> <span class="main">≤</span> Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="main">(</span>exact <span class="free">k</span> <span class="free">qs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Max_exact_ge<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">…</span> <span class="main">≤</span> 𝖻 <span class="main">(</span>exact <span class="free">k</span> <span class="free">qs</span><span class="main">)</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"exact <span class="free">k</span> <span class="free">qs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exact_Nil_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> normal_form_exact_decompE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">qs</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">0</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="free">qs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">0</span> <span class="free">qs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> homogeneous <span class="bound">f</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">g</span> <span class="main">∈</span> punit.reduced_GB <span class="free">F</span> <span class="main">⟹</span> poly_deg <span class="bound">g</span> <span class="main">≤</span> 𝖻 <span class="free">qs</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.reduced_GB <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lpp <span class="main">`</span> <span class="var">?G</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?N</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qs</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="main">_</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> snd <span class="main">(</span>split <span class="main">0</span> <span class="free">X</span> <span class="var">?S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> fin_X assms <span class="keyword1"><span class="command">have</span></span> std<span class="main">:</span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">0</span> <span class="skolem">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cn<span class="main">:</span> <span class="quoted"><span class="quoted">"cone_decomp <span class="var">?N</span> <span class="skolem">qs</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> qs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_cone_decomp_snd_split<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> fin_X assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_reduced_GB_Polys<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> fin_X subset_refl <span class="keyword1"><span class="command">have</span></span> valid<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> qs_def <span class="keyword1"><span class="command">using</span></span> zero_in_PPs
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decomp_split<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> fin_X subset_refl <span class="quoted"><span class="quoted">‹finite <span class="var">?S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> md<span class="main">:</span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="skolem">qs</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> qs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decomp_split<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"exact <span class="main">0</span> <span class="skolem">qs</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> valid std <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="var">?qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">0</span> <span class="var">?qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> valid std md <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="var">?qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decomp_exact<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> valid std cn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="var">?N</span> <span class="var">?qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decomp_exact<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> valid std <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="main">0</span> <span class="var">?qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">g</span> <span class="main">≤</span> 𝖻 <span class="var">?qs</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> homogeneous <span class="bound">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="var">?G</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> one_in_Polys <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normal_form <span class="free">F</span> <span class="main">1</span> <span class="main">∈</span> <span class="var">?N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> True cn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cone_decomp_def direct_decomp_def bij_betw_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_X assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normal_form_zero_iff ideal_eq_UNIV_iff_reduced_GB_eq_one_Polys
                <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> ideal_eq_UNIV_iff_contains_one<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> fin_X assms that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">g</span> <span class="main">≤</span> Suc <span class="main">(</span>Max <span class="main">(</span>poly_deg <span class="main">`</span> fst <span class="main">`</span> set <span class="skolem">qs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> qs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> standard_cone_decomp_snd_split<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> valid std False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> 𝖻 <span class="var">?qs</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻_zero_exact<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* pm_powerprod *)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* theory *)</span>
</pre>
</div><div id="Dube_Bound">
<div class="head">
<h1>Theory Dube_Bound</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Alexander Maletzky *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Dub\'{e}'s Degree-Bound for Homogeneous Gr\"obner Bases›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Dube_Bound
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Poly_Fun.html">Poly_Fun</a> <a href="Cone_Decomposition.html">Cone_Decomposition</a> <a href="Degree_Bound_Utils.html">Degree_Bound_Utils</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="free">d</span> <span class="main">::</span> <span class="quoted">nat</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">Dube_aux</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Dube_aux</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">then</span>
                  <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">Dube_aux</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">+</span><span class="numeral">3</span><span class="main">..</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="free">Dube_aux</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>Suc <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">d</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="keyword1">else</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">(</span>measure <span class="main">(</span><span class="main">(-)</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> wf_measure<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Dube</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Dube</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">d</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">d</span> <span class="keyword1">else</span> Dube_aux <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Dube_aux_ge_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> Dube_aux <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">j</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Dube_aux.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">j</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∨</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> linorder_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> Dube_aux <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> step.hyps<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> Dube_aux <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">&lt;</span> Dube_aux <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> less_le_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> _ <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dube_aux <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> Dube_aux <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> upper_le_binomial<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> Dube_aux <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dube_aux <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> Dube_aux <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Dube_ge_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> Dube"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dube_def Dube_aux_ge_d <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Dube_aux.simps<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Dub\'{e} in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> Dube1990<span class="antiquote"><span class="antiquote">}</span></span></span></span> proves the following theorem, to obtain a short closed form for
  the degree bound. However, the proof he gives is wrong: In the last-but-one proof step of Lemma 8.1
  the sum on the right-hand-side of the inequality can be greater than 1/2 (e.g. for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span> <span class="main"><span class="main">=</span></span> <span class="numeral"><span class="numeral">7</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">d</span></span> <span class="main"><span class="main">=</span></span> <span class="numeral"><span class="numeral">2</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">j</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">1</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>), rendering the value inside the big brackets negative. This is
  also true without the additional summand <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>2›</span></span></span></span> we had to introduce in function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Dube_aux<span class="antiquote"><span class="antiquote">}</span></span></span></span> to
  correct another mistake found in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> Dube1990<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  Nonetheless, experiments carried out in Mathematica still suggest that the short closed form is a
  valid upper bound for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Dube<span class="antiquote"><span class="antiquote">}</span></span></span></span>, even with the additional summand <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>2›</span></span></span></span>. So, with some effort it
  might be possible to prove the theorem below; but in fact function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Dube<span class="antiquote"><span class="antiquote">}</span></span></span></span> gives typically
  much better (i.e. smaller) values for concrete values of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>d›</span></span></span></span>, so it is better to stick to
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Dube<span class="antiquote"><span class="antiquote">}</span></span></span></span> instead of the closed form anyway. Asymptotically, as <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> tends to infinity,
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Dube<span class="antiquote"><span class="antiquote">}</span></span></span></span> grows double exponentially, too.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="quoted"><span class="quoted">"rat_of_nat Dube <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>rat_of_nat <span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>rat_of_nat <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Hilbert Function and Hilbert Polynomial›</span></span>

<span class="keyword1"><span class="command">context</span></span> pm_powerprod
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin_X<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Hilbert_fun_cone_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> card <span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span><span class="main">.</span> deg_pm <span class="bound">t</span> <span class="main">+</span> poly_deg <span class="free">h</span> <span class="main">=</span> <span class="free">z</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lpp <span class="free">h</span> <span class="main">∈</span> keys <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_in_keys<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> deg_h<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"deg_pm <span class="main">(</span>lpp <span class="free">h</span><span class="main">)</span> <span class="main">=</span> poly_deg <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> homogeneousD_poly_deg<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_subset_PolysI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> fin_X <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> card <span class="main">(</span>lpp <span class="main">`</span> <span class="main">(</span>hom_deg_set <span class="free">z</span> <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subspace_cone<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Hilbert_fun_alt<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lpp <span class="main">`</span> <span class="main">(</span>hom_deg_set <span class="free">z</span> <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span>
                            <span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> lpp <span class="main">`</span> <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> deg_pm <span class="bound">t</span> <span class="main">=</span> <span class="free">z</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> image_lt_hom_deg_set homogeneous_set_coneI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> lpp <span class="main">`</span> <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> deg_pm <span class="bound">t</span> <span class="main">=</span> <span class="free">z</span><span class="main">}</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">+</span> lpp <span class="free">h</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span><span class="main">.</span> deg_pm <span class="bound">t</span> <span class="main">+</span> poly_deg <span class="free">h</span> <span class="main">=</span> <span class="free">z</span><span class="main">}</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⊆</span> <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> lpp <span class="main">`</span> <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> lpp <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> lpp <span class="skolem">q</span> <span class="main">+</span> lpp <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> 2 a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lp_times<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="main">(</span>lpp <span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> poly_deg <span class="free">h</span> <span class="main">=</span> deg_pm <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_pm_plus deg_h<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="main">(</span>lpp <span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> poly_deg <span class="free">h</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">q</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_lpp<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">q</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span><span class="main">.</span> deg_pm <span class="bound">t</span> <span class="main">+</span> poly_deg <span class="free">h</span> <span class="main">=</span> <span class="free">z</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> lpp <span class="skolem">q</span> <span class="main">+</span> lpp <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> t<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_image_eqI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊆</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span><span class="main">.</span> deg_pm <span class="bound">t</span> <span class="main">+</span> poly_deg <span class="free">h</span> <span class="main">=</span> <span class="free">z</span><span class="main">}</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> t1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">+</span> lpp <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">s</span> <span class="main">+</span> poly_deg <span class="free">h</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monomial_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">*</span> <span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lpp <span class="main">(</span><span class="var">?q</span> <span class="main">*</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> lpp <span class="var">?q</span> <span class="main">+</span> lpp <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> times_not_zero<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> lp_times<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> lpp <span class="main">(</span><span class="var">?q</span> <span class="main">*</span> <span class="free">h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t1 punit.lt_monomial<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_monomial<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">*</span> <span class="free">h</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneI<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> _ assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">*</span> <span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> times_not_zero<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monomial_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">*</span> <span class="free">h</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> lpp <span class="main">`</span> <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deg_pm <span class="skolem">t</span> <span class="main">=</span> int <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t1<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_pm_plus deg_h <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> 1<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">…</span> <span class="main">=</span> card <span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span><span class="main">.</span> deg_pm <span class="bound">t</span> <span class="main">+</span> poly_deg <span class="free">h</span> <span class="main">=</span> <span class="free">z</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_image<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Hilbert_fun_cone_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> poly_deg <span class="free">h</span> <span class="main">=</span> <span class="free">z</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> card <span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{}</span><span class="main">::</span><span class="tfree">'x</span> set<span class="main">]</span><span class="main">.</span> deg_pm <span class="bound">t</span> <span class="main">+</span> poly_deg <span class="free">h</span> <span class="main">=</span> <span class="free">z</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> empty_subsetI assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hilbert_fun_cone_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> poly_deg <span class="free">h</span> <span class="main">=</span> <span class="free">z</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Hilbert_fun_cone_nonempty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span>
          <span class="main">(</span><span class="keyword1">if</span> poly_deg <span class="free">h</span> <span class="main">≤</span> <span class="free">z</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">(</span><span class="free">z</span> <span class="main">-</span> poly_deg <span class="free">h</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>card <span class="free">U</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>card <span class="free">U</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">h</span> <span class="main">≤</span> <span class="free">z</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> fin_X <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1-4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> card <span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span><span class="main">.</span> deg_pm <span class="bound">t</span> <span class="main">+</span> poly_deg <span class="free">h</span> <span class="main">=</span> <span class="free">z</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hilbert_fun_cone_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span><span class="main">.</span> deg_pm <span class="bound">t</span> <span class="main">+</span> poly_deg <span class="free">h</span> <span class="main">=</span> <span class="free">z</span><span class="main">}</span> <span class="main">=</span> deg_sect <span class="free">U</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> poly_deg <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deg_sect_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">U</span>›</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> poly_deg <span class="free">h</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>card <span class="free">U</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>card <span class="free">U</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_deg_sect<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1-4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="main">(</span>cone <span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> card <span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span><span class="main">.</span> deg_pm <span class="bound">t</span> <span class="main">+</span> poly_deg <span class="free">h</span> <span class="main">=</span> <span class="free">z</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hilbert_fun_cone_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span><span class="main">.</span> deg_pm <span class="bound">t</span> <span class="main">+</span> poly_deg <span class="free">h</span> <span class="main">=</span> <span class="free">z</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> <span class="main">.[</span><span class="free">U</span><span class="main">]</span><span class="main">.</span> deg_pm <span class="bound">t</span> <span class="main">+</span> poly_deg <span class="free">h</span> <span class="main">=</span> <span class="free">z</span><span class="main">}</span> <span class="main">=</span> card <span class="main">(</span><span class="main">{}</span><span class="main">::</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Hilbert_fun_Polys<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="main">(</span><span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> set<span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?one</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="main">(</span><span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span> <span class="free">z</span> <span class="main">=</span> Hilbert_fun <span class="main">(</span>cone <span class="main">(</span><span class="var">?one</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> poly_deg <span class="var">?one</span> <span class="main">≤</span> <span class="free">z</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">(</span><span class="free">z</span> <span class="main">-</span> poly_deg <span class="var">?one</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_in_Polys _ subset_refl _ assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hilbert_fun_cone_nonempty<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Hilbert_fun_cone_decomp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="free">T</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">hU</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> Hilbert_fun <span class="main">(</span>cone <span class="bound">hU</span><span class="main">)</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> fin_X
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span> 1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_cone_decomp_subset_Polys<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> dd<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="free">T</span> <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decompD<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="free">T</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">s</span><span class="main">∈</span>set <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span><span class="main">.</span> Hilbert_fun <span class="bound">s</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Hilbert_fun_direct_decomp<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">cn</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cn</span> <span class="main">∈</span> set <span class="main">(</span>map cone <span class="free">ps</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">hU</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hU</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cn</span> <span class="main">=</span> cone <span class="skolem">hU</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_map <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> hU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hU</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_decompD<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"homogeneous_set <span class="skolem">cn</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cn hU <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> homogeneous_set_coneI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"phull.subspace <span class="skolem">cn</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> subspace_cone<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">hU</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> Hilbert_fun <span class="bound">s</span> <span class="free">z</span><span class="main">)</span> <span class="main">∘</span> cone<span class="main">)</span> <span class="bound">hU</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_map <span class="keyword1"><span class="command">using</span></span> finite_set
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_nontrivial<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">hU1</span> <span class="skolem">hU2</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hU1</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hU2</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hU1</span> <span class="main">≠</span> <span class="skolem">hU2</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> dd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone <span class="skolem">hU1</span> <span class="main">∩</span> cone <span class="skolem">hU2</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_in_cone <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_map_Int_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"cone <span class="skolem">hU1</span> <span class="main">=</span> cone <span class="skolem">hU2</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="main">(</span>cone <span class="skolem">hU1</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Hilbert_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> int <span class="main">⇒</span> int"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Hilbert_poly</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span>
                <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>int<span class="main">.</span> <span class="keyword1">let</span> <span class="bound">n</span> <span class="main">=</span> card <span class="free">X</span> <span class="keyword1">in</span>
                  <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="bound">z</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">i</span> <span class="main">+</span> <span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_fun_Hilbert_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_fun <span class="main">(</span>Hilbert_poly <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hilbert_poly_def Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Hilbert_fun_eq_Hilbert_poly_plus_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="free">ps</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="free">X</span> <span class="main">0</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>Hilbert_fun <span class="free">T</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">h</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>field<span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">∧</span> poly_deg <span class="bound">h</span> <span class="main">=</span> <span class="free">d</span><span class="main">}</span> <span class="main">+</span> Hilbert_poly <span class="main">(</span>𝖻 <span class="free">ps</span><span class="main">)</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> card <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_gt_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> pos_decomp_subset <span class="keyword1"><span class="command">have</span></span> eq0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="free">ps</span> <span class="main">-</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">=</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ps</span> <span class="main">-</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> fin2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>set <span class="free">ps</span> <span class="main">-</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_set <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">hU</span><span class="main">∈</span>set <span class="free">ps</span> <span class="main">-</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> Hilbert_fun <span class="main">(</span>cone <span class="bound">hU</span><span class="main">)</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">∈</span>set <span class="free">ps</span> <span class="main">-</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> poly_deg <span class="bound">h</span> <span class="main">=</span> <span class="free">d</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> refl
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">-</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_decompD<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="main">(</span>cone <span class="skolem">x</span><span class="main">)</span> <span class="free">d</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">⇒</span> <span class="keyword1">if</span> poly_deg <span class="bound">h</span> <span class="main">=</span> <span class="free">d</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> Hilbert_fun_cone_empty <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> fin2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">h'</span></span><span class="main">,</span> <span class="bound"><span class="bound">U'</span></span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">-</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> <span class="free">d</span><span class="main">}</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.mono_neutral_cong_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">h</span></span><span class="main">,</span> <span class="bound"><span class="bound">U</span></span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">-</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> poly_deg <span class="bound">h</span> <span class="main">=</span> <span class="free">d</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">h</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">∧</span> poly_deg <span class="bound">h</span> <span class="main">=</span> <span class="free">d</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> card_Diff_pos_decomp<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">hU</span><span class="main">∈</span>set <span class="free">ps</span> <span class="main">-</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> Hilbert_fun <span class="main">(</span>cone <span class="bound">hU</span><span class="main">)</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span>
                      card <span class="main">{</span><span class="bound">h</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">∧</span> poly_deg <span class="bound">h</span> <span class="main">=</span> <span class="free">d</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span>int <span class="free">d</span><span class="main">)</span> <span class="main">-</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span> <span class="keyword1">gchoose</span> <span class="bound">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="main">∑</span><span class="bound">hU</span><span class="main">∈</span>set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> Hilbert_fun <span class="main">(</span>cone <span class="bound">hU</span><span class="main">)</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">hU</span><span class="main">∈</span>set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> int <span class="main">(</span>Hilbert_fun <span class="main">(</span>cone <span class="bound">hU</span><span class="main">)</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_sum prod.case_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">h</span></span><span class="main">,</span> <span class="bound"><span class="bound">U</span></span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> card <span class="bound">U</span> <span class="main">=</span> <span class="bound">i</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span>poly_deg <span class="bound">h</span><span class="main">)</span> <span class="main">(</span>card <span class="bound">U</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> card <span class="bound">U</span> <span class="main">=</span> <span class="bound">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Set.set_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> fin_X assms<span class="main">(</span>6<span class="main">)</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact_decompD<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> card <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_gt_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> fin_X <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> card <span class="bound">U'</span> <span class="main">=</span> card <span class="skolem">U</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> card <span class="bound">U</span> <span class="main">=</span> <span class="bound">i</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> card <span class="bound">U</span> <span class="main">=</span> <span class="bound">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> card <span class="bound">U</span> <span class="main">=</span> <span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> fin_X assms<span class="main">(</span>2<span class="main">,</span> 5<span class="main">)</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻_one_gr<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> int1<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="free">d</span> <span class="main">-</span> poly_deg <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> int <span class="free">d</span> <span class="main">-</span> int <span class="main">(</span>poly_deg <span class="skolem">h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">U</span> <span class="main">=</span> <span class="skolem">j</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> card <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> int2<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>card <span class="skolem">U</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span>card <span class="skolem">U</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pos_decomp_subset <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_decompD<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> card <span class="skolem">U</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="main">(</span>cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="free">d</span> <span class="main">=</span>
                <span class="main">(</span><span class="keyword1">if</span> poly_deg <span class="skolem">h</span> <span class="main">≤</span> <span class="free">d</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> poly_deg <span class="skolem">h</span> <span class="main">+</span> <span class="main">(</span>card <span class="skolem">U</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>card <span class="skolem">U</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hilbert_fun_cone_nonempty<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹poly_deg <span class="skolem">h</span> <span class="main">&lt;</span> <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> poly_deg <span class="skolem">h</span> <span class="main">+</span> <span class="main">(</span>card <span class="skolem">U</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>card <span class="skolem">U</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>Hilbert_fun <span class="main">(</span>cone <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>int <span class="free">d</span> <span class="main">-</span> int <span class="main">(</span>poly_deg <span class="skolem">h</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>card <span class="skolem">U</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>card <span class="skolem">U</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_binomial int1 int2<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>Hilbert_fun <span class="main">(</span>cone <span class="skolem">x</span><span class="main">)</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">⇒</span> int <span class="free">d</span> <span class="main">-</span> int <span class="main">(</span>poly_deg <span class="bound">h</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>card <span class="bound">U</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>card <span class="bound">U</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">h'</span></span><span class="main">,</span> <span class="bound"><span class="bound">U'</span></span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> card <span class="bound">U'</span> <span class="main">=</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span>poly_deg <span class="bound">h</span><span class="main">)</span> <span class="main">(</span>card <span class="bound">U</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.UNION_disjoint ballI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> card <span class="bound">U</span> <span class="main">=</span> <span class="skolem">j</span><span class="main">}</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> card <span class="bound">U</span> <span class="main">=</span> <span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_set <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="bound">j</span> <span class="main">-</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="bound">j</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> fin_X this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="skolem">j</span> <span class="main">≤</span> 𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻_decreasing<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> fin_X <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> 𝖻 <span class="free">ps</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻_decreasing<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹𝖻 <span class="free">ps</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> int_j<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> int <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> card <span class="bound">U'</span> <span class="main">=</span> <span class="skolem">j</span><span class="main">}</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span>poly_deg <span class="bound">h</span><span class="main">)</span> <span class="main">(</span>card <span class="bound">U</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
         <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="main">⋃</span><span class="bound">d0</span><span class="main">∈</span><span class="main">{</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">..</span>int <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> int <span class="main">(</span>poly_deg <span class="bound">h'</span><span class="main">)</span> <span class="main">=</span> <span class="bound">d0</span> <span class="main">∧</span> card <span class="bound">U'</span> <span class="main">=</span> <span class="skolem">j</span><span class="main">}</span><span class="main">)</span><span class="main">.</span>
            <span class="var">?f</span> <span class="main">(</span>poly_deg <span class="bound">h</span><span class="main">)</span> <span class="main">(</span>card <span class="bound">U</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> _ refl
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> card <span class="bound">U'</span> <span class="main">=</span> <span class="skolem">j</span><span class="main">}</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">⋃</span><span class="bound">d0</span><span class="main">∈</span><span class="main">{</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">..</span>int <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> int <span class="main">(</span>poly_deg <span class="bound">h'</span><span class="main">)</span> <span class="main">=</span> <span class="bound">d0</span> <span class="main">∧</span> card <span class="bound">U'</span> <span class="main">=</span> <span class="skolem">j</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Set.set_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> card <span class="bound">U'</span> <span class="main">=</span> <span class="skolem">j</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">U</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">with</span></span> fin_X assms<span class="main">(</span>5<span class="main">,</span> 6<span class="main">)</span> <span class="quoted"><span class="quoted">‹Suc <span class="main">0</span> <span class="main">≤</span> <span class="skolem">j</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> poly_deg <span class="skolem">h</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lem_6_1_3<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> fin_X <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pos_decomp_subset <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> card <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">U</span> <span class="main">=</span> <span class="skolem">j</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">∈</span> <span class="main">{</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">..</span>int <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> poly_deg <span class="skolem">h</span> <span class="main">∧</span> card <span class="bound">U'</span> <span class="main">=</span> card <span class="skolem">U</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">d0</span><span class="main">∈</span><span class="main">{</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">..</span>int <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span>
                                <span class="main">{</span><span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> int <span class="main">(</span>poly_deg <span class="bound">h'</span><span class="main">)</span> <span class="main">=</span> <span class="bound">d0</span> <span class="main">∧</span> card <span class="bound">U'</span> <span class="main">=</span> <span class="skolem">j</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x <span class="quoted"><span class="quoted">‹card <span class="skolem">U</span> <span class="main">=</span> <span class="skolem">j</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">d0</span><span class="main">=</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">..</span>int <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">.</span>
                        <span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> <span class="bound">d0</span> <span class="main">∧</span> card <span class="bound">U'</span> <span class="main">=</span> <span class="skolem">j</span><span class="main">}</span><span class="main">.</span>
                            <span class="var">?f</span> <span class="main">(</span>poly_deg <span class="bound">h</span><span class="main">)</span> <span class="main">(</span>card <span class="bound">U</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.UNION_disjoint ballI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d0</span><span class="main">::</span><span class="quoted">int</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> <span class="skolem">d0</span> <span class="main">∧</span> card <span class="bound">U'</span> <span class="main">=</span> <span class="skolem">j</span><span class="main">}</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> <span class="skolem">d0</span> <span class="main">∧</span> card <span class="bound">U'</span> <span class="main">=</span> <span class="skolem">j</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> finite_set <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">d0</span><span class="main">=</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">..</span>int <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">d0</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d0</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d0</span> <span class="main">∈</span> <span class="main">{</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">..</span>int <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">d0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d0</span> <span class="main">&lt;</span> int <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> nat <span class="skolem">d0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nat <span class="skolem">d0</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> <span class="skolem">d0</span> <span class="main">∧</span> card <span class="bound">U'</span> <span class="main">=</span> <span class="skolem">j</span><span class="main">}</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span>poly_deg <span class="bound">h</span><span class="main">)</span> <span class="main">(</span>card <span class="bound">U</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> <span class="skolem">d0</span> <span class="main">∧</span> card <span class="bound">U'</span> <span class="main">=</span> <span class="skolem">j</span><span class="main">}</span><span class="main">.</span> <span class="var">?f</span> <span class="skolem">d0</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> refl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">{</span><span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> nat <span class="skolem">d0</span> <span class="main">∧</span> card <span class="bound">U'</span> <span class="main">=</span> <span class="skolem">j</span><span class="main">}</span> <span class="main">*</span> <span class="var">?f</span> <span class="skolem">d0</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">d0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_eq_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">d0</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> fin_X assms<span class="main">(</span>5<span class="main">,</span> 6<span class="main">)</span> <span class="quoted"><span class="quoted">‹Suc <span class="main">0</span> <span class="main">≤</span> <span class="skolem">j</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> nat <span class="skolem">d0</span>›</span></span> <span class="quoted"><span class="quoted">‹nat <span class="skolem">d0</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="skolem">j</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> n_def lem_6_1_2'<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> poly_deg <span class="bound">h'</span> <span class="main">=</span> <span class="skolem">d0</span> <span class="main">∧</span> card <span class="bound">U'</span> <span class="main">=</span> <span class="skolem">j</span><span class="main">}</span><span class="main">.</span>
                      <span class="var">?f</span> <span class="main">(</span>poly_deg <span class="bound">h</span><span class="main">)</span> <span class="main">(</span>card <span class="bound">U</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">d0</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">d0</span><span class="main">∈</span><span class="main">(-)</span> <span class="main">(</span>int <span class="free">d</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">..</span>int <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="bound">d0</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">(-)</span> <span class="main">(</span>int <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">..</span>int <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sum.reindex o_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">d0</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span>int <span class="free">d</span> <span class="main">-</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="main">0</span><span class="main">..</span>int <span class="free">d</span> <span class="main">-</span> 𝖻 <span class="free">ps</span> <span class="skolem">j</span><span class="main">}</span><span class="main">.</span> <span class="bound">d0</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> _ refl
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(-)</span> <span class="main">(</span>int <span class="free">d</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">..</span>int <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span>int <span class="free">d</span> <span class="main">-</span> <span class="main">(</span>int <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">..</span>int <span class="free">d</span> <span class="main">-</span> int <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> image_diff_atLeastAtMost<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>int <span class="free">d</span> <span class="main">-</span> int <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>int <span class="free">d</span> <span class="main">-</span> int <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="skolem">j</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹𝖻 <span class="free">ps</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> int <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(-)</span> <span class="main">(</span>int <span class="free">d</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">..</span>int <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span>
                    <span class="main">{</span><span class="main">0</span><span class="main">..</span>int <span class="free">d</span> <span class="main">-</span> int <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>int <span class="free">d</span> <span class="main">-</span> int <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="skolem">j</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">d0</span><span class="main">=</span><span class="main">0</span><span class="main">..</span>int <span class="free">d</span> <span class="main">-</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">d0</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                    <span class="main">(</span><span class="main">∑</span><span class="bound">d0</span><span class="main">=</span><span class="main">0</span><span class="main">..</span>int <span class="free">d</span> <span class="main">-</span> 𝖻 <span class="free">ps</span> <span class="skolem">j</span><span class="main">.</span> <span class="bound">d0</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_diff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> 𝖻 <span class="free">ps</span> <span class="skolem">j</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>›</span></span> <span class="quoted"><span class="quoted">‹𝖻 <span class="free">ps</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">-</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="skolem">j</span><span class="main">)</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gchoose_rising_sum<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_j <span class="dynamic"><span class="dynamic">ac_simps</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">U</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">h'</span><span class="main">,</span> <span class="bound">U'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span> <span class="main">∧</span> card <span class="bound">U'</span> <span class="main">=</span> <span class="skolem">j</span><span class="main">}</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span>poly_deg <span class="bound">h</span><span class="main">)</span> <span class="main">(</span>card <span class="bound">U</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                    <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">-</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="skolem">j</span><span class="main">)</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="bound">j</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> sum_subtractf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="bound">j</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sum_tail_nat<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">-</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">1</span><span class="main">)</span> <span class="main">1</span> <span class="main">+</span>
                  <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sum.atLeast_Suc_atMost<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span><span class="main"><span class="main">]</span></span> sum_atLeast_Suc_shift<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">-</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">1</span><span class="main">)</span> <span class="main">1</span> <span class="main">-</span>
                  <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span> <span class="main">-</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sum_subtractf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>int <span class="free">d</span> <span class="main">-</span> 𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                  <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span>int <span class="free">d</span> <span class="main">-</span> 𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">1</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>int <span class="free">d</span> <span class="main">-</span> 𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_Suc_gbinomial<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span> <span class="main">-</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span>
                              <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span>int <span class="free">d</span> <span class="main">-</span> 𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_Suc_gbinomial<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span>int <span class="free">d</span> <span class="main">-</span> 𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sum.atLeast_Suc_atMost<span class="main"><span class="main">[</span></span><span class="operator">OF</span> le0<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?f</span> <span class="main">(</span>𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span>Suc <span class="main">0</span><span class="main">..</span>Suc <span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>int <span class="free">d</span> <span class="main">-</span> 𝖻 <span class="free">ps</span> <span class="bound">j</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sum.shift_bounds_cl_Suc_ivl<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Hilbert_poly <span class="main">(</span>𝖻 <span class="free">ps</span><span class="main">)</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hilbert_poly_def Let_def n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="main">∑</span><span class="bound">hU</span><span class="main">∈</span>set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> Hilbert_fun <span class="main">(</span>cone <span class="bound">hU</span><span class="main">)</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> Hilbert_poly <span class="main">(</span>𝖻 <span class="free">ps</span><span class="main">)</span> <span class="main">(</span>int <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">,</span> 2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="free">T</span> <span class="free">d</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">hU</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> Hilbert_fun <span class="main">(</span>cone <span class="bound">hU</span><span class="main">)</span> <span class="free">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hilbert_fun_cone_decomp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">hU</span><span class="main">∈</span><span class="main">(</span>set <span class="free">ps</span> <span class="main">-</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> Hilbert_fun <span class="main">(</span>cone <span class="bound">hU</span><span class="main">)</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq0<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">hU</span><span class="main">∈</span>set <span class="free">ps</span> <span class="main">-</span> set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> Hilbert_fun <span class="main">(</span>cone <span class="bound">hU</span><span class="main">)</span> <span class="free">d</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">hU</span><span class="main">∈</span>set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> Hilbert_fun <span class="main">(</span>cone <span class="bound">hU</span><span class="main">)</span> <span class="free">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin2 finite_set <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">h</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">∧</span> poly_deg <span class="bound">h</span> <span class="main">=</span> <span class="free">d</span><span class="main">}</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">hU</span><span class="main">∈</span>set <span class="main">(</span><span class="free">ps</span><span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span><span class="main">.</span> Hilbert_fun <span class="main">(</span>cone <span class="bound">hU</span><span class="main">)</span> <span class="free">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">…</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">h</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">∧</span> poly_deg <span class="bound">h</span> <span class="main">=</span> <span class="free">d</span><span class="main">}</span> <span class="main">+</span> Hilbert_poly <span class="main">(</span>𝖻 <span class="free">ps</span><span class="main">)</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq2 int_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Hilbert_fun_eq_Hilbert_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="free">T</span> <span class="free">ps</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp <span class="free">k</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="free">X</span> <span class="main">0</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>Hilbert_fun <span class="main">(</span><span class="free">T</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> set<span class="main">)</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> Hilbert_poly <span class="main">(</span>𝖻 <span class="free">ps</span><span class="main">)</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> fin_X <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> 𝖻 <span class="free">ps</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻_decreasing<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝖻 <span class="free">ps</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1-6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>Hilbert_fun <span class="free">T</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span>
                int <span class="main">(</span>card <span class="main">{</span><span class="bound">h</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">∧</span> poly_deg <span class="bound">h</span> <span class="main">=</span> <span class="free">d</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> Hilbert_poly <span class="main">(</span>𝖻 <span class="free">ps</span><span class="main">)</span> <span class="main">(</span>int <span class="free">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hilbert_fun_eq_Hilbert_poly_plus_card<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Hilbert_poly <span class="main">(</span>𝖻 <span class="free">ps</span><span class="main">)</span> <span class="main">(</span>int <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">h</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">∧</span> poly_deg <span class="bound">h</span> <span class="main">=</span> <span class="free">d</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> fin_X this<span class="main">(</span>1<span class="main">)</span> le0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">&lt;</span> 𝖻 <span class="free">ps</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹poly_deg <span class="skolem">h</span> <span class="main">=</span> <span class="free">d</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Dub\'{e}'s Bound›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>field"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n_gr_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fin_F<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> F_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> hom_F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f'</span><span class="main">.</span> <span class="bound">f'</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> homogeneous <span class="bound">f'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f_max<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f'</span><span class="main">.</span> <span class="bound">f'</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> poly_deg <span class="bound">f'</span> <span class="main">≤</span> poly_deg <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> d_gr_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> poly_deg <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ideal_f_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">≠</span> ideal <span class="free">F</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≡</span> card <span class="free">X</span>"</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≡</span> poly_deg <span class="free">f</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_in_Polys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> f_in F_sub <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_f<span class="main">:</span> <span class="quoted"><span class="quoted">"homogeneous <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> f_in <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_F<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> d_gr_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> X_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_gr_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> n_gr_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> n"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> n›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">corollary</span></span> int_n_minus_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>n <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> int n <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_gr_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> int_n_minus_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>n <span class="main">-</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> int n <span class="main">-</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_gr_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> cone_f_X_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> cone <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="main">1</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> f_in_Polys <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> cone <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_mono_1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ideal_Int_Polys_eq_cone<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">=</span> cone <span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> subset_antisym subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="free">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f'</span><span class="main">∈</span><span class="main">{</span><span class="free">f</span><span class="main">}</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f'</span> <span class="main">*</span> <span class="bound">f'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_finiteE<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="free">f</span> <span class="main">*</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> <span class="skolem">q</span> <span class="free">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="free">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f_in_Polys f_not_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> times_in_PolysD<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> p <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coneE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_base<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> f_in_Polys <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> IntI ideal.span_scale Polys_closed_times<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">P_ps</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">P_ps</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> valid_decomp <span class="free">X</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> standard_decomp d <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                        exact_decomp <span class="free">X</span> <span class="main">0</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> cone_decomp <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> hom_decomp <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                        direct_decomp <span class="main">(</span>ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">[</span>ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> fst <span class="bound">x</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">P</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> fst P_ps"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">ps</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">=</span> snd P_ps"</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> valid_ps<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> ps"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> std_ps<span class="main">:</span> <span class="quoted"><span class="quoted">"standard_decomp d ps"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> ext_ps<span class="main">:</span> <span class="quoted"><span class="quoted">"exact_decomp <span class="free">X</span> <span class="main">0</span> ps"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis3</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> cn_ps<span class="main">:</span> <span class="quoted"><span class="quoted">"cone_decomp P ps"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis4</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> hom_ps<span class="main">:</span> <span class="quoted"><span class="quoted">"hom_decomp ps"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis5</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> decomp_F<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">[</span>ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> P<span class="main">]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis6</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> fin_X
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> fin_F <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> F_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="skolem">ps'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"standard_decomp d <span class="skolem">ps'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"cone_decomp <span class="skolem">P'</span> <span class="skolem">ps'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 40<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">f'</span><span class="main">.</span> <span class="bound">f'</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">⟹</span> homogeneous <span class="bound">f'</span><span class="main">)</span> <span class="main">⟹</span> hom_decomp <span class="skolem">ps'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 50<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>ideal <span class="main">(</span>insert <span class="free">f</span> <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">[</span>ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> <span class="skolem">P'</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_in_Polys f_max <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal_decompE<span class="main">)</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"hom_decomp <span class="skolem">ps'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> 40 hom_F<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> 50 f_in <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="main">(</span>ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">[</span>ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> <span class="skolem">P'</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_absorb<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ps</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"exact <span class="free">X</span> <span class="main">(</span>poly_deg <span class="free">f</span><span class="main">)</span> <span class="skolem">ps'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> fin_X 1 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="var">?ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"standard_decomp d <span class="var">?ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"exact_decomp <span class="free">X</span> <span class="main">0</span> <span class="var">?ps</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exact<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> fin_X 1 2 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone_decomp <span class="skolem">P'</span> <span class="var">?ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decomp_exact<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> fin_X 1 2 4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hom_decomp <span class="var">?ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_decomp_exact<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="main">(</span>snd <span class="main">(</span><span class="skolem">P'</span><span class="main">,</span> <span class="var">?ps</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> standard_decomp d <span class="main">(</span>snd <span class="main">(</span><span class="skolem">P'</span><span class="main">,</span> <span class="var">?ps</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                    exact_decomp <span class="free">X</span> <span class="main">0</span> <span class="main">(</span>snd <span class="main">(</span><span class="skolem">P'</span><span class="main">,</span> <span class="var">?ps</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> cone_decomp <span class="main">(</span>fst <span class="main">(</span><span class="skolem">P'</span><span class="main">,</span> <span class="var">?ps</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="skolem">P'</span><span class="main">,</span> <span class="var">?ps</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                    hom_decomp <span class="main">(</span>snd <span class="main">(</span><span class="skolem">P'</span><span class="main">,</span> <span class="var">?ps</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                    direct_decomp <span class="main">(</span>ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="main">[</span>ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> fst <span class="main">(</span><span class="skolem">P'</span><span class="main">,</span> <span class="var">?ps</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis1</span> <span class="main">∧</span> <span class="var">?thesis2</span> <span class="main">∧</span> <span class="var">?thesis3</span> <span class="main">∧</span> <span class="var">?thesis4</span> <span class="main">∧</span> <span class="var">?thesis5</span> <span class="main">∧</span> <span class="var">?thesis6</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> P_def ps_def P_ps_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis3</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis4</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis5</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis6</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> P_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"P <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_ps cn_ps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_cone_decomp_subset_Polys<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ps_not_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"ps<span class="main"><span class="hidden">⇩</span><sub>+</sub></span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ps<span class="main"><span class="hidden">⇩</span><sub>+</sub></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Keys P <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">hU</span><span class="main">∈</span>set ps<span class="main">.</span> keys <span class="main">(</span>fst <span class="bound">hU</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⊆</span> <span class="var">?A</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> Keys P"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> P"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_KeysE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> cn_ps <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp P <span class="main">(</span>map cone ps<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_decompD<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="main">(</span>map cone ps<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> sum_list <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> P›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">p</span>›</span></span> keys_sum_list_subset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> Keys <span class="main">(</span>set <span class="skolem">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="skolem">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_KeysE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">qs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> qs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length ps"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="main">(</span>map cone ps<span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> listsetD <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> nth_map<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> cone <span class="main">(</span>ps <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"ps <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length ps›</span></span> this<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set ps"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set ps›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>ps<span class="main"><span class="hidden">⇩</span><sub>+</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_decomp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹ps<span class="main"><span class="hidden">⇩</span><sub>+</sub></span> <span class="main">=</span> <span class="main">[]</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> cone <span class="main">(</span>ps <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">⋅</span> <span class="skolem">h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq cone_empty<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">⋅</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="main">…</span> <span class="main">⊆</span> keys <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> keys_map_scale_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>fst <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set ps›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> finite_set finite_keys <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_UN_I<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Keys P<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span><span class="main">∈</span>ideal <span class="free">F</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">¬</span> lpp <span class="free">f</span> <span class="keyword1">adds</span> lpp <span class="bound">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">q</span><span class="main">∈</span>ideal <span class="free">F</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">¬</span> lpp <span class="free">f</span> <span class="keyword1">adds</span> lpp <span class="bound">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> adds<span class="main">:</span> <span class="quoted"><span class="quoted">"lpp <span class="free">f</span> <span class="keyword1">adds</span> lpp <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> fin_X _ F_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">=</span> ideal <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> punit.pmdl_eqI_adds_lt_dgrad_p_set<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> dickson_grading_varnum<span class="main"><span class="main">,</span></span>
          <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> dgrad_p_set_varnum<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> f_in_Polys <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> f_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">⊆</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lpp <span class="free">f</span> <span class="keyword1">adds</span> lpp <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> f_not_0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">∈</span><span class="main">{</span><span class="free">f</span><span class="main">}</span><span class="main">.</span> <span class="bound">g</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> lpp <span class="bound">g</span> <span class="keyword1">adds</span> lpp <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> ideal_f_neq <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q0</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q0</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> nadds_q0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> lpp <span class="free">f</span> <span class="keyword1">adds</span> lpp <span class="skolem">q0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> hom_component <span class="skolem">q0</span> <span class="main">(</span>deg_pm <span class="main">(</span>lpp <span class="skolem">q0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> hom_F <span class="quoted"><span class="quoted">‹<span class="skolem">q0</span> <span class="main">∈</span> ideal <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> homogeneous_ideal<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> homogeneous_set_Polys <span class="quoted"><span class="quoted">‹<span class="skolem">q0</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> homogeneous_setD<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q0</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">q</span> <span class="main">=</span> lpp <span class="skolem">q0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_component_lpp<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> nadds_q0 this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> nadds_q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> lpp <span class="free">f</span> <span class="keyword1">adds</span> lpp <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> hom_q<span class="main">:</span> <span class="quoted"><span class="quoted">"homogeneous <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> q_def homogeneous_hom_component<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> nadds_q <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> lookup <span class="main">(</span>lpp <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≤</span> lookup <span class="main">(</span>lpp <span class="skolem">q</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adds_poly_mapping le_fun_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> n_gr_1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> n"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">Y</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_geq_ex_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_2_E<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">Y</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="skolem">y</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> inj1<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="skolem">q'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> injI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> q'_def <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> punit.monom_mult_inj_2 monomial_inj<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> q'_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="skolem">k</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="keyword1"><span class="command">unfolding</span></span> q'_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> ideal <span class="free">F</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> IntI punit.pmdl_closed_monom_mult<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span> Polys_closed_monom_mult PPs_closed_single<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> lpp_q'<span class="main">:</span> <span class="quoted"><span class="quoted">"lpp <span class="main">(</span><span class="skolem">q'</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> Poly_Mapping.single <span class="skolem">y</span> <span class="skolem">k</span> <span class="main">+</span> lpp <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q'_def punit.lt_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> inj2<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>deg_pm <span class="main">∘</span> lpp<span class="main">)</span> <span class="main">(</span>range <span class="skolem">q'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> inj_onI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lpp_q' deg_pm_plus deg_pm_single <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> monomial_inj<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deg_pm <span class="main">∘</span> lpp<span class="main">)</span> <span class="main">`</span> range <span class="skolem">q'</span> <span class="main">⊆</span> deg_pm <span class="main">`</span> Keys P"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> <span class="main">(</span>deg_pm <span class="main">∘</span> lpp<span class="main">)</span> <span class="main">`</span> range <span class="skolem">q'</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> deg_pm <span class="main">(</span>lpp <span class="main">(</span><span class="skolem">q'</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> deg_pm <span class="var">?t</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> hom_q <span class="keyword1"><span class="command">have</span></span> hom_q'<span class="main">:</span> <span class="quoted"><span class="quoted">"homogeneous <span class="main">(</span><span class="skolem">q'</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q'_def homogeneous_monom_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q'_def punit.monom_mult_eq_zero_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">∈</span> keys <span class="main">(</span><span class="skolem">q'</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_in_keys<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> hom_q' <span class="keyword1"><span class="command">have</span></span> deg_q'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> poly_deg <span class="main">(</span><span class="skolem">q'</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> homogeneousD_poly_deg<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> decomp_F q'_in <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">∈</span> listset <span class="main">[</span>ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> P<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="skolem">k</span> <span class="main">=</span> sum_list <span class="skolem">qs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decompE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f0</span></span> <span class="skolem"><span class="skolem">p0</span></span> <span class="keyword2"><span class="keyword">where</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f0</span> <span class="main">∈</span> ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p0</span> <span class="main">∈</span> P"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qs</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">f0</span><span class="main">,</span> <span class="skolem">p0</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listset_doubletonE<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> q'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">f0</span> <span class="main">+</span> <span class="skolem">p0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span> <span class="main">=</span> hom_component <span class="skolem">f0</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">=</span> hom_component <span class="skolem">p0</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> hom_q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"homogeneous <span class="main">(</span><span class="skolem">q'</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q'_def homogeneous_monom_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="skolem">k</span> <span class="main">=</span> hom_component <span class="main">(</span><span class="skolem">q'</span> <span class="skolem">k</span><span class="main">)</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hom_component_of_homogeneous deg_q'<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">f1</span> <span class="main">+</span> <span class="skolem">p1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> q' hom_component_plus f1_def p1_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">f1</span> <span class="main">+</span> <span class="skolem">p1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">p1</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">p1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q'</span> <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">f1</span> <span class="main">+</span> <span class="skolem">p1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q'</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">=</span> lpp <span class="skolem">f1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> f0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f0</span> <span class="main">∈</span> ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> _ <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span> <span class="main">∈</span> ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> homogeneous_ideal<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hom_f<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> punit.is_Groebner_basis_singleton <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lpp <span class="skolem">g</span> <span class="keyword1">adds</span> lpp <span class="skolem">f1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.GB_adds_lt<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lpp <span class="free">f</span> <span class="keyword1">adds</span> <span class="var">?t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>lpp <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≤</span> lookup <span class="var">?t</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adds_poly_mapping le_fun_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> lookup <span class="main">(</span>lpp <span class="skolem">q</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lpp_q' lookup_add lookup_single <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>lpp <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≤</span> lookup <span class="main">(</span>lpp <span class="skolem">q</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">p1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> deg_pm <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p1_def keys_hom_component<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> cn_ps hom_ps <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"homogeneous_set P"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> homogeneous_set_cone_decomp<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">∈</span> P"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p0</span> <span class="main">∈</span> P›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> homogeneous_setD<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">p1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> Keys P"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_KeysI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">=</span> deg_pm <span class="skolem">t</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> deg_pm <span class="main">`</span> Keys P"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> image_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> inj1 inj2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="main">(</span>deg_pm <span class="main">∘</span> lpp<span class="main">)</span> <span class="main">`</span> range <span class="skolem">q'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_image_iff o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deg_pm <span class="main">`</span> Keys P<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> infinite_super<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>Keys P<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>Keys P<span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">N</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">=</span> normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">qs</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">qs</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">qs'</span><span class="main">.</span> valid_decomp <span class="free">X</span> <span class="bound">qs'</span> <span class="main">∧</span> standard_decomp <span class="main">0</span> <span class="bound">qs'</span> <span class="main">∧</span>
                                    monomial_decomp <span class="bound">qs'</span> <span class="main">∧</span> cone_decomp N <span class="bound">qs'</span> <span class="main">∧</span> exact_decomp <span class="free">X</span> <span class="main">0</span> <span class="bound">qs'</span> <span class="main">∧</span>
                                    <span class="main">(</span><span class="main">∀</span><span class="bound">g</span><span class="main">∈</span>punit.reduced_GB <span class="free">F</span><span class="main">.</span> poly_deg <span class="bound">g</span> <span class="main">≤</span> 𝖻 <span class="bound">qs'</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">aa</span> <span class="main">≡</span> 𝖻 ps"</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">bb</span> <span class="main">≡</span> 𝖻 qs"</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">cc</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> aa <span class="bound">i</span> <span class="main">+</span> bb <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> valid_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> qs"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> std_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">0</span> qs"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> mon_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"monomial_decomp qs"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis3</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> hom_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"hom_decomp qs"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis6</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> cn_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"cone_decomp N qs"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis4</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> ext_qs<span class="main">:</span> <span class="quoted"><span class="quoted">"exact_decomp <span class="free">X</span> <span class="main">0</span> qs"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis5</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> deg_RGB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> punit.reduced_GB <span class="free">F</span> <span class="main">⟹</span> poly_deg <span class="free">g</span> <span class="main">≤</span> bb <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> fin_X F_sub <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="skolem">qs'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"standard_decomp <span class="main">0</span> <span class="skolem">qs'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"monomial_decomp <span class="skolem">qs'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"cone_decomp <span class="main">(</span>normal_form <span class="free">F</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">)</span> <span class="skolem">qs'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"exact_decomp <span class="free">X</span> <span class="main">0</span> <span class="skolem">qs'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 60<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> homogeneous <span class="bound">f</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">g</span> <span class="main">∈</span> punit.reduced_GB <span class="free">F</span> <span class="main">⟹</span> poly_deg <span class="bound">g</span> <span class="main">≤</span> 𝖻 <span class="skolem">qs'</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> normal_form_exact_decompE<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> hom_F <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> punit.reduced_GB <span class="free">F</span> <span class="main">⟹</span> poly_deg <span class="bound">g</span> <span class="main">≤</span> 𝖻 <span class="skolem">qs'</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 60<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 1 2 3 4 5 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_decomp <span class="free">X</span> <span class="skolem">qs'</span> <span class="main">∧</span> standard_decomp <span class="main">0</span> <span class="skolem">qs'</span> <span class="main">∧</span>
                        monomial_decomp <span class="skolem">qs'</span> <span class="main">∧</span> cone_decomp N <span class="skolem">qs'</span> <span class="main">∧</span> exact_decomp <span class="free">X</span> <span class="main">0</span> <span class="skolem">qs'</span> <span class="main">∧</span>
                        <span class="main">(</span><span class="main">∀</span><span class="bound">g</span><span class="main">∈</span>punit.reduced_GB <span class="free">F</span><span class="main">.</span> poly_deg <span class="bound">g</span> <span class="main">≤</span> 𝖻 <span class="skolem">qs'</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> N_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis1</span> <span class="main">∧</span> <span class="var">?thesis2</span> <span class="main">∧</span> <span class="var">?thesis3</span> <span class="main">∧</span> <span class="var">?thesis4</span> <span class="main">∧</span> <span class="var">?thesis5</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">g</span><span class="main">∈</span>punit.reduced_GB <span class="free">F</span><span class="main">.</span> poly_deg <span class="bound">g</span> <span class="main">≤</span> bb <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> qs_def bb_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis3</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis4</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis5</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> punit.reduced_GB <span class="free">F</span> <span class="main">⟹</span> poly_deg <span class="free">g</span> <span class="main">≤</span> bb <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?thesis3</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis6</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monomial_decomp_imp_hom_decomp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> N_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"N <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_qs cn_qs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_cone_decomp_subset_Polys<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> decomp_Polys<span class="main">:</span> <span class="quoted"><span class="quoted">"direct_decomp <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">[</span>ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> P<span class="main">,</span> N<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> fin_X F_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">[</span>ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> N<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> N_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_ideal_normal_form<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">(</span><span class="main">[</span>N<span class="main">]</span> <span class="main">@</span> <span class="main">[</span>ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> P<span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> decomp_F
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_direct_decomp<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direct_decomp <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">(</span><span class="main">[</span>ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> P<span class="main">]</span> <span class="main">@</span> <span class="main">[</span>N<span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> perm_append_swap
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_perm<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> aa_Suc_n <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"aa <span class="main">(</span>Suc n<span class="main">)</span> <span class="main">=</span> d"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> fin_X ext_ps le_refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"aa <span class="main">(</span>Suc n<span class="main">)</span> <span class="main">=</span> 𝖺 ps"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> aa_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻_card_X<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> fin_X valid_ps std_ps ps_not_Nil <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> d"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖺_nonempty_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bb_Suc_n <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bb <span class="main">(</span>Suc n<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> fin_X ext_qs le_refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bb <span class="main">(</span>Suc n<span class="main">)</span> <span class="main">=</span> 𝖺 qs"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bb_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻_card_X<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> std_qs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> 𝖺_def<span class="main">[</span><span class="operator">OF</span> fin_X<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Hilbert_fun_X<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"d <span class="main">≤</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="main">(</span><span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span> <span class="free">z</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">(</span><span class="free">z</span> <span class="main">-</span> d<span class="main">)</span> <span class="main">+</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> Hilbert_fun P <span class="free">z</span> <span class="main">+</span> Hilbert_fun N <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ss</span> <span class="main">=</span> <span class="main">[</span>ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> P<span class="main">,</span> N<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"homogeneous_set <span class="skolem">A</span> <span class="main">∧</span> phull.subspace <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> set <span class="skolem">ss</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∨</span> <span class="skolem">A</span> <span class="main">=</span> P <span class="main">∨</span> <span class="skolem">A</span> <span class="main">=</span> N"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ss_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> A
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conjI homogeneous_set_IntI phull.subspace_inter homogeneous_set_homogeneous_ideal
            homogeneous_set_Polys subspace_ideal subspace_Polys<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hom_f<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> P"</span></span>
      <span class="keyword1"><span class="command">from</span></span> cn_ps hom_ps <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> A
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conjI homogeneous_set_cone_decomp subspace_cone_decomp<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> N"</span></span>
      <span class="keyword1"><span class="command">from</span></span> cn_qs hom_qs <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> A
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conjI homogeneous_set_cone_decomp subspace_cone_decomp<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> set <span class="skolem">ss</span> <span class="main">⟹</span> homogeneous_set <span class="bound">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> set <span class="skolem">ss</span> <span class="main">⟹</span> phull.subspace <span class="bound">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="main">(</span><span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ss</span><span class="main">.</span> Hilbert_fun <span class="bound">p</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin_X subset_refl decomp_Polys <span class="keyword1"><span class="command">unfolding</span></span> ss_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Hilbert_fun_direct_decomp<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> set <span class="main">[</span>ideal <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">,</span> P<span class="main">,</span> N<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> set <span class="skolem">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ss_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"homogeneous_set <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"phull.subspace <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> 2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ss</span><span class="main">.</span> count_list <span class="skolem">ss</span> <span class="bound">p</span> <span class="main">*</span> Hilbert_fun <span class="bound">p</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> refl
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="skolem">ss</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"count_list <span class="skolem">ss</span> <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> count_list_eq_0_iff not_not<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"count_list <span class="skolem">ss</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="main">1</span> <span class="main">&lt;</span> count_list <span class="skolem">ss</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="skolem">p</span> <span class="free">z</span> <span class="main">=</span> count_list <span class="skolem">ss</span> <span class="skolem">p</span> <span class="main">*</span> Hilbert_fun <span class="skolem">p</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> count_list <span class="skolem">ss</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> decomp_Polys <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ss_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> phull.subspace_0
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> direct_decomp_repeated_eq_zero<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> Hilbert_fun <span class="bound">p</span> <span class="free">z</span><span class="main">)</span> <span class="skolem">ss</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> sum_list_map_eq_sum_count<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Hilbert_fun <span class="main">(</span>cone <span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span> <span class="main">+</span> Hilbert_fun P <span class="free">z</span> <span class="main">+</span> Hilbert_fun N <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ss_def ideal_Int_Polys_eq_cone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="main">(</span>cone <span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> d <span class="main">+</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_not_0 f_in_Polys fin_X hom_f X_not_empty <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hilbert_fun_cone_nonempty assms<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dube_eq_0<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>int<span class="main">.</span> <span class="main">(</span><span class="bound">z</span> <span class="main">+</span> int n <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>int<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">-</span> d <span class="main">+</span> n <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> Hilbert_poly aa <span class="bound">z</span> <span class="main">+</span> Hilbert_poly bb <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">=</span> <span class="var">?g</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_fun_eqI_ge<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span><span class="main">::</span><span class="quoted">int</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"nat <span class="skolem">z</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>aa <span class="main">0</span><span class="main">)</span> <span class="main">(</span>bb <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"aa <span class="main">0</span> <span class="main">≤</span> nat <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bb <span class="main">0</span> <span class="main">≤</span> nat <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> int_z<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="var">?z</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d <span class="main">≤</span> aa <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> aa_Suc_n<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> fin_X le0 <span class="keyword1"><span class="command">unfolding</span></span> aa_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻_decreasing<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"d <span class="main">≤</span> <span class="var">?z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹aa <span class="main">0</span> <span class="main">≤</span> nat <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> int_zd<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="var">?z</span> <span class="main">-</span> d<span class="main">)</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">-</span> int d"</span></span> <span class="keyword1"><span class="command">using</span></span> int_z <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹d <span class="main">≤</span> <span class="var">?z</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="main">(</span><span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span> <span class="var">?z</span> <span class="main">=</span>
                      <span class="main">(</span><span class="main">(</span><span class="var">?z</span> <span class="main">-</span> d<span class="main">)</span> <span class="main">+</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> Hilbert_fun P <span class="var">?z</span> <span class="main">+</span> Hilbert_fun N <span class="var">?z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hilbert_fun_X<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">-</span> d <span class="main">+</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> Hilbert_poly aa <span class="skolem">z</span> <span class="main">+</span> Hilbert_poly bb <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> X_not_empty valid_ps hom_ps cn_ps std_ps ext_ps <span class="quoted"><span class="quoted">‹aa <span class="main">0</span> <span class="main">≤</span> nat <span class="skolem">z</span>›</span></span>
          valid_qs hom_qs cn_qs std_qs ext_qs <span class="quoted"><span class="quoted">‹bb <span class="main">0</span> <span class="main">≤</span> nat <span class="skolem">z</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="skolem">z</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hilbert_fun_eq_Hilbert_poly int_z aa_def bb_def int_binomial int_zd<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">z</span> <span class="main">=</span> <span class="var">?g</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_X X_not_empty <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="skolem">z</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hilbert_fun_Polys int_binomial<span class="main">)</span> <span class="operator">smt</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_fun_Hilbert_poly<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> dube_eq_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>int<span class="main">.</span> <span class="main">(</span><span class="bound">z</span> <span class="main">+</span> int n <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>int<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">-</span> d <span class="main">+</span> n <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">-</span> d <span class="main">+</span> n<span class="main">)</span> <span class="keyword1">gchoose</span> n<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">+</span> n<span class="main">)</span> <span class="keyword1">gchoose</span> n<span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">-</span>
           <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span>n<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">-</span> aa <span class="bound">i</span> <span class="main">+</span> <span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">-</span> bb <span class="bound">i</span> <span class="main">+</span> <span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dube_eq_0<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Hilbert_poly_def Let_def sum.distrib<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dube_eq_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> n"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>int<span class="main">.</span> <span class="main">(</span><span class="bound">z</span> <span class="main">+</span> int n <span class="main">-</span> int <span class="free">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>int<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">-</span> d <span class="main">+</span> n <span class="main">-</span> int <span class="free">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">-</span> d <span class="main">+</span> n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                    <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">+</span> n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">-</span>
                    <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="free">j</span><span class="main">..</span>n<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">-</span> aa <span class="bound">i</span> <span class="main">+</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">-</span> bb <span class="bound">i</span> <span class="main">+</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">=</span> <span class="var">?g</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">+</span> <span class="main">(</span>int <span class="bound">i</span> <span class="main">-</span> aa <span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">+</span> <span class="main">(</span>int <span class="bound">i</span> <span class="main">-</span> bb <span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?hj</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">+</span> <span class="main">(</span>int <span class="bound">i</span> <span class="main">-</span> aa <span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">+</span> <span class="main">(</span>int <span class="bound">i</span> <span class="main">-</span> bb <span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> n <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> n"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">j</span><span class="main">.</span> <span class="var">?h</span> <span class="bound">z</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j0</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>int<span class="main">.</span> <span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">j</span><span class="main">.</span> <span class="var">?h</span> <span class="bound">z</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>int<span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="skolem">j0</span><span class="main">.</span> <span class="var">?h</span> <span class="bound">z</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="var">?h</span> <span class="bound">z</span> <span class="free">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">j</span> <span class="main">=</span> Suc <span class="skolem">j0</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>int<span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="skolem">j0</span><span class="main">.</span> <span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="var">?h</span> <span class="bound">z</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">z</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bw_diff_gbinomial_pow<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="skolem">j0</span><span class="main">.</span> <span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="var">?h</span> <span class="bound">z</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="skolem">j0</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span><span class="main">::</span><span class="quoted">int</span>
      <span class="keyword1"><span class="command">using</span></span> refl
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">j0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">j</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">j</span> <span class="main">=</span> Suc <span class="skolem">j0</span>›</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="var">?h</span> <span class="bound">z</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bw_diff_gbinomial_pow<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="free">j</span><span class="main">..</span>n<span class="main">.</span> <span class="var">?h</span> <span class="bound">z</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="free">j</span><span class="main">..</span>n<span class="main">.</span> <span class="var">?hj</span> <span class="bound">z</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="free">j</span><span class="main">..</span>n<span class="main">.</span> <span class="var">?h</span> <span class="bound">z</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="free">j</span><span class="main">..</span>n<span class="main">.</span> <span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="var">?h</span> <span class="bound">z</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="free">j</span><span class="main">..</span>n<span class="main">.</span> <span class="var">?hj</span> <span class="bound">z</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext sum.cong<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span>Suc <span class="free">j</span><span class="main">..</span>n<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="var">?h</span> <span class="bound">z</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="var">?hj</span> <span class="skolem">z</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bw_diff_gbinomial_pow<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> refl<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">=</span> <span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>int<span class="main">.</span> <span class="main">(</span><span class="bound">z</span> <span class="main">+</span> <span class="main">(</span>int n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bw_diff_gbinomial_pow<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>int<span class="main">.</span> <span class="main">(</span><span class="bound">z</span> <span class="main">+</span> int n <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">j</span><span class="main">)</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>int<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">-</span> d <span class="main">+</span> n <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">-</span> d <span class="main">+</span> n<span class="main">)</span> <span class="keyword1">gchoose</span> n<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">+</span> n<span class="main">)</span> <span class="keyword1">gchoose</span> n<span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">-</span>
            <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span>n<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">-</span> aa <span class="bound">i</span> <span class="main">+</span> <span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">-</span> bb <span class="bound">i</span> <span class="main">+</span> <span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dube_eq_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">j</span><span class="main">)</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>int<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">+</span> <span class="main">(</span>int n <span class="main">-</span> d <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">+</span> <span class="main">(</span>int n <span class="main">-</span> d<span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> n<span class="main">)</span> <span class="main">+</span>
                    <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">+</span> n<span class="main">)</span> <span class="keyword1">gchoose</span> n<span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span>n<span class="main">.</span> <span class="var">?h</span> <span class="bound">z</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>int<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">+</span> <span class="main">(</span>int n <span class="main">-</span> d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
            <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">+</span> <span class="main">(</span>int n <span class="main">-</span> d<span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="bound">z</span> <span class="main">+</span> n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">-</span>
            <span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span>n<span class="main">.</span> <span class="var">?h</span> <span class="bound">z</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bw_diff_const_pow bw_diff_gbinomial_pow <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> bw_diff_sum_pow<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">j</span> <span class="main">≤</span> n›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span>n<span class="main">.</span> <span class="var">?h</span> <span class="bound">z</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">j</span><span class="main">.</span> <span class="var">?h</span> <span class="bound">z</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="free">j</span><span class="main">..</span>n<span class="main">.</span> <span class="var">?h</span> <span class="bound">z</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_split_nat_ivl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">j</span><span class="main">.</span> <span class="var">?h</span> <span class="bound">z</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">z</span> <span class="main">+</span> <span class="main">(</span>bw_diff <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="free">j</span><span class="main">..</span>n<span class="main">.</span> <span class="var">?h</span> <span class="bound">z</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> bw_diff_plus_pow<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="free">j</span><span class="main">..</span>n<span class="main">.</span> <span class="var">?hj</span> <span class="bound">z</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq1 eq2<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dube_eq_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> n"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                    <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span>
                    <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="free">j</span><span class="main">..</span>n<span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">=</span> int n <span class="main">-</span> <span class="free">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> int n <span class="main">-</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int n <span class="main">-</span> int <span class="free">j</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> int <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"int n <span class="main">-</span> int <span class="free">j</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int n <span class="main">-</span> int <span class="free">j</span> <span class="main">=</span> int <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"int n <span class="main">-</span> int <span class="free">j</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"int n <span class="main">-</span> d <span class="main">-</span> <span class="free">j</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gbinomial_int_negated_upper<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"int n <span class="main">-</span> d <span class="main">-</span> <span class="free">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span> 1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eq4<span class="main">:</span> <span class="quoted"><span class="quoted">"int n <span class="main">-</span> d <span class="main">-</span> <span class="free">j</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gbinomial_int_negated_upper<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"int n <span class="main">-</span> d <span class="main">-</span> <span class="free">j</span>"</span></span><span class="main"><span class="main">]</span></span> 2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eq5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> Suc <span class="free">j</span><span class="main">..</span>n<span class="main">.</span> int <span class="bound">i</span> <span class="main">-</span> aa <span class="bound">i</span> <span class="main">-</span> <span class="free">j</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="bound">i</span> <span class="main">-</span> bb <span class="bound">i</span> <span class="main">-</span> <span class="free">j</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="free">j</span><span class="main">..</span>n<span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> refl
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span>Suc <span class="free">j</span><span class="main">..</span>n<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> int <span class="skolem">i</span> <span class="main">-</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">i</span> <span class="main">-</span> aa <span class="skolem">i</span> <span class="main">-</span> <span class="free">j</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="skolem">i</span> <span class="main">-</span> bb <span class="skolem">i</span> <span class="main">-</span> <span class="free">j</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gbinomial_int_negated_upper<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"int <span class="skolem">i</span> <span class="main">-</span> aa <span class="skolem">i</span> <span class="main">-</span> <span class="free">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span>
            gbinomial_int_negated_upper<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"int <span class="skolem">i</span> <span class="main">-</span> bb <span class="skolem">i</span> <span class="main">-</span> <span class="free">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span> 3 distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> fun_cong<span class="main">[</span><span class="operator">OF</span> dube_eq_2<span class="main">,</span> <span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq1 eq2 eq3 eq4 eq5<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dube_aux_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> set ps <span class="main">∪</span> set qs"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">h</span> <span class="main">&lt;</span> max <span class="main">(</span>aa <span class="main">1</span><span class="main">)</span> <span class="main">(</span>bb <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> poly_deg <span class="free">h</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">z</span> <span class="main">&lt;</span> max <span class="main">(</span>aa <span class="main">1</span><span class="main">)</span> <span class="main">(</span>bb <span class="main">1</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="main">{</span><span class="bound">h</span><span class="main">.</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">A</span> <span class="main">∧</span> poly_deg <span class="bound">h</span> <span class="main">=</span> <span class="skolem">z</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="var">?S</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'x</span> set<span class="main">)</span> set"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="var">?S</span> <span class="skolem">A</span> <span class="main">⊆</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="main">{}</span><span class="main">::</span><span class="tfree">'x</span> set<span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="var">?S</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="main">{}</span><span class="main">::</span><span class="tfree">'x</span> set<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?S</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> finite_set <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>set ps<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fin<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> finite_set <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>set qs<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fin<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">z</span> <span class="main">&lt;</span> max <span class="main">(</span>aa <span class="main">1</span><span class="main">)</span> <span class="main">(</span>bb <span class="main">1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"aa <span class="main">1</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bb <span class="main">1</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d <span class="main">≤</span> aa <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> aa_Suc_n<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> aa_def <span class="keyword1"><span class="command">using</span></span> fin_X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻_decreasing<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"d <span class="main">≤</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹aa <span class="main">1</span> <span class="main">≤</span> <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="skolem">z</span> <span class="main">-</span> d<span class="main">)</span> <span class="main">=</span> int <span class="skolem">z</span> <span class="main">-</span> int d"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹d <span class="main">≤</span> <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hilbert_fun <span class="main">(</span><span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span>
                        <span class="main">(</span><span class="main">(</span><span class="skolem">z</span> <span class="main">-</span> d<span class="main">)</span> <span class="main">+</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> Hilbert_fun P <span class="skolem">z</span> <span class="main">+</span> Hilbert_fun N <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hilbert_fun_X<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>int <span class="skolem">z</span> <span class="main">-</span> d <span class="main">+</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> Hilbert_poly aa <span class="skolem">z</span> <span class="main">+</span> Hilbert_poly bb <span class="skolem">z</span><span class="main">)</span> <span class="main">+</span>
                        <span class="main">(</span>int <span class="main">(</span>card <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>set ps<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span>card <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>set qs<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> X_not_empty valid_ps hom_ps cn_ps std_ps ext_ps <span class="quoted"><span class="quoted">‹aa <span class="main">1</span> <span class="main">≤</span> <span class="skolem">z</span>›</span></span>
          valid_qs hom_qs cn_qs std_qs ext_qs <span class="quoted"><span class="quoted">‹bb <span class="main">1</span> <span class="main">≤</span> <span class="skolem">z</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hilbert_fun_eq_Hilbert_poly_plus_card aa_def bb_def int_binomial eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>int <span class="skolem">z</span> <span class="main">-</span> d <span class="main">+</span> n <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> Hilbert_poly aa <span class="skolem">z</span> <span class="main">+</span> Hilbert_poly bb <span class="skolem">z</span><span class="main">)</span> <span class="main">+</span>
                  <span class="main">(</span>int <span class="main">(</span>card <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>set ps<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span>card <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>set qs<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> int <span class="skolem">z</span> <span class="main">+</span> n <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin_X X_not_empty <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hilbert_fun_Polys int_binomial <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>int <span class="skolem">z</span> <span class="main">-</span> d <span class="main">+</span> n <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> Hilbert_poly aa <span class="skolem">z</span> <span class="main">+</span> Hilbert_poly bb <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> dube_eq_0<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> fun_cong<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>card <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>set ps<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span>card <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>set qs<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>set ps<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>set qs<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> 1 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">(</span>set ps <span class="main">∪</span> set qs<span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="var">?S</span> <span class="main">(</span>set ps <span class="main">∪</span> set qs<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> z_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subst<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> aa_n<span class="main">:</span> <span class="quoted"><span class="quoted">"aa n <span class="main">=</span> d"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bb_n<span class="main">:</span> <span class="quoted"><span class="quoted">"bb n <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bb_0<span class="main">:</span> <span class="quoted"><span class="quoted">"bb <span class="main">0</span> <span class="main">≤</span> max <span class="main">(</span>aa <span class="main">1</span><span class="main">)</span> <span class="main">(</span>bb <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?j</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"n <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> n_gr_0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?j</span> <span class="main">&lt;</span> n"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="var">?j</span> <span class="main">=</span> n"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"n <span class="main">-</span> <span class="var">?j</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> Suc <span class="var">?j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="var">?j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                    <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> <span class="var">?j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="var">?j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span>
                    <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="var">?j</span><span class="main">..</span>n<span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="var">?j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="var">?j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="var">?j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dube_eq_3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"aa n <span class="main">+</span> bb n <span class="main">=</span> d"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq1 eq2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"aa n <span class="main">≤</span> d"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d <span class="main">≤</span> aa n"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> aa_Suc_n<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> aa_def <span class="keyword1"><span class="command">using</span></span> fin_X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻_decreasing<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"aa n <span class="main">=</span> d"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> eq <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bb n <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bb <span class="main">0</span> <span class="main">=</span> 𝖻 qs <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> bb_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> fin_X <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> max <span class="main">(</span>aa <span class="main">1</span><span class="main">)</span> <span class="main">(</span>bb <span class="main">1</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">≤</span> <span class="var">?m</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻_le<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> fin_X ext_qs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝖺 qs <span class="main">=</span> bb <span class="main">(</span>Suc n<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 𝖻_card_X bb_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> bb <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bb_def <span class="keyword1"><span class="command">using</span></span> fin_X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻_decreasing<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> max.cobounded2<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"𝖺 qs <span class="main">≤</span> <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">U</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set qs"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">&lt;</span> <span class="var">?m</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"card <span class="skolem">U</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> fin_X valid_qs <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set qs›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_decompD_finite<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set qs›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> set ps <span class="main">∪</span> set qs"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dube_aux_1<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> card <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> fin_X <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> set qs›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">h</span> <span class="main">&lt;</span> bb <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bb_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 𝖻<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> max.cobounded2<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bb <span class="main">0</span> <span class="main">≤</span> <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dube_eq_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> n"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span>
                    <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="free">j</span><span class="main">..</span>n<span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">j</span> <span class="main">≤</span> n"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> n"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">=</span> n <span class="main">-</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> 1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                    <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span>
                    <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="free">j</span><span class="main">..</span>n<span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dube_eq_3<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                    <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span>
                    <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa n<span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb n<span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                    <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="free">j</span><span class="main">..</span>n<span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> n›</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="free">j</span> <span class="main">≤</span> n›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sum_tail_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                    <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>int d <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span>
                    <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="free">j</span><span class="main">..</span>n<span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aa_n bb_n gbinomial_0_left right_diff_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>int d <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>Suc <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1 2 <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> mult_minus_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gbinomial_int_Suc_Suc<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cc_Suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> n <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>cc <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                   <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="free">j</span><span class="main">+</span><span class="numeral">2</span><span class="main">..</span>n<span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> n"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">j</span> <span class="main">≤</span> n <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"n <span class="main">-</span> <span class="free">j</span> <span class="main">=</span> Suc <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">j</span> <span class="main">&lt;</span> n›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span>
             <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span>Suc <span class="free">j</span><span class="main">..</span>n<span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dube_eq_4<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cc <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span>
             <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="free">j</span><span class="main">+</span><span class="numeral">2</span><span class="main">..</span>n<span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="free">j</span> <span class="main">≤</span> n <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.atLeast_Suc_atMost eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cc_n_minus_1<span class="main">:</span> <span class="quoted"><span class="quoted">"cc <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> d"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?j</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"n <span class="main">-</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> n_gr_1 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="var">?j</span> <span class="main">=</span> n <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?j</span> <span class="main">&lt;</span> n <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> n"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"n <span class="main">-</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"n <span class="main">-</span> <span class="var">?j</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>cc <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span>cc <span class="main">(</span>Suc <span class="var">?j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> 1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?j</span> <span class="main">&lt;</span> n <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>n <span class="main">-</span> <span class="var">?j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="var">?j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
         <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="var">?j</span><span class="main">+</span><span class="numeral">2</span><span class="main">..</span>n<span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="var">?j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>int <span class="main">(</span>aa <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="var">?j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="var">?j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cc_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> int <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> d<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1 2 3 4<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> int_int_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Since the case <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"n <span class="main"><span class="main">=</span></span> <span class="numeral"><span class="numeral">2</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is settled, we can concentrate on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="numeral"><span class="numeral">2</span></span> <span class="main"><span class="main">&lt;</span></span> n"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> now.›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n_gr_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">&lt;</span> n"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cc_n_minus_2<span class="main">:</span> <span class="quoted"><span class="quoted">"cc <span class="main">(</span>n <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> d<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> d"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?j</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"n <span class="main">-</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> n_gr_2 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="var">?j</span> <span class="main">=</span> n <span class="main">-</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?j</span> <span class="main">&lt;</span> n <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>n <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> n <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"n <span class="main">-</span> <span class="main">(</span>n <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"n <span class="main">-</span> <span class="var">?j</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>cc <span class="main">(</span>n <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span>cc <span class="main">(</span>Suc <span class="var">?j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> 1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?j</span> <span class="main">&lt;</span> n <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>n <span class="main">-</span> <span class="var">?j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="var">?j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
         <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="var">?j</span><span class="main">+</span><span class="numeral">2</span><span class="main">..</span>n<span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="var">?j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>int <span class="main">(</span>aa <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="var">?j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="var">?j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cc_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1 2 3 4<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> int d <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> add_left_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span>bb <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> gbinomial_int_plus_le<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> int <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> d<span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> cc_n_minus_1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> int d <span class="keyword1">gchoose</span> <span class="numeral">2</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_ops<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> int d <span class="keyword1">gchoose</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">-</span> fact <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> int d <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fact_2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>int d <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> int d <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gbinomial_int_mult_fact<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2 prod.atLeast0_lessThan_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>int d <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> int d <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gbinomial_prod_rev numeral_2_eq_2 prod.atLeast0_lessThan_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> int <span class="main">(</span>d<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> d<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> int_int_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cc_Suc_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> n <span class="main">-</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>cc <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>cc <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="free">j</span><span class="main">+</span><span class="numeral">4</span><span class="main">..</span>n<span class="main">-</span><span class="main">1</span><span class="main">.</span> int <span class="main">(</span>cc <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="comment1">―‹Could be proved without coercing to <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">int</span><span class="antiquote">}</span></span>, because everything is non-negative.›</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span>int <span class="main">(</span>aa <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="free">j</span><span class="main">+</span><span class="bound">x</span><span class="main">..</span>n<span class="main">-</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="var">?f</span> <span class="bound">i</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S3</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="free">j</span><span class="main">+</span><span class="bound">x</span><span class="main">..</span>n<span class="main">-</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>int <span class="main">(</span>cc <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ie1<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>aa <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span> int <span class="main">(</span>cc <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>aa <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span> int <span class="main">(</span>aa <span class="skolem">i</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span>bb <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> gbinomial_int_plus_le<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> int <span class="main">(</span>cc <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> d_gr_0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> int d <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> n <span class="main">-</span> Suc <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> f_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="var">?f</span> <span class="skolem">i</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gbinomial_int_nonneg<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"n <span class="main">=</span> <span class="free">j</span> <span class="main">+</span> <span class="numeral">4</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> n <span class="main">-</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"n <span class="main">-</span> Suc <span class="free">j</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> n <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>n <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"n <span class="main">-</span> <span class="main">(</span>n <span class="main">-</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"n <span class="main">-</span> <span class="free">j</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"n <span class="main">-</span> Suc <span class="main">0</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"n <span class="main">-</span> <span class="numeral">2</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">j</span> <span class="main">&lt;</span> n <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>cc <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
           <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="free">j</span><span class="main">+</span><span class="numeral">2</span><span class="main">..</span>n<span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>int <span class="main">(</span>aa <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cc_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="main">(</span>n <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                    <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1 2 3 4 5 6<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="main">(</span>n <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> add_left_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> cc_n_minus_1 <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span>bb <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> int d"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> ie2<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> int d"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> int d <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int d <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="numeral">3</span> <span class="main">≤</span> int d <span class="keyword1">gchoose</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> gbinomial_int_mono<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>int d <span class="keyword1">gchoose</span> <span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> _ ie2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">3</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> int d <span class="main">-</span> int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">3</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> binomial_int_ineq_3<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">3</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> eq1<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">3</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="main">(</span>n <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> ie1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>cc <span class="main">(</span>n <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add_left_mono<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>cc <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="var">?S3</span> <span class="numeral">4</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">+</span> <span class="numeral">4</span> <span class="main">≤</span> n <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> n_gr_1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> n <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">≤</span> n <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">≤</span> n <span class="main">-</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"n <span class="main">-</span> <span class="free">j</span> <span class="main">=</span> Suc <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> n <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>cc <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="var">?S</span> <span class="numeral">2</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cc_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                    <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                    <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="var">?S</span> <span class="numeral">2</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> n <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">j</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">≤</span> n <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sum_tail_nat<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span>int <span class="main">(</span>cc <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="var">?S</span> <span class="numeral">2</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> add_right_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> rl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                    <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                    <span class="main">(</span>int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> 1 <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span>int <span class="main">(</span>cc <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                <span class="main">(</span>int <span class="main">(</span>bb <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                                                     <span class="main">(</span>int <span class="main">(</span>bb <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rl<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gbinomial_int_nonneg<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> n <span class="main">-</span> Suc <span class="free">j</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> int d <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> int d <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> gbinomial_int_plus_le<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> int d <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> gbinomial_int_mono<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> int d <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> int d <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> int <span class="main">(</span>cc <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> cc_n_minus_1<span class="main">)</span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                <span class="main">(</span>int <span class="main">(</span>bb <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span>int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rl<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gbinomial_int_nonneg d_gr_0<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> n <span class="main">-</span> Suc <span class="free">j</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> int <span class="main">(</span>cc <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ie1<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int d <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                    <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
                    <span class="main">(</span>int <span class="main">(</span>cc <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span>n <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>cc <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span>
                    <span class="main">(</span>int <span class="main">(</span>bb <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="var">?S</span> <span class="numeral">3</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">j</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">≤</span> n <span class="main">-</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.atLeast_Suc_atMost numeral_3_eq_3<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>cc <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span>
                    <span class="main">(</span>int <span class="main">(</span>bb <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="var">?S3</span> <span class="numeral">4</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> add_left_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">j</span> <span class="main">+</span> <span class="numeral">4</span> <span class="main">≤</span> n <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">≤</span> n <span class="main">-</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="numeral">3</span> <span class="numeral">2</span> <span class="main">=</span> <span class="var">?S</span> <span class="numeral">4</span> <span class="numeral">2</span> <span class="main">-</span> <span class="var">?f</span> <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">)</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.atLeast_Suc_atMost add.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="numeral">3</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="var">?S</span> <span class="numeral">4</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f_nonneg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">+</span> <span class="numeral">3</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="var">?S3</span> <span class="numeral">4</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_mono<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="free">j</span> <span class="main">+</span> <span class="numeral">4</span><span class="main">..</span>n <span class="main">-</span> <span class="numeral">2</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> f_nonneg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="var">?f</span> <span class="skolem">i</span> <span class="free">j</span> <span class="main">≤</span> <span class="var">?f</span> <span class="skolem">i</span> <span class="free">j</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> minus_one_mult_self mult_cancel_right1 pos_zmult_eq_1_iff_lemma zero_less_mult_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">j</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> int <span class="main">(</span>cc <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ie1<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="var">?f</span> <span class="skolem">i</span> <span class="free">j</span> <span class="main">≤</span> int <span class="main">(</span>cc <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="numeral">3</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="var">?S3</span> <span class="numeral">4</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>int <span class="main">(</span>aa <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bb <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="var">?S3</span> <span class="numeral">4</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> n <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">j</span> <span class="main">+</span> <span class="numeral">4</span> <span class="main">≤</span> n <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sum_tail_nat<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> ie1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> int <span class="main">(</span>cc <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="var">?S3</span> <span class="numeral">4</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add_right_mono<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>cc <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="var">?S3</span> <span class="numeral">4</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> cc_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> n <span class="main">-</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cc <span class="free">j</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>cc <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="free">j</span><span class="main">+</span><span class="numeral">3</span><span class="main">..</span>n<span class="main">-</span><span class="main">1</span><span class="main">.</span> cc <span class="bound">i</span> <span class="keyword1">choose</span> <span class="main">(</span>Suc <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">j0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j0</span> <span class="main">=</span> <span class="free">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> Suc <span class="skolem">j0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j0</span> <span class="main">&lt;</span> n <span class="main">-</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>cc <span class="free">j</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span>cc <span class="main">(</span>Suc <span class="skolem">j0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> j<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>cc <span class="main">(</span><span class="skolem">j0</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="skolem">j0</span><span class="main">+</span><span class="numeral">4</span><span class="main">..</span>n<span class="main">-</span><span class="main">1</span><span class="main">.</span> int <span class="main">(</span>cc <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="skolem">j0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j0</span> <span class="main">&lt;</span> n <span class="main">-</span> <span class="numeral">3</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cc_Suc_le<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>cc <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="skolem">j0</span><span class="main">+</span><span class="numeral">4</span><span class="main">..</span>n<span class="main">-</span><span class="main">1</span><span class="main">.</span> int <span class="main">(</span>cc <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="skolem">j0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> j<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="skolem">j0</span><span class="main">+</span><span class="numeral">4</span><span class="main">..</span>n<span class="main">-</span><span class="main">1</span><span class="main">.</span> int <span class="main">(</span>cc <span class="bound">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="skolem">j0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="free">j</span><span class="main">+</span><span class="numeral">3</span><span class="main">..</span>n<span class="main">-</span><span class="main">1</span><span class="main">.</span> cc <span class="bound">i</span> <span class="keyword1">choose</span> <span class="main">(</span>Suc <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> int_sum
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="free">j</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">..</span>n <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">j0</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> j<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="skolem">j0</span> <span class="main">=</span> Suc <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> j<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>cc <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">gchoose</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="skolem">j0</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span>cc <span class="skolem">i</span> <span class="keyword1">choose</span> <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_binomial<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> j<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>cc <span class="free">j</span><span class="main">)</span> <span class="main">≤</span> int <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>cc <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="free">j</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">..</span>n <span class="main">-</span> <span class="main">1</span><span class="main">.</span> cc <span class="bound">i</span> <span class="keyword1">choose</span> <span class="main">(</span>Suc <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> int_plus int_binomial<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> zle_int<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> cc_le_Dube_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> n <span class="main">⟹</span> cc <span class="free">j</span> <span class="main">≤</span> Dube_aux n d <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">j</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Dube_aux.induct<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">n</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">j</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> step.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">&lt;</span> n <span class="main">∨</span> <span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">=</span> n <span class="main">∨</span> <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> n"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">&lt;</span> n"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> n"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cc <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> Dube_aux n d <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> step.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"cc <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="numeral">2</span> <span class="main">≤</span> Dube_aux n d <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Binomial_Int.binomial_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">..</span>n <span class="main">-</span> <span class="main">1</span><span class="main">.</span> cc <span class="bound">i</span> <span class="keyword1">choose</span> Suc <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
              <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">..</span>n <span class="main">-</span> <span class="main">1</span><span class="main">.</span> Dube_aux n d <span class="bound">i</span> <span class="keyword1">choose</span> Suc <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_mono<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="quoted">nat</span>
      <span class="keyword1"><span class="command">note</span></span> *
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">j</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">..</span>n <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">&lt;</span> n›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> n"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cc <span class="skolem">i</span> <span class="main">≤</span> Dube_aux n d <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> step.hyps<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cc <span class="skolem">i</span> <span class="keyword1">choose</span> Suc <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> Dube_aux n d <span class="skolem">i</span> <span class="keyword1">choose</span> Suc <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Binomial_Int.binomial_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> n <span class="main">-</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> step.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cc <span class="skolem">j</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>cc <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">..</span>n <span class="main">-</span> <span class="main">1</span><span class="main">.</span> cc <span class="bound">i</span> <span class="keyword1">choose</span> Suc <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cc_le<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> * 1 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> Dube_aux n d <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">=</span> n"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> n <span class="main">-</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Dube_aux n d <span class="skolem">j</span> <span class="main">=</span> d<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> d"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> cc_n_minus_2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> n"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> n <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Dube_aux n d <span class="skolem">j</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> d"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> cc_n_minus_1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Dube_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> punit.reduced_GB <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">g</span> <span class="main">≤</span> Dube_aux n d <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"n <span class="main">=</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">g</span> <span class="main">≤</span> bb <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> deg_RGB<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> max <span class="main">(</span>aa <span class="main">1</span><span class="main">)</span> <span class="main">(</span>bb <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> bb_0<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> cc <span class="main">(</span>n <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> d"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> cc_n_minus_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Dube_aux n d <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> n›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">&lt;</span> n"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> n"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">g</span> <span class="main">≤</span> bb <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> deg_RGB<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> max <span class="main">(</span>aa <span class="main">1</span><span class="main">)</span> <span class="main">(</span>bb <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> bb_0<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> cc <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">&lt;</span> n›</span></span> _ <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> n›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> Dube_aux n d <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cc_le_Dube_aux<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Dube<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> homogeneous <span class="bound">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> punit.reduced_GB <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">g</span> <span class="main">≤</span> Dube <span class="main">(</span>card <span class="free">X</span><span class="main">)</span> <span class="main">(</span>maxdeg <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="free">F</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> punit.reduced_GB_empty punit.reduced_GB_singleton<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">`</span> <span class="free">F</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> fin1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>poly_deg <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>poly_deg <span class="main">`</span> <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">`</span> <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"maxdeg <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> poly_deg <span class="main">`</span> <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maxdeg_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Max_in<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> md1<span class="main">:</span> <span class="quoted"><span class="quoted">"maxdeg <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> poly_deg <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"maxdeg <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">≤</span> maxdeg <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> maxdeg_def <span class="keyword1"><span class="command">using</span></span> image_mono * fin1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Max_mono<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">f</span> <span class="main">≤</span> maxdeg <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> f_max<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">f'</span> <span class="main">≤</span> poly_deg <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f'</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">f'</span> <span class="main">∈</span> poly_deg <span class="main">`</span> <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> fin <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">f'</span> <span class="main">≤</span> poly_deg <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> md1<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> maxdeg_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Max_ge<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"maxdeg <span class="free">F</span> <span class="main">≤</span> poly_deg <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maxdeg_def <span class="keyword1"><span class="command">using</span></span> fin1 <span class="quoted"><span class="quoted">‹poly_deg <span class="main">`</span> <span class="free">F</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Max.boundedI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> poly_deg <span class="main">`</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> poly_deg <span class="skolem">f'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">f'</span> <span class="main">≤</span> poly_deg <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> f_max<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≤</span> poly_deg <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹poly_deg <span class="skolem">f</span> <span class="main">≤</span> maxdeg <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> md<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">f</span> <span class="main">=</span> maxdeg <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"ideal <span class="main">{</span><span class="skolem">f</span><span class="main">}</span> <span class="main">=</span> ideal <span class="free">F</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.reduced_GB <span class="free">F</span> <span class="main">=</span> punit.reduced_GB <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> punit.finite_reduced_GB_finite punit.reduced_GB_is_reduced_GB_finite
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.reduced_GB_unique<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.reduced_GB_pmdl_finite<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span> True<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">{</span>punit.monic <span class="skolem">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.reduced_GB_singleton<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="main">{</span>punit.monic <span class="skolem">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">g</span> <span class="main">=</span> poly_deg <span class="main">(</span>punit.monic <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> poly_deg_monom_mult_le<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> lcf <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> p<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> poly_deg <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.monic_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> maxdeg <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> md<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> Dube <span class="main">(</span>card <span class="free">X</span><span class="main">)</span> <span class="main">(</span>maxdeg <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> Dube_ge_d<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly_deg <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>lookup <span class="skolem">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_deg_zero_imp_monomial<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> lookup <span class="skolem">f</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> monomial <span class="skolem">c</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monomial_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_base<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">0</span> <span class="skolem">f</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.pmdl_closed_monom_mult<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">=</span> UNIV"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f punit.monom_mult_monomial ideal_eq_UNIV_iff_contains_one<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.reduced_GB <span class="free">F</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ideal_eq_UNIV_iff_reduced_GB_eq_one_finite<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> poly_deg <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∨</span> <span class="main">1</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword1"><span class="command">note</span></span> fin_X
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_base<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">g</span> <span class="main">≤</span> poly_deg <span class="skolem">f</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> deg_reduced_GB_univariate_le<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> Dube <span class="main">(</span>card <span class="free">X</span><span class="main">)</span> <span class="main">(</span>maxdeg <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> md <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> Dube_ge_d<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">g</span> <span class="main">≤</span> Dube_aux <span class="main">(</span>card <span class="free">X</span><span class="main">)</span> <span class="main">(</span>poly_deg <span class="skolem">f</span><span class="main">)</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> f_max <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> poly_deg <span class="skolem">f</span>›</span></span> <span class="quoted"><span class="quoted">‹ideal <span class="main">{</span><span class="skolem">f</span><span class="main">}</span> <span class="main">≠</span> ideal <span class="free">F</span>›</span></span> assms<span class="main">(</span>4<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Dube_aux<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> card <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> poly_deg <span class="skolem">f</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Dube <span class="main">(</span>card <span class="free">X</span><span class="main">)</span> <span class="main">(</span>maxdeg <span class="free">F</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dube_def md<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Dube_is_hom_GB_bound<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">⟹</span> is_hom_GB_bound <span class="free">F</span> <span class="main">(</span>Dube <span class="main">(</span>card <span class="free">X</span><span class="main">)</span> <span class="main">(</span>maxdeg <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> is_hom_GB_boundI Dube<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Dube_indets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> homogeneous <span class="bound">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> punit.reduced_GB <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_deg <span class="free">g</span> <span class="main">≤</span> Dube <span class="main">(</span>card <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>maxdeg <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> _ assms<span class="main">(</span>1<span class="main">)</span> _ assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Dube<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_indets<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Polys_alt<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Dube_is_hom_GB_bound_indets<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">F</span> <span class="main">⟹</span> is_hom_GB_bound <span class="free">F</span> <span class="main">(</span>Dube <span class="main">(</span>card <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>maxdeg <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> is_hom_GB_boundI Dube_indets<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* pm_powerprod *)</span>

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> pm_powerprod.𝖺 pm_powerprod.𝖻

<span class="keyword1"><span class="command">context</span></span> extended_ord_pm_powerprod
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Dube_is_GB_cofactor_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_GB_cofactor_bound <span class="free">F</span> <span class="main">(</span>Dube <span class="main">(</span>Suc <span class="main">(</span>card <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>maxdeg <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> hom_GB_bound_is_GB_cofactor_bound<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"homogenize None <span class="main">`</span> extend_indets <span class="main">`</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insert None <span class="main">(</span>Some <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="var">?X</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="var">?F</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">=</span> homogenize None <span class="main">(</span>extend_indets <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"extend_indets <span class="skolem">f</span> <span class="main">∈</span> <span class="keyword1">P[</span>Some <span class="main">`</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Polys_alt indets_extend_indets<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="var">?X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> homogenize_in_Polys<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"extended_ord.is_hom_GB_bound <span class="var">?F</span> <span class="main">(</span>Dube <span class="main">(</span>card <span class="var">?X</span><span class="main">)</span> <span class="main">(</span>maxdeg <span class="var">?F</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> extended_ord.Dube_is_hom_GB_bound<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"maxdeg <span class="var">?F</span> <span class="main">=</span> maxdeg <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"maxdeg <span class="var">?F</span> <span class="main">=</span> maxdeg <span class="main">(</span>extend_indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indets_extend_indets <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> maxdeg_homogenize<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> maxdeg <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> maxdeg_def image_image<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"maxdeg <span class="var">?F</span> <span class="main">=</span> maxdeg <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?X</span> <span class="main">=</span> card <span class="free">X</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_image<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"extended_ord.is_hom_GB_bound <span class="var">?F</span> <span class="main">(</span>Dube <span class="main">(</span>Suc <span class="main">(</span>card <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>maxdeg <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Dube_is_GB_cofactor_bound_explicit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">G</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">G</span> <span class="main">=</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="bound">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span>
                            <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∧</span> poly_deg <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> Dube <span class="main">(</span>Suc <span class="main">(</span>card <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>maxdeg <span class="free">F</span><span class="main">)</span> <span class="main">∧</span>
                              <span class="main">(</span><span class="bound">f</span> <span class="main">∉</span> <span class="free">F</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_GB_cofactor_bound <span class="free">F</span> <span class="main">(</span>Dube <span class="main">(</span>Suc <span class="main">(</span>card <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>maxdeg <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"is_GB_cofactor_bound <span class="main">_</span> <span class="var">?b</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Dube_is_GB_cofactor_bound<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal <span class="skolem">G</span> <span class="main">=</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="skolem">G</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">F'</span> <span class="bound">q</span><span class="main">.</span> finite <span class="bound">F'</span> <span class="main">∧</span> <span class="bound">F'</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> <span class="bound">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="bound">F'</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span>
                              <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∧</span> poly_deg <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?b</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∉</span> <span class="bound">F'</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_GB_cofactor_boundE_Polys<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1-3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">F'</span> <span class="bound">q</span><span class="main">.</span> finite <span class="bound">F'</span> <span class="main">∧</span> <span class="bound">F'</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="bound">F'</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span>
                              <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∧</span> poly_deg <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?b</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∉</span> <span class="bound">F'</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F'</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F'</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">F'</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> poly_deg <span class="main">(</span><span class="skolem">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∉</span> <span class="skolem">F'</span> <span class="main">⟹</span> <span class="skolem">q</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">∧</span> poly_deg <span class="main">(</span><span class="bound">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?b</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∉</span> <span class="free">F</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI allI conjI impI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">F'</span> <span class="main">⊆</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">F'</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_left ballI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">-</span> <span class="skolem">F'</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∉</span> <span class="skolem">F'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">f</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f</span> <span class="main">*</span> <span class="bound">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> g<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∉</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F'</span> <span class="main">⊆</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∉</span> <span class="skolem">F'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Dube_is_GB_cofactor_bound_indets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_GB_cofactor_bound <span class="free">F</span> <span class="main">(</span>Dube <span class="main">(</span>Suc <span class="main">(</span>card <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>maxdeg <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> _ assms _
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Dube_is_GB_cofactor_bound<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_indets<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Polys_alt<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* extended_ord_pm_powerprod *)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* theory *)</span>
</pre>
</div><div id="Groebner_Macaulay_Examples">
<div class="head">
<h1>Theory Groebner_Macaulay_Examples</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Alexander Maletzky *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Sample Computations of Gr\"obner Bases via Macaulay Matrices›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Groebner_Macaulay_Examples
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="Groebner_Macaulay.html">Groebner_Macaulay</a>
    <a href="Dube_Bound.html">Dube_Bound</a>
    <a href="../Groebner_Bases/Benchmarks.html">Groebner_Bases.Benchmarks</a>
    <a href="../Jordan_Normal_Form/Gauss_Jordan_IArray_Impl.html">Jordan_Normal_Form.Gauss_Jordan_IArray_Impl</a>
    <a href="../Groebner_Bases/Code_Target_Rat.html">Groebner_Bases.Code_Target_Rat</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Combining <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">theory</span></span> <a href="Groebner_Macaulay.html"></a><a href="Groebner_Macaulay.html">Groebner_Macaulay.Groebner_Macaulay</a><span class="antiquote"><span class="antiquote">}</span></span></span></span> and
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">theory</span></span> <a href="Dube_Bound.html"></a><a href="Dube_Bound.html">Groebner_Macaulay.Dube_Bound</a><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">context</span></span> extended_ord_pm_powerprod
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">theorem</span></span> thm_2_3_6_Dube<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">fs</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="main">(</span>set <span class="main">(</span>punit.Macaulay_list
                                        <span class="main">(</span>deg_shifts <span class="free">X</span> <span class="main">(</span>Dube <span class="main">(</span>Suc <span class="main">(</span>card <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>maxdeg <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Dube_is_GB_cofactor_bound <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> thm_2_3_6<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> thm_2_3_7_Dube<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">fs</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span> <span class="main">⟷</span>
          <span class="main">1</span> <span class="main">∈</span> set <span class="main">(</span>punit.Macaulay_list <span class="main">(</span>deg_shifts <span class="free">X</span> <span class="main">(</span>Dube <span class="main">(</span>Suc <span class="main">(</span>card <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>maxdeg <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Dube_is_GB_cofactor_bound <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> thm_2_3_7<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> thm_2_3_6_indets_Dube<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">fs</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≡</span> <span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> set <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="main">(</span>set <span class="main">(</span>punit.Macaulay_list
                                        <span class="main">(</span>deg_shifts <span class="free">X</span> <span class="main">(</span>Dube <span class="main">(</span>Suc <span class="main">(</span>card <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>maxdeg <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> X_def <span class="keyword1"><span class="command">using</span></span> Dube_is_GB_cofactor_bound_indets <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> thm_2_3_6_indets<span class="main">)</span> <span class="main">(</span><span class="operator">fact</span> finite_set<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> thm_2_3_7_indets_Dube<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">fs</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≡</span> <span class="main">⋃</span><span class="main">(</span>indets <span class="main">`</span> set <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span> <span class="main">⟷</span>
          <span class="main">1</span> <span class="main">∈</span> set <span class="main">(</span>punit.Macaulay_list <span class="main">(</span>deg_shifts <span class="free">X</span> <span class="main">(</span>Dube <span class="main">(</span>Suc <span class="main">(</span>card <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>maxdeg <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> X_def <span class="keyword1"><span class="command">using</span></span> Dube_is_GB_cofactor_bound_indets <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> thm_2_3_7_indets<span class="main">)</span> <span class="main">(</span><span class="operator">fact</span> finite_set<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* extended_ord_pm_powerprod *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Preparations›</span></span>

<span class="comment1">(* This is exactly the same as in "Groebner_Bases.F4_Examples". Pull out into common ancestor? *)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">remdups_wrt_rev</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'b</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">remdups_wrt_rev</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">remdups_wrt_rev</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">fx</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">in</span> <span class="keyword1">if</span> List.member <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="bound">fx</span> <span class="keyword1">then</span> <span class="free">remdups_wrt_rev</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="main">(</span><span class="free">remdups_wrt_rev</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="bound">fx</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> remdups_wrt_rev_notin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="free">vs</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">f</span> <span class="main">`</span> set <span class="main">(</span>remdups_wrt_rev <span class="free">f</span> <span class="free">xs</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">vs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> <span class="free">f</span> <span class="main">`</span> set <span class="main">(</span>remdups_wrt_rev <span class="free">f</span> <span class="skolem">xs</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> <span class="free">f</span> <span class="main">`</span> set <span class="main">(</span>remdups_wrt_rev <span class="free">f</span> <span class="skolem">xs</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def 1 2 List.member_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> distinct_remdups_wrt_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>remdups_wrt_rev <span class="free">f</span> <span class="free">xs</span> <span class="free">vs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">vs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def Cons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> remdups_wrt_rev_notin<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_of_remdups_wrt_rev'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_of <span class="main">(</span>remdups_wrt_rev fst <span class="free">xs</span> <span class="free">vs</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> map_of <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> fst <span class="bound">x</span> <span class="main">∉</span> set <span class="free">vs</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">vs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def List.member_def Cons<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> fst <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map_of <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> fst <span class="bound">y</span> <span class="main">≠</span> fst <span class="skolem">x</span> <span class="main">∧</span> fst <span class="bound">y</span> <span class="main">∉</span> set <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span>
          map_of <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> fst <span class="bound">y</span> <span class="main">≠</span> fst <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> fst <span class="bound">y</span> <span class="main">∉</span> set <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> filter_filter conj_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> map_of <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> fst <span class="bound">y</span> <span class="main">∉</span> set <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">|`</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≠</span> fst <span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> map_of_filter<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map_of <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> fst <span class="bound">y</span> <span class="main">≠</span> fst <span class="skolem">x</span> <span class="main">∧</span> fst <span class="bound">y</span> <span class="main">∉</span> set <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span>
                  map_of <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> fst <span class="bound">y</span> <span class="main">∉</span> set <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_map_def <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≠</span> fst <span class="skolem">x</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> map_of_remdups_wrt_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"map_of <span class="main">(</span>remdups_wrt_rev fst <span class="free">xs</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> map_of <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_of_remdups_wrt_rev'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> term_powerprod<span class="main">)</span> compute_list_to_poly <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"list_to_poly <span class="free">ts</span> <span class="free">cs</span> <span class="main">=</span> distr<span class="hidden">⇩</span><sub>0</sub> DRLEX <span class="main">(</span>remdups_wrt_rev fst <span class="main">(</span>zip <span class="free">ts</span> <span class="free">cs</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_mapping_eqI<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_list_to_poly list_to_fun_def distr<span class="hidden">⇩</span><sub>0</sub>_def oalist_of_list_ntm_def
        oa_ntm.lookup_oalist_of_list distinct_remdups_wrt_rev lookup_dflt_def map_of_remdups_wrt_rev<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ordered_term<span class="main">)</span> compute_Macaulay_list <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Macaulay_list <span class="free">ps</span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ts</span> <span class="main">=</span> Keys_to_list <span class="free">ps</span> <span class="keyword1">in</span>
      filter <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>mat_to_polys <span class="bound">ts</span> <span class="main">(</span>row_echelon <span class="main">(</span>polys_to_mat <span class="bound">ts</span> <span class="free">ps</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
     <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Macaulay_list_def Macaulay_mat_def Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> conversep_iff <span class="main">[</span><span class="operator">code</span><span class="main">]</span>

<span class="keyword1"><span class="command">derive</span></span> <span class="main">(</span>eq<span class="main">)</span> ceq <span class="quoted">poly_mapping</span>
<span class="keyword1"><span class="command">derive</span></span> <span class="main">(</span>no<span class="main">)</span> ccompare <span class="quoted">poly_mapping</span>
<span class="keyword1"><span class="command">derive</span></span> <span class="main">(</span>dlist<span class="main">)</span> set_impl <span class="quoted">poly_mapping</span>
<span class="keyword1"><span class="command">derive</span></span> <span class="main">(</span>no<span class="main">)</span> cenum <span class="quoted">poly_mapping</span>

<span class="keyword1"><span class="command">derive</span></span> <span class="main">(</span>eq<span class="main">)</span> ceq <span class="quoted">rat</span>
<span class="keyword1"><span class="command">derive</span></span> <span class="main">(</span>no<span class="main">)</span> ccompare <span class="quoted">rat</span>
<span class="keyword1"><span class="command">derive</span></span> <span class="main">(</span>dlist<span class="main">)</span> set_impl <span class="quoted">rat</span>
<span class="keyword1"><span class="command">derive</span></span> <span class="main">(</span>no<span class="main">)</span> cenum <span class="quoted">rat</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Connection between <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="tfree"><span class="tfree">'x</span></span> <span class="main"><span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="tfree"><span class="tfree">'a</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="tfree"><span class="tfree">'b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="tfree"><span class="tfree">'x</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'a</span></span><span class="main"><span class="main">)</span></span> pp <span class="main"><span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="tfree"><span class="tfree">'b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="comment1">(* Move into "Polynomials.PP_Type"? *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">keys_pp_to_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'x</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>zero<span class="main">)</span> pp <span class="main">⇒</span> <span class="tfree">'x</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">keys_pp_to_list</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> sorted_list_of_set <span class="main">(</span>keys_pp <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inj_PP<span class="main">:</span> <span class="quoted"><span class="quoted">"inj PP"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PP_inject inj_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inj_mapping_of<span class="main">:</span> <span class="quoted"><span class="quoted">"inj mapping_of"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mapping_of_inject inj_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mapping_of_comp_PP <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mapping_of <span class="main">∘</span> PP <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PP <span class="main">∘</span> mapping_of <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_def PP_inverse mapping_of_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_key_PP_mapping_of <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Poly_Mapping.map_key PP <span class="main">(</span>Poly_Mapping.map_key mapping_of <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_key_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inj_PP inj_mapping_of<span class="main"><span class="main">]</span></span> comp_def PP_inverse map_key_id<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_key_mapping_of_PP <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Poly_Mapping.map_key mapping_of <span class="main">(</span>Poly_Mapping.map_key PP <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_key_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inj_mapping_of inj_PP<span class="main"><span class="main">]</span></span> comp_def mapping_of_inverse map_key_id<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> map_key_PP_plus <span class="main">=</span> map_key_plus<span class="main">[</span><span class="operator">OF</span> inj_PP<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> map_key_PP_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> map_key_zero<span class="main">[</span><span class="operator">OF</span> inj_PP<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> lookup_map_key_PP<span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>Poly_Mapping.map_key PP <span class="free">p</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> lookup <span class="free">p</span> <span class="main">(</span>PP <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_key.rep_eq inj_PP<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> keys_map_key_PP<span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>Poly_Mapping.map_key PP <span class="free">p</span><span class="main">)</span> <span class="main">=</span> mapping_of <span class="main">`</span> keys <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_map_key inj_PP<span class="main">)</span>
     <span class="main">(</span><span class="operator">smt</span> Collect_cong PP_inverse UNIV_I image_def pp.mapping_of_inverse vimage_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_key_PP_zero_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Poly_Mapping.map_key PP <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> map_key_PP_zero map_key_mapping_of_PP<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_key_PP_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Poly_Mapping.map_key PP <span class="main">(</span><span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> Poly_Mapping.map_key PP <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_mapping_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_map_key_PP<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_key_PP_minus<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Poly_Mapping.map_key PP <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> Poly_Mapping.map_key PP <span class="free">p</span> <span class="main">-</span> Poly_Mapping.map_key PP <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_mapping_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_map_key_PP lookup_minus<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_key_PP_monomial <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Poly_Mapping.map_key PP <span class="main">(</span>monomial <span class="free">c</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> monomial <span class="free">c</span> <span class="main">(</span>mapping_of <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Poly_Mapping.map_key PP <span class="main">(</span>monomial <span class="free">c</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> Poly_Mapping.map_key PP <span class="main">(</span>monomial <span class="free">c</span> <span class="main">(</span>PP <span class="main">(</span>mapping_of <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mapping_of_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> inj_PP <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> monomial <span class="free">c</span> <span class="main">(</span>mapping_of <span class="free">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> map_key_single<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_key_PP_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Poly_Mapping.map_key PP <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_pp.rep_eq <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> single_one<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_key_PP_monom_mult_punit<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Poly_Mapping.map_key PP <span class="main">(</span>monom_mult_punit <span class="free">c</span> <span class="free">t</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span>
    monom_mult_punit <span class="free">c</span> <span class="main">(</span>mapping_of <span class="free">t</span><span class="main">)</span> <span class="main">(</span>Poly_Mapping.map_key PP <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_mapping_eqI<span class="main">)</span>
     <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.lookup_monom_mult monom_mult_punit_def adds_pp_iff PP_inverse lookup_map_key_PP
          mapping_of_inverse <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> minus_pp.abs_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_key_PP_times<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Poly_Mapping.map_key PP <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span>
    Poly_Mapping.map_key PP <span class="free">p</span> <span class="main">*</span> Poly_Mapping.map_key PP <span class="main">(</span><span class="free">q</span><span class="main">::</span><span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">::</span>add_linorder<span class="main">)</span> pp <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> poly_mapping_plus_induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_right map_key_PP_plus times_monomial_left map_key_PP_monom_mult_punit
        <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> monom_mult_punit_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_key_PP_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"Poly_Mapping.map_key PP <span class="main">(</span>sum <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> Poly_Mapping.map_key PP <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_key_PP_plus<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_key_PP_ideal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Poly_Mapping.map_key PP <span class="main">`</span> ideal <span class="free">F</span> <span class="main">=</span> ideal <span class="main">(</span>Poly_Mapping.map_key PP <span class="main">`</span> <span class="main">(</span><span class="free">F</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">::</span>add_linorder<span class="main">)</span> pp <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">)</span> set<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> map_key_PP_mapping_of <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"surj <span class="main">(</span>Poly_Mapping.map_key PP<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> surjI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> map_key_PP_plus map_key_PP_times <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> image_ideal_eq_surj<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Locale <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pp_powerprod›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We have to introduce a new locale analogous to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">locale</span></span> pm_powerprod<span class="antiquote"><span class="antiquote">}</span></span></span></span>, but this time for
  power-products represented by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> pp<span class="antiquote"><span class="antiquote">}</span></span></span></span> rather than <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> poly_mapping<span class="antiquote"><span class="antiquote">}</span></span></span></span>. This apparently leads
  to some (more-or-less) duplicate definitions and lemmas, but seems to be the only feasible way to
  get both
  <span class="antiquoted"><span class="antiquoted">▪</span></span> the convenient representation by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> poly_mapping<span class="antiquote"><span class="antiquote">}</span></span></span></span> for theory development, and
  <span class="antiquoted"><span class="antiquoted">▪</span></span> the executable representation by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> pp<span class="antiquote"><span class="antiquote">}</span></span></span></span> for code generation.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> pp_powerprod <span class="main">=</span>
  ordered_powerprod <span class="quoted"><span class="free">ord</span></span> <span class="quoted"><span class="free">ord_strict</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">ord</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'x</span><span class="main">::</span><span class="main">{</span>countable<span class="main">,</span>linorder<span class="main">}</span><span class="main">,</span> nat<span class="main">)</span> pp <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'x</span><span class="main">,</span> nat<span class="main">)</span> pp <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ord_strict</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> gd_powerprod <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> pp_pm<span class="main">:</span> extended_ord_pm_powerprod <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="free">ord</span> <span class="main">(</span>PP <span class="bound">s</span><span class="main">)</span> <span class="main">(</span>PP <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="free">ord_strict</span> <span class="main">(</span>PP <span class="bound">s</span><span class="main">)</span> <span class="main">(</span>PP <span class="bound">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_min plus_monotone <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> zero_pp_def plus_pp.abs_eq PP_inject<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly_deg_pp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'x</span><span class="main">,</span> nat<span class="main">)</span> pp <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>zero<span class="main">)</span> <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">poly_deg_pp</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> max_list <span class="main">(</span>map deg_pp <span class="main">(</span>punit.keys_to_list <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">deg_le_sect_pp_aux</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> list <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'x</span><span class="main">,</span> nat<span class="main">)</span> pp <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deg_le_sect_pp_aux</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">deg_le_sect_pp_aux</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">p</span> <span class="main">=</span> <span class="free">deg_le_sect_pp_aux</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">in</span> <span class="bound">p</span> <span class="main">+</span> foldr <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(+)</span> <span class="main">(</span>monom_mult_punit <span class="main">1</span> <span class="main">(</span>single_pp <span class="bound">x</span> <span class="main">1</span><span class="main">)</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">deg_le_sect_pp</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> list <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'x</span><span class="main">,</span> nat<span class="main">)</span> pp list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">deg_le_sect_pp</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">=</span> punit.keys_to_list <span class="main">(</span>deg_le_sect_pp_aux <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">deg_shifts_pp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> list <span class="main">⇒</span> nat <span class="main">⇒</span>
                                <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span><span class="main">,</span> nat<span class="main">)</span> pp <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span><span class="main">,</span> nat<span class="main">)</span> pp <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">::</span>semiring_1<span class="main">)</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">deg_shifts_pp</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">=</span> concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> monom_mult_punit <span class="main">1</span> <span class="bound">t</span> <span class="bound">f</span><span class="main">)</span>
                                          <span class="main">(</span>deg_le_sect_pp <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">-</span> poly_deg_pp <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">indets_pp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'x</span><span class="main">,</span> nat<span class="main">)</span> pp <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">::</span>zero<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'x</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">indets_pp</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> remdups <span class="main">(</span>concat <span class="main">(</span>map keys_pp_to_list <span class="main">(</span>punit.keys_to_list <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Indets_pp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'x</span><span class="main">,</span> nat<span class="main">)</span> pp <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">::</span>zero<span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'x</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Indets_pp</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">=</span> remdups <span class="main">(</span>concat <span class="main">(</span>map indets_pp <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_PP_insort<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map PP <span class="main">(</span>pp_pm.ordered_powerprod_lin.insort <span class="free">x</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> ordered_powerprod_lin.insort <span class="main">(</span>PP <span class="free">x</span><span class="main">)</span> <span class="main">(</span>map PP <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> map_PP_sorted_list_of_set<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map PP <span class="main">(</span>pp_pm.ordered_powerprod_lin.sorted_list_of_set <span class="free">T</span><span class="main">)</span> <span class="main">=</span>
    ordered_powerprod_lin.sorted_list_of_set <span class="main">(</span>PP <span class="main">`</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">T</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>infinite <span class="skolem">T</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> inj_PP subset_UNIV <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on PP <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_on_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_PP finite_image_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> insert<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"PP <span class="skolem">t</span> <span class="main">∉</span> PP <span class="main">`</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PP_inject image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_PP_insort<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_PP_pps_to_list<span class="main">:</span> <span class="quoted"><span class="quoted">"map PP <span class="main">(</span>pp_pm.punit.pps_to_list <span class="free">T</span><span class="main">)</span> <span class="main">=</span> punit.pps_to_list <span class="main">(</span>PP <span class="main">`</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_pm.punit.pps_to_list_def punit.pps_to_list_def map_PP_sorted_list_of_set <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> rev_map<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_mapping_of_pps_to_list<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map mapping_of <span class="main">(</span>punit.pps_to_list <span class="free">T</span><span class="main">)</span> <span class="main">=</span> pp_pm.punit.pps_to_list <span class="main">(</span>mapping_of <span class="main">`</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map mapping_of <span class="main">(</span>punit.pps_to_list <span class="free">T</span><span class="main">)</span> <span class="main">=</span> map mapping_of <span class="main">(</span>punit.pps_to_list <span class="main">(</span>PP <span class="main">`</span> mapping_of <span class="main">`</span> <span class="free">T</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> map mapping_of <span class="main">(</span>map PP <span class="main">(</span>pp_pm.punit.pps_to_list <span class="main">(</span>mapping_of <span class="main">`</span> <span class="free">T</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> map_PP_pps_to_list<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> pp_pm.punit.pps_to_list <span class="main">(</span>mapping_of <span class="main">`</span> <span class="free">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> keys_to_list_map_key_PP<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pp_pm.punit.keys_to_list <span class="main">(</span>Poly_Mapping.map_key PP <span class="free">p</span><span class="main">)</span> <span class="main">=</span> map mapping_of <span class="main">(</span>punit.keys_to_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_pm.punit.keys_to_list_def punit.keys_to_list_def keys_map_key_PP map_mapping_of_pps_to_list<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Keys_to_list_map_key_PP<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pp_pm.punit.Keys_to_list <span class="main">(</span>map <span class="main">(</span>Poly_Mapping.map_key PP<span class="main">)</span> <span class="free">fs</span><span class="main">)</span> <span class="main">=</span> map mapping_of <span class="main">(</span>punit.Keys_to_list <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.Keys_to_list_eq_pps_to_list pp_pm.punit.Keys_to_list_eq_pps_to_list
          map_mapping_of_pps_to_list Keys_def image_UN keys_map_key_PP<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_deg_map_key_PP<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_deg <span class="main">(</span>Poly_Mapping.map_key PP <span class="free">p</span><span class="main">)</span> <span class="main">=</span> poly_deg_pp <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"map deg_pp <span class="main">(</span>punit.keys_to_list <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.keys_to_list_def punit.pps_to_list_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>deg_pp <span class="main">`</span> keys <span class="free">p</span><span class="main">)</span> <span class="main">=</span> max_list <span class="main">(</span>map deg_pp <span class="main">(</span>punit.keys_to_list <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_list_Max punit.set_keys_to_list<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_deg_def poly_deg_pp_def keys_map_key_PP image_image <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> deg_pp.rep_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> deg_le_sect_pp_aux_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> keys <span class="main">(</span>deg_le_sect_pp_aux <span class="free">xs</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"deg_pp <span class="free">t</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"keys_pp <span class="free">t</span> <span class="main">⊆</span> set <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deg_pp <span class="free">t</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> keys_pp <span class="free">t</span> <span class="main">⊆</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_pp.rep_eq zero_pp.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> set <span class="free">xs</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> deg_le_sect_pp_aux <span class="free">xs</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> keys <span class="skolem">q</span> <span class="main">⟹</span> deg_pp <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">∧</span> keys_pp <span class="skolem">s</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span> <span class="keyword1"><span class="command">unfolding</span></span> q_def X_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> Suc.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> Suc.prems
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>deg_le_sect_pp_aux <span class="free">xs</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> keys <span class="skolem">q</span> <span class="main">∪</span>
                    keys <span class="main">(</span>foldr <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(+)</span> <span class="main">(</span>monom_mult_punit <span class="main">1</span> <span class="main">(</span>single_pp <span class="bound">x</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⊆</span> <span class="main">_</span> <span class="main">∪</span> keys <span class="main">(</span>foldr <span class="var">?r</span> <span class="free">xs</span> <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def Poly_Mapping.keys_add <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> q_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"deg_pp <span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">∧</span> keys_pp <span class="skolem">t</span> <span class="main">⊆</span> set <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>foldr <span class="var">?r</span> <span class="free">xs</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> X_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deg_pp <span class="skolem">t</span> <span class="main">≤</span> Suc <span class="skolem">n</span> <span class="main">∧</span> keys_pp <span class="skolem">t</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">xs</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">note</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>foldr <span class="var">?r</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">⊆</span> keys <span class="main">(</span><span class="var">?r</span> <span class="skolem">x</span> <span class="main">0</span><span class="main">)</span> <span class="main">∪</span> keys <span class="main">(</span>foldr <span class="var">?r</span> <span class="skolem">xs</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Poly_Mapping.keys_add<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span><span class="var">?r</span> <span class="skolem">x</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(+)</span> <span class="main">(</span>single_pp <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> keys <span class="skolem">q</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_mult_punit_def punit.keys_monom_mult<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> keys <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> single_pp <span class="skolem">x</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deg_pp <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">∧</span> keys_pp <span class="skolem">s</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t deg_pp_plus deg_pp_single keys_pp.rep_eq plus_pp.rep_eq
                keys_plus_ninv_comm_monoid_add single_pp.rep_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>foldr <span class="var">?r</span> <span class="skolem">xs</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"deg_pp <span class="skolem">t</span> <span class="main">≤</span> Suc <span class="skolem">n</span> <span class="main">∧</span> keys_pp <span class="skolem">t</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">xs</span> <span class="main">⊆</span> <span class="skolem">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.hyps<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> X_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"deg_pp <span class="free">t</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"keys_pp <span class="free">t</span> <span class="main">⊆</span> set <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> deg_le_sect_pp_aux_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"deg_pp <span class="free">t</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"keys_pp <span class="free">t</span> <span class="main">⊆</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> keys <span class="main">(</span>deg_le_sect_pp_aux <span class="free">xs</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> foldr<span class="main">:</span> <span class="quoted"><span class="quoted">"foldr <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(+)</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ys</span> <span class="main">0</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> foldr <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(+)</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ys</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="skolem">ys</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'z</span><span class="main">::</span>monoid_add"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> deg_le_sect_pp_aux <span class="free">xs</span> <span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> Suc.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deg_pp <span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">∨</span> deg_pp <span class="skolem">t</span> <span class="main">=</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"deg_pp <span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> lookup <span class="skolem">q</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> lookup <span class="main">(</span>deg_le_sect_pp_aux <span class="free">xs</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def lookup_add <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> q_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"deg_pp <span class="skolem">t</span> <span class="main">=</span> Suc <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"keys_pp <span class="skolem">t</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_pp.rep_eq deg_pp.rep_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> keys_pp <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> Suc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs1</span></span> <span class="skolem"><span class="skolem">xs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="skolem">xs1</span> <span class="main">@</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> split_list<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">-</span> single_pp <span class="skolem">x</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> keys_pp <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"single_pp <span class="skolem">x</span> <span class="main">1</span> <span class="keyword1">adds</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adds_pp_iff single_pp.rep_eq keys_pp.rep_eq adds_poly_mapping le_fun_def
          lookup_single when_def in_keys_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">+</span> single_pp <span class="skolem">x</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> single_pp <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> single_pp <span class="skolem">x</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> s_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> minus_plus<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> single_pp <span class="skolem">x</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deg_pp <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_pp_plus deg_pp_single<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys_pp <span class="skolem">s</span> <span class="main">⊆</span> set <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Suc.prems<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">xs</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"keys_pp <span class="skolem">t</span> <span class="main">∪</span> keys_pp <span class="main">(</span>single_pp <span class="skolem">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">xs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_pp.rep_eq single_pp.rep_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_def keys_pp.rep_eq minus_pp.rep_eq keys_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> keys <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>monom_mult_punit <span class="main">1</span> <span class="main">(</span>single_pp <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_mult_punit_def punit.keys_monom_mult t<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> lookup <span class="main">(</span>monom_mult_punit <span class="main">1</span> <span class="main">(</span>single_pp <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> lookup <span class="main">(</span><span class="skolem">q</span> <span class="main">+</span> <span class="main">(</span>foldr <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(+)</span> <span class="main">(</span>monom_mult_punit <span class="main">1</span> <span class="main">(</span>single_pp <span class="bound">x</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="skolem">xs1</span> <span class="main">0</span> <span class="main">+</span>
                      <span class="main">(</span>monom_mult_punit <span class="main">1</span> <span class="main">(</span>single_pp <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">+</span>
                        foldr <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(+)</span> <span class="main">(</span>monom_mult_punit <span class="main">1</span> <span class="main">(</span>single_pp <span class="bound">x</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="skolem">xs2</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_add<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> lookup <span class="main">(</span>deg_le_sect_pp_aux <span class="free">xs</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def foldr <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> q_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xs<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> keys_deg_le_sect_pp_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"keys <span class="main">(</span>deg_le_sect_pp_aux <span class="free">xs</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> deg_pp <span class="bound">t</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> keys_pp <span class="bound">t</span> <span class="main">⊆</span> set <span class="free">xs</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> deg_le_sect_pp_aux_1 deg_le_sect_pp_aux_2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deg_le_sect_deg_le_sect_pp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map PP <span class="main">(</span>pp_pm.punit.pps_to_list <span class="main">(</span>deg_le_sect <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> deg_le_sect_pp <span class="free">xs</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"PP <span class="main">`</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> deg_pm <span class="bound">t</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">∧</span> keys <span class="bound">t</span> <span class="main">⊆</span> set <span class="free">xs</span><span class="main">}</span> <span class="main">=</span> PP <span class="main">`</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> deg_pp <span class="main">(</span>PP <span class="bound">t</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">∧</span> keys_pp <span class="main">(</span>PP <span class="bound">t</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">xs</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> keys_pp.abs_eq deg_pp.abs_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> deg_pp <span class="bound">t</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">∧</span> keys_pp <span class="bound">t</span> <span class="main">⊆</span> set <span class="free">xs</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> subset_antisym subsetI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> deg_pp <span class="bound">t</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">∧</span> keys_pp <span class="bound">t</span> <span class="main">⊆</span> set <span class="free">xs</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> PP <span class="main">(</span>mapping_of <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mapping_of_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> PP <span class="main">`</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> deg_pp <span class="main">(</span>PP <span class="bound">t</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">∧</span> keys_pp <span class="main">(</span>PP <span class="bound">t</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">xs</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_le_sect_pp_def punit.keys_to_list_def keys_deg_le_sect_pp_aux deg_le_sect_alt
      PPs_def conj_commute map_PP_pps_to_list <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> Collect_conj_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> deg_shifts_deg_shifts_pp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pp_pm.deg_shifts <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="free">d</span> <span class="main">(</span>map <span class="main">(</span>Poly_Mapping.map_key PP<span class="main">)</span> <span class="free">fs</span><span class="main">)</span> <span class="main">=</span>
        map <span class="main">(</span>Poly_Mapping.map_key PP<span class="main">)</span> <span class="main">(</span>deg_shifts_pp <span class="free">xs</span> <span class="free">d</span> <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_pm.deg_shifts_def deg_shifts_pp_def map_concat comp_def poly_deg_map_key_PP
         map_key_PP_monom_mult_punit PP_inverse <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> deg_le_sect_deg_le_sect_pp monom_mult_punit_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ideal_deg_shifts_pp<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>set <span class="main">(</span>deg_shifts_pp <span class="free">xs</span> <span class="free">d</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>set <span class="main">(</span>deg_shifts_pp <span class="free">xs</span> <span class="free">d</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        Poly_Mapping.map_key mapping_of <span class="main">`</span> Poly_Mapping.map_key PP <span class="main">`</span> ideal <span class="main">(</span>set <span class="main">(</span>deg_shifts_pp <span class="free">xs</span> <span class="free">d</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Poly_Mapping.map_key mapping_of <span class="main">`</span> ideal
                    <span class="main">(</span>set <span class="main">(</span>map <span class="main">(</span>Poly_Mapping.map_key PP<span class="main">)</span> <span class="main">(</span>deg_shifts_pp <span class="free">xs</span> <span class="free">d</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_key_PP_ideal<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Poly_Mapping.map_key mapping_of <span class="main">`</span> ideal <span class="main">(</span>Poly_Mapping.map_key PP <span class="main">`</span> set <span class="free">fs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> deg_shifts_deg_shifts_pp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Poly_Mapping.map_key mapping_of <span class="main">`</span> Poly_Mapping.map_key PP <span class="main">`</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> map_key_PP_ideal<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_indets_pp<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>indets_pp <span class="free">p</span><span class="main">)</span> <span class="main">=</span> indets <span class="main">(</span>Poly_Mapping.map_key PP <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> indets_pp_def indets_def keys_pp_to_list_def keys_pp.rep_eq punit.set_keys_to_list
        keys_map_key_PP<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_to_row_map_key_PP<span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly_to_row <span class="main">(</span>map pp.mapping_of <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>Poly_Mapping.map_key PP <span class="free">p</span><span class="main">)</span> <span class="main">=</span> poly_to_row <span class="free">xs</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_to_row_def comp_def lookup_map_key_PP mapping_of_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Macaulay_mat_map_key_PP<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pp_pm.punit.Macaulay_mat <span class="main">(</span>map <span class="main">(</span>Poly_Mapping.map_key PP<span class="main">)</span> <span class="free">fs</span><span class="main">)</span> <span class="main">=</span> punit.Macaulay_mat <span class="free">fs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.Macaulay_mat_def pp_pm.punit.Macaulay_mat_def Keys_to_list_map_key_PP
          polys_to_mat_def comp_def poly_to_row_map_key_PP<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> row_to_poly_mapping_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">ts</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">r</span> <span class="main">=</span> length <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row_to_poly <span class="main">(</span>map pp.mapping_of <span class="free">ts</span><span class="main">)</span> <span class="free">r</span> <span class="main">=</span> Poly_Mapping.map_key PP <span class="main">(</span>row_to_poly <span class="free">ts</span> <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_mapping_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lookup_map_key_PP<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ts</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map mapping_of <span class="free">ts</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> inj_mapping_of subset_UNIV <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on mapping_of <span class="main">(</span>set <span class="free">ts</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_on_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="var">?ts</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_map<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">r</span> <span class="main">=</span> length <span class="var">?ts</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>row_to_poly <span class="var">?ts</span> <span class="free">r</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> lookup <span class="main">(</span>row_to_poly <span class="free">ts</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span>PP <span class="skolem">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> set <span class="var">?ts</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="var">?ts</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="var">?ts</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> i2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ts</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t2<span class="main">:</span> <span class="quoted"><span class="quoted">"PP <span class="skolem">t</span> <span class="main">=</span> <span class="free">ts</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mapping_of_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>row_to_poly <span class="var">?ts</span> <span class="free">r</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> <span class="free">r</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> t1 <span class="keyword1"><span class="command">using</span></span> 1 2 i1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lookup_row_to_poly<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>row_to_poly <span class="free">ts</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span>PP <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> t2 <span class="keyword1"><span class="command">using</span></span> assms i2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lookup_row_to_poly<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"PP <span class="skolem">t</span> <span class="main">∉</span> set <span class="free">ts</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"PP <span class="skolem">t</span> <span class="main">∈</span> set <span class="free">ts</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"mapping_of <span class="main">(</span>PP <span class="skolem">t</span><span class="main">)</span> <span class="main">∈</span> mapping_of <span class="main">`</span> set <span class="free">ts</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PP_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> punit.keys_row_to_poly <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>row_to_poly <span class="free">ts</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span>PP <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_keys_iff in_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> False punit.keys_row_to_poly <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>row_to_poly <span class="var">?ts</span> <span class="free">r</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_keys_iff in_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mat_to_polys_mapping_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">ts</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">m</span> <span class="main">=</span> length <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_to_polys <span class="main">(</span>map pp.mapping_of <span class="free">ts</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> map <span class="main">(</span>Poly_Mapping.map_key PP<span class="main">)</span> <span class="main">(</span>mat_to_polys <span class="free">ts</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> set <span class="main">(</span>rows <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> row <span class="free">m</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rows_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="skolem">r</span> <span class="main">=</span> length <span class="free">ts</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row_to_poly <span class="main">(</span>map pp.mapping_of <span class="free">ts</span><span class="main">)</span> <span class="skolem">r</span> <span class="main">=</span> Poly_Mapping.map_key PP <span class="main">(</span>row_to_poly <span class="free">ts</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> row_to_poly_mapping_of<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_to_polys_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_key_PP_Macaulay_list<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map <span class="main">(</span>Poly_Mapping.map_key PP<span class="main">)</span> <span class="main">(</span>punit.Macaulay_list <span class="free">fs</span><span class="main">)</span> <span class="main">=</span>
      pp_pm.punit.Macaulay_list <span class="main">(</span>map <span class="main">(</span>Poly_Mapping.map_key PP<span class="main">)</span> <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.Macaulay_list_def pp_pm.punit.Macaulay_list_def Macaulay_mat_map_key_PP
          Keys_to_list_map_key_PP mat_to_polys_mapping_of filter_map comp_def
          punit.distinct_Keys_to_list punit.length_Keys_to_list<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lpp_map_key_PP<span class="main">:</span> <span class="quoted"><span class="quoted">"pp_pm.lpp <span class="main">(</span>Poly_Mapping.map_key PP <span class="free">p</span><span class="main">)</span> <span class="main">=</span> mapping_of <span class="main">(</span>lpp <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_pp.rep_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> pp_pm.punit.lt_eqI_keys<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pp.mapping_of <span class="main">(</span>lpp <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>Poly_Mapping.map_key PP <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> keys_map_key_PP
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> imageI punit.lt_in_keys False<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> keys <span class="main">(</span>Poly_Mapping.map_key PP <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> mapping_of <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> keys_map_key_PP <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">ord</span> <span class="main">(</span>PP <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span>PP <span class="main">(</span>pp.mapping_of <span class="main">(</span>lpp <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mapping_of_inverse punit.lt_max_keys<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_GB_map_key_PP<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">G</span> <span class="main">⟹</span> pp_pm.punit.is_Groebner_basis <span class="main">(</span>Poly_Mapping.map_key PP <span class="main">`</span> <span class="free">G</span><span class="main">)</span> <span class="main">⟷</span> punit.is_Groebner_basis <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.GB_alt_3_finite pp_pm.punit.GB_alt_3_finite lpp_map_key_PP adds_pp_iff
        <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> map_key_PP_ideal<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> thm_2_3_6_pp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pp_pm.is_GB_cofactor_bound <span class="main">(</span>Poly_Mapping.map_key PP <span class="main">`</span> set <span class="free">fs</span><span class="main">)</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="main">(</span>set <span class="main">(</span>punit.Macaulay_list <span class="main">(</span>deg_shifts_pp <span class="main">(</span>Indets_pp <span class="free">fs</span><span class="main">)</span> <span class="free">b</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>Poly_Mapping.map_key PP<span class="main">)</span> <span class="free">fs</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pp_pm.is_GB_cofactor_bound <span class="main">(</span>set <span class="var">?fs</span><span class="main">)</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pp_pm.punit.is_Groebner_basis
                <span class="main">(</span>set <span class="main">(</span>pp_pm.punit.Macaulay_list <span class="main">(</span>pp_pm.deg_shifts <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>indets <span class="main">`</span> set <span class="var">?fs</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span> <span class="var">?fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pp_pm.thm_2_3_6_indets<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>indets <span class="main">`</span> set <span class="var">?fs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>Indets_pp <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Indets_pp_def set_indets_pp<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_shifts_deg_shifts_pp map_key_PP_Macaulay_list <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> set_map is_GB_map_key_PP<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Dube_is_GB_cofactor_bound_pp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pp_pm.is_GB_cofactor_bound <span class="main">(</span>Poly_Mapping.map_key PP <span class="main">`</span> set <span class="free">fs</span><span class="main">)</span>
            <span class="main">(</span>Dube <span class="main">(</span>Suc <span class="main">(</span>length <span class="main">(</span>Indets_pp <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>max_list <span class="main">(</span>map poly_deg_pp <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">fs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pp_pm.is_GB_cofactor_boundI_subset_zero<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Poly_Mapping.map_key PP <span class="main">`</span> set <span class="free">fs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pp_pm.is_GB_cofactor_bound <span class="var">?F</span> <span class="main">(</span>Dube <span class="main">(</span>Suc <span class="main">(</span>card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>indets <span class="main">`</span> <span class="var">?F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>maxdeg <span class="var">?F</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> pp_pm.Dube_is_GB_cofactor_bound_indets finite_imageI finite_set<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>indets <span class="main">`</span> <span class="var">?F</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>Indets_pp <span class="free">fs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Indets_pp_def length_remdups_card_conv set_indets_pp<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"maxdeg <span class="var">?F</span> <span class="main">=</span> max_list <span class="main">(</span>map poly_deg_pp <span class="free">fs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_list_Max maxdeg_def image_image poly_deg_map_key_PP<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">GB_Macaulay_Dube</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'x</span><span class="main">,</span> nat<span class="main">)</span> pp <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span><span class="main">,</span> nat<span class="main">)</span> pp <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">GB_Macaulay_Dube</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">=</span> punit.Macaulay_list <span class="main">(</span>deg_shifts_pp <span class="main">(</span>Indets_pp <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span>
                            <span class="main">(</span>Dube <span class="main">(</span>Suc <span class="main">(</span>length <span class="main">(</span>Indets_pp <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>max_list <span class="main">(</span>map poly_deg_pp <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> GB_Macaulay_Dube_is_GB<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="main">(</span>set <span class="main">(</span>GB_Macaulay_Dube <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> GB_Macaulay_Dube_def <span class="keyword1"><span class="command">using</span></span> Dube_is_GB_cofactor_bound_pp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> thm_2_3_6_pp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ideal_GB_Macaulay_Dube<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>set <span class="main">(</span>GB_Macaulay_Dube <span class="free">fs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GB_Macaulay_Dube_def punit.pmdl_Macaulay_list<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span> ideal_deg_shifts_pp<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> punit'<span class="main">:</span> pp_powerprod <span class="quoted"><span class="quoted">"ord_pp_punit <span class="free">cmp_term</span>"</span></span> <span class="quoted"><span class="quoted">"ord_pp_strict_punit <span class="free">cmp_term</span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"punit.adds_term <span class="main">=</span> <span class="keyword1">(adds)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.pp_of_term <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.component_of_term <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">()</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.monom_mult <span class="main">=</span> monom_mult_punit"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.mult_scalar <span class="main">=</span> mult_scalar_punit"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit'.punit.min_term <span class="main">=</span> min_term_punit"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit'.punit.lt <span class="main">=</span> lt_punit <span class="free">cmp_term</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit'.punit.lc <span class="main">=</span> lc_punit <span class="free">cmp_term</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit'.punit.tail <span class="main">=</span> tail_punit <span class="free">cmp_term</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit'.punit.ord_p <span class="main">=</span> ord_p_punit <span class="free">cmp_term</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit'.punit.keys_to_list <span class="main">=</span> keys_to_list_punit <span class="free">cmp_term</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">cmp_term</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>nat<span class="main">,</span> nat<span class="main">)</span> pp nat_term_order"</span></span>

  <span class="keyword2"><span class="keyword">defines</span></span> max_punit <span class="main">=</span> <span class="quoted">punit'.ordered_powerprod_lin.max</span>
  <span class="keyword2"><span class="keyword">and</span></span> max_list_punit <span class="main">=</span> <span class="quoted">punit'.ordered_powerprod_lin.max_list</span>
  <span class="keyword2"><span class="keyword">and</span></span> Keys_to_list_punit <span class="main">=</span> <span class="quoted">punit'.punit.Keys_to_list</span>
  <span class="keyword2"><span class="keyword">and</span></span> Macaulay_mat_punit <span class="main">=</span> <span class="quoted">punit'.punit.Macaulay_mat</span>
  <span class="keyword2"><span class="keyword">and</span></span> Macaulay_list_punit <span class="main">=</span> <span class="quoted">punit'.punit.Macaulay_list</span>
  <span class="keyword2"><span class="keyword">and</span></span> poly_deg_pp_punit <span class="main">=</span> <span class="quoted">punit'.poly_deg_pp</span>
  <span class="keyword2"><span class="keyword">and</span></span> deg_le_sect_pp_aux_punit <span class="main">=</span> <span class="quoted">punit'.deg_le_sect_pp_aux</span>
  <span class="keyword2"><span class="keyword">and</span></span> deg_le_sect_pp_punit <span class="main">=</span> <span class="quoted">punit'.deg_le_sect_pp</span>
  <span class="keyword2"><span class="keyword">and</span></span> deg_shifts_pp_punit <span class="main">=</span> <span class="quoted">punit'.deg_shifts_pp</span>
  <span class="keyword2"><span class="keyword">and</span></span> indets_pp_punit <span class="main">=</span> <span class="quoted">punit'.indets_pp</span>
  <span class="keyword2"><span class="keyword">and</span></span> Indets_pp_punit <span class="main">=</span> <span class="quoted">punit'.Indets_pp</span>
  <span class="keyword2"><span class="keyword">and</span></span> GB_Macaulay_Dube_punit <span class="main">=</span> <span class="quoted">punit'.GB_Macaulay_Dube</span>

  <span class="comment1">(* Only needed for auto-reduction: *)</span>
  <span class="keyword2"><span class="keyword">and</span></span> find_adds_punit <span class="main">=</span> <span class="quoted">punit'.punit.find_adds</span>
  <span class="keyword2"><span class="keyword">and</span></span> trd_aux_punit <span class="main">=</span> <span class="quoted">punit'.punit.trd_aux</span>
  <span class="keyword2"><span class="keyword">and</span></span> trd_punit <span class="main">=</span> <span class="quoted">punit'.punit.trd</span>
  <span class="keyword2"><span class="keyword">and</span></span> comp_min_basis_punit <span class="main">=</span> <span class="quoted">punit'.punit.comp_min_basis</span>
  <span class="keyword2"><span class="keyword">and</span></span> comp_red_basis_aux_punit <span class="main">=</span> <span class="quoted">punit'.punit.comp_red_basis_aux</span>
  <span class="keyword2"><span class="keyword">and</span></span> comp_red_basis_punit <span class="main">=</span> <span class="quoted">punit'.punit.comp_red_basis</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> punit0.ord_pp_def punit0.ord_pp_strict_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> punit_adds_term<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> punit_component_of_term<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> monom_mult_punit_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult_scalar_punit_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> min_term_punit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lt_punit_def ord_pp_punit_alt<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lc_punit_def ord_pp_punit_alt<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> tail_punit_def ord_pp_punit_alt<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ord_p_punit_def ord_pp_strict_punit_alt<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> keys_to_list_punit_def ord_pp_punit_alt<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Computations›</span></span>

<span class="keyword1"><span class="command">experiment</span></span> <span class="keyword2"><span class="keyword">begin</span></span> <span class="keyword1"><span class="command">interpretation</span></span> trivariate<span class="hidden">⇩</span><sub>0</sub>_rat <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"comp_red_basis_punit DRLEX <span class="main">(</span>GB_Macaulay_Dube_punit DRLEX <span class="main">[</span>X <span class="main">*</span> Y<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> X<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> Y<span class="main">,</span> Y <span class="main">^</span> <span class="numeral">3</span> <span class="main">-</span> X <span class="main">^</span> <span class="numeral">3</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">[</span>X <span class="main">^</span> <span class="numeral">5</span><span class="main">,</span> X <span class="main">^</span> <span class="numeral">3</span> <span class="main">*</span> Y <span class="main">-</span> C<span class="hidden">⇩</span><sub>0</sub> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">9</span><span class="main">)</span> <span class="main">*</span> X <span class="main">^</span> <span class="numeral">4</span><span class="main">,</span> Y <span class="main">^</span> <span class="numeral">3</span> <span class="main">-</span> X <span class="main">^</span> <span class="numeral">3</span><span class="main">,</span> X <span class="main">*</span> Y<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> X<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> Y<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* theory *)</span>
</pre>
</div>