<div id="Preliminaries">
<div class="head">
<h1>Theory Preliminaries</h1>
</div>
<pre class="source"><span class="comment1">(*  Author: Lukas Bulwahn &lt;lukas.bulwahn-at-gmail.com&gt; *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Preliminaries
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Main.html">Main</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Multiset.html">HOL-Library.Multiset</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/FuncSet.html">HOL-Library.FuncSet</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Permutations.html">HOL-Library.Permutations</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-ex/Birthday_Paradox.html">HOL-ex.Birthday_Paradox</a>"</span>
  <a href="../Card_Partitions/Card_Partitions.html">Card_Partitions.Card_Partitions</a>
  <a href="../Bell_Numbers_Spivey/Bell_Numbers.html">Bell_Numbers_Spivey.Bell_Numbers</a>
  <a href="../Card_Multisets/Card_Multisets.html">Card_Multisets.Card_Multisets</a>
  <a href="../Card_Number_Partitions/Card_Number_Partitions.html">Card_Number_Partitions.Card_Number_Partitions</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Additions to Finite Set Theory›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subset_with_given_card_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> card <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">B</span></span> <span class="main">⊆</span> <span class="free">A</span><span class="main">.</span> card <span class="bound">B</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">B</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">B</span> <span class="main">=</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">B</span> <span class="main">&lt;</span> card <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">n</span> <span class="main">≤</span> card <span class="free">A</span>›</span></span> card.infinite <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> finite_subset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">B</span> <span class="main">&lt;</span> card <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_irrefl subsetI subset_antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">a</span> <span class="skolem">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> Suc <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∉</span> <span class="skolem">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">B</span> <span class="main">=</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Additions to Equiv Relation Theory›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> univ_commute' <span class="main">=</span> univ_commute<span class="main">[</span><span class="operator">unfolded</span> Equiv_Relations.proj_def<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> univ_predicate_impl_forall<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equiv <span class="free">A</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">respects</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">//</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"univ <span class="free">P</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> equiv_class_self quotientE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> <span class="free">R</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Image_singleton_iff equiv_class_eq quotientE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_class_eq_iff univ_commute' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> univ_preserves_predicate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equiv <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">respects</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">r</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">X</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="main">//</span> <span class="free">r</span><span class="main">.</span> univ <span class="free">P</span> <span class="bound">X</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">r</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">X</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="main">//</span> <span class="free">r</span><span class="main">.</span> univ <span class="free">P</span> <span class="bound">X</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="free">r</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> quotientE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">//</span> <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">=</span> <span class="free">r</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> quotientI<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"univ <span class="free">P</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">=</span> <span class="free">r</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>›</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> univ_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">X</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="main">//</span> <span class="free">r</span><span class="main">.</span> univ <span class="free">P</span> <span class="bound">X</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">X</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="main">//</span> <span class="free">r</span><span class="main">.</span> univ <span class="free">P</span> <span class="bound">X</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">X</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="main">//</span> <span class="free">r</span><span class="main">.</span> univ <span class="free">P</span> <span class="bound">X</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">//</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"univ <span class="free">P</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">//</span> <span class="free">r</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="free">r</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> quotientE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">=</span> <span class="free">r</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹univ <span class="free">P</span> <span class="skolem">X</span>›</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> univ_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">=</span> <span class="free">r</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> quotientI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Union_quotient_restricted<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equiv <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">respects</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">r</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="free">r</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">x'</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> quotientE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹equiv <span class="free">A</span> <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equiv_class_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">=</span> <span class="free">r</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">x'</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="keyword1">respects</span> <span class="free">r</span>›</span></span> congruentD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹equiv <span class="free">A</span> <span class="free">r</span>›</span></span> equiv_class_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> quotientI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_equiv_implies_finite_carrier<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equiv <span class="free">A</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">A</span> <span class="main">//</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">//</span> <span class="free">R</span><span class="main">.</span> finite <span class="bound">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹equiv <span class="free">A</span> <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span><span class="free">A</span> <span class="main">//</span> <span class="free">R</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Union_quotient<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="free">A</span> <span class="main">//</span> <span class="free">R</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">//</span> <span class="free">R</span><span class="main">.</span> finite <span class="bound">X</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_Union <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_quotient_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equiv <span class="free">A</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟷</span> <span class="main">(</span>finite <span class="main">(</span><span class="free">A</span> <span class="main">//</span> <span class="free">R</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">//</span> <span class="free">R</span><span class="main">.</span> finite <span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> equiv_type finite_equiv_class finite_equiv_implies_finite_carrier finite_quotient<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Counting Sets by Splitting into Equivalence Classes›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_equiv_class_restricted<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equiv <span class="free">A</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">respects</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> sum card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">R</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹equiv <span class="free">A</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="keyword1">respects</span> <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Union_quotient_restricted<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">C</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">R</span><span class="main">.</span> card <span class="bound">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">R</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹equiv <span class="free">A</span> <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_imageI proj_image<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">R</span><span class="main">.</span> finite <span class="bound">C</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹equiv <span class="free">A</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="keyword1">respects</span> <span class="free">R</span>›</span></span> Union_quotient_restricted
        Union_upper finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C1</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">R</span><span class="main">.</span> <span class="main">∀</span><span class="bound">C2</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">R</span><span class="main">.</span> <span class="bound">C1</span> <span class="main">≠</span> <span class="bound">C2</span> <span class="main">⟶</span> <span class="bound">C1</span> <span class="main">∩</span> <span class="bound">C2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹equiv <span class="free">A</span> <span class="free">R</span>›</span></span> quotient_disj
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq quotientE quotientI<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_Union_disjoint<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pairwise_def disjnt_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_equiv_class_restricted_same_size<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equiv <span class="free">A</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">respects</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">R</span> <span class="main">⟹</span> card <span class="bound">F</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="free">k</span> <span class="main">*</span> card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">R</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> sum card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">R</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹equiv <span class="free">A</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="keyword1">respects</span> <span class="free">R</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_equiv_class_restricted<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="main">*</span> card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">R</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">R</span> <span class="main">⟹</span> card <span class="bound">F</span> <span class="main">=</span> <span class="free">k</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span><span class="main">}</span> <span class="main">//</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹equiv <span class="free">A</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="keyword1">respects</span> <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Union_quotient_restricted<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">R</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">X</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">R</span><span class="main">.</span> infinite <span class="bound">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">R</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹infinite <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">R</span><span class="main">.</span> infinite <span class="bound">X</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹infinite <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">//</span> <span class="free">R</span> <span class="main">⟹</span> card <span class="bound">F</span> <span class="main">=</span> <span class="free">k</span>›</span></span> card.infinite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_equiv_class<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equiv <span class="free">A</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> sum card <span class="main">(</span><span class="free">A</span> <span class="main">//</span> <span class="free">R</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> True<span class="main">)</span> <span class="keyword1">respects</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> congruentI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹equiv <span class="free">A</span> <span class="free">R</span>›</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> card_equiv_class_restricted<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> True"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_equiv_class_same_size<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equiv <span class="free">A</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">//</span> <span class="free">R</span> <span class="main">⟹</span> card <span class="bound">F</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> <span class="free">k</span> <span class="main">*</span> card <span class="main">(</span><span class="free">A</span> <span class="main">//</span> <span class="free">R</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> True<span class="main">)</span> <span class="keyword1">respects</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> congruentI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹equiv <span class="free">A</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">//</span> <span class="free">R</span> <span class="main">⟹</span> card <span class="bound">F</span> <span class="main">=</span> <span class="free">k</span>›</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> card_equiv_class_restricted_same_size<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> True"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Additions to FuncSet Theory›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_same_card_bij_on_ext_funcset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span> <span class="main">∧</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> f'<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f'</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_same_card_bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="keyword1">else</span> undefined<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f' <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betwE<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f'</span> <span class="free">A</span> <span class="free">B</span> <span class="main">⟷</span> bij_betw <span class="skolem">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bij_betw_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">f'</span> <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_extensional_funcset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> card <span class="free">B</span> <span class="main">^</span> card <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_PiE prod_constant<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_implies_inj_on_and_card_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span> <span class="main">⟷</span> inj_on <span class="free">f</span> <span class="free">A</span> <span class="main">∧</span> card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">A</span> <span class="main">∧</span> card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_imp_inj_on bij_betw_same_card<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">A</span> <span class="main">∧</span> card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹inj_on <span class="free">f</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> card <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_image<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>›</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> card_subset_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹inj_on <span class="free">f</span> <span class="free">A</span>›</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_imageI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_implies_surj_on_and_card_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span> <span class="main">∧</span> card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span> <span class="main">∧</span> card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span>›</span></span> bij_betw_imp_surj_on bij_betw_same_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span> <span class="main">∧</span> card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> inj_on_iff_eq_card<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_imageI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Additions to Permutations Theory›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> X_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">,</span> 4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">⟷</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">p</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> permutes_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> X_eq this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">p</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Collect_cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_in_image<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> X_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">,</span> 4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">⟷</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> inv <span class="free">p</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_inverses<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span> 2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> X_eq this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> inv <span class="free">p</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Collect_cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="free">p</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_in_image permutes_inv<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Additions to List Theory›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The theorem <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] card_lists_length_eq<span class="antiquote"><span class="antiquote">}</span></span></span></span> contains the superfluous assumption <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"finite <span class="free"><span class="free">A</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
Here, we derive that fact without that unnecessary assumption.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lists_length_eq_Suc_eq_image_Cons<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> Suc <span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">xs</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⊆</span> <span class="var">?B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊆</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lists_length_eq_Suc_eq_empty_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> Suc <span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟷</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">#</span><span class="main">[]</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> length <span class="skolem">xs</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_length_conv insert_subset length_0_conv list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> <span class="main">{</span><span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lists_length_eq_Suc_eq_image_Cons<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lists_length_eq_eq_empty_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lists_length_eq_Suc_eq_empty_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_lists_length_eq_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">⟷</span> <span class="main">(</span>finite <span class="free">A</span> <span class="main">∨</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">∨</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">xs</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inj_onI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> finite_imageD inj_on_subset subset_UNIV lists_length_eq_Suc_eq_image_Cons<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
        <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lists_length_eq_eq_empty_iff <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> finite_cartesian_productD1<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">∨</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_lists_length_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_lists_length_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">=</span> card <span class="free">B</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_lists_length_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹infinite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_lists_length_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹infinite <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Additions to Disjoint Set Theory›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_congI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">A'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">g</span> <span class="free">A</span> <span class="free">A'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms bij_betw_cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> disjoint_family_onI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="bound">m</span> <span class="main">≠</span> <span class="bound">n</span> <span class="main">⟹</span> <span class="free">A</span> <span class="bound">m</span> <span class="main">∩</span> <span class="free">A</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"disjoint_family_on <span class="free">A</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> disjoint_family_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following lemma is not needed for this development, but is useful
and could be moved to Disjoint Set theory or Equiv Relation theory if
translated from set partitions to equivalence relations.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> infinite_partition_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> finite_subset subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infinite_remove<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">singletons_except_one</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">singletons_except_one</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a'</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">a'</span> <span class="keyword1">then</span> <span class="main">{</span><span class="bound">a</span><span class="main">,</span> <span class="skolem">x</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="skolem">singletons_except_one</span> <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">singletons_except_one</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> singletons_except_one_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>›</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> finite_imageD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">singletons_except_one</span> <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">∈</span> <span class="skolem">singletons_except_one</span> <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="skolem">singletons_except_one</span> <span class="skolem">a'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"partition_on <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span> <span class="main">=</span> <span class="skolem">a'</span> <span class="keyword1">then</span> <span class="main">{</span><span class="bound">a</span><span class="main">,</span> <span class="skolem">x</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> partition_onI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"partition_on <span class="free">A</span> <span class="skolem">P</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> P singletons_except_one_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infinite_super<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finitely_many_partition_on_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span><span class="main">}</span> <span class="main">⟷</span> finite <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> finitely_many_partition_on infinite_partition_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Additions to Multiset Theory›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mset_set_subseteq_mset_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="free">A</span> <span class="main">⊆#</span> mset_set <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≤</span> count <span class="main">(</span>mset_set <span class="free">B</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> count_mset_set<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span> 3<span class="main"><span class="main">)</span></span> eq_iff subsetCE zero_le_one<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="free">A</span> <span class="main">⊆#</span> mset_set <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mset_subset_eqI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mset_set_set_mset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊆#</span> mset_set <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="main">(</span>set_mset <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span> <span class="main">⊆#</span> mset_set <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="free">M</span> <span class="skolem">x</span> <span class="main">≤</span> count <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mset_subset_eq_count<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="main">(</span>mset_set <span class="main">(</span>set_mset <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> count <span class="free">M</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> count_eq_zero_iff count_greater_eq_one_iff count_mset_set
        dual_order.antisym dual_order.trans finite_set_mset<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> multiset_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mset_set_set_mset'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> count <span class="free">M</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="main">(</span>set_mset <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="free">M</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> count <span class="free">M</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> le_SucE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="main">(</span>mset_set <span class="main">(</span>set_mset <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> count <span class="free">M</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> count_eq_zero_iff count_mset_set<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> finite_set_mset<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> multiset_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_set_mset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊆#</span> mset_set <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set_mset <span class="free">M</span><span class="main">)</span> <span class="main">=</span> size <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mset_set_set_mset size_mset_set<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> card_set_mset'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> count <span class="free">M</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set_mset <span class="free">M</span><span class="main">)</span> <span class="main">=</span> size <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mset_set_set_mset' size_mset_set<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> count_mset_set_leq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"count <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> count_mset_set<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> eq_iff zero_le_one<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> count_mset_set_leq'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"count <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="free">x</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms count_mset_set_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> msubset_mset_set_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="free">M</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> count <span class="free">M</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">M</span> <span class="main">⊆#</span> mset_set <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="free">M</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> count <span class="free">M</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊆#</span> mset_set <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> count_inI count_mset_set<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> le0 mset_subset_eqI subsetCE<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊆#</span> mset_set <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="free">M</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mset_subset_eqD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span> <span class="main">⊆#</span> mset_set <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="free">M</span> <span class="skolem">x</span> <span class="main">≤</span> count <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mset_subset_eq_count<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="free">M</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> count_mset_set_leq le_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="free">M</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> count <span class="free">M</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> image_mset_fun_upd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉#</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="free">M</span> <span class="main">=</span> image_mset <span class="free">f</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Additions to Number Partitions Theory›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Partition_diag<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Partition <span class="free">n</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Partition_diag Partition.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinality Theorems with Iverson Function›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iverson</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">iverson</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_partition_on_size1_eq_iverson<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="bound">P</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> iverson <span class="main">(</span>card <span class="free">A</span> <span class="main">≤</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≤</span> <span class="free">k</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> iverson_def
    <span class="keyword1"><span class="command">using</span></span> card_partition_on_size1_eq_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> iverson_def
    <span class="keyword1"><span class="command">using</span></span> card_partition_on_size1_eq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_number_partitions_with_only_parts_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">N</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈#</span> <span class="bound">N</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> number_partition <span class="free">n</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span> <span class="main">=</span> iverson <span class="main">(</span><span class="free">n</span> <span class="main">≤</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> card_number_partitions_with_only_parts_1_eq_1
      <span class="keyword1"><span class="command">unfolding</span></span> iverson_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> card_number_partitions_with_only_parts_1_eq_0
      <span class="keyword1"><span class="command">unfolding</span></span> iverson_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Twelvefold_Way_Core">
<div class="head">
<h1>Theory Twelvefold_Way_Core</h1>
</div>
<pre class="source"><span class="comment1">(*  Author: Lukas Bulwahn &lt;lukas.bulwahn-at-gmail.com&gt; *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Main Observations on Operations and Permutations›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Twelvefold_Way_Core
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Preliminaries.html">Preliminaries</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Range Multiset›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Existence of a Suitable Finite Function›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> obtain_function<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"size <span class="free">M</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> image_mset <span class="bound">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> insert<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"size <span class="skolem">M</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_gt_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈#</span> <span class="skolem">M</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gr0_implies_Suc size_eq_Suc_imp_elem <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> insert<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"size <span class="main">(</span><span class="skolem">M</span> <span class="main">-</span> <span class="main">{#</span><span class="skolem">y</span><span class="main">#}</span><span class="main">)</span> <span class="main">=</span> card <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Diff_insert_absorb card_Diff_singleton_if insertI1 size_Diff_submset<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> insert.hyps this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="skolem">f'</span> <span class="main">(</span>mset_set <span class="skolem">A</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">M</span> <span class="main">-</span> <span class="main">{#</span><span class="skolem">y</span><span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="main">(</span><span class="skolem">f'</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>mset_set <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">M</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈#</span> <span class="skolem">M</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_mset_fun_upd<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> obtain_function_on_ext_funcset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"size <span class="free">M</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> set_mset <span class="free">M</span><span class="main">.</span> image_mset <span class="bound">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> range_eq_M<span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> obtain_function <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹size <span class="free">M</span> <span class="main">=</span> card <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">else</span> undefined"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> set_mset <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> range_eq_M <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="var">?f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> range_eq_M <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> multiset.map_cong0<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Existence of Permutation›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> image_mset_eq_implies_bij_betw<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a1</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a2</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mset_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset <span class="free">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> image_mset <span class="free">f'</span> <span class="main">(</span>mset_set <span class="free">A'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">bij</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">bij</span> <span class="free">A</span> <span class="free">A'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f'</span> <span class="main">(</span><span class="free">bij</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">b</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A'</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">b</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="main">(</span>set_mset <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f'</span> <span class="main">`</span> <span class="main">(</span>set_mset <span class="main">(</span>mset_set <span class="free">A'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mset_eq multiset.set_map<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">bij</span><span class="main">.</span> bij_betw <span class="bound">bij</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A'</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command">from</span></span> mset_eq <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"count <span class="main">(</span>image_mset <span class="free">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="skolem">b</span> <span class="main">=</span> count <span class="main">(</span>image_mset <span class="free">f'</span> <span class="main">(</span>mset_set <span class="free">A'</span><span class="main">)</span><span class="main">)</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A'</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">a</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A'</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_image_mset_eq_card_vimage<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">bij</span><span class="main">.</span> bij_betw <span class="bound">bij</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A'</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">a</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_same_card_bij<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">bij</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">.</span> bij_betw <span class="main">(</span><span class="bound">bij</span> <span class="bound">b</span><span class="main">)</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A'</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bchoice<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> bij <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">note</span></span> bij <span class="main">=</span> this
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bij'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bij'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">bij</span> <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">bij'</span> <span class="free">A</span> <span class="free">A'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"disjoint_family_on <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A'</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">i</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> disjoint_family_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">bij</span> <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A'</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">a</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
      <span class="keyword1"><span class="command">using</span></span> bij b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> bij_betw_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">bij</span> <span class="skolem">b</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">bij</span> <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">b</span><span class="main">∈</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">b</span><span class="main">∈</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A'</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_UNION_disjoint<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">b</span><span class="main">∈</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">b</span><span class="main">∈</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A'</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">A'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">bij'</span> <span class="free">A</span> <span class="free">A'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> bij'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> bij_betw_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">bij</span> <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> bij <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f'</span> <span class="main">(</span><span class="skolem">bij'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bij'_def <span class="keyword1"><span class="command">using</span></span> bij_betwE <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> image_mset_eq_implies_permutes<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mset_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset <span class="free">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> image_mset <span class="free">f'</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">p</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f'</span> <span class="main">(</span><span class="free">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">b</span> <span class="free">A</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f'</span> <span class="main">(</span><span class="skolem">b</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> image_mset_eq_implies_bij_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="skolem">b</span> <span class="bound">a</span> <span class="keyword1">else</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_imp_permutes<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">p</span> <span class="free">A</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">b</span> <span class="free">A</span> <span class="free">A</span>›</span></span> bij_betw_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f'</span> <span class="main">(</span><span class="skolem">b</span> <span class="bound">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f'</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Domain Partition›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Existence of a Suitable Finite Function›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> obtain_function_with_partition<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"partition_on <span class="free">A</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">P</span> <span class="main">≤</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">g'</span> <span class="free">P</span> <span class="main">(</span><span class="skolem">g'</span> <span class="main">`</span> <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">`</span> <span class="free">P</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms card_le_inj finite_elements inj_on_imp_bij_betw<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="skolem">g'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> f_def
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g'</span> <span class="main">`</span> <span class="free">P</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> partition_on_the_part_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
      <span class="keyword3"><span class="command">assume</span></span> X<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x'</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this X <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹partition_on <span class="free">A</span> <span class="free">P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> partition_on_the_part_mem<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x'</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> X_eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">g'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> inv_into <span class="free">P</span> <span class="skolem">g'</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x'</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">x'</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹partition_on <span class="free">A</span> <span class="free">P</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> partition_on_the_part_mem<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> X_eq1 <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">g'</span> <span class="main">`</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">x'</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">x'</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> inv_into <span class="free">P</span> <span class="skolem">g'</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">x'</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">x'</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span>inv_into <span class="free">P</span> <span class="skolem">g'</span> <span class="main">(</span><span class="skolem">g'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">x'</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> inv_into <span class="free">P</span> <span class="skolem">g'</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">g'</span> <span class="main">`</span> <span class="free">P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inv_into_injective<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv_into <span class="free">P</span> <span class="skolem">g'</span> <span class="main">(</span><span class="skolem">g'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">x'</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">x'</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">g'</span> <span class="free">P</span> <span class="main">(</span><span class="skolem">g'</span> <span class="main">`</span> <span class="free">P</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">x'</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_inv_into_left<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> X_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> inv_into <span class="free">P</span> <span class="skolem">g'</span> <span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv_into <span class="free">P</span> <span class="skolem">g'</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> X_eq <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"inv_into <span class="free">P</span> <span class="skolem">g'</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> inv_into <span class="free">P</span> <span class="skolem">g'</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> partition_on_all_in_part_eq_part<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹partition_on <span class="free">A</span> <span class="free">P</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹inv_into <span class="free">P</span> <span class="skolem">g'</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> partition_onE<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="skolem">X</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g'</span> <span class="main">`</span> <span class="free">P</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">g'</span> <span class="skolem">X</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">g'</span> <span class="skolem">X</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> partition_onE<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> partition_on_the_part_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">g'</span> <span class="skolem">X</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">g'</span> <span class="skolem">X</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">g'</span> <span class="skolem">X</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">g'</span> <span class="skolem">X</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g'</span> <span class="skolem">X</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> partition_on_the_part_mem<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> this g_eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">g'</span> <span class="free">P</span> <span class="main">(</span><span class="skolem">g'</span> <span class="main">`</span> <span class="free">P</span><span class="main">)</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_inv_into_left<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> partition_on_in_the_unique_part <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Equality under Permutation Application›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> permutes_implies_inv_image_on_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">p</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">p</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> inv <span class="free">p</span> <span class="bound">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_inverses<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">p</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> inv <span class="free">p</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> image_cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> inv <span class="free">p</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> permutes_inv permutes_image<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Existence of Permutation›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> the_elem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> partitions_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"the_elem <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">xa</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">xa</span> <span class="main">=</span> <span class="free">f'</span> <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x'</span> <span class="main">=</span> <span class="free">f'</span> <span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f'</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x'</span> <span class="main">=</span> <span class="free">f'</span> <span class="free">x</span><span class="main">}</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x'</span> <span class="main">=</span> <span class="free">f'</span> <span class="free">x</span><span class="main">}</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> partitions_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x'</span> <span class="main">=</span> <span class="free">f'</span> <span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"the_elem <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x'</span> <span class="main">=</span> <span class="free">f'</span> <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> empty_iff mem_Collect_eq the_elem_image_unique<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> the_elem_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"the_elem <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">=</span> <span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"the_elem <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">=</span> <span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> the_elem<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> partitions_eq_implies<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> partitions_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x'</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f'</span> <span class="free">x</span> <span class="main">=</span> <span class="free">f'</span> <span class="free">x'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x'</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x'</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span><span class="main">}</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">a</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x'</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">a</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> partitions_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Diff_iff imageE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f'</span> <span class="free">x</span> <span class="main">=</span> <span class="free">f'</span> <span class="free">x'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_domain_partitions<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> the_elem_eq<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> the_elem <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_imageI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> the_elem <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">X'</span>
      <span class="keyword3"><span class="command">assume</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> X'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X'</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"the_elem <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> the_elem <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">X'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> X <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> X this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Collect_empty_eq Diff_iff image_iff insertCI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> X' <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X'_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X'</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> X' this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Collect_empty_eq Diff_iff image_iff insertCI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> X_eq X'_eq eq <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⟹</span> the_elem <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="skolem">X'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> X_eq X'_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> the_elem <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> the_elem <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⟹</span> the_elem <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> the_elem <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> the_elem <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⟹</span> the_elem <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> the_elem <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> partitions_eq_implies_permutes<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> partitions_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="free">B</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">(</span><span class="free">f'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> card_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">f'</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_domain_partitions<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> card_domain_partitions<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> partitions_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this card_eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_Diff_subset finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">p'</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_same_card_bij finite_Diff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">`</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_imp_surj_on<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="skolem">p</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span> <span class="keyword1">then</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="keyword1">then</span> the_elem <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">else</span> <span class="skolem">p'</span> <span class="bound">b</span><span class="main">)</span> <span class="keyword1">else</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">(</span><span class="free">f'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this partitions_eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the_elem <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">xa</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">xa</span> <span class="main">=</span> <span class="free">f'</span> <span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> the_elem<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">(</span><span class="free">f'</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> p_def <span class="quoted"><span class="quoted">‹<span class="free">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_imp_permutes<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?invp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="keyword1">then</span> the_elem <span class="main">(</span><span class="free">f'</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">else</span> <span class="bound">b</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> the_elem<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> partitions_eq<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">p</span> <span class="free">B</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_imageI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">`</span> <span class="free">B</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> the_elem <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="free">f'</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">`</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>›</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">`</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="skolem">p</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">p</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∉</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
            <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">`</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∉</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">(</span><span class="free">f'</span> <span class="bound">x</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">p</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">b'</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">p</span> <span class="skolem">b'</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⟷</span> <span class="skolem">b'</span> <span class="main">∈</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⟷</span> <span class="skolem">p</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">`</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">B</span> <span class="main">-</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⟷</span> <span class="skolem">p</span> <span class="skolem">b'</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">p</span> <span class="skolem">b'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">b'</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⟷</span> <span class="skolem">b'</span> <span class="main">∈</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">`</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">B</span> <span class="main">-</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span> <span class="main">∈</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">b'</span> <span class="main">∈</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">∉</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">b'</span> <span class="main">∉</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b'</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">b'</span> <span class="main">∈</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="free">f'</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">=</span> <span class="free">f'</span> <span class="skolem">a'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">b</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">b'</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">a'</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">p</span> <span class="skolem">b'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">a'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f'</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">f'</span> <span class="skolem">a'</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> partitions_eq_implies<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> partitions_eq<span class="main">]</span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b'</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">=</span> <span class="free">f'</span> <span class="skolem">a'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> <span class="free">f'</span> <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∉</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">b'</span> <span class="main">∉</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">b'</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="skolem">b'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="skolem">b</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">p</span> <span class="skolem">b'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="skolem">b'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">-</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">-</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∉</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">b'</span> <span class="main">∉</span> <span class="free">f'</span> <span class="main">`</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b'</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">p'</span> <span class="main">_</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_inv_into_left<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Number Partition of Range›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Existence of a Suitable Finite Function›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> obtain_partition<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> image_mset card <span class="main">(</span>mset_set <span class="bound">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">N</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> number_partition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"partition_on <span class="skolem">A</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> partition_on_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset card <span class="main">(</span>mset_set <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>add <span class="skolem">x</span> <span class="skolem">N</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> add.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉#</span> add_mset <span class="skolem">x</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sum_mset <span class="main">(</span>add_mset <span class="skolem">x</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">=</span> card <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> number_partition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> card <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subset_with_given_card_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉#</span> add_mset <span class="skolem">x</span> <span class="skolem">N</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_mset <span class="skolem">N</span> <span class="main">=</span> card <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sum_mset <span class="main">(</span>add_mset <span class="skolem">x</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">=</span> card <span class="skolem">A</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">X</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">A</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute add.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> add_diff_cancel_right' card_Diff_subset infinite_super sum_mset.add_mset<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉#</span> add_mset <span class="skolem">x</span> <span class="skolem">N</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"number_partition <span class="main">(</span>card <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="skolem">X</span><span class="main">)</span><span class="main">)</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> number_partition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"partition_on <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="skolem">X</span><span class="main">)</span> <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq_N<span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset card <span class="main">(</span>mset_set <span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add.hyps <span class="quoted"><span class="quoted">‹finite <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹partition_on <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="skolem">X</span><span class="main">)</span> <span class="skolem">P</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">A</span>›</span></span> finite_elements <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹partition_on <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="skolem">X</span><span class="main">)</span> <span class="skolem">P</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∉</span> <span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> partition_onD1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"partition_on <span class="skolem">A</span> <span class="main">(</span>insert <span class="skolem">X</span> <span class="skolem">P</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹partition_on <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="skolem">X</span><span class="main">)</span> <span class="skolem">P</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> partition_on_insert'<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset card <span class="main">(</span>mset_set <span class="main">(</span>insert <span class="skolem">X</span> <span class="skolem">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> add_mset <span class="skolem">x</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq_N <span class="quoted"><span class="quoted">‹card <span class="skolem">X</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">P</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∉</span> <span class="skolem">P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> obtain_extensional_function_from_number_partition<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"size <span class="free">N</span> <span class="main">≤</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> image_mset <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> card <span class="bound">X</span><span class="main">)</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"partition_on <span class="free">A</span> <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq_N<span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset card <span class="main">(</span>mset_set <span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms obtain_partition <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> eq_N<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹size <span class="free">N</span> <span class="main">≤</span> card <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">P</span> <span class="main">≤</span> card <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹partition_on <span class="free">A</span> <span class="skolem">P</span>›</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> eq_P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> obtain_function_with_partition<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> card <span class="bound">X</span><span class="main">)</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq_P eq_N <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Equality under Permutation Application›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> permutes_implies_multiset_of_partition_cards_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="free">f'</span> <span class="main">(</span><span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">(`)</span> <span class="main">(</span>inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> inj_image_eq_iff inj_onI permutes_surj surj_imp_inj_inv<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="free">f'</span> <span class="main">(</span><span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="free">f'</span> <span class="main">(</span><span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="main">(</span><span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> permutes_implies_inv_image_on_eq<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="main">(</span><span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">=</span> inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="main">(</span><span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">⊆</span> inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="main">(</span><span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f'</span> <span class="main">(</span><span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_in_image<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> permutes_inverses<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="main">(</span><span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f'</span> <span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_in_image permutes_inv<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f'</span> <span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f'</span> <span class="main">(</span><span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> permutes_inverses<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="main">(</span><span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> image_mset <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> card <span class="main">(</span>inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹inj_on <span class="main">(</span><span class="main">(`)</span> <span class="main">(</span>inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> image_mset_mset_set<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> image_mset.compositionality<span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> comp_apply<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_image inj_on_inv_into permutes_surj<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Existence of Permutation›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> partition_implies_permutes<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"partition_on <span class="free">A</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"partition_on <span class="free">A</span> <span class="free">P'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"image_mset card <span class="main">(</span>mset_set <span class="free">P'</span><span class="main">)</span> <span class="main">=</span> image_mset card <span class="main">(</span>mset_set <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">p</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">p</span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span> <span class="main">`</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹partition_on <span class="free">A</span> <span class="free">P</span>›</span></span> <span class="quoted"><span class="quoted">‹partition_on <span class="free">A</span> <span class="free">P'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">P'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> finite_elements <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹image_mset card <span class="main">(</span>mset_set <span class="free">P'</span><span class="main">)</span> <span class="main">=</span> image_mset card <span class="main">(</span>mset_set <span class="free">P</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bij</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">bij</span> <span class="free">P</span> <span class="free">P'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="main">(</span><span class="skolem">bij</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> image_mset_eq_implies_bij_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p'</span><span class="main">.</span> bij_betw <span class="bound">p'</span> <span class="bound">X</span> <span class="main">(</span><span class="skolem">bij</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹partition_on <span class="free">A</span> <span class="free">P</span>›</span></span> partition_onD1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> rev_finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bij</span> <span class="skolem">X</span> <span class="main">∈</span> <span class="free">P'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">bij</span> <span class="free">P</span> <span class="free">P'</span>›</span></span> bij_betwE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bij</span> <span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹partition_on <span class="free">A</span> <span class="free">P'</span>›</span></span> partition_onD1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">bij</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> rev_finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">=</span> card <span class="main">(</span><span class="skolem">bij</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="main">(</span><span class="skolem">bij</span> <span class="bound">X</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span><span class="main">.</span> bij_betw <span class="bound">p'</span> <span class="skolem">X</span> <span class="main">(</span><span class="skolem">bij</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="skolem">bij</span> <span class="skolem">X</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">X</span>›</span></span> finite_same_card_bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span><span class="main">.</span> <span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> bij_betw <span class="main">(</span><span class="bound">p'</span> <span class="bound">X</span><span class="main">)</span> <span class="bound">X</span> <span class="main">(</span><span class="skolem">bij</span> <span class="bound">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> bij_betw <span class="main">(</span><span class="skolem">p'</span> <span class="bound">X</span><span class="main">)</span> <span class="bound">X</span> <span class="main">(</span><span class="skolem">bij</span> <span class="bound">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">p</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="bound">a</span> <span class="keyword1">else</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">p</span> <span class="free">A</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"disjoint_family_on <span class="skolem">bij</span> <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">X'</span>
        <span class="keyword3"><span class="command">assume</span></span> XX'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X'</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">≠</span> <span class="skolem">X'</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bij</span> <span class="skolem">X</span> <span class="main">∈</span> <span class="free">P'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bij</span> <span class="skolem">X'</span> <span class="main">∈</span> <span class="free">P'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">bij</span> <span class="free">P</span> <span class="free">P'</span>›</span></span> bij_betwE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> XX' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bij</span> <span class="skolem">X</span> <span class="main">≠</span> <span class="skolem">bij</span> <span class="skolem">X'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">bij</span> <span class="free">P</span> <span class="free">P'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_inv_into_left<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bij</span> <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">bij</span> <span class="skolem">X'</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹partition_on <span class="free">A</span> <span class="free">P'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> partition_onE<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">(</span><span class="skolem">bij</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="skolem">p'</span> <span class="skolem">X</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">(</span><span class="skolem">bij</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> bij_betw <span class="main">(</span><span class="skolem">p'</span> <span class="bound">X</span><span class="main">)</span> <span class="bound">X</span> <span class="main">(</span><span class="skolem">bij</span> <span class="bound">X</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹partition_on <span class="free">A</span> <span class="free">P</span>›</span></span> partition_on_the_part_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> bij_betw_congI<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">X</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">X</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> <span class="skolem">bij</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_UNION_disjoint<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">X</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">X</span><span class="main">∈</span><span class="free">P'</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹partition_on <span class="free">A</span> <span class="free">P</span>›</span></span> <span class="quoted"><span class="quoted">‹partition_on <span class="free">A</span> <span class="free">P'</span>›</span></span> partition_onD1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">X</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> <span class="skolem">bij</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">X</span><span class="main">∈</span><span class="free">P'</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">bij</span> <span class="free">P</span> <span class="free">P'</span>›</span></span> bij_betw_imp_surj_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="free">A</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="bound">a</span> <span class="main">=</span> <span class="skolem">p</span> <span class="bound">a</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_congI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="free">A</span>›</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_imp_permutes<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span> <span class="main">`</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P'</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span> <span class="main">`</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> in_P<span class="main">:</span> <span class="quoted"><span class="quoted">"the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P'</span>›</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">bij</span> <span class="free">P</span> <span class="free">P'</span>›</span></span> bij_betwE bij_betw_the_inv_into <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> eq_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bij</span> <span class="main">(</span>the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P'</span>›</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">bij</span> <span class="free">P</span> <span class="free">P'</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> f_the_inv_into_f_bij_betw<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">`</span> <span class="main">(</span>the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword1"><span class="command">from</span></span> in_P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹partition_on <span class="free">A</span> <span class="free">P</span>›</span></span> partition_onD1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">`</span> the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">`</span> the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">`</span> the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> x_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> a_in in_P <span class="quoted"><span class="quoted">‹partition_on <span class="free">A</span> <span class="free">P</span>›</span></span> partition_on_the_part_eq
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">from</span></span> this x_eq <span class="keyword1"><span class="command">have</span></span> x_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">(</span>the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span><span class="main">)</span> <span class="skolem">a</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">bij</span> <span class="main">(</span>the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> a_in in_P bij_betwE p' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> this eq_X <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">`</span> the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span>"</span></span>
            <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> the_inv_into <span class="var">?X'</span> <span class="main">(</span><span class="skolem">p'</span> <span class="var">?X'</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> in_P p' eq_X <span class="keyword1"><span class="command">have</span></span> bij_betw<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="skolem">p'</span> <span class="var">?X'</span><span class="main">)</span> <span class="var">?X'</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> bij_betw <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="var">?X'</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> x'_def
              <span class="keyword1"><span class="command">using</span></span> bij_betwE bij_betw_the_inv_into <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> this in_P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">x'</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="var">?X'</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹partition_on <span class="free">A</span> <span class="free">P</span>›</span></span> partition_on_the_part_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">x'</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="skolem">x'</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> x'_def
              <span class="keyword1"><span class="command">using</span></span> bij_betw f_the_inv_into_f_bij_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> <span class="var">?X'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">`</span> the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">p</span> <span class="main">`</span> the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">`</span> the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">p</span> <span class="main">`</span> the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="skolem">x'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> in_P partition_onD1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">x'</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> in_P partition_on_the_part_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">have</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">(</span>the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span><span class="main">)</span> <span class="skolem">x'</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span>›</span></span> bij_betwE eq_X in_P p' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="skolem">x'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> eq p' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P'</span>›</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">bij</span> <span class="free">P</span> <span class="free">P'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the_inv_into <span class="free">P</span> <span class="skolem">bij</span> <span class="skolem">X</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> bij_betwE bij_betw_the_inv_into <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span> <span class="main">`</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span> <span class="main">`</span> <span class="free">P</span> <span class="main">⊆</span> <span class="free">P'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X'</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span> <span class="main">`</span> <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> X'_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X'</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">`</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> partition_onD1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> p' <span class="keyword1"><span class="command">have</span></span> bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="skolem">p'</span> <span class="skolem">X</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">(</span><span class="skolem">bij</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">`</span> <span class="skolem">X</span> <span class="main">∈</span> <span class="free">P'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">bij</span> <span class="free">P</span> <span class="free">P'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bij</span> <span class="skolem">X</span> <span class="main">∈</span> <span class="free">P'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> bij_betwE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">X</span> <span class="main">=</span> <span class="skolem">bij</span> <span class="skolem">X</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">bij</span> <span class="skolem">X</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x'</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">X</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x'_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> eq_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> partition_on_the_part_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">from</span></span> bij <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> x'_eq eq_X <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="skolem">bij</span> <span class="skolem">X</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> bij_betwE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bij</span> <span class="skolem">X</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">X</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x'</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="skolem">bij</span> <span class="skolem">X</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"inv_into <span class="skolem">X</span> <span class="main">(</span><span class="skolem">p'</span> <span class="skolem">X</span><span class="main">)</span> <span class="skolem">x'</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> <span class="skolem">bij</span> <span class="skolem">X</span>›</span></span> bij <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  bij_betw_imp_surj_on inv_into_into<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="var">?x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> partition_on_the_part_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> <span class="skolem">bij</span> <span class="skolem">X</span>›</span></span> bij <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="var">?x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="var">?x</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> bij_betw_inv_into_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> <span class="skolem">bij</span> <span class="skolem">X</span>›</span></span> bij <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_imp_surj_on inv_into_into<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">X</span> <span class="main">∈</span> <span class="free">P'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">X</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="bound">a</span> <span class="keyword1">else</span> <span class="bound">a</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">X</span> "</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> image_cong<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
         <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">X</span> <span class="main">∈</span> <span class="free">P'</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> this X'_eq <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X'</span> <span class="main">∈</span> <span class="free">P'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> permutes_domain_partition_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">b</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> permutes_in_image permutes_inverses<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span>inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> permutes_inverses<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">(</span>inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> permutes_in_image permutes_inv<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> image_domain_partition_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> eq <span class="main">=</span> permutes_domain_partition_eq<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> eq <span class="main">=</span> permutes_domain_partition_eq<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>inv <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> multiset_of_partition_cards_eq_implies_permutes<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="free">f'</span> <span class="main">(</span><span class="free">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"partition_on <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> partition_onI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"partition_on <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> partition_onI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> partition_implies_permutes<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> _ _ eq<span class="main">]</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    inv_image_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span>
      <span class="main">(`)</span> <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">(`)</span> <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> injI inj_image_eq_iff permutes_inj<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> inv_image_eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="main">(</span>inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">note</span></span> inv_image_eq
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f'</span> <span class="main">(</span>inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> image_domain_partition_eq<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_set_diff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹inj <span class="main">(</span><span class="main">(`)</span> <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> permutes_inv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f'</span> <span class="main">(</span>inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> permutes_in_image <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> this <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="free">f'</span> <span class="main">(</span>inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> partitions_eq_implies_permutes<span class="main">[</span><span class="operator">OF</span> _ _ _ inv_image_eq'<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> eq'' that <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bijections on Same Domain and Range›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Existence of Domain Permutation›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> obtain_domain_permutation_for_two_bijections<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f'</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">p</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">f'</span> <span class="main">(</span><span class="free">p</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> the_inv_into <span class="free">A</span> <span class="free">f'</span> <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="bound">a</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_imp_permutes<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="var">?p</span> <span class="free">A</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_imageI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?p</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">a'</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">a</span> <span class="main">=</span> <span class="var">?p</span> <span class="skolem">a'</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the_inv_into <span class="free">A</span> <span class="free">f'</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> the_inv_into <span class="free">A</span> <span class="free">f'</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">a'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">a'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> assms
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betwE f_the_inv_into_f_bij_betw<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> assms
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_inv_into_left<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?p</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> the_inv_into <span class="free">A</span> <span class="free">f'</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">a'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> this assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betwE bij_betw_imp_inj_on bij_betw_imp_surj_on subset_iff the_inv_into_into<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="var">?p</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the_inv_into <span class="free">A</span> <span class="free">f</span> <span class="main">(</span><span class="free">f'</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bij_betwE bij_betw_the_inv_into<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> the_inv_into <span class="free">A</span> <span class="free">f'</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>the_inv_into <span class="free">A</span> <span class="free">f</span> <span class="main">(</span><span class="free">f'</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betwE bij_betw_imp_inj_on f_the_inv_into_f_bij_betw the_inv_into_f_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?p</span> <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">f'</span> <span class="main">(</span><span class="var">?p</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="free">f'</span> <span class="free">A</span> <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_betwE f_the_inv_into_f_bij_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> that
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Existence of Range Permutation›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> obtain_range_permutation_for_two_bijections<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f'</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">p</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">p</span> <span class="main">(</span><span class="free">f'</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span>inv_into <span class="free">A</span> <span class="free">f'</span> <span class="bound">b</span><span class="main">)</span> <span class="keyword1">else</span> <span class="bound">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_imp_permutes<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="var">?p</span> <span class="free">B</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_imageI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?p</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">b'</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">b</span> <span class="main">=</span> <span class="var">?p</span> <span class="skolem">b'</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>inv_into <span class="free">A</span> <span class="free">f'</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>inv_into <span class="free">A</span> <span class="free">f'</span> <span class="skolem">b'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv_into <span class="free">A</span> <span class="free">f'</span> <span class="skolem">b</span> <span class="main">=</span> inv_into <span class="free">A</span> <span class="free">f'</span> <span class="skolem">b'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> assms
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_imp_surj_on bij_betw_inv_into_left inv_into_into<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_inv_into_right<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">`</span> <span class="free">B</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">`</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betwE bij_betw_def inv_into_into<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="var">?p</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f'</span> <span class="main">(</span>inv_into <span class="free">A</span> <span class="free">f</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betwE bij_betw_imp_surj_on inv_into_into<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">(</span><span class="free">f'</span> <span class="main">(</span>inv_into <span class="free">A</span> <span class="free">f</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="free">f'</span> <span class="main">(</span>inv_into <span class="free">A</span> <span class="free">f</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_imp_surj_on bij_betw_inv_into_left bij_betw_inv_into_right inv_into_into<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="var">?p</span> <span class="main">`</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∉</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">(</span><span class="free">f'</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="free">f'</span> <span class="free">A</span> <span class="free">B</span>›</span></span> bij_betw_inv_into_left bij_betwE <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> that
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Equiv_Relations_on_Functions">
<div class="head">
<h1>Theory Equiv_Relations_on_Functions</h1>
</div>
<pre class="source"><span class="comment1">(*  Author: Lukas Bulwahn &lt;lukas.bulwahn-at-gmail.com&gt; *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Definition of Equivalence Classes›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Equiv_Relations_on_Functions
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Preliminaries.html">Preliminaries</a>
  <a href="Twelvefold_Way_Core.html">Twelvefold_Way_Core</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Permutation on the Domain›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">domain_permutation</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">domain_permutation</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">f</span></span><span class="main">,</span> <span class="bound"><span class="bound">f'</span></span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">f'</span> <span class="main">(</span><span class="bound">p</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> equiv_domain_permutation<span class="main">:</span>
  <span class="quoted"><span class="quoted">"equiv <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span>domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equivI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span>domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> refl_onI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> permutes_id <span class="keyword1"><span class="command">unfolding</span></span> domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span>domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> symI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">f'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_inv<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span>inv <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> permutes_in_image permutes_inverses<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f'</span><span class="main">,</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span>domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> transI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">f'</span> <span class="skolem">f''</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f'</span><span class="main">,</span> <span class="skolem">f''</span><span class="main">)</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">f'</span><span class="main">,</span> <span class="skolem">f''</span><span class="main">)</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f''</span> <span class="main">(</span><span class="skolem">p'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">f'</span><span class="main">,</span> <span class="skolem">f''</span><span class="main">)</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f''</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p'</span> <span class="main">∘</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_compose<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f''</span> <span class="main">(</span><span class="main">(</span><span class="skolem">p'</span> <span class="main">∘</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f''</span> <span class="main">(</span><span class="skolem">p'</span> <span class="bound">x</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_in_image<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f''</span><span class="main">)</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Respecting Functions›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inj_on_respects_domain_permutation<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">respects</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> congruentI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">f'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> inv_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span>inv <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> permutes_inverses<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> permutes_not_in<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">A</span> <span class="main">⟷</span> inj_on <span class="skolem">f'</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">A</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f'</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">a'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="skolem">a'</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="skolem">p</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"inv <span class="skolem">p</span> <span class="skolem">a'</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  permutes_in_image permutes_inv<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>inv <span class="skolem">p</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span>inv <span class="skolem">p</span> <span class="skolem">a'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="skolem">a'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> inv_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹inj_on <span class="skolem">f</span> <span class="free">A</span>›</span></span> this <span class="quoted"><span class="quoted">‹inv <span class="skolem">p</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹inv <span class="skolem">p</span> <span class="skolem">a'</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="skolem">p</span> <span class="skolem">a</span> <span class="main">=</span> inv <span class="skolem">p</span> <span class="skolem">a'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inj_on_contraD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> permutes_inverses<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f'</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this p <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inj_on_contraD permutes_in_image permutes_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> image_respects_domain_permutation<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">respects</span> <span class="main">(</span>domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> congruentI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">f'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> p f_eq <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_in_image<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span>inv <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> permutes_in_image permutes_inverses<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_inv permutes_in_image<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> surjective_respects_domain_permutation<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">)</span> <span class="keyword1">respects</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_respects_domain_permutation congruentD congruentI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_respects_domain_permutation<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="keyword1">respects</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> congruentI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">f'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> <span class="free">A</span> <span class="free">B</span> <span class="main">⟷</span> bij_betw <span class="main">(</span><span class="skolem">f'</span> <span class="keyword1">o</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> bij_betw_cong comp_apply<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> bij_betw <span class="skolem">f'</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bij_betw_comp_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> permutes_imp_bij<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> <span class="free">A</span> <span class="free">B</span> <span class="main">⟷</span> bij_betw <span class="skolem">f'</span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> image_mset_respects_domain_permutation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> image_mset <span class="bound">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">respects</span> <span class="main">(</span>domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> congruentI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">f'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> image_mset <span class="skolem">f'</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> permutes_implies_image_mset_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Permutation on the Range›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">range_permutation</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">range_permutation</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">f</span></span><span class="main">,</span> <span class="bound"><span class="bound">f'</span></span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">(</span><span class="bound">f'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> equiv_range_permutation<span class="main">:</span>
  <span class="quoted"><span class="quoted">"equiv <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span>range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equivI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span>range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> refl_onI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> permutes_id <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span>range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> symI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">f'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_inv<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> inv <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_inverses<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f'</span><span class="main">,</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span>range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> transI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">f'</span> <span class="skolem">f''</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f'</span><span class="main">,</span> <span class="skolem">f''</span><span class="main">)</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">f'</span><span class="main">,</span> <span class="skolem">f''</span><span class="main">)</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">(</span><span class="skolem">f''</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">f'</span><span class="main">,</span> <span class="skolem">f''</span><span class="main">)</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f''</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">∘</span> <span class="skolem">p'</span><span class="main">)</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_compose<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">∘</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f''</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">(</span><span class="skolem">f''</span> <span class="bound">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f''</span><span class="main">)</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Respecting Functions›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inj_on_respects_range_permutation<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">respects</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> congruentI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">f'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> inv_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> inv <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_inverses<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">A</span> <span class="main">⟷</span> inj_on <span class="skolem">f'</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this p <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f'</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f'</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this inv_p <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> surj_on_respects_range_permutation<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">)</span> <span class="keyword1">respects</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> congruentI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">f'</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> a <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> image_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"inv <span class="skolem">p</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_image image_inv_f_f permutes_inj<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_image permutes_inv<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_image permutes_image<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_respects_range_permutation<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="keyword1">respects</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> congruentI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">f'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> <span class="free">A</span> <span class="free">B</span> <span class="main">⟷</span> bij_betw <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">o</span> <span class="skolem">f'</span><span class="main">)</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> bij_betw_cong comp_apply<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> bij_betw <span class="skolem">f'</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bij_betw_comp_iff2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> permutes_imp_bij<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> <span class="free">A</span> <span class="free">B</span> <span class="main">⟷</span> bij_betw <span class="skolem">f'</span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> domain_partitions_respects_range_permutation<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">respects</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> congruentI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">f'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">⟷</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> permutes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betwE permutes_imp_bij permutes_inverses<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">{}</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">⟷</span> <span class="main">{}</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> permutes_implies_inv_image_on_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span>›</span></span> Collect_cong image_cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Permutation on the Domain and the Range›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">domain_and_range_permutation</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">domain_and_range_permutation</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">f</span></span><span class="main">,</span> <span class="bound"><span class="bound">f'</span></span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main">.</span>
    <span class="main">∃</span><span class="bound">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">p<span class="hidden">⇩</span><sub>B</sub></span><span class="main">.</span> <span class="bound">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="bound">f'</span> <span class="main">(</span><span class="bound">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> equiv_domain_and_range_permutation<span class="main">:</span>
  <span class="quoted"><span class="quoted">"equiv <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span>domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equivI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span>domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> refl_onI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_and_range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> permutes_id<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> permutes_id<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_and_range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span>domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> symI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">f'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_and_range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_and_range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"inv <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_inv<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> inv <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹inv <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> bij_betwE bij_inv_eq_iff permutes_bij permutes_imp_bij<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f'</span><span class="main">,</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_and_range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span>domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> transI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">f'</span> <span class="skolem">f''</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f'</span><span class="main">,</span> <span class="skolem">f''</span><span class="main">)</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_and_range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">f'</span><span class="main">,</span> <span class="skolem">f''</span><span class="main">)</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">p'<span class="hidden">⇩</span><sub>B</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">p'<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p'<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f''</span> <span class="main">(</span><span class="skolem">p'<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_and_range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_and_range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">f'</span><span class="main">,</span> <span class="skolem">f''</span><span class="main">)</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f''</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_and_range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p'<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∘</span> <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_compose<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">∘</span> <span class="skolem">p'<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_compose<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">∘</span> <span class="skolem">p'<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span> <span class="main">(</span><span class="skolem">f''</span> <span class="main">(</span><span class="main">(</span><span class="skolem">p'<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∘</span> <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p'<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f''</span> <span class="main">(</span><span class="skolem">p'<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_in_image<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f''</span><span class="main">)</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_and_range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Respecting Functions›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inj_on_respects_domain_and_range_permutation<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">respects</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> congruentI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">f'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> domain_and_range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> domain_and_range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_image<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_betw_imp_inj_on permutes_imp_bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_betw_imp_inj_on permutes_imp_bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">A</span> <span class="main">⟷</span> inj_on <span class="skolem">f'</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">A</span> <span class="main">⟷</span> inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>›</span></span> inj_on_cong comp_apply <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">A</span> <span class="main">⟷</span> inj_on <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">o</span> <span class="skolem">f'</span> <span class="keyword1">o</span> <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>›</span></span> inj_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">o</span> <span class="skolem">f'</span> <span class="keyword1">o</span> <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="free">A</span> <span class="main">⟷</span> inj_on <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">o</span> <span class="skolem">f'</span><span class="main">)</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹inj_on <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">A</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> inj_on_imageI <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> comp_inj_on<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">o</span> <span class="skolem">f'</span><span class="main">)</span> <span class="free">A</span> <span class="main">⟷</span> inj_on <span class="skolem">f'</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹inj_on <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> inj_on_imageI2 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> comp_inj_on subset_inj_on<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> surjective_respects_domain_and_range_permutation<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">)</span> <span class="keyword1">respects</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> congruentI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">f'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span>
    permutes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> domain_and_range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> permutes <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">`</span> <span class="free">B</span> <span class="main">=</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_image<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_inj<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> image_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_image<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">`</span> <span class="free">B</span> <span class="main">=</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹inj <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_image image_inv_f_f<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_respects_domain_and_range_permutation<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="keyword1">respects</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> congruentI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">f'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> domain_and_range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> <span class="free">A</span> <span class="free">B</span> <span class="main">⟷</span> bij_betw <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">o</span> <span class="skolem">f'</span> <span class="keyword1">o</span> <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>›</span></span> bij_betw_congI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> bij_betw <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">o</span> <span class="skolem">f'</span><span class="main">)</span>  <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bij_betw_comp_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> permutes_imp_bij<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> bij_betw <span class="skolem">f'</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bij_betw_comp_iff2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> permutes_imp_bij<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> <span class="free">A</span> <span class="free">B</span> <span class="main">⟷</span> bij_betw <span class="skolem">f'</span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> count_image_mset'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"count <span class="main">(</span>image_mset <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> sum <span class="main">(</span>count <span class="free">A</span><span class="main">)</span> <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> set_mset <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">=</span> <span class="free">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count <span class="main">(</span>image_mset <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> sum <span class="main">(</span>count <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">-`</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">∩</span> set_mset <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> count_image_mset <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="main">(</span>count <span class="free">A</span><span class="main">)</span> <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> set_mset <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">=</span> <span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">-`</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">∩</span> set_mset <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> set_mset <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">=</span> <span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> multiset_of_partition_cards_respects_domain_and_range_permutation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> image_mset <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> card <span class="bound">X</span><span class="main">)</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">respects</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> congruentI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">f'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> domain_and_range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> permutes_implies_inv_image_on_eq<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> multiset_eqI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span> <span class="main">{</span><span class="bound"><span class="bound">X</span></span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">{</span><span class="bound"><span class="bound">X</span></span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">X</span></span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="bound">X</span> <span class="main">=</span> <span class="bound">X</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> image_inv_f_f permutes_inj<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">X</span></span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="bound">X</span> <span class="main">=</span> <span class="bound">X</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> image_f_inv_f permutes_surj<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">X</span></span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">X</span></span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> injD inj_onI permutes_inj<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_image<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> permutes_in_image<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span>inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> permutes_inverses<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> permutes_in_image permutes_inv<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> image_eqI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="bound">X</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">X</span></span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">X</span></span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> injD inj_onI permutes_surj surj_imp_inj_inv<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_image<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_in_image permutes_inv permutes_inverses<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">⊆</span> inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> permutes_inverses<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> permutes_in_image<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> inv <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> image_eqI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">.</span> card <span class="bound">x'</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">.</span> card <span class="bound">x'</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"count <span class="main">(</span>image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span>
      count <span class="main">(</span>image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_image_mset'<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Twelvefold_Way_Entry1">
<div class="head">
<h1>Theory Twelvefold_Way_Entry1</h1>
</div>
<pre class="source"><span class="comment1">(*  Author: Lukas Bulwahn &lt;lukas.bulwahn-at-gmail.com&gt; *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Functions from A to B›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Twelvefold_Way_Entry1
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Preliminaries.html">Preliminaries</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Note that the cardinality theorems of both structures, lists and finite
functions, are already available. Hence, this development creates the
bijection between those two structures and transfers the one cardinality
theorem to the other structures and vice versa, although not strictly
needed as both cardinality theorems were already available.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition of Bijections›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sequence_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sequence_of</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">enum</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">enum</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">function_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">function_of</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">enum</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">!</span> inv_into <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">}</span> <span class="free"><span class="bound"><span class="entity">enum</span></span></span> <span class="bound">a</span> <span class="keyword1">else</span> undefined<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties for Bijections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nth_sequence_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> card <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="free">f</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">enum</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> sequence_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nth_sequence_of_inv_into<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="free">f</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span>inv_into <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">enum</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv_into <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">enum</span> <span class="free">a</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms bij_betwE bij_betw_inv_into <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="free">f</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span>inv_into <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">enum</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sequence_of_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_inv_into_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_sequence_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="free">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> PiE bij_betwE assms
<span class="keyword1"><span class="command">unfolding</span></span> sequence_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> length_sequence_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> sequence_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> function_of_enum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> card <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"function_of <span class="free">A</span> <span class="free">enum</span> <span class="free">xs</span> <span class="main">(</span><span class="free">enum</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> function_of_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_inv_into_left bij_betwE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> function_of_in_extensional_funcset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"function_of <span class="free">A</span> <span class="free">enum</span> <span class="free">xs</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv_into <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">xs</span><span class="main">}</span> <span class="free">enum</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">xs</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_def inv_into_into<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> inv_into <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">xs</span><span class="main">}</span> <span class="free">enum</span> <span class="skolem">x</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"function_of <span class="free">A</span> <span class="free">enum</span> <span class="free">xs</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> function_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"function_of <span class="free">A</span> <span class="free">enum</span> <span class="free">xs</span> <span class="skolem">x</span> <span class="main">=</span> undefined"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> function_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sequence_of_function_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="main">(</span>function_of <span class="free">A</span> <span class="free">enum</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"function_of <span class="free">A</span> <span class="free">enum</span> <span class="free">xs</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> function_of_in_extensional_funcset<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="main">(</span>function_of <span class="free">A</span> <span class="free">enum</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_sequence_of<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="main">(</span>sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="main">(</span>function_of <span class="free">A</span> <span class="free">enum</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="main">(</span>function_of <span class="free">A</span> <span class="free">enum</span> <span class="free">xs</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_sequence_of function_of_enum<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> function_of_sequence_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"function_of <span class="free">A</span> <span class="free">enum</span> <span class="main">(</span>sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"function_of <span class="free">A</span> <span class="free">enum</span> <span class="main">(</span>sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> function_of_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_sequence_of nth_sequence_of_inv_into<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bijections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_sequence_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>sequence_of <span class="free">A</span> <span class="free">enum</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"function_of <span class="free">A</span> <span class="free">enum</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> function_of <span class="free">A</span> <span class="free">enum</span> <span class="main">(</span>sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="bound">f</span><span class="main">)</span> <span class="main">=</span> <span class="bound">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> function_of_sequence_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span><span class="main">∈</span><span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span><span class="main">.</span> sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="main">(</span>function_of <span class="free">A</span> <span class="free">enum</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">=</span> <span class="bound">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sequence_of_function_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms set_sequence_of<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> length_sequence_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"function_of <span class="free">A</span> <span class="free">enum</span> <span class="main">`</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms function_of_in_extensional_funcset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_function_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>function_of <span class="free">A</span> <span class="free">enum</span><span class="main">)</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"sequence_of <span class="free">A</span> <span class="free">enum</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> function_of <span class="free">A</span> <span class="free">enum</span> <span class="main">(</span>sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="bound">f</span><span class="main">)</span> <span class="main">=</span> <span class="bound">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> function_of_sequence_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span><span class="main">∈</span><span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span><span class="main">.</span> sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="main">(</span>function_of <span class="free">A</span> <span class="free">enum</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">=</span> <span class="bound">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sequence_of_function_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms set_sequence_of<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> length_sequence_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"function_of <span class="free">A</span> <span class="free">enum</span> <span class="main">`</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms function_of_in_extensional_funcset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinality›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> card <span class="free">B</span> <span class="main">^</span> card <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">enum</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> ex_bij_betw_nat_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>sequence_of <span class="free">A</span> <span class="skolem">enum</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_sequence_of<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span> <span class="main">=</span> card <span class="free">B</span> <span class="main">^</span> card <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_lists_length_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_sequences<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span> <span class="main">=</span> card <span class="free">B</span> <span class="main">^</span> card <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">enum</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> ex_bij_betw_nat_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>function_of <span class="free">A</span> <span class="skolem">enum</span><span class="main">)</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_function_of<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span> <span class="main">=</span> card <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> card <span class="free">B</span> <span class="main">^</span> card <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_extensional_funcset<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">^</span> card <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_sequences<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Twelvefold_Way_Entry2">
<div class="head">
<h1>Theory Twelvefold_Way_Entry2</h1>
</div>
<pre class="source"><span class="comment1">(*  Author: Lukas Bulwahn &lt;lukas.bulwahn-at-gmail.com&gt; *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Injections from A to B›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Twelvefold_Way_Entry2
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Twelvefold_Way_Entry1.html">Twelvefold_Way_Entry1</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Note that the cardinality theorems of both structures, distinct lists
and finite injective functions, are already available. Hence, this
development creates the bijection between those two structures and
transfers the one cardinality theorem to the other structures and vice
versa, although not strictly needed as both cardinality theorems were
already available.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties for Bijections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inj_on_implies_distinct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span>sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> bounds assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> bounds'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> card <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> card <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> length_sequence_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> in_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">enum</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">enum</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bij_betwE <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>›</span></span>  bounds' assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">enum</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="free">enum</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_inv_into_left lessThan_iff atLeast0LessThan<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">enum</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="free">f</span> <span class="main">(</span><span class="free">enum</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> in_A inj_onD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> this bounds' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="free">f</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">≠</span> sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="free">f</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_sequence_of<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_conv_nth<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> distinct_implies_inj_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>function_of <span class="free">A</span> <span class="free">enum</span> <span class="free">xs</span><span class="main">)</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?idx_of</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inv_into <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">xs</span><span class="main">}</span> <span class="free">enum</span> <span class="bound">x</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"function_of <span class="free">A</span> <span class="free">enum</span> <span class="free">xs</span> <span class="skolem">x</span> <span class="main">=</span> function_of <span class="free">A</span> <span class="free">enum</span> <span class="free">xs</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> <span class="var">?idx_of</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="var">?idx_of</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> function_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?idx_of</span> <span class="skolem">x</span> <span class="main">=</span> <span class="var">?idx_of</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?idx_of</span> <span class="skolem">x</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atLeast0LessThan bij_betw_imp_surj_on inv_into_into lessThan_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?idx_of</span> <span class="skolem">y</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atLeast0LessThan bij_betw_imp_surj_on inv_into_into lessThan_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="free">xs</span> <span class="main">!</span> <span class="var">?idx_of</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="var">?idx_of</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="free">xs</span>›</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> nth_eq_iff_index_eq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> i<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="var">?idx_of</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> j<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="var">?idx_of</span> <span class="skolem">y</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹bij_betw <span class="main">_</span> <span class="main">_</span> <span class="main">_</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="free">xs</span> <span class="main">=</span> card <span class="free">A</span>›</span></span> bij_betw_inv_into_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> image_sequence_of_inj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">∧</span> distinct <span class="bound">xs</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> xs f <span class="quoted"><span class="quoted">‹bij_betw <span class="main">_</span> <span class="main">_</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">xs</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_sequence_of subsetCE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> xs f <span class="quoted"><span class="quoted">‹bij_betw <span class="main">_</span> <span class="main">_</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> length_sequence_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> xs f <span class="quoted"><span class="quoted">‹bij_betw <span class="main">_</span> <span class="main">_</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inj_on_implies_distinct <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">∧</span> distinct <span class="bound">xs</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> image_function_of_distinct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"function_of <span class="free">A</span> <span class="free">enum</span> <span class="main">`</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">∧</span> distinct <span class="bound">xs</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> function_of <span class="free">A</span> <span class="free">enum</span> <span class="main">`</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">∧</span> distinct <span class="bound">xs</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> f assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> function_of_in_extensional_funcset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> f assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms distinct_implies_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bijections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_sequence_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>sequence_of <span class="free">A</span> <span class="free">enum</span><span class="main">)</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span> <span class="main">∧</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">∧</span> distinct <span class="bound">xs</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"function_of <span class="free">A</span> <span class="free">enum</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span><span class="main">.</span> function_of <span class="free">A</span> <span class="free">enum</span> <span class="main">(</span>sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="bound">f</span><span class="main">)</span> <span class="main">=</span> <span class="bound">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> function_of_sequence_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span><span class="main">∈</span><span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">∧</span> distinct <span class="bound">xs</span><span class="main">}</span><span class="main">.</span> sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="main">(</span>function_of <span class="free">A</span> <span class="free">enum</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">=</span> <span class="bound">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sequence_of_function_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">∧</span> distinct <span class="bound">xs</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_sequence_of_inj<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"function_of <span class="free">A</span> <span class="free">enum</span> <span class="main">`</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">∧</span> distinct <span class="bound">xs</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_function_of_distinct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_function_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>function_of <span class="free">A</span> <span class="free">enum</span><span class="main">)</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">∧</span> distinct <span class="bound">xs</span><span class="main">}</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"sequence_of <span class="free">A</span> <span class="free">enum</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span><span class="main">.</span> function_of <span class="free">A</span> <span class="free">enum</span> <span class="main">(</span>sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="bound">f</span><span class="main">)</span> <span class="main">=</span> <span class="bound">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> function_of_sequence_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span><span class="main">∈</span><span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">∧</span> distinct <span class="bound">xs</span><span class="main">}</span><span class="main">.</span> sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="main">(</span>function_of <span class="free">A</span> <span class="free">enum</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">=</span> <span class="bound">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sequence_of_function_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sequence_of <span class="free">A</span> <span class="free">enum</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">∧</span> distinct <span class="bound">xs</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_sequence_of_inj<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"function_of <span class="free">A</span> <span class="free">enum</span> <span class="main">`</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">∧</span> distinct <span class="bound">xs</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_function_of_distinct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinality›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≤</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">=</span> <span class="main">∏</span><span class="main">{</span>card <span class="free">B</span> <span class="main">-</span> card <span class="free">A</span> <span class="main">+</span> <span class="main">1</span><span class="main">..</span>card <span class="free">B</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">enum</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> ex_bij_betw_nat_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>sequence_of <span class="free">A</span> <span class="skolem">enum</span><span class="main">)</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">∧</span> distinct <span class="bound">xs</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_sequence_of<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">∧</span> distinct <span class="bound">xs</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">∧</span> distinct <span class="bound">xs</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">∧</span> distinct <span class="bound">xs</span> <span class="main">∧</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">∧</span> distinct <span class="bound">xs</span> <span class="main">∧</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span><span class="main">}</span> <span class="main">=</span> <span class="main">∏</span><span class="main">{</span>card <span class="free">B</span> <span class="main">-</span> card <span class="free">A</span> <span class="main">+</span> <span class="main">1</span><span class="main">..</span>card <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">A</span> <span class="main">≤</span> card <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> List.card_lists_distinct_length_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_sequences<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≤</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">∧</span> distinct <span class="bound">xs</span><span class="main">}</span> <span class="main">=</span> fact <span class="main">(</span>card <span class="free">B</span><span class="main">)</span> <span class="keyword1">div</span> fact <span class="main">(</span>card <span class="free">B</span> <span class="main">-</span> card <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">enum</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> ex_bij_betw_nat_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>function_of <span class="free">A</span> <span class="skolem">enum</span><span class="main">)</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">∧</span> distinct <span class="bound">xs</span><span class="main">}</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_function_of<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> card <span class="free">A</span> <span class="main">∧</span> distinct <span class="bound">xs</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">=</span> fact <span class="main">(</span>card <span class="free">B</span><span class="main">)</span> <span class="keyword1">div</span> fact <span class="main">(</span>card <span class="free">B</span> <span class="main">-</span> card <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">A</span> <span class="main">≤</span> card <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_extensional_funcset_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Twelvefold_Way_Entry4">
<div class="head">
<h1>Theory Twelvefold_Way_Entry4</h1>
</div>
<pre class="source"><span class="comment1">(*  Author: Lukas Bulwahn &lt;lukas.bulwahn-at-gmail.com&gt; *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Functions from A to B, up to a Permutation of A›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Twelvefold_Way_Entry4
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Equiv_Relations_on_Functions.html">Equiv_Relations_on_Functions</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition of Bijections›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">msubset_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span>  <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'b</span> multiset"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">msubset_of</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> image_mset <span class="bound">f</span> <span class="main">(</span>mset_set <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">functions_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> multiset <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">functions_of</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> set_mset <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">.</span> image_mset <span class="bound">f</span> <span class="main">(</span>mset_set <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties for Bijections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> msubset_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"size <span class="main">(</span>msubset_of <span class="free">A</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="main">(</span>msubset_of <span class="free">A</span> <span class="free">F</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> F_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> quotientE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"msubset_of <span class="free">A</span> <span class="free">F</span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> image_mset <span class="bound">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> msubset_of_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> image_mset <span class="bound">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> F_eq <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_domain_permutation image_mset_respects_domain_permutation <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> univ_commute'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> msubset_of_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"msubset_of <span class="free">A</span> <span class="free">F</span> <span class="main">=</span> image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"size <span class="main">(</span>msubset_of <span class="free">A</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"size <span class="main">(</span>msubset_of <span class="free">A</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> size <span class="main">(</span>image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> msubset_of_eq <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="main">(</span>msubset_of <span class="free">A</span> <span class="free">F</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="main">(</span>msubset_of <span class="free">A</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> set_mset <span class="main">(</span>image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> msubset_of_eq <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> functions_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="free">M</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"size <span class="free">M</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">M</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> set_mset <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> obtain_function_on_ext_funcset <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹size <span class="free">M</span> <span class="main">=</span> card <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> set_mset <span class="free">M</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹set_mset <span class="free">M</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span> PiE_iff subset_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">M</span> <span class="main">=</span> <span class="main">(</span>domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">M</span> <span class="main">⊆</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="free">M</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">=</span> image_mset <span class="skolem">f'</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PiE_iff image_subset_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span> <span class="main">=</span> image_mset <span class="skolem">f'</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span>›</span></span>
          image_mset_eq_implies_permutes <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span> <span class="main">⊆</span> functions_of <span class="free">A</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">M</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="skolem">f'</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">M</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> congruentD<span class="main">[</span><span class="operator">OF</span> image_mset_respects_domain_permutation<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> set_mset <span class="free">M</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="free">M</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> quotientI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> functions_of_msubset_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="main">(</span>msubset_of <span class="free">A</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> F_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> quotientE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"msubset_of <span class="free">A</span> <span class="free">F</span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> image_mset <span class="bound">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> msubset_of_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> image_mset <span class="bound">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> F_eq <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_domain_permutation image_mset_respects_domain_permutation <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> univ_commute'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> msubset_of_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"msubset_of <span class="free">A</span> <span class="free">F</span> <span class="main">=</span> image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="main">(</span>msubset_of <span class="free">A</span> <span class="free">F</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="main">(</span>msubset_of <span class="free">A</span> <span class="free">F</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> f'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">f</span> <span class="main">`</span> set_mset <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"image_mset <span class="skolem">f'</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> msubset_of_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> f'<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹image_mset <span class="skolem">f'</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_mset_eq_implies_permutes<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> F_eq domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> functions_of <span class="free">A</span> <span class="main">(</span>msubset_of <span class="free">A</span> <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> F_eq domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">F</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> F_eq domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset <span class="skolem">f'</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> permutes_implies_image_mset_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> set_mset <span class="main">(</span>image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="main">(</span>msubset_of <span class="free">A</span> <span class="free">F</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def msubset_of_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> msubset_of_functions_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="free">M</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"size <span class="free">M</span> <span class="main">=</span> card <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"msubset_of <span class="free">A</span> <span class="main">(</span>functions_of <span class="free">A</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">M</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> functions_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">M</span> <span class="main">=</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> quotientE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_domain_permutation equiv_class_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"msubset_of <span class="free">A</span> <span class="main">(</span>functions_of <span class="free">A</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> image_mset <span class="bound">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>functions_of <span class="free">A</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> msubset_of_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> image_mset <span class="bound">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹functions_of <span class="free">A</span> <span class="free">M</span> <span class="main">=</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_domain_permutation image_mset_respects_domain_permutation <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> univ_commute'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="free">M</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bijections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_msubset_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>msubset_of <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">M</span><span class="main">.</span> functions_of <span class="free">A</span> <span class="bound">M</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">.</span> functions_of <span class="free">A</span> <span class="main">(</span>msubset_of <span class="free">A</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="bound">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> functions_of_msubset_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">M</span><span class="main">∈</span><span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span><span class="main">.</span> msubset_of <span class="free">A</span> <span class="main">(</span>functions_of <span class="free">A</span> <span class="bound">M</span><span class="main">)</span> <span class="main">=</span> <span class="bound">M</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> msubset_of_functions_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"msubset_of <span class="free">A</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> msubset_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="main">`</span> <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> functions_of <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinality›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> card <span class="free">B</span> <span class="main">+</span> card <span class="free">A</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">choose</span> card <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>msubset_of <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_msubset_of<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span> <span class="main">=</span> card <span class="free">B</span> <span class="main">+</span> card <span class="free">A</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">choose</span> card <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_multisets<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Twelvefold_Way_Entry5">
<div class="head">
<h1>Theory Twelvefold_Way_Entry5</h1>
</div>
<pre class="source"><span class="comment1">(*  Author: Lukas Bulwahn &lt;lukas.bulwahn-at-gmail.com&gt; *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Injections from A to B up to a Permutation of A›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Twelvefold_Way_Entry5
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Equiv_Relations_on_Functions.html">Equiv_Relations_on_Functions</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition of Bijections›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subset_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span>  <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'b</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subset_of</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">functions_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">functions_of</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties for Bijections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> functions_of_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_imageI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">⊆</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> PiE_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">(</span><span class="bound">p</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> inv_into <span class="free">A</span> <span class="skolem">f'</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="bound">x</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="keyword1">permutes</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">(</span><span class="var">?p</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_imp_permutes<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="var">?p</span> <span class="free">A</span> <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_imageI<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?p</span> <span class="free">A</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">a'</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">a</span> <span class="main">=</span> <span class="var">?p</span> <span class="skolem">a'</span>"</span></span>
              <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv_into <span class="free">A</span> <span class="skolem">f'</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> inv_into <span class="free">A</span> <span class="skolem">f'</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">a'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">a'</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> inv_into_injective <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij bij_betw_inv_into_left<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_subsetI inv_into_into<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="var">?p</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span>
                <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
                <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f'</span> <span class="free">A</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹inj_on <span class="free">f</span> <span class="free">A</span>›</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_image eq_card_imp_inj_on<span class="main">)</span>
                <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv_into <span class="free">A</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">f'</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_eqI inv_into_into<span class="main">)</span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> inv_into <span class="free">A</span> <span class="skolem">f'</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>inv_into <span class="free">A</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">f'</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹inj_on <span class="skolem">f'</span> <span class="free">A</span>›</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f_inv_into_f image_eqI inv_into_f_f<span class="main">)</span>
                <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?p</span> <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">(</span><span class="var">?p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_inv_into_f<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">⊆</span> functions_of <span class="free">A</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="skolem">x'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>inv <span class="skolem">p</span> <span class="skolem">x'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> permutes_in_image permutes_inverses<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="skolem">p</span> <span class="skolem">x'</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> p <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_in_image permutes_inv<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="skolem">f'</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> p permutes_in_image <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subset_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subset_of <span class="free">A</span> <span class="free">F</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>subset_of <span class="free">A</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> F_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> <span class="main">(</span>domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mem_Collect_eq quotientE <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subset_of <span class="free">A</span> <span class="main">(</span>domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_domain_permutation image_respects_domain_permutation
    <span class="keyword1"><span class="command">unfolding</span></span> subset_of_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> univ_commute'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this f F_eq <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subset_of <span class="free">A</span> <span class="free">F</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>subset_of <span class="free">A</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_image<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> functions_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">X</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">X</span> <span class="main">∧</span> bij_betw <span class="skolem">f</span> <span class="free">A</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_same_card_bij_on_ext_funcset finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> f <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_imp_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">X</span> <span class="main">=</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> functions_of_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">X</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> quotientI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subset_of_functions_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subset_of <span class="free">A</span> <span class="main">(</span>functions_of <span class="free">A</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> <span class="free">A</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_same_card_bij_on_ext_funcset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> subset_of<span class="main">:</span> <span class="quoted"><span class="quoted">"subset_of <span class="free">A</span> <span class="main">(</span>domain_permutation <span class="free">A</span> <span class="free">X</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_domain_permutation image_respects_domain_permutation
    <span class="keyword1"><span class="command">unfolding</span></span> subset_of_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> univ_commute'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">f</span> <span class="free">A</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subset_of <span class="free">A</span> <span class="main">(</span>functions_of <span class="free">A</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> subset_of <span class="free">A</span> <span class="main">(</span>functions_of <span class="free">A</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> subset_of <span class="free">A</span> <span class="main">(</span>domain_permutation <span class="free">A</span> <span class="free">X</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹inj_on <span class="skolem">f</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> functions_of_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹inj_on <span class="skolem">f</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_of<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> functions_of_subset_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="main">(</span>subset_of <span class="free">A</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> quotientE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> F_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subset_of <span class="free">A</span> <span class="main">(</span>domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_domain_permutation image_respects_domain_permutation
    <span class="keyword1"><span class="command">unfolding</span></span> subset_of_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> univ_commute'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this f F_eq <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="main">(</span>subset_of <span class="free">A</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> functions_of_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bijections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_subset_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>subset_of <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"functions_of <span class="free">A</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">.</span> functions_of <span class="free">A</span> <span class="main">(</span>subset_of <span class="free">A</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="bound">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> functions_of_subset_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span><span class="main">.</span> subset_of <span class="free">A</span> <span class="main">(</span>functions_of <span class="free">A</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="bound">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subset_of_functions_of <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> finite_subset mem_Collect_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subset_of <span class="free">A</span> <span class="main">`</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subset_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="main">`</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> functions_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_functions_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>functions_of <span class="free">A</span><span class="main">)</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"subset_of <span class="free">A</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">.</span> functions_of <span class="free">A</span> <span class="main">(</span>subset_of <span class="free">A</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="bound">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> functions_of_subset_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span><span class="main">.</span> subset_of <span class="free">A</span> <span class="main">(</span>functions_of <span class="free">A</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="bound">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subset_of_functions_of <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> finite_subset mem_Collect_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subset_of <span class="free">A</span> <span class="main">`</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subset_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="main">`</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> functions_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_mset_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw mset_set <span class="main">{</span><span class="bound">A</span><span class="main">.</span> finite <span class="bound">A</span><span class="main">}</span> <span class="main">{</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> count <span class="bound">M</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"set_mset"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="main">{</span><span class="bound">A</span><span class="main">.</span> finite <span class="bound">A</span><span class="main">}</span><span class="main">.</span> set_mset <span class="main">(</span>mset_set <span class="bound">A</span><span class="main">)</span> <span class="main">=</span> <span class="bound">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">M</span><span class="main">∈</span><span class="main">{</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> count <span class="bound">M</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> mset_set <span class="main">(</span>set_mset <span class="bound">M</span><span class="main">)</span> <span class="main">=</span> <span class="bound">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mset_set_set_mset'<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="main">`</span> <span class="main">{</span><span class="bound">A</span><span class="main">.</span> finite <span class="bound">A</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> count <span class="bound">M</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nat_le_linear <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="main">`</span> <span class="main">{</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> count <span class="bound">M</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">A</span><span class="main">.</span> finite <span class="bound">A</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_mset_set_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw mset_set <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">{</span><span class="bound">M</span><span class="main">.</span> <span class="bound">M</span> <span class="main">⊆#</span> mset_set <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"set_mset"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span><span class="main">.</span> set_mset <span class="main">(</span>mset_set <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="bound">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> rev_finite_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">M</span><span class="main">∈</span><span class="main">{</span><span class="bound">M</span><span class="main">.</span> <span class="bound">M</span> <span class="main">⊆#</span> mset_set <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span><span class="main">.</span> mset_set <span class="main">(</span>set_mset <span class="bound">M</span><span class="main">)</span> <span class="main">=</span> <span class="bound">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mset_set_set_mset<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="main">`</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">M</span><span class="main">.</span> <span class="bound">M</span> <span class="main">⊆#</span> mset_set <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> rev_finite_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mset_set_subseteq_mset_set<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="main">`</span> <span class="main">{</span><span class="bound">M</span><span class="main">.</span> <span class="bound">M</span> <span class="main">⊆#</span> mset_set <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms mset_subset_eqD card_set_mset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_mset_set_card'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw mset_set <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> count <span class="bound">M</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"set_mset"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span><span class="main">.</span> set_mset <span class="main">(</span>mset_set <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="bound">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> rev_finite_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">M</span><span class="main">∈</span><span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> count <span class="bound">M</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> mset_set <span class="main">(</span>set_mset <span class="bound">M</span><span class="main">)</span> <span class="main">=</span> <span class="bound">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mset_set_set_mset'<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mset_set <span class="main">`</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> count <span class="bound">M</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> rev_finite_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_mset_set_leq'<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="main">`</span> <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> count <span class="bound">M</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_set_mset'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinality›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_injective_functions_domain_permutation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> card <span class="free">B</span> <span class="keyword1">choose</span> card <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>subset_of <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_subset_of<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span> <span class="main">=</span> card <span class="free">B</span> <span class="keyword1">choose</span> card <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> n_subsets<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_multiset_only_sets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">M</span><span class="main">.</span> <span class="bound">M</span> <span class="main">⊆#</span> mset_set <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">=</span> card <span class="free">A</span> <span class="keyword1">choose</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw mset_set <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">{</span><span class="bound">M</span><span class="main">.</span> <span class="bound">M</span> <span class="main">⊆#</span> mset_set <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_mset_set_card<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">M</span><span class="main">.</span> <span class="bound">M</span> <span class="main">⊆#</span> mset_set <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_same_card<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" card <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">=</span> card <span class="free">A</span> <span class="keyword1">choose</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> n_subsets<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_multiset_only_sets'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> count <span class="bound">M</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> card <span class="free">A</span> <span class="keyword1">choose</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> count <span class="bound">M</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
    <span class="main">{</span><span class="bound">M</span><span class="main">.</span> <span class="bound">M</span> <span class="main">⊆#</span> mset_set <span class="free">A</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> msubset_mset_set_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> card_multiset_only_sets <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Twelvefold_Way_Entry6">
<div class="head">
<h1>Theory Twelvefold_Way_Entry6</h1>
</div>
<pre class="source"><span class="comment1">(*  Author: Lukas Bulwahn &lt;lukas.bulwahn-at-gmail.com&gt; *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Surjections from A to B up to a Permutation on A›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Twelvefold_Way_Entry6
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Twelvefold_Way_Entry4.html">Twelvefold_Way_Entry4</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties for Bijections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_mset_eq_implies_surj_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"size <span class="free">M</span> <span class="main">=</span> card <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="free">M</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="free">M</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="free">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹image_mset <span class="free">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">M</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹set_mset <span class="free">M</span> <span class="main">=</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> finite_set_mset_mset_set set_image_mset <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> surj_on_implies_set_mset_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="main">(</span>msubset_of <span class="free">A</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> F_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> quotientE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"msubset_of <span class="free">A</span> <span class="free">F</span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> image_mset <span class="bound">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> msubset_of_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> image_mset <span class="bound">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> F_eq <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_domain_permutation image_mset_respects_domain_permutation <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> univ_commute'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"msubset_of <span class="free">A</span> <span class="free">F</span> <span class="main">=</span> image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> iffD1<span class="main">[</span><span class="operator">OF</span> univ_commute'<span class="main">,</span> <span class="operator">OF</span> equiv_domain_permutation<span class="main">,</span> <span class="operator">OF</span> surjective_respects_domain_permutation<span class="main">,</span> <span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span><span class="main">]</span>
    <span class="quoted"><span class="quoted">‹univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">)</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="main">(</span>image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="main">(</span>image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> set_mset <span class="main">(</span>image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>›</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> in_image_mset<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="main">(</span>msubset_of <span class="free">A</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> functions_of_is_surj_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"size <span class="free">M</span> <span class="main">=</span> card <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="free">M</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span>functions_of <span class="free">A</span> <span class="free">M</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">M</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> functions_of <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹size <span class="free">M</span> <span class="main">=</span> card <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹set_mset <span class="free">M</span> <span class="main">=</span> <span class="free">B</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq_f<span class="main">:</span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">M</span> <span class="main">=</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> quotientE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> eq_f <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> equiv_domain_permutation equiv_class_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="free">M</span>›</span></span> assms set_mset_eq_implies_surj_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq_f <span class="keyword1"><span class="command">using</span></span> equiv_domain_permutation surjective_respects_domain_permutation <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> univ_commute'<span class="main">)</span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bijections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_msubset_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>msubset_of <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>
    <span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">=</span> <span class="free">B</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">_</span> <span class="var">?FSet</span> <span class="var">?MSet</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">M</span><span class="main">.</span> functions_of <span class="free">A</span> <span class="bound">M</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> quotient_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?FSet</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">F</span></span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">.</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">)</span> <span class="bound">F</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_domain_permutation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> surjective_respects_domain_permutation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> univ_preserves_predicate<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">∈</span><span class="var">?FSet</span><span class="main">.</span> functions_of <span class="free">A</span> <span class="main">(</span>msubset_of <span class="free">A</span> <span class="bound">f</span><span class="main">)</span> <span class="main">=</span> <span class="bound">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> quotient_eq functions_of_msubset_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">M</span><span class="main">∈</span><span class="var">?MSet</span><span class="main">.</span> msubset_of <span class="free">A</span> <span class="main">(</span>functions_of <span class="free">A</span> <span class="bound">M</span><span class="main">)</span> <span class="main">=</span> <span class="bound">M</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> msubset_of_functions_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"msubset_of <span class="free">A</span> <span class="main">`</span> <span class="var">?FSet</span> <span class="main">⊆</span> <span class="var">?MSet</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotient_eq surj_on_implies_set_mset_eq msubset_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="main">`</span> <span class="var">?MSet</span> <span class="main">⊆</span> <span class="var">?FSet</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotient_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> functions_of functions_of_is_surj_on<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinality›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_surjective_functions_domain_permutation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">B</span> <span class="main">≤</span> card <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>card <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>card <span class="free">A</span> <span class="main">-</span> card <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?FSet</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?MSet</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">M</span><span class="main">.</span> set_mset <span class="bound">M</span> <span class="main">=</span> <span class="free">B</span> <span class="main">∧</span> size <span class="bound">M</span> <span class="main">=</span> card <span class="free">A</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>msubset_of <span class="free">A</span><span class="main">)</span> <span class="var">?FSet</span> <span class="var">?MSet</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_msubset_of<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?FSet</span> <span class="main">=</span> card <span class="var">?MSet</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?MSet</span> <span class="main">=</span> <span class="main">(</span>card <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">choose</span> <span class="main">(</span>card <span class="free">A</span> <span class="main">-</span> card <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">B</span> <span class="main">≤</span> card <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_multisets_covering_set<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Twelvefold_Way_Entry7">
<div class="head">
<h1>Theory Twelvefold_Way_Entry7</h1>
</div>
<pre class="source"><span class="comment1">(*  Author: Lukas Bulwahn &lt;lukas.bulwahn-at-gmail.com&gt; *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Functions from A to B up to a Permutation on B›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Twelvefold_Way_Entry7
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Equiv_Relations_on_Functions.html">Equiv_Relations_on_Functions</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition of Bijections›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">partitions_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">partitions_of</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">functions_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">functions_of</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties for Bijections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> partitions_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>partitions_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"partition_on <span class="free">A</span> <span class="main">(</span>partitions_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> F_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> quotientE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"partitions_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> partitions_of_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> F_eq <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_range_permutation domain_partitions_respects_range_permutation <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> univ_commute'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> partitions_of_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"partitions_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>partitions_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>partitions_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> partitions_of_eq <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> card_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> card <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_image_le<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"partition_on <span class="free">A</span> <span class="main">(</span>partitions_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"partition_on <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> partition_onI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> partitions_of_eq <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> functions_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"partition_on <span class="free">A</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">P</span> <span class="main">≤</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> obtain_function_with_partition<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹partition_on <span class="free">A</span> <span class="free">P</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">P</span> <span class="main">≤</span> card <span class="free">B</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span> <span class="main">⊆</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> r1 r2
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> partitions_eq_implies_permutes<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span> <span class="main">⊆</span> functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> congruentD<span class="main">[</span><span class="operator">OF</span> domain_partitions_respects_range_permutation<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> this r1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> quotientI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> functions_of_partitions_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="main">(</span>partitions_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span> <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> F_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> quotientE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> partitions_of_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"partitions_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> partitions_of_def F_eq
        <span class="keyword1"><span class="command">using</span></span> equiv_range_permutation domain_partitions_respects_range_permutation <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> univ_commute'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="main">(</span>partitions_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span> <span class="free">A</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
      <span class="keyword3"><span class="command">assume</span></span> f'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> functions_of <span class="main">(</span>partitions_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> partitions_of_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> f' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> partitions_eq_implies_permutes<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> F_eq range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> functions_of <span class="main">(</span>partitions_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> F_eq range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">F</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> F_eq range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> permutes_implies_inv_image_on_eq<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">f'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> functions_of <span class="main">(</span>partitions_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def partitions_of_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> partitions_of_functions_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"partition_on <span class="free">A</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">P</span> <span class="main">≤</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"partitions_of <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹partition_on <span class="free">A</span> <span class="free">P</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">P</span> <span class="main">≤</span> card <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> functions_of<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> functions_of_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> quotientE <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> functions_of_eq <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_range_permutation equiv_class_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"partitions_of <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> partitions_of_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_range_permutation domain_partitions_respects_range_permutation <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> univ_commute'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bijections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_partitions_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>partitions_of <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">P</span><span class="main">.</span> functions_of <span class="bound">P</span> <span class="free">A</span> <span class="free">B</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">.</span> functions_of <span class="main">(</span>partitions_of <span class="free">A</span> <span class="free">B</span> <span class="bound">F</span><span class="main">)</span> <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="bound">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> functions_of_partitions_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">P</span><span class="main">∈</span><span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span><span class="main">.</span> partitions_of <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>functions_of <span class="bound">P</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="bound">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> partitions_of_functions_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"partitions_of <span class="free">A</span> <span class="free">B</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> partitions_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">P</span><span class="main">.</span> functions_of <span class="bound">P</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> functions_of <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinality›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span>card <span class="free">B</span><span class="main">.</span> Stirling <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>partitions_of <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_partitions_of<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card  <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span>card <span class="free">B</span><span class="main">.</span> Stirling <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_partition_on_at_most_size<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Twelvefold_Way_Entry8">
<div class="head">
<h1>Theory Twelvefold_Way_Entry8</h1>
</div>
<pre class="source"><span class="comment1">(*  Author: Lukas Bulwahn &lt;lukas.bulwahn-at-gmail.com&gt; *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Injections from A to B up to a Permutation on B›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Twelvefold_Way_Entry8
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Twelvefold_Way_Entry7.html">Twelvefold_Way_Entry7</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties for Bijections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inj_on_implies_partitions_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> partitions_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> F_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> quotientE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">)</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> univ_commute'<span class="main">[</span><span class="operator">OF</span> equiv_range_permutation inj_on_respects_range_permutation <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">xa</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">xa</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹inj_on <span class="skolem">f</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> inj_onD<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> partitions_of_def F_eq
    <span class="keyword1"><span class="command">using</span></span> equiv_range_permutation domain_partitions_respects_range_permutation <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> univ_commute'<span class="main">)</span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unique_part_eq_singleton<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"partition_on <span class="free">A</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹partition_on <span class="free">A</span> <span class="free">P</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> partition_on_the_part_mem<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">X</span><span class="main">.</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹partition_on <span class="free">A</span> <span class="free">P</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> partition_on_in_the_unique_part<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_1_singletonE singleton_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> functions_of_is_inj_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"partition_on <span class="free">A</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">P</span> <span class="main">≤</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> functions_of <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹partition_on <span class="free">A</span> <span class="free">P</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">P</span> <span class="main">≤</span> card <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq_f<span class="main">:</span> <span class="quoted"><span class="quoted">"functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> quotientE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> eq_f <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> equiv_range_permutation equiv_class_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x'</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x'</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x'</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x'</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">}</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="main">1</span>›</span></span> eq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_1_singletonE singletonD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq_f <span class="keyword1"><span class="command">using</span></span> equiv_range_permutation inj_on_respects_range_permutation <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> univ_commute'<span class="main">)</span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bijections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_partitions_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>partitions_of <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">≤</span> card <span class="free">B</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="bound">P</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">P</span><span class="main">.</span> functions_of <span class="bound">P</span> <span class="free">A</span> <span class="free">B</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> quotient_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">F</span></span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">.</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">)</span> <span class="bound">F</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equiv_range_permutation inj_on_respects_range_permutation univ_preserves_predicate<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">.</span> functions_of <span class="main">(</span>partitions_of <span class="free">A</span> <span class="free">B</span> <span class="bound">F</span><span class="main">)</span> <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="bound">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotient_eq functions_of_partitions_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">P</span><span class="main">∈</span><span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">≤</span> card <span class="free">B</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="bound">P</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> partitions_of <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>functions_of <span class="bound">P</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="bound">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> partitions_of_functions_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"partitions_of <span class="free">A</span> <span class="free">B</span> <span class="main">`</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">≤</span> card <span class="free">B</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="bound">P</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> quotient_eq partitions_of inj_on_implies_partitions_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">P</span><span class="main">.</span> functions_of <span class="bound">P</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">≤</span> card <span class="free">B</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="bound">P</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotient_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> functions_of functions_of_is_inj_on<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinality›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_injective_functions_range_permutation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> iverson <span class="main">(</span>card <span class="free">A</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">enum</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">enum</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> ex_bij_betw_nat_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>partitions_of <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">≤</span> card <span class="free">B</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="bound">P</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_partitions_of<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">≤</span> card <span class="free">B</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="bound">P</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">≤</span> card <span class="free">B</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="bound">P</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> iverson <span class="main">(</span>card <span class="free">A</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_partition_on_size1_eq_iverson<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Twelvefold_Way_Entry9">
<div class="head">
<h1>Theory Twelvefold_Way_Entry9</h1>
</div>
<pre class="source"><span class="comment1">(*  Author: Lukas Bulwahn &lt;lukas.bulwahn-at-gmail.com&gt; *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Surjections from A to B up to a Permutation on B›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Twelvefold_Way_Entry9
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Twelvefold_Way_Entry7.html">Twelvefold_Way_Entry7</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties for Bijections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> surjective_on_implies_card_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inj_onI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{}</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_image<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_eq_implies_surjective_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> card_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"card <span class="free">B</span> <span class="main">≥</span> <span class="main">1</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> card <span class="free">B</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">B</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card <span class="free">B</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">{}</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">B</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> card_image_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">B</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_Diff_singleton<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this card_eq <span class="quoted"><span class="quoted">‹card <span class="free">B</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_partitions_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>partitions_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> F_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> quotientE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">)</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> univ_commute'<span class="main">[</span><span class="operator">OF</span> equiv_range_permutation surj_on_respects_range_permutation <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>partitions_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> partitions_of_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">(</span>univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> F_eq <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_range_permutation domain_partitions_respects_range_permutation <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> univ_commute'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> surjective_on_implies_card_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> functions_of_is_surj_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"partition_on <span class="free">A</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">P</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span>functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> functions_of <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹partition_on <span class="free">A</span> <span class="free">P</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">P</span> <span class="main">=</span> card <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq_f<span class="main">:</span> <span class="quoted"><span class="quoted">"functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> quotientE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> eq_f <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> equiv_range_permutation equiv_class_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> functions_of <span class="free">P</span> <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">P</span> <span class="main">=</span> card <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_eq_implies_surjective_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq_f <span class="keyword1"><span class="command">using</span></span> equiv_range_permutation surj_on_respects_range_permutation <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> univ_commute'<span class="main">)</span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bijections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_partitions_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>partitions_of <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">=</span> card <span class="free">B</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">P</span><span class="main">.</span> functions_of <span class="bound">P</span> <span class="free">A</span> <span class="free">B</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> quotient_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">F</span></span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">.</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">)</span> <span class="bound">F</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> equiv_range_permutation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> surj_on_respects_range_permutation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> univ_preserves_predicate<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">.</span> functions_of <span class="main">(</span>partitions_of <span class="free">A</span> <span class="free">B</span> <span class="bound">F</span><span class="main">)</span> <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="bound">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> functions_of_partitions_of quotient_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">P</span><span class="main">∈</span><span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">=</span> card <span class="free">B</span><span class="main">}</span><span class="main">.</span> partitions_of <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>functions_of <span class="bound">P</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="bound">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> partitions_of_functions_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"partitions_of <span class="free">A</span> <span class="free">B</span> <span class="main">`</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">=</span> card <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> quotient_eq card_partitions_of partitions_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">P</span><span class="main">.</span> functions_of <span class="bound">P</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">=</span> card <span class="free">B</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotient_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> functions_of functions_of_is_surj_on<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinality›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_surjective_functions_range_permutation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> Stirling <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="main">(</span>card <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>partitions_of <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">=</span> card <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_partitions_of<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">=</span> card <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">=</span> card <span class="free">B</span><span class="main">}</span> <span class="main">=</span> Stirling <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="main">(</span>card <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_partition_on<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Twelvefold_Way_Entry3">
<div class="head">
<h1>Theory Twelvefold_Way_Entry3</h1>
</div>
<pre class="source"><span class="comment1">(*  Author: Lukas Bulwahn &lt;lukas.bulwahn-at-gmail.com&gt; *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Surjections from A to B›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Twelvefold_Way_Entry3
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Twelvefold_Way_Entry9.html">Twelvefold_Way_Entry9</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_of_equiv_class<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">F</span> <span class="main">=</span> fact <span class="main">(</span>card <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> F_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> quotientE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> set_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="bound">p</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="free">B</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="bound">p</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> inv <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> inv <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span>›</span></span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> permutes_inverses<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_inv<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="bound">p</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="free">B</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">p</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="bound">p</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="free">B</span><span class="main">}</span> <span class="main">⊆</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="bound">p</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="free">B</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f'_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> permutes_in_image <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_inv<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> inv <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> f'_eq
          <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> permutes_inverses<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">p</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="bound">p</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="free">B</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">p'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="free">B</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="free">B</span><span class="main">}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="skolem">p'</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> eq this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">y</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="free">B</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="free">B</span><span class="main">}</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">F</span> <span class="main">=</span> card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">p</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="bound">p</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="free">B</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> F_eq set_eq <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">p</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="bound">p</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="free">B</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_image<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fact <span class="main">(</span>card <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_permutations<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_extensional_funcset_surj_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">=</span> fact <span class="main">(</span>card <span class="free">B</span><span class="main">)</span> <span class="main">*</span> Stirling <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="main">(</span>card <span class="free">B</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?F</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?F</span> <span class="main">=</span> fact <span class="main">(</span>card <span class="free">B</span><span class="main">)</span> <span class="main">*</span> card <span class="main">(</span><span class="var">?F</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> card_equiv_class_restricted_same_size<span class="main"><span class="main">[</span></span><span class="operator">OF</span> equiv_range_permutation surj_on_respects_range_permutation card_of_equiv_class<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fact <span class="main">(</span>card <span class="free">B</span><span class="main">)</span> <span class="main">*</span> Stirling <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="main">(</span>card <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> card_surjective_functions_range_permutation<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Twelvefold_Way_Entry10">
<div class="head">
<h1>Theory Twelvefold_Way_Entry10</h1>
</div>
<pre class="source"><span class="comment1">(*  Author: Lukas Bulwahn &lt;lukas.bulwahn-at-gmail.com&gt; *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Functions from A to B up to a Permutation on A and B›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Twelvefold_Way_Entry10
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Equiv_Relations_on_Functions.html">Equiv_Relations_on_Functions</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition of Bijections›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">number_partition_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> nat multiset"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">number_partition_of</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> image_mset <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> card <span class="bound">X</span><span class="main">)</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">functions_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> set <span class="main">⇒</span> nat multiset <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">functions_of</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">.</span> image_mset <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> card <span class="bound">X</span><span class="main">)</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties for Bijections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_setsum_partition<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">.</span> finite <span class="bound">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_Union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pairwise_def disjnt_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> number_partition_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"size <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> F_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> quotientE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> number_partition_of_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span> <span class="main">=</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> number_partition_of_def <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> F_eq <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> equiv_domain_and_range_permutation multiset_of_partition_cards_respects_domain_and_range_permutation <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> univ_commute'<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_mset <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> number_partition_of_eq <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sum_unfold_sum_mset<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> card_setsum_partition<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉#</span> number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span><span class="main">.</span> finite <span class="bound">X</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">.</span> card <span class="bound">X</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> number_partition_of_eq <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> number_partition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"size <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> number_partition_of_eq <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> card_Diff1_le card_image_le finite_imageI le_trans size_image_mset size_mset_set<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> functions_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"size <span class="free">N</span> <span class="main">≤</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq_N<span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> card <span class="bound">X</span><span class="main">)</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> obtain_extensional_function_from_number_partition <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="free">N</span>›</span></span> <span class="quoted"><span class="quoted">‹size <span class="free">N</span> <span class="main">≤</span> card <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span> <span class="main">=</span> <span class="main">(</span>domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span> <span class="main">⊆</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> eq_N'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">=</span> image_mset <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> card <span class="bound">X</span><span class="main">)</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eq_N eq_N' multiset_of_partition_cards_eq_implies_permutes<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">f'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> domain_and_range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span> <span class="main">⊆</span> functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> in_equiv_relation<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> eq_N <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> card <span class="bound">X</span><span class="main">)</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">N</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> congruentD<span class="main">[</span><span class="operator">OF</span> multiset_of_partition_cards_respects_domain_and_range_permutation in_equiv_relation<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> domain_and_range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> quotientI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> functions_of_number_partition_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> F_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> quotientE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> number_partition_of_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> F_eq <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_domain_and_range_permutation multiset_of_partition_cards_respects_domain_and_range_permutation <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> univ_commute'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> number_partition_of_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span> <span class="main">=</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> number_partition_of_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> eq
          multiset_of_partition_cards_eq_implies_permutes<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">f'</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> F_eq domain_and_range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> functions_of <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">F</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> F_eq domain_and_range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>›</span></span> permutes_implies_multiset_of_partition_cards_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> F_eq domain_and_range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def number_partition_of_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> number_partition_of_functions_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"size <span class="free">N</span> <span class="main">≤</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span><span class="main">)</span> <span class="main">=</span> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> functions_of assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span> <span class="main">=</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> quotientE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_domain_and_range_permutation equiv_class_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span><span class="main">)</span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> number_partition_of_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span>  image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span> <span class="main">=</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> equiv_domain_and_range_permutation
      multiset_of_partition_cards_respects_domain_and_range_permutation
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> univ_commute'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bijections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_number_partition_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">{</span><span class="bound">N</span><span class="main">.</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">M</span><span class="main">.</span> functions_of <span class="free">A</span> <span class="free">B</span> <span class="bound">M</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">.</span> functions_of <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="bound">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> functions_of_number_partition_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">N</span><span class="main">∈</span><span class="main">{</span><span class="bound">N</span><span class="main">.</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span><span class="main">.</span> number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>functions_of <span class="free">A</span> <span class="free">B</span> <span class="bound">N</span><span class="main">)</span> <span class="main">=</span> <span class="bound">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> number_partition_of_functions_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">N</span><span class="main">.</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> number_partition_of<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">B</span></span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">B</span> <span class="main">`</span> <span class="main">{</span><span class="bound">N</span><span class="main">.</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> functions_of <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinality›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_domain_and_range_permutation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> Partition <span class="main">(</span>card <span class="free">A</span> <span class="main">+</span> card <span class="free">B</span><span class="main">)</span> <span class="main">(</span>card <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">{</span><span class="bound">N</span><span class="main">.</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_number_partition_of<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">N</span><span class="main">.</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">N</span><span class="main">.</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span> <span class="main">=</span> Partition <span class="main">(</span>card <span class="free">A</span> <span class="main">+</span> card <span class="free">B</span><span class="main">)</span> <span class="main">(</span>card <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_number_partitions_with_atmost_k_parts<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Twelvefold_Way_Entry11">
<div class="head">
<h1>Theory Twelvefold_Way_Entry11</h1>
</div>
<pre class="source"><span class="comment1">(*  Author: Lukas Bulwahn &lt;lukas.bulwahn-at-gmail.com&gt; *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Injections from A to B up to a permutation on A and B›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Twelvefold_Way_Entry11
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Twelvefold_Way_Entry10.html">Twelvefold_Way_Entry10</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties for Bijections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> all_one_implies_inj_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈#</span> <span class="free">N</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"size <span class="free">N</span> <span class="main">≤</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">=</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈#</span> <span class="free">N</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> parts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> card <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> parts <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_singleton <span class="main">{</span><span class="bound"><span class="bound">x'</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_singleton_altdef<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 1 this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_singletonE singletonD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inj_on_implies_all_one<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈#</span> number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> F_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> quotientE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> number_partition_of_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>  univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> F_eq <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> equiv_domain_and_range_permutation multiset_of_partition_cards_respects_domain_and_range_permutation <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> univ_commute'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span> <span class="main">=</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> iffD1<span class="main">[</span><span class="operator">OF</span> univ_commute'<span class="main">,</span> <span class="operator">OF</span> equiv_domain_and_range_permutation<span class="main">,</span> <span class="operator">OF</span> inj_on_respects_domain_and_range_permutation<span class="main">,</span> <span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span><span class="main">]</span>
    assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈#</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> card <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹inj_on <span class="skolem">f</span> <span class="free">A</span>›</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_singleton <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_eq_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_singletonI'<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> is_singleton_altdef<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∉</span> <span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈#</span> number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> functions_of_is_inj_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈#</span> <span class="free">N</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"size <span class="free">N</span> <span class="main">≤</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms functions_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq_f<span class="main">:</span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span> <span class="main">=</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> quotientE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> eq_f <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> equiv_domain_and_range_permutation equiv_class_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span>›</span></span> assms all_one_implies_inj_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq_f <span class="keyword1"><span class="command">using</span></span> equiv_domain_and_range_permutation inj_on_respects_domain_and_range_permutation <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> univ_commute'<span class="main">)</span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bijections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_number_partition_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">{</span><span class="bound">N</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈#</span> <span class="bound">N</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">B</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> quotient_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">F</span></span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">.</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">)</span> <span class="bound">F</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_domain_and_range_permutation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> inj_on_respects_domain_and_range_permutation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> univ_preserves_predicate<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">.</span>
       functions_of <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="bound">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> quotient_eq functions_of_number_partition_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">N</span><span class="main">∈</span> <span class="main">{</span><span class="bound">N</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈#</span> <span class="bound">N</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span><span class="main">.</span> number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>functions_of <span class="free">A</span> <span class="free">B</span> <span class="bound">N</span><span class="main">)</span> <span class="main">=</span> <span class="bound">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> number_partition_of_functions_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="main">`</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>
    <span class="main">⊆</span> <span class="main">{</span><span class="bound">N</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈#</span> <span class="bound">N</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotient_eq number_partition_of inj_on_implies_all_one <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">B</span> <span class="main">`</span> <span class="main">{</span><span class="bound">N</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈#</span> <span class="bound">N</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span>
    <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotient_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> functions_of functions_of_is_inj_on<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_functions_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>functions_of <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">{</span><span class="bound">N</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈#</span> <span class="bound">N</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"number_partition_of <span class="free">A</span> <span class="free">B</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> quotient_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">F</span></span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">.</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">)</span> <span class="bound">F</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_domain_and_range_permutation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> inj_on_respects_domain_and_range_permutation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> univ_preserves_predicate<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">.</span>
       functions_of <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="bound">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> quotient_eq functions_of_number_partition_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">N</span><span class="main">∈</span> <span class="main">{</span><span class="bound">N</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈#</span> <span class="bound">N</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span><span class="main">.</span> number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>functions_of <span class="free">A</span> <span class="free">B</span> <span class="bound">N</span><span class="main">)</span> <span class="main">=</span> <span class="bound">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> number_partition_of_functions_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="main">`</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>
    <span class="main">⊆</span> <span class="main">{</span><span class="bound">N</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈#</span> <span class="bound">N</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotient_eq number_partition_of inj_on_implies_all_one <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">B</span> <span class="main">`</span> <span class="main">{</span><span class="bound">N</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈#</span> <span class="bound">N</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span>
    <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotient_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> functions_of functions_of_is_inj_on<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinality›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_injective_functions_domain_and_range_permutation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> iverson <span class="main">(</span>card <span class="free">A</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">{</span><span class="bound">N</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈#</span> <span class="bound">N</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_number_partition_of<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">N</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈#</span> <span class="bound">N</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">N</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈#</span> <span class="bound">N</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">}</span> <span class="main">=</span> iverson <span class="main">(</span>card <span class="free">A</span> <span class="main">≤</span> card <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_number_partitions_with_only_parts_1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Twelvefold_Way_Entry12">
<div class="head">
<h1>Theory Twelvefold_Way_Entry12</h1>
</div>
<pre class="source"><span class="comment1">(*  Author: Lukas Bulwahn &lt;lukas.bulwahn-at-gmail.com&gt; *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Surjections from A to B up to a Permutation on A and B›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Twelvefold_Way_Entry12
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Twelvefold_Way_Entry9.html">Twelvefold_Way_Entry9</a> <a href="Twelvefold_Way_Entry10.html">Twelvefold_Way_Entry10</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties for Bijections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> size_eq_card_implies_surj_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"size <span class="free">N</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">=</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> functions_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹size <span class="free">N</span> <span class="main">=</span> card <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_eq_implies_surjective_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> surj_on_implies_size_eq_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"size <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> F_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> quotientE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span> <span class="main">=</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> number_partition_of_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>  univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> F_eq <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> equiv_domain_and_range_permutation multiset_of_partition_cards_respects_domain_and_range_permutation <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> univ_commute'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span> <span class="main">=</span> image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> iffD1<span class="main">[</span><span class="operator">OF</span> univ_commute'<span class="main">,</span> <span class="operator">OF</span> equiv_domain_and_range_permutation<span class="main">,</span> <span class="operator">OF</span> surjective_respects_domain_and_range_permutation<span class="main">,</span> <span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span><span class="main">]</span>
    assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"size <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> size <span class="main">(</span>image_mset card <span class="main">(</span>mset_set <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> surjective_on_implies_card_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> functions_of_is_surj_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"size <span class="free">N</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span>functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> functions_of <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="free">N</span> ›</span></span> <span class="quoted"><span class="quoted">‹size <span class="free">N</span> <span class="main">=</span> card <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq_f<span class="main">:</span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span> <span class="main">=</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> quotientE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> eq_f <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> equiv_domain_and_range_permutation equiv_class_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> functions_of <span class="free">A</span> <span class="free">B</span> <span class="free">N</span>›</span></span> assms size_eq_card_implies_surj_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq_f <span class="keyword1"><span class="command">using</span></span> equiv_domain_and_range_permutation surjective_respects_domain_and_range_permutation <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> univ_commute'<span class="main">)</span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bijections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_number_partition_of<span class="main">:</span>
   <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">{</span><span class="bound">N</span><span class="main">.</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">=</span> card <span class="free">B</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">B</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> quotient_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">F</span></span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">.</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">)</span> <span class="bound">F</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_domain_and_range_permutation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> surjective_respects_domain_and_range_permutation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> univ_preserves_predicate<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">.</span>
       functions_of <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="bound">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> quotient_eq functions_of_number_partition_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">N</span><span class="main">∈</span><span class="main">{</span><span class="bound">N</span><span class="main">.</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span>  <span class="main">∧</span> size <span class="bound">N</span> <span class="main">=</span> card <span class="free">B</span><span class="main">}</span><span class="main">.</span> number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>functions_of <span class="free">A</span> <span class="free">B</span> <span class="bound">N</span><span class="main">)</span> <span class="main">=</span> <span class="bound">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> number_partition_of_functions_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="main">`</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>
    <span class="main">⊆</span> <span class="main">{</span><span class="bound">N</span><span class="main">.</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span>  <span class="main">∧</span> size <span class="bound">N</span> <span class="main">=</span> card <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotient_eq number_partition_of surj_on_implies_size_eq_card<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">B</span> <span class="main">`</span> <span class="main">{</span><span class="bound">N</span><span class="main">.</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">=</span> card <span class="free">B</span><span class="main">}</span>
    <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotient_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> functions_of functions_of_is_surj_on<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_functions_of<span class="main">:</span>
   <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>functions_of <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">{</span><span class="bound">N</span><span class="main">.</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">=</span> card <span class="free">B</span><span class="main">}</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"number_partition_of <span class="free">A</span> <span class="free">B</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> quotient_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">F</span></span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">.</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">)</span> <span class="bound">F</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_domain_and_range_permutation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> surjective_respects_domain_and_range_permutation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> univ_preserves_predicate<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">.</span>
       functions_of <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="bound">F</span><span class="main">)</span> <span class="main">=</span> <span class="bound">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> quotient_eq functions_of_number_partition_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">N</span><span class="main">∈</span><span class="main">{</span><span class="bound">N</span><span class="main">.</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span>  <span class="main">∧</span> size <span class="bound">N</span> <span class="main">=</span> card <span class="free">B</span><span class="main">}</span><span class="main">.</span> number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>functions_of <span class="free">A</span> <span class="free">B</span> <span class="bound">N</span><span class="main">)</span> <span class="main">=</span> <span class="bound">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> number_partition_of_functions_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"number_partition_of <span class="free">A</span> <span class="free">B</span> <span class="main">`</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span>
    <span class="main">⊆</span> <span class="main">{</span><span class="bound">N</span><span class="main">.</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span>  <span class="main">∧</span> size <span class="bound">N</span> <span class="main">=</span> card <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotient_eq number_partition_of surj_on_implies_size_eq_card<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"functions_of <span class="free">A</span> <span class="free">B</span> <span class="main">`</span> <span class="main">{</span><span class="bound">N</span><span class="main">.</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">=</span> card <span class="free">B</span><span class="main">}</span>
    <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotient_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> functions_of functions_of_is_surj_on<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinality›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_surjective_functions_domain_and_range_permutation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> Partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="main">(</span>card <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>number_partition_of <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">{</span><span class="bound">N</span><span class="main">.</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">=</span> card <span class="free">B</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_number_partition_of<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">N</span><span class="main">.</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">=</span> card <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">N</span><span class="main">.</span> number_partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="bound">N</span> <span class="main">∧</span> size <span class="bound">N</span> <span class="main">=</span> card <span class="free">B</span><span class="main">}</span> <span class="main">=</span> Partition <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="main">(</span>card <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_partitions_with_k_parts<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Card_Bijections">
<div class="head">
<h1>Theory Card_Bijections</h1>
</div>
<pre class="source"><span class="comment1">(*  Author: Lukas Bulwahn &lt;lukas.bulwahn-at-gmail.com&gt; *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Cardinality of Bijections›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Card_Bijections
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Twelvefold_Way_Entry2.html">Twelvefold_Way_Entry2</a>
  <a href="Twelvefold_Way_Entry3.html">Twelvefold_Way_Entry3</a>
  <a href="Twelvefold_Way_Entry5.html">Twelvefold_Way_Entry5</a>
  <a href="Twelvefold_Way_Entry6.html">Twelvefold_Way_Entry6</a>
  <a href="Twelvefold_Way_Entry8.html">Twelvefold_Way_Entry8</a>
  <a href="Twelvefold_Way_Entry9.html">Twelvefold_Way_Entry9</a>
  <a href="Twelvefold_Way_Entry11.html">Twelvefold_Way_Entry11</a>
  <a href="Twelvefold_Way_Entry12.html">Twelvefold_Way_Entry12</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bijections from A to B›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_set_is_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≠</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms bij_betw_same_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> card_bijections_eq_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≠</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> bij_betw_set_is_empty<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> card.empty<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Two alternative proofs for the cardinality of bijections up to a permutation on A.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">=</span> fact <span class="main">(</span>card <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_implies_inj_on_and_card_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fact <span class="main">(</span>card <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_extensional_funcset_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_bijections<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">=</span> fact <span class="main">(</span>card <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_implies_surj_on_and_card_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fact <span class="main">(</span>card <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_extensional_funcset_surj_on<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bijections from A to B up to a Permutation on A›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_quotient_domain_permutation_eq_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≠</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">A</span> <span class="main">≠</span> card <span class="free">B</span>›</span></span> bij_betw_same_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> card_bijections_domain_permutation_eq_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≠</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> bij_betw_quotient_domain_permutation_eq_empty<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> card.empty<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Two alternative proofs for the cardinality of bijections up to a permutation on A.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>
    <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> PiE_cong bij_betw_implies_inj_on_and_card_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_injective_functions_domain_permutation<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_bijections_domain_permutation_eq_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>
    <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> PiE_cong bij_betw_implies_surj_on_and_card_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_surjective_functions_domain_permutation<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_bijections_domain_permutation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> iverson <span class="main">(</span>card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms card_bijections_domain_permutation_eq_0 card_bijections_domain_permutation_eq_1
<span class="keyword1"><span class="command">unfolding</span></span> iverson_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bijections from A to B up to a Permutation on B›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_quotient_range_permutation_eq_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≠</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">A</span> <span class="main">≠</span> card <span class="free">B</span>›</span></span> bij_betw_same_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> card_bijections_range_permutation_eq_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≠</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> bij_betw_quotient_range_permutation_eq_empty<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> card.empty<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Two alternative proofs for the cardinality of bijections up to a permutation on B.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">=</span>
    <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> PiE_cong bij_betw_implies_inj_on_and_card_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iverson_def card_injective_functions_range_permutation<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_bijections_range_permutation_eq_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">=</span>
    <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> PiE_cong bij_betw_implies_surj_on_and_card_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_surjective_functions_range_permutation<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_bijections_range_permutation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> iverson <span class="main">(</span>card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms card_bijections_range_permutation_eq_0 card_bijections_range_permutation_eq_1
<span class="keyword1"><span class="command">unfolding</span></span> iverson_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bijections from A to B up to a Permutation on A and B›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_quotient_domain_and_range_permutation_eq_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≠</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">A</span> <span class="main">≠</span> card <span class="free">B</span>›</span></span> bij_betw_same_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> card_bijections_domain_and_range_permutation_eq_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≠</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> bij_betw_quotient_domain_and_range_permutation_eq_empty<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> card.empty<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Two alternative proofs for the cardinality of bijections up to a permutation on A and B.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">=</span>
    <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> inj_on <span class="bound">f</span> <span class="free">A</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> PiE_cong bij_betw_implies_inj_on_and_card_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iverson_def card_injective_functions_domain_and_range_permutation<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_bijections_domain_and_range_permutation_eq_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">=</span>
    <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> PiE_cong bij_betw_implies_surj_on_and_card_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_surjective_functions_domain_and_range_permutation Partition_diag<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_bijections_domain_and_range_permutation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> iverson <span class="main">(</span>card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms card_bijections_domain_and_range_permutation_eq_0 card_bijections_domain_and_range_permutation_eq_1
<span class="keyword1"><span class="command">unfolding</span></span> iverson_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Card_Bijections_Direct">
<div class="head">
<h1>Theory Card_Bijections_Direct</h1>
</div>
<pre class="source"><span class="comment1">(*  Author: Lukas Bulwahn &lt;lukas.bulwahn-at-gmail.com&gt; *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Direct Proofs for Cardinality of Bijections›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Card_Bijections_Direct
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Equiv_Relations_on_Functions.html">Equiv_Relations_on_Functions</a>
  <a href="Twelvefold_Way_Core.html">Twelvefold_Way_Core</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bijections from A to B up to a Permutation on A›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Equivalence Class›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bijections_in_domain_permutation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_same_card_bij_on_ext_funcset mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> proj_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">=</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> f <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">⊆</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_permutation_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> obtain_domain_permutation_for_two_bijections<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f'</span><span class="main">,</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>›</span></span> equiv_domain_permutation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equiv_class_eq_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> bij_betw_comp_iff f permutes_imp_bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f'</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> bij_betw_cong comp_apply<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotientI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_quotient_domain_permutation_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bijections_in_domain_permutation<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">F</span>
    <span class="keyword3"><span class="command">assume</span></span> F_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">F</span></span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">.</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="bound">F</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> equiv_domain_permutation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> bij_betw_respects_domain_permutation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> univ_preserves_predicate<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> F_in this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="skolem">F</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> <span class="skolem">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ImageE equiv_class_eq_iff equiv_domain_permutation quotientE<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> <span class="skolem">F</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> univ_predicate_impl_forall<span class="main">[</span><span class="operator">OF</span> equiv_domain_permutation bij_betw_respects_domain_permutation<span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="skolem">F</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">F</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f'</span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> quotientE<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> univ_commute'<span class="main">[</span><span class="operator">OF</span> equiv_domain_permutation bij_betw_respects_domain_permutation<span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">=</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="skolem">F</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> obtain_domain_permutation_for_two_bijections
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">f</span> <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">f'</span> <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> domain_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">=</span> domain_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="main">{</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinality›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> bij_betw_quotient_domain_permutation_eq<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bijections from A to B up to a Permutation on B›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Equivalence Class›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bijections_in_range_permutation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_same_card_bij_on_ext_funcset mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> proj_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">=</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> f <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">⊆</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> obtain_range_permutation_for_two_bijections<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f'</span><span class="main">,</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>›</span></span> equiv_range_permutation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equiv_class_eq_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="skolem">p</span> <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> bij_betw_comp_iff f permutes_imp_bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f'</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> bij_betw_cong comp_apply<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotientI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_quotient_range_permutation_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bijections_in_range_permutation<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">F</span>
    <span class="keyword3"><span class="command">assume</span></span> F_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">F</span></span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">.</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="bound">F</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> equiv_range_permutation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> bij_betw_respects_range_permutation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> univ_preserves_predicate<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this F_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> <span class="skolem">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ImageE equiv_class_eq_iff equiv_range_permutation quotientE<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> <span class="skolem">F</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> univ_predicate_impl_forall<span class="main">[</span><span class="operator">OF</span> equiv_range_permutation bij_betw_respects_range_permutation<span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="skolem">F</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">F</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f'</span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> quotientE<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> univ_commute'<span class="main">[</span><span class="operator">OF</span> equiv_range_permutation bij_betw_respects_range_permutation<span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">=</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="skolem">F</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> obtain_range_permutation_for_two_bijections
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">f</span> <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">f'</span> <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">=</span> range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="main">{</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinality›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_bijections_range_permutation_eq_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> bij_betw_quotient_range_permutation_eq<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bijections from A to B up to a Permutation on A and B›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Equivalence Class›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bijections_in_domain_and_range_permutation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_same_card_bij_on_ext_funcset mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> proj_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">=</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"id <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_id<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> f this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">⊆</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> domain_and_range_permutation_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> obtain_range_permutation_for_two_bijections<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f'</span><span class="main">,</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>›</span></span> equiv_domain_and_range_permutation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equiv_class_eq_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> domain_and_range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">∘</span> <span class="skolem">f</span> <span class="main">∘</span> <span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> bij_betw_comp_iff f permutes_imp_bij
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f'</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">p<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> bij_betw_congI<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> domain_and_range_permutation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotientI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_betw_quotient_domain_and_range_permutation_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span><span class="main">}</span>
    <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bijections_in_domain_and_range_permutation<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">F</span>
    <span class="keyword3"><span class="command">assume</span></span> F_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">F</span></span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">.</span> univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="bound">F</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> equiv_domain_and_range_permutation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> bij_betw_respects_domain_and_range_permutation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> univ_preserves_predicate<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> F_in this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> <span class="skolem">F</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ImageE equiv_class_eq_iff equiv_domain_and_range_permutation quotientE<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> <span class="skolem">F</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> univ_predicate_impl_forall<span class="main">[</span><span class="operator">OF</span> equiv_domain_and_range_permutation bij_betw_respects_domain_and_range_permutation<span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="skolem">F</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">F</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f'</span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> quotientE<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> univ_commute'<span class="main">[</span><span class="operator">OF</span> equiv_domain_and_range_permutation bij_betw_respects_domain_and_range_permutation<span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">=</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹univ <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="skolem">F</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> obtain_domain_permutation_for_two_bijections
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">f</span> <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹bij_betw <span class="skolem">f'</span> <span class="free">A</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"id <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_id<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>›</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">∈</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> domain_and_range_permutation_def id_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">=</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="main">{</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinality›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_bijections_domain_and_range_permutation_eq_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">.</span> bij_betw <span class="bound">f</span> <span class="free">A</span> <span class="free">B</span><span class="main">}</span> <span class="main">//</span> domain_and_range_permutation <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> bij_betw_quotient_domain_and_range_permutation_eq<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Twelvefold_Way">
<div class="head">
<h1>Theory Twelvefold_Way</h1>
</div>
<pre class="source"><span class="comment1">(*  Author: Lukas Bulwahn &lt;lukas.bulwahn-at-gmail.com&gt;
    Dedicated to Sara L. for being a loyal soul mate
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Twelvefold Way›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Twelvefold_Way
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Preliminaries.html">Preliminaries</a>
  <a href="Twelvefold_Way_Core.html">Twelvefold_Way_Core</a>
  <a href="Equiv_Relations_on_Functions.html">Equiv_Relations_on_Functions</a>
  <a href="Twelvefold_Way_Entry1.html">Twelvefold_Way_Entry1</a>
  <a href="Twelvefold_Way_Entry2.html">Twelvefold_Way_Entry2</a>
  <a href="Twelvefold_Way_Entry4.html">Twelvefold_Way_Entry4</a>
  <a href="Twelvefold_Way_Entry5.html">Twelvefold_Way_Entry5</a>
  <a href="Twelvefold_Way_Entry6.html">Twelvefold_Way_Entry6</a>
  <a href="Twelvefold_Way_Entry7.html">Twelvefold_Way_Entry7</a>
  <a href="Twelvefold_Way_Entry8.html">Twelvefold_Way_Entry8</a>
  <a href="Twelvefold_Way_Entry9.html">Twelvefold_Way_Entry9</a>
  <a href="Twelvefold_Way_Entry3.html">Twelvefold_Way_Entry3</a>
  <a href="Twelvefold_Way_Entry10.html">Twelvefold_Way_Entry10</a>
  <a href="Twelvefold_Way_Entry11.html">Twelvefold_Way_Entry11</a>
  <a href="Twelvefold_Way_Entry12.html">Twelvefold_Way_Entry12</a>
  <a href="Card_Bijections.html">Card_Bijections</a>
  <a href="Card_Bijections_Direct.html">Card_Bijections_Direct</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>