<div id="FOL_Fitting">
<div class="head">
<h1>Theory FOL_Fitting</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Stefan Berghofer, TU Muenchen, 2003
    Author: Asta Halkjær From, DTU Compute, 2019
    Thanks to John Bruntse Larsen, Anders Schlichtkrull &amp; Jørgen Villadsen
    See also the Natural Deduction Assistant: https://nadea.compute.dtu.dk/
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹First-Order Logic According to Fitting›</span></span>

<span class="keyword1"><span class="command">theory</span></span> FOL_Fitting
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Library/Countable.html">HOL-Library.Countable</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Miscellaneous Utilities›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some facts about (in)finite sets›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> set_inter_compl_diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">-</span> <span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="free">B</span> <span class="main">-</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Terms and formulae›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\label{sec:terms}
The datatypes of terms and formulae in {\em de Bruijn notation}
are defined as follows:
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> <span class="quoted">"term"</span>
  <span class="main">=</span> Var <span class="quoted">nat</span>
  <span class="main">|</span> App <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term list›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form
  <span class="main">=</span> FF
  <span class="main">|</span> TT
  <span class="main">|</span> Pred <span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term list›</span></span>
  <span class="main">|</span> And <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span>
  <span class="main">|</span> Or <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span>
  <span class="main">|</span> Impl <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span>
  <span class="main">|</span> Neg <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span>
  <span class="main">|</span> Forall <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span>
  <span class="main">|</span> Exists <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We use <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>'a›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>'b›</span></span></span></span> to denote the type of
{\em function symbols} and {\em predicate symbols}, respectively.
In applications <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>App a ts›</span></span></span></span> and predicates
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Pred a ts›</span></span></span></span>, the length of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ts›</span></span></span></span> is considered
to be a part of the function or predicate name, so <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>App a [t]›</span></span></span></span>
and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>App a [t,u]›</span></span></span></span> refer to different functions.

The size of a formula is used later for wellfounded induction. The
default implementation provided by the datatype package is not quite
what we need, so here is an alternative version:
›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">size_form</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form <span class="main">⇒</span> nat›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">size_form</span> FF <span class="main">=</span> <span class="main">0</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">size_form</span> TT <span class="main">=</span> <span class="main">0</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">size_form</span> <span class="main">(</span>Pred <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">size_form</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">size_form</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">+</span> <span class="free">size_form</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">+</span> <span class="main">1</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">size_form</span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">size_form</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">+</span> <span class="free">size_form</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">+</span> <span class="main">1</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">size_form</span> <span class="main">(</span>Impl <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">size_form</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">+</span> <span class="free">size_form</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">+</span> <span class="main">1</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">size_form</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">size_form</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">+</span> <span class="main">1</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">size_form</span> <span class="main">(</span>Forall <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">size_form</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">+</span> <span class="main">1</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">size_form</span> <span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">size_form</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">+</span> <span class="main">1</span>›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Closed terms and formulae›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Many of the results proved in the following sections are restricted
to closed terms and formulae. We call a term or formula {\em closed at
level <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i›</span></span></span></span>}, if it only contains ``loose'' bound variables with
indices smaller than <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">closedt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹nat <span class="main">⇒</span> <span class="tfree">'a</span> term <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="entity">closedts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹nat <span class="main">⇒</span> <span class="tfree">'a</span> term list <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">closedt</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">closedt</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>App <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">closedts</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">closedts</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">[]</span> <span class="main">=</span> True›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">closedts</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">closedt</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∧</span> <span class="free">closedts</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">closed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">closed</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> FF <span class="main">=</span> True›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">closed</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> TT <span class="main">=</span> True›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">closed</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Pred <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> closedts <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">closed</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">closed</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span> <span class="free">closed</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">closed</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">closed</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span> <span class="free">closed</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">closed</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Impl <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">closed</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span> <span class="free">closed</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">closed</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">closed</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">closed</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Forall <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">closed</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">closed</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">closed</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> closedt_mono<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹closedt <span class="free">i</span> <span class="main">(</span><span class="free">t</span><span class="main">::</span><span class="tfree">'a</span> term<span class="main">)</span> <span class="main">⟹</span> closedt <span class="free">j</span> <span class="free">t</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closedts <span class="free">i</span> <span class="main">(</span><span class="free">ts</span><span class="main">::</span><span class="tfree">'a</span> term list<span class="main">)</span> <span class="main">⟹</span> closedts <span class="free">j</span> <span class="free">ts</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> closedt.induct closedts.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">theorem</span></span> closed_mono<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹closed <span class="free">i</span> <span class="free">p</span> <span class="main">⟹</span> closed <span class="free">j</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> le
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pred <span class="skolem">i</span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> closedt_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Substitution›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We now define substitution functions for terms and formulae. When performing
substitutions under quantifiers, we need to {\em lift} the terms to be substituted
for variables, in order for the ``loose'' bound variables to point to the right
position.
›</span></span>

<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">substt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term <span class="main">⇒</span> <span class="tfree">'a</span> term <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> term›</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">[</span>_<span class="keyword1">'/</span>_<span class="keyword1">]</span>"</span> <span class="main">[</span>300<span class="main">,</span> 0<span class="main">,</span> 0<span class="main">]</span> 300<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="entity">substts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term list <span class="main">⇒</span> <span class="tfree">'a</span> term <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> term list›</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">[</span>_<span class="keyword1">'/</span>_<span class="keyword1">]</span>"</span> <span class="main">[</span>300<span class="main">,</span> 0<span class="main">,</span> 0<span class="main">]</span> 300<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">then</span> Var <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">else</span> Var <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>App <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">=</span> App <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">[]</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">=</span> <span class="main">[]</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span>›</span></span>

<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">liftt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term <span class="main">⇒</span> <span class="tfree">'a</span> term›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="entity">liftts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term list <span class="main">⇒</span> <span class="tfree">'a</span> term list›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">liftt</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> Var <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">liftt</span> <span class="main">(</span>App <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> App <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free">liftts</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">liftts</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">liftts</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">liftt</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free">liftts</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span>›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">subst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form <span class="main">⇒</span> <span class="tfree">'a</span> term <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span>
  <span class="main">(</span><span class="quoted">"_<span class="keyword1">[</span>_<span class="keyword1">'/</span>_<span class="keyword1">]</span>"</span> <span class="main">[</span>300<span class="main">,</span> 0<span class="main">,</span> 0<span class="main">]</span> 300<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹FF<span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">=</span> FF›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹TT<span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">=</span> TT›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Pred <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">=</span> Pred <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">/</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">]</span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">=</span> And <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">=</span> Or <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Impl <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">=</span> Impl <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">=</span> Neg <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Forall <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">=</span> Forall <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main"><span class="free">[</span></span>liftt <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">=</span> Exists <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main"><span class="free">[</span></span>liftt <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">/</span></span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">]</span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> lift_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="main">(</span><span class="free">t</span><span class="main">::</span><span class="tfree">'a</span> term<span class="main">)</span> <span class="main">⟹</span> closedt <span class="main">0</span> <span class="main">(</span>liftt <span class="free">t</span><span class="main">)</span>›</span></span>
  <span class="quoted"><span class="quoted">‹closedts <span class="main">0</span> <span class="main">(</span><span class="free">ts</span><span class="main">::</span><span class="tfree">'a</span> term list<span class="main">)</span> <span class="main">⟹</span> closedts <span class="main">0</span> <span class="main">(</span>liftts <span class="free">ts</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> closedt.induct closedts.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">theorem</span></span> subst_closedt <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="free">u</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹closedt <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="free">t</span> <span class="main">⟹</span> closedt <span class="free">i</span> <span class="main">(</span><span class="free">t</span><span class="main">[</span><span class="free">u</span><span class="main">/</span><span class="free">i</span><span class="main">]</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closedts <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="free">ts</span> <span class="main">⟹</span> closedts <span class="free">i</span> <span class="main">(</span><span class="free">ts</span><span class="main">[</span><span class="free">u</span><span class="main">/</span><span class="free">i</span><span class="main">]</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> u closedt_mono<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> closedt.induct closedts.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> subst_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="free">t</span> <span class="main">⟹</span> closed <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="free">p</span> <span class="main">⟹</span> closed <span class="free">i</span> <span class="main">(</span><span class="free">p</span><span class="main">[</span><span class="free">t</span><span class="main">/</span><span class="free">i</span><span class="main">]</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">theorem</span></span> subst_size_form <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹size_form <span class="main">(</span>subst <span class="free">p</span> <span class="free">t</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> size_form <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Parameters›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The introduction rule <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ForallI›</span></span></span></span> for the universal quantifier,
as well as the elimination rule <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ExistsE›</span></span></span></span> for the existential
quantifier introduced in \secref{sec:proof-calculus} require the
quantified variable to be replaced by a ``fresh'' parameter. Fitting's
solution is to use a new nullary function symbol for this purpose.
To express that a function symbol is ``fresh'', we introduce functions
for collecting all function symbols occurring in a term or formula.
›</span></span>

<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">paramst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term <span class="main">⇒</span> <span class="tfree">'a</span> set›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="entity">paramsts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term list <span class="main">⇒</span> <span class="tfree">'a</span> set›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">paramst</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">paramst</span> <span class="main">(</span>App <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free">paramsts</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">paramsts</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">paramsts</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">paramst</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∪</span> <span class="free">paramsts</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">params</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form <span class="main">⇒</span> <span class="tfree">'a</span> set›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">params</span> FF <span class="main">=</span> <span class="main">{}</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">params</span> TT <span class="main">=</span> <span class="main">{}</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">params</span> <span class="main">(</span>Pred <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> paramsts <span class="free"><span class="bound"><span class="entity">ts</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">params</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">params</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∪</span> <span class="free">params</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">params</span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">params</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∪</span> <span class="free">params</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">params</span> <span class="main">(</span>Impl <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">params</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∪</span> <span class="free">params</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">params</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">params</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">params</span> <span class="main">(</span>Forall <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">params</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">params</span> <span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">params</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
We also define parameter substitution functions on terms and formulae
that apply a function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f›</span></span></span></span> to all function symbols.
›</span></span>

<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">psubstt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> term <span class="main">⇒</span> <span class="tfree">'c</span> term›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="entity">psubstts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> term list <span class="main">⇒</span> <span class="tfree">'c</span> term list›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">psubstt</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> Var <span class="free"><span class="bound"><span class="entity">i</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">psubstt</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>App <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> App <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">psubstts</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">psubstts</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">psubstts</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">psubstt</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free">psubstts</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span>›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">psubst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'c</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">psubst</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> FF <span class="main">=</span> FF›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">psubst</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> TT <span class="main">=</span> TT›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">psubst</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Pred <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> Pred <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>psubstts <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">psubst</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> And <span class="main">(</span><span class="free">psubst</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">psubst</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">psubst</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> Or <span class="main">(</span><span class="free">psubst</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">psubst</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">psubst</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Impl <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> Impl <span class="main">(</span><span class="free">psubst</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">psubst</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">psubst</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> Neg <span class="main">(</span><span class="free">psubst</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">psubst</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Forall <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> Forall <span class="main">(</span><span class="free">psubst</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">psubst</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> Exists <span class="main">(</span><span class="free">psubst</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> psubstt_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹closedt <span class="free">i</span> <span class="main">(</span>psubstt <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> closedt <span class="free">i</span> <span class="free">t</span>›</span></span>
  <span class="quoted"><span class="quoted">‹closedts <span class="free">i</span> <span class="main">(</span>psubstts <span class="free">f</span> <span class="free">ts</span><span class="main">)</span> <span class="main">=</span> closedts <span class="free">i</span> <span class="free">ts</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> closedt.induct closedts.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">theorem</span></span> psubst_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹closed <span class="free">i</span> <span class="main">(</span>psubst <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> closed <span class="free">i</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">theorem</span></span> psubstt_subst <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹psubstt <span class="free">f</span> <span class="main">(</span>substt <span class="free">t</span> <span class="free">u</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> substt <span class="main">(</span>psubstt <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="main">(</span>psubstt <span class="free">f</span> <span class="free">u</span><span class="main">)</span> <span class="free">i</span>›</span></span>
  <span class="quoted"><span class="quoted">‹psubstts <span class="free">f</span> <span class="main">(</span>substts <span class="free">ts</span> <span class="free">u</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> substts <span class="main">(</span>psubstts <span class="free">f</span> <span class="free">ts</span><span class="main">)</span> <span class="main">(</span>psubstt <span class="free">f</span> <span class="free">u</span><span class="main">)</span> <span class="free">i</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> psubstt.induct psubstts.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">theorem</span></span> psubstt_lift <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹psubstt <span class="free">f</span> <span class="main">(</span>liftt <span class="free">t</span><span class="main">)</span> <span class="main">=</span> liftt <span class="main">(</span>psubstt <span class="free">f</span> <span class="free">t</span><span class="main">)</span>›</span></span>
  <span class="quoted"><span class="quoted">‹psubstts <span class="free">f</span> <span class="main">(</span>liftts <span class="free">ts</span><span class="main">)</span> <span class="main">=</span> liftts <span class="main">(</span>psubstts <span class="free">f</span> <span class="free">ts</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> psubstt.induct psubstts.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">theorem</span></span> psubst_subst <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹psubst <span class="free">f</span> <span class="main">(</span>subst <span class="free">P</span> <span class="free">t</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> subst <span class="main">(</span>psubst <span class="free">f</span> <span class="free">P</span><span class="main">)</span> <span class="main">(</span>psubstt <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="free">i</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">P</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">theorem</span></span> psubstt_upd <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∉</span> paramst <span class="main">(</span><span class="free">t</span><span class="main">::</span><span class="tfree">'a</span> term<span class="main">)</span> <span class="main">⟹</span> psubstt <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> psubstt <span class="free">f</span> <span class="free">t</span>›</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∉</span> paramsts <span class="main">(</span><span class="free">ts</span><span class="main">::</span><span class="tfree">'a</span> term list<span class="main">)</span> <span class="main">⟹</span> psubstts <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="free">ts</span> <span class="main">=</span> psubstts <span class="free">f</span> <span class="free">ts</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> psubstt.induct psubstts.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> sum.split<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> psubst_upd <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∉</span> params <span class="free">P</span> <span class="main">⟹</span> psubst <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="free">P</span> <span class="main">=</span> psubst <span class="free">f</span> <span class="free">P</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">P</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> psubstt_id<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term list›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹psubstt id <span class="free">t</span> <span class="main">=</span> <span class="free">t</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹psubstts <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="free">ts</span> <span class="main">=</span> <span class="free">ts</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> psubstt.induct psubstts.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">theorem</span></span> psubst_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹psubst id <span class="main">=</span> id›</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹psubst id <span class="skolem">p</span> <span class="main">=</span> id <span class="skolem">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> psubstt_id<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> psubstt_image <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹paramst <span class="main">(</span>psubstt <span class="free">f</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> paramst <span class="free">t</span>›</span></span>
  <span class="quoted"><span class="quoted">‹paramsts <span class="main">(</span>psubstts <span class="free">f</span> <span class="free">ts</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> paramsts <span class="free">ts</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> paramst.induct paramsts.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_Un<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> psubst_image <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹params <span class="main">(</span>psubst <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> params <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_Un<span class="main">)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Semantics›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\label{sec:semantics}
In this section, we define evaluation functions for terms and formulae.
Evaluation is performed relative to an environment mapping indices of variables
to values. We also introduce a function, denoted by <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>e⟨i:a⟩›</span></span></span></span>, for inserting
a value <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>a›</span></span></span></span> at position <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i›</span></span></span></span> into the environment. All values of variables
with indices less than <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i›</span></span></span></span> are left untouched by this operation, whereas the
values of variables with indices greater or equal than <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i›</span></span></span></span> are shifted one
position up.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">shift</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>›</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">⟨</span>_<span class="keyword1">:</span>_<span class="keyword1">⟩</span>"</span> <span class="main">[</span>90<span class="main">,</span> 0<span class="main">,</span> 0<span class="main">]</span> 91<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main"><span class="free">:</span></span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">j</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shift_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">=</span> <span class="free">j</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">e</span><span class="main">⟨</span><span class="free">i</span><span class="main">:</span><span class="free">T</span><span class="main">⟩</span><span class="main">)</span> <span class="free">j</span> <span class="main">=</span> <span class="free">T</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> shift_gt <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">j</span> <span class="main">&lt;</span> <span class="free">i</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">e</span><span class="main">⟨</span><span class="free">i</span><span class="main">:</span><span class="free">T</span><span class="main">⟩</span><span class="main">)</span> <span class="free">j</span> <span class="main">=</span> <span class="free">e</span> <span class="free">j</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> shift_lt <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">e</span><span class="main">⟨</span><span class="free">i</span><span class="main">:</span><span class="free">T</span><span class="main">⟩</span><span class="main">)</span> <span class="free">j</span> <span class="main">=</span> <span class="free">e</span> <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> shift_commute <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">e</span><span class="main">⟨</span><span class="free">i</span><span class="main">:</span><span class="free">U</span><span class="main">⟩</span><span class="main">⟨</span><span class="main">0</span><span class="main">:</span><span class="free">T</span><span class="main">⟩</span> <span class="main">=</span> <span class="free">e</span><span class="main">⟨</span><span class="main">0</span><span class="main">:</span><span class="free">T</span><span class="main">⟩</span><span class="main">⟨</span>Suc <span class="free">i</span><span class="main">:</span><span class="free">U</span><span class="main">⟩</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">e</span><span class="main">⟨</span><span class="free">i</span><span class="main">:</span><span class="free">U</span><span class="main">⟩</span><span class="main">⟨</span><span class="main">0</span><span class="main">:</span><span class="free">T</span><span class="main">⟩</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">e</span><span class="main">⟨</span><span class="main">0</span><span class="main">:</span><span class="free">T</span><span class="main">⟩</span><span class="main">⟨</span>Suc <span class="free">i</span><span class="main">:</span><span class="free">U</span><span class="main">⟩</span><span class="main">)</span> <span class="skolem">x</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">evalt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'c</span> list <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> term <span class="main">⇒</span> <span class="tfree">'c</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="entity">evalts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'c</span> list <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> term list <span class="main">⇒</span> <span class="tfree">'c</span> list›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">evalt</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">evalt</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>App <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free">evalts</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">evalts</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">evalts</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">evalt</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free">evalts</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span>›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">eval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'c</span> list <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">⇒</span>
  <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span> list <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> FF <span class="main">=</span> False›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> TT <span class="main">=</span> True›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span>Pred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>evalts <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span>Impl <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span>Forall <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">eval</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">⟨</span><span class="main">0</span><span class="main">:</span><span class="bound">z</span><span class="main">⟩</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free">eval</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">⟨</span><span class="main">0</span><span class="main">:</span><span class="bound">z</span><span class="main">⟩</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We write <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>e,f,g,ps ⊨ p›</span></span></span></span> to mean that the formula <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span> is a
semantic consequence of the list of formulae <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ps›</span></span></span></span> with respect to an
environment <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>e›</span></span></span></span> and interpretations <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>g›</span></span></span></span> for
function and predicate symbols, respectively.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">model</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'c</span> list <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span> list <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form <span class="main">⇒</span> bool›</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">,</span>_<span class="keyword1">,</span>_<span class="keyword1">,</span>_ <span class="keyword1">⊨</span> _"</span> <span class="main">[</span>50<span class="main">,</span>50<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>list_all <span class="main">(</span>eval <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">⟶</span> eval <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following substitution lemmas relate substitution and evaluation functions:
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> subst_lemma' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹evalt <span class="free">e</span> <span class="free">f</span> <span class="main">(</span>substt <span class="free">t</span> <span class="free">u</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> evalt <span class="main">(</span><span class="free">e</span><span class="main">⟨</span><span class="free">i</span><span class="main">:</span>evalt <span class="free">e</span> <span class="free">f</span> <span class="free">u</span><span class="main">⟩</span><span class="main">)</span> <span class="free">f</span> <span class="free">t</span>›</span></span>
  <span class="quoted"><span class="quoted">‹evalts <span class="free">e</span> <span class="free">f</span> <span class="main">(</span>substts <span class="free">ts</span> <span class="free">u</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> evalts <span class="main">(</span><span class="free">e</span><span class="main">⟨</span><span class="free">i</span><span class="main">:</span>evalt <span class="free">e</span> <span class="free">f</span> <span class="free">u</span><span class="main">⟩</span><span class="main">)</span> <span class="free">f</span> <span class="free">ts</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> substt.induct substts.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">theorem</span></span> lift_lemma <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹evalt <span class="main">(</span><span class="free">e</span><span class="main">⟨</span><span class="main">0</span><span class="main">:</span><span class="free">z</span><span class="main">⟩</span><span class="main">)</span> <span class="free">f</span> <span class="main">(</span>liftt <span class="free">t</span><span class="main">)</span> <span class="main">=</span> evalt <span class="free">e</span> <span class="free">f</span> <span class="free">t</span>›</span></span>
  <span class="quoted"><span class="quoted">‹evalts <span class="main">(</span><span class="free">e</span><span class="main">⟨</span><span class="main">0</span><span class="main">:</span><span class="free">z</span><span class="main">⟩</span><span class="main">)</span> <span class="free">f</span> <span class="main">(</span>liftts <span class="free">ts</span><span class="main">)</span> <span class="main">=</span> evalts <span class="free">e</span> <span class="free">f</span> <span class="free">ts</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> liftt.induct liftts.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">theorem</span></span> subst_lemma <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>subst <span class="free">a</span> <span class="free">t</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> eval <span class="main">(</span><span class="free">e</span><span class="main">⟨</span><span class="free">i</span><span class="main">:</span>evalt <span class="free">e</span> <span class="free">f</span> <span class="free">t</span><span class="main">⟩</span><span class="main">)</span> <span class="free">f</span> <span class="free">g</span> <span class="free">a</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">e</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">theorem</span></span> upd_lemma' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">∉</span> paramst <span class="free">t</span> <span class="main">⟹</span> evalt <span class="free">e</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">n</span> <span class="main">:=</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> evalt <span class="free">e</span> <span class="free">f</span> <span class="free">t</span>›</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">∉</span> paramsts <span class="free">ts</span> <span class="main">⟹</span> evalts <span class="free">e</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">n</span> <span class="main">:=</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="free">ts</span> <span class="main">=</span> evalts <span class="free">e</span> <span class="free">f</span> <span class="free">ts</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> paramst.induct paramsts.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> upd_lemma <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">∉</span> params <span class="free">p</span> <span class="main">⟹</span> eval <span class="free">e</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">n</span> <span class="main">:=</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="free">p</span> <span class="main">=</span> eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">theorem</span></span> list_upd_lemma <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">n</span> <span class="main">∉</span> params <span class="bound">p</span><span class="main">)</span> <span class="free">G</span> <span class="main">⟹</span>
  list_all <span class="main">(</span>eval <span class="free">e</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">n</span> <span class="main">:=</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span> <span class="free">G</span> <span class="main">=</span> list_all <span class="main">(</span>eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">G</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">theorem</span></span> psubst_eval' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹evalt <span class="free">e</span> <span class="free">f</span> <span class="main">(</span>psubstt <span class="free">h</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> evalt <span class="free">e</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">h</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span>›</span></span>
  <span class="quoted"><span class="quoted">‹evalts <span class="free">e</span> <span class="free">f</span> <span class="main">(</span>psubstts <span class="free">h</span> <span class="free">ts</span><span class="main">)</span> <span class="main">=</span> evalts <span class="free">e</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">h</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="free">ts</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> psubstt.induct psubstts.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">theorem</span></span> psubst_eval<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>psubst <span class="free">h</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> eval <span class="free">e</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">h</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In order to test the evaluation function defined above, we apply it
to an example:
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> ex_all_commute_eval<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>Impl <span class="main">(</span>Exists <span class="main">(</span>Forall <span class="main">(</span>Pred <span class="free">p</span> <span class="main">[</span>Var <span class="main">1</span><span class="main">,</span> Var <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>Forall <span class="main">(</span>Exists <span class="main">(</span>Pred <span class="free">p</span> <span class="main">[</span>Var <span class="main">0</span><span class="main">,</span> Var <span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹
Simplification yields the following proof state:
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">subgoals</span></span> [display]<span class="antiquote"><span class="antiquote">}</span></span></span></span>
This is easily proved using intuitionistic logic:
›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">iprover</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Proof calculus›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\label{sec:proof-calculus}
We now introduce a natural deduction proof calculus for first order logic.
The derivability judgement <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>G ⊢ a›</span></span></span></span> is defined as an inductive predicate.
›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">deriv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form <span class="main">⇒</span> bool›</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊢</span> _"</span> <span class="main">[</span>50<span class="main">,</span>50<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  Assum<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>›</span></span>
<span class="main">|</span> TTI<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> TT›</span></span>
<span class="main">|</span> FFE<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> FF <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>›</span></span>
<span class="main">|</span> NegI<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> FF <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> Neg <span class="free"><span class="bound"><span class="entity">a</span></span></span>›</span></span>
<span class="main">|</span> NegE<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> Neg <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> FF›</span></span>
<span class="main">|</span> Class<span class="main">:</span> <span class="quoted"><span class="quoted">‹Neg <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> FF <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>›</span></span>
<span class="main">|</span> AndI<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> And <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>›</span></span>
<span class="main">|</span> AndE1<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> And <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>›</span></span>
<span class="main">|</span> AndE2<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> And <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>›</span></span>
<span class="main">|</span> OrI1<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> Or <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>›</span></span>
<span class="main">|</span> OrI2<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> Or <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>›</span></span>
<span class="main">|</span> OrE<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> Or <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>›</span></span>
<span class="main">|</span> ImplI<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> Impl <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>›</span></span>
<span class="main">|</span> ImplE<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> Impl <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>›</span></span>
<span class="main">|</span> ForallI<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">[</span>App <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span> <span class="main">⟹</span> list_all <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∉</span> params <span class="bound">p</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span>
    <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∉</span> params <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> Forall <span class="free"><span class="bound"><span class="entity">a</span></span></span>›</span></span>
<span class="main">|</span> ForallE<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> Forall <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">/</span><span class="main">0</span><span class="main">]</span>›</span></span>
<span class="main">|</span> ExistsI<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">/</span><span class="main">0</span><span class="main">]</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> Exists <span class="free"><span class="bound"><span class="entity">a</span></span></span>›</span></span>
<span class="main">|</span> ExistsE<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> Exists <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">[</span>App <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟹</span>
    list_all <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∉</span> params <span class="bound">p</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∉</span> params <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∉</span> params <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following derived inference rules are sometimes useful in applications.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Class'<span class="main">:</span> <span class="quoted"><span class="quoted">‹Neg <span class="free">A</span> <span class="main">#</span> <span class="free">G</span> <span class="main">⊢</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">G</span> <span class="main">⊢</span> <span class="free">A</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Class<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> NegE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Assum<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">iprover</span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> cut<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">G</span> <span class="main">⊢</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">#</span> <span class="free">G</span> <span class="main">⊢</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">G</span> <span class="main">⊢</span> <span class="free">B</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ImplE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ImplI<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> ForallE'<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">G</span> <span class="main">⊢</span> Forall <span class="free">a</span> <span class="main">⟹</span> subst <span class="free">a</span> <span class="free">t</span> <span class="main">0</span> <span class="main">#</span> <span class="free">G</span> <span class="main">⊢</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">G</span> <span class="main">⊢</span> <span class="free">B</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cut<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ForallE<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
As an example, we show that the excluded middle, a commutation property
for existential and universal quantifiers, the drinker principle, as well
as Peirce's law are derivable in the calculus given above.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> tnd<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">[]</span> <span class="main">⊢</span> Or <span class="main">(</span>Pred <span class="free">p</span> <span class="main">[]</span><span class="main">)</span> <span class="main">(</span>Neg <span class="main">(</span>Pred <span class="free">p</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="main">_</span> <span class="main">⊢</span> <span class="var">?or</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span>Neg <span class="var">?or</span><span class="main">]</span> <span class="main">⊢</span> Neg <span class="var">?or</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span>Pred <span class="free">p</span> <span class="main">[]</span><span class="main">,</span> Neg <span class="var">?or</span><span class="main">]</span> <span class="main">⊢</span> Neg <span class="var">?or</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span>Pred <span class="free">p</span> <span class="main">[]</span><span class="main">,</span> Neg <span class="var">?or</span><span class="main">]</span> <span class="main">⊢</span> Pred <span class="free">p</span> <span class="main">[]</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span>Pred <span class="free">p</span> <span class="main">[]</span><span class="main">,</span> Neg <span class="var">?or</span><span class="main">]</span> <span class="main">⊢</span> <span class="var">?or</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> OrI1<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span>Pred <span class="free">p</span> <span class="main">[]</span><span class="main">,</span> Neg <span class="var">?or</span><span class="main">]</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> NegE<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span>Neg <span class="var">?or</span><span class="main">]</span> <span class="main">⊢</span> Neg <span class="main">(</span>Pred <span class="free">p</span> <span class="main">[]</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> NegI<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span>Neg <span class="var">?or</span><span class="main">]</span> <span class="main">⊢</span> <span class="var">?or</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> OrI2<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span>Neg <span class="var">?or</span><span class="main">]</span> <span class="main">⊢</span> FF›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> NegE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Class<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> ex_all_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">[]</span><span class="main">::</span><span class="main">(</span>nat<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form list<span class="main">)</span> <span class="main">⊢</span> Impl <span class="main">(</span>Exists <span class="main">(</span>Forall <span class="main">(</span>Pred <span class="free">p</span> <span class="main">[</span>Var <span class="main">1</span><span class="main">,</span> Var <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
     <span class="main">(</span>Forall <span class="main">(</span>Exists <span class="main">(</span>Pred <span class="free">p</span> <span class="main">[</span>Var <span class="main">0</span><span class="main">,</span> Var <span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?forall</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Forall <span class="main">(</span>Pred <span class="free">p</span> <span class="main">[</span>Var <span class="main">1</span><span class="main">,</span> Var <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">::</span> <span class="main">(</span>nat<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span>Exists <span class="var">?forall</span><span class="main">]</span> <span class="main">⊢</span> Exists <span class="var">?forall</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span><span class="var">?forall</span><span class="main">[</span>App <span class="main">1</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">,</span> Exists <span class="var">?forall</span><span class="main">]</span> <span class="main">⊢</span> Forall <span class="main">(</span>Pred <span class="free">p</span> <span class="main">[</span>App <span class="main">1</span> <span class="main">[]</span><span class="main">,</span> Var <span class="main">0</span><span class="main">]</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span>Pred <span class="free">p</span> <span class="main">[</span>App <span class="main">1</span> <span class="main">[]</span><span class="main">,</span> Var <span class="main">0</span><span class="main">]</span><span class="main">[</span>App <span class="main">0</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">,</span> <span class="var">?forall</span><span class="main">[</span>App <span class="main">1</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
      Exists <span class="var">?forall</span><span class="main">]</span> <span class="main">⊢</span> Pred <span class="free">p</span> <span class="main">[</span>Var <span class="main">0</span><span class="main">,</span> App <span class="main">0</span> <span class="main">[]</span><span class="main">]</span><span class="main">[</span>App <span class="main">1</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span><span class="var">?forall</span><span class="main">[</span>App <span class="main">1</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">,</span> Exists <span class="var">?forall</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>Pred <span class="free">p</span> <span class="main">[</span>Var <span class="main">0</span><span class="main">,</span> App <span class="main">0</span> <span class="main">[]</span><span class="main">]</span><span class="main">)</span><span class="main">[</span>App <span class="main">1</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ForallE'<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span><span class="var">?forall</span><span class="main">[</span>App <span class="main">1</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">,</span> Exists <span class="var">?forall</span><span class="main">]</span> <span class="main">⊢</span> Exists <span class="main">(</span>Pred <span class="free">p</span> <span class="main">[</span>Var <span class="main">0</span><span class="main">,</span> App <span class="main">0</span> <span class="main">[]</span><span class="main">]</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ExistsI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">1</span> <span class="main">∉</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">[</span>Exists <span class="var">?forall</span><span class="main">]</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">∉</span> params <span class="var">?forall</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">∉</span> params <span class="main">(</span>Exists <span class="main">(</span>Pred <span class="free">p</span> <span class="main">[</span>Var <span class="main">0</span><span class="main">,</span> App <span class="main">(</span><span class="main">0</span> <span class="main">::</span> nat<span class="main">)</span> <span class="main">[]</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span>Exists <span class="var">?forall</span><span class="main">]</span> <span class="main">⊢</span> Exists <span class="main">(</span>Pred <span class="free">p</span> <span class="main">[</span>Var <span class="main">0</span><span class="main">,</span> App <span class="main">0</span> <span class="main">[]</span><span class="main">]</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ExistsE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span>Exists <span class="var">?forall</span><span class="main">]</span> <span class="main">⊢</span> <span class="main">(</span>Exists <span class="main">(</span>Pred <span class="free">p</span> <span class="main">[</span>Var <span class="main">0</span><span class="main">,</span> Var <span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">[</span>App <span class="main">0</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">0</span> <span class="main">∉</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">[</span>Exists <span class="var">?forall</span><span class="main">]</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> params <span class="main">(</span>Exists <span class="main">(</span>Pred <span class="free">p</span> <span class="main">[</span>Var <span class="main">0</span><span class="main">,</span> Var <span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span>Exists <span class="var">?forall</span><span class="main">]</span> <span class="main">⊢</span> Forall <span class="main">(</span>Exists <span class="main">(</span>Pred <span class="free">p</span> <span class="main">[</span>Var <span class="main">0</span><span class="main">,</span> Var <span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ForallI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ImplI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> drinker<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">[]</span><span class="main">::</span><span class="main">(</span>nat<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form list<span class="main">)</span> <span class="main">⊢</span>
  Exists <span class="main">(</span>Impl <span class="main">(</span>Pred <span class="free">P</span> <span class="main">[</span>Var <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Forall <span class="main">(</span>Pred <span class="free">P</span> <span class="main">[</span>Var <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?impl</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Impl <span class="main">(</span>Pred <span class="free">P</span> <span class="main">[</span>Var <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Forall <span class="main">(</span>Pred <span class="free">P</span> <span class="main">[</span>Var <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> <span class="main">(</span>nat<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">[</span>Pred <span class="free">P</span> <span class="main">[</span>Var <span class="main">0</span><span class="main">]</span><span class="main">,</span> Neg <span class="main">(</span>Exists <span class="var">?impl</span><span class="main">)</span><span class="main">]</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Pred <span class="free">P</span> <span class="main">[</span>App <span class="main">0</span> <span class="main">[]</span><span class="main">]</span><span class="main">)</span> <span class="main">#</span> <span class="var">?G'</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?G</span> <span class="main">⊢</span> Neg <span class="main">(</span>Exists <span class="var">?impl</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Pred <span class="free">P</span> <span class="main">[</span>App <span class="main">0</span> <span class="main">[]</span><span class="main">]</span> <span class="main">#</span> <span class="var">?G</span> <span class="main">⊢</span> Neg <span class="main">(</span>Pred <span class="free">P</span> <span class="main">[</span>App <span class="main">0</span> <span class="main">[]</span><span class="main">]</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Pred <span class="free">P</span> <span class="main">[</span>App <span class="main">0</span> <span class="main">[]</span><span class="main">]</span> <span class="main">#</span> <span class="var">?G</span> <span class="main">⊢</span> Pred <span class="free">P</span> <span class="main">[</span>App <span class="main">0</span> <span class="main">[]</span><span class="main">]</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Pred <span class="free">P</span> <span class="main">[</span>App <span class="main">0</span> <span class="main">[]</span><span class="main">]</span> <span class="main">#</span> <span class="var">?G</span> <span class="main">⊢</span> FF›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> NegE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Pred <span class="free">P</span> <span class="main">[</span>App <span class="main">0</span> <span class="main">[]</span><span class="main">]</span> <span class="main">#</span> <span class="var">?G</span> <span class="main">⊢</span> Forall <span class="main">(</span>Pred <span class="free">P</span> <span class="main">[</span>Var <span class="main">0</span><span class="main">]</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> FFE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?G</span> <span class="main">⊢</span> <span class="var">?impl</span><span class="main">[</span>App <span class="main">0</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ImplI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?G</span> <span class="main">⊢</span> Exists <span class="var">?impl</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ExistsI<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?G</span> <span class="main">⊢</span> FF›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> NegE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?G'</span> <span class="main">⊢</span> Pred <span class="free">P</span> <span class="main">[</span>Var <span class="main">0</span><span class="main">]</span><span class="main">[</span>App <span class="main">0</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Class <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> nat<span class="main">)</span> <span class="main">∉</span> params <span class="bound">p</span><span class="main">)</span> <span class="var">?G'</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">0</span> <span class="main">::</span> nat<span class="main">)</span> <span class="main">∉</span> params <span class="main">(</span>Pred <span class="free">P</span> <span class="main">[</span>Var <span class="main">0</span><span class="main">]</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?G'</span> <span class="main">⊢</span> Forall <span class="main">(</span>Pred <span class="free">P</span> <span class="main">[</span>Var <span class="main">0</span><span class="main">]</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ForallI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span>Neg <span class="main">(</span>Exists <span class="var">?impl</span><span class="main">)</span><span class="main">]</span> <span class="main">⊢</span> <span class="var">?impl</span><span class="main">[</span>Var <span class="main">0</span><span class="main">/</span><span class="main">0</span><span class="main">]</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ImplI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span>Neg <span class="main">(</span>Exists <span class="var">?impl</span><span class="main">)</span><span class="main">]</span> <span class="main">⊢</span> Exists <span class="var">?impl</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ExistsI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Class'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> peirce<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">[]</span> <span class="main">⊢</span> Impl <span class="main">(</span>Impl <span class="main">(</span>Impl <span class="main">(</span>Pred <span class="free">P</span> <span class="main">[]</span><span class="main">)</span> <span class="main">(</span>Pred <span class="free">Q</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Pred <span class="free">P</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Pred <span class="free">P</span> <span class="main">[]</span><span class="main">)</span>›</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[]</span> <span class="main">⊢</span> Impl <span class="var">?PQP</span> <span class="main">(</span>Pred <span class="free">P</span> <span class="main">[]</span><span class="main">)</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?PQPP</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Impl <span class="var">?PQP</span> <span class="main">(</span>Pred <span class="free">P</span> <span class="main">[]</span><span class="main">)</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span><span class="var">?PQP</span><span class="main">,</span> Neg <span class="var">?PQPP</span><span class="main">]</span> <span class="main">⊢</span> <span class="var">?PQP</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span>Pred <span class="free">P</span> <span class="main">[]</span><span class="main">,</span> <span class="var">?PQP</span><span class="main">,</span> Neg <span class="var">?PQPP</span><span class="main">]</span> <span class="main">⊢</span> Neg <span class="var">?PQPP</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span><span class="var">?PQP</span><span class="main">,</span> Pred <span class="free">P</span> <span class="main">[]</span><span class="main">,</span> <span class="var">?PQP</span><span class="main">,</span> Neg <span class="var">?PQPP</span><span class="main">]</span> <span class="main">⊢</span> Pred <span class="free">P</span> <span class="main">[]</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span>Pred <span class="free">P</span> <span class="main">[]</span><span class="main">,</span> <span class="var">?PQP</span><span class="main">,</span> Neg <span class="var">?PQPP</span><span class="main">]</span> <span class="main">⊢</span> <span class="var">?PQPP</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ImplI<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span>Pred <span class="free">P</span> <span class="main">[]</span><span class="main">,</span> <span class="var">?PQP</span><span class="main">,</span> Neg <span class="var">?PQPP</span><span class="main">]</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> NegE<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span>Pred <span class="free">P</span> <span class="main">[]</span><span class="main">,</span> <span class="var">?PQP</span><span class="main">,</span> Neg <span class="var">?PQPP</span><span class="main">]</span> <span class="main">⊢</span> Pred <span class="free">Q</span> <span class="main">[]</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> FFE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span><span class="var">?PQP</span><span class="main">,</span> Neg <span class="var">?PQPP</span><span class="main">]</span> <span class="main">⊢</span> Impl <span class="main">(</span>Pred <span class="free">P</span> <span class="main">[]</span><span class="main">)</span> <span class="main">(</span>Pred <span class="free">Q</span> <span class="main">[]</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ImplI<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span><span class="var">?PQP</span><span class="main">,</span> Neg <span class="var">?PQPP</span><span class="main">]</span> <span class="main">⊢</span> Pred <span class="free">P</span> <span class="main">[]</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ImplE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span>Neg <span class="var">?PQPP</span><span class="main">]</span> <span class="main">⊢</span> <span class="var">?PQPP</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ImplI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[]</span> <span class="main">⊢</span> <span class="var">?PQPP</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Class'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Correctness›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The correctness of the proof calculus introduced in \secref{sec:proof-calculus}
can now be proved by induction on the derivation of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">G</span></span> <span class="main"><span class="main">⊢</span></span> <span class="free"><span class="free">p</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, using the
substitution rules proved in \secref{sec:semantics}.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> correctness<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">G</span> <span class="main">⊢</span> <span class="free">p</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">e</span><span class="main">,</span><span class="bound">f</span><span class="main">,</span><span class="bound">g</span><span class="main">,</span><span class="free">G</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> deriv.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assum <span class="skolem">a</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> model_def list_all_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ForallI <span class="skolem">G</span> <span class="skolem">a</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">e</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹nat <span class="main">⇒</span> <span class="tfree">'c</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">e</span><span class="main">,</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="skolem">g</span><span class="main">,</span> <span class="skolem">G</span> <span class="main">⊨</span> <span class="main">(</span><span class="skolem">a</span><span class="main">[</span>App <span class="skolem">n</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ForallI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> list_all <span class="main">(</span>eval <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span><span class="main">)</span> <span class="skolem">G</span> <span class="main">⟶</span> eval <span class="main">(</span><span class="skolem">e</span><span class="main">⟨</span><span class="main">0</span><span class="main">:</span><span class="bound">z</span><span class="main">⟩</span><span class="main">)</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">a</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ForallI <span class="keyword1"><span class="command">unfolding</span></span> model_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span><span class="main">,</span><span class="skolem">f</span><span class="main">,</span><span class="skolem">g</span><span class="main">,</span><span class="skolem">G</span> <span class="main">⊨</span> Forall <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> model_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ExistsE <span class="skolem">G</span> <span class="skolem">a</span> <span class="skolem">n</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">e</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹nat <span class="main">⇒</span> <span class="tfree">'c</span>›</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span>eval <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span><span class="main">)</span> <span class="skolem">G</span> <span class="main">⟶</span> eval <span class="main">(</span><span class="skolem">e</span><span class="main">⟨</span><span class="main">0</span><span class="main">:</span><span class="skolem">z</span><span class="main">⟩</span><span class="main">)</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">a</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ExistsE <span class="keyword1"><span class="command">unfolding</span></span> model_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span><span class="main">,</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="skolem">g</span><span class="main">,</span> <span class="skolem">G</span> <span class="main">⊨</span> <span class="skolem">b</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ExistsE <span class="keyword1"><span class="command">unfolding</span></span> model_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span><span class="main">,</span><span class="skolem">f</span><span class="main">,</span><span class="skolem">g</span><span class="main">,</span><span class="skolem">G</span> <span class="main">⊨</span> <span class="skolem">b</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ExistsE <span class="keyword1"><span class="command">unfolding</span></span> model_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> model_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Completeness›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The goal of this section is to prove completeness of the natural deduction
calculus introduced in \secref{sec:proof-calculus}. Before we start with the
actual proof, it is useful to note that the following two formulations of
completeness are equivalent:
\begin{enumerate}
\item All valid formulae are derivable, i.e.
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ps ⊨ p ⟹ ps ⊢ p›</span></span></span></span>
\item All consistent sets are satisfiable
\end{enumerate}
The latter property is called the {\em model existence theorem}. To see why 2
implies 1, observe that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Neg p, ps \&lt;notturnstile&gt; FF›</span></span></span></span> implies
that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Neg p, ps›</span></span></span></span> is consistent, which, by the model existence theorem,
implies that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Neg p, ps›</span></span></span></span> has a model, which in turn implies that
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ps \&lt;notTurnstile&gt; p›</span></span></span></span>. By contraposition, it therefore follows
from <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ps ⊨ p›</span></span></span></span> that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Neg p, ps ⊢ FF›</span></span></span></span>, which allows us to
deduce <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ps ⊢ p›</span></span></span></span> using rule <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Class›</span></span></span></span>.

In most textbooks on logic, a set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>S›</span></span></span></span> of formulae is called {\em consistent},
if no contradiction can be derived from <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>S›</span></span></span></span> using a {\em specific proof calculus},
i.e.\ <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>S \&lt;notturnstile&gt; FF›</span></span></span></span>. Rather than defining consistency relative to
a {\em specific} calculus, Fitting uses the more general approach of describing
properties that all consistent sets must have (see \secref{sec:consistent-sets}).

The key idea behind the proof of the model existence theorem is to
extend a consistent set to one that is {\em maximal} (see \secref{sec:extend}).
In order to do this, we use the fact that the set of formulae is enumerable
(see \secref{sec:enumeration}), which allows us to form a sequence
$\phi_0$, $\phi_1$, $\phi_2$, $\ldots$ containing all formulae.
We can then construct a sequence $S_i$ of consistent sets as follows:
\[
\begin{array}{l}
  S_0 = S \\
  S_{i+1} = \left\{\begin{array}{ll}
    S_i \cup \{\phi_i\} &amp; \hbox{if } S_i \cup \{\phi_i\} \hbox{ consistent} \\
    S_i &amp; \hbox{otherwise}
  \end{array}\right.
\end{array}
\]
To obtain a maximal consistent set, we form the union $\bigcup_i S_i$ of these
sets. To ensure that this union is still consistent, additional closure
(see \secref{sec:closure}) and finiteness (see \secref{sec:finiteness})
properties are needed.
It can be shown that a maximal consistent set is a {\em Hintikka set}
(see \secref{sec:hintikka}). Hintikka sets are satisfiable in {\em Herbrand}
models, where closed terms coincide with their interpretation.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Consistent sets›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\label{sec:consistent-sets}
In this section, we describe an abstract criterion for consistent sets.
A set of sets of formulae is called a {\em consistency property}, if the
following holds:
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">consistency</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form set set <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">consistency</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟶</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">p</span> <span class="bound">ts</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>Pred <span class="bound">p</span> <span class="bound">ts</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">∧</span> Neg <span class="main">(</span>Pred <span class="bound">p</span> <span class="bound">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
     FF <span class="main">∉</span> <span class="bound">S</span> <span class="main">∧</span> Neg TT <span class="main">∉</span> <span class="bound">S</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">Z</span><span class="main">.</span> Neg <span class="main">(</span>Neg <span class="bound">Z</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">Z</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> And <span class="bound">A</span> <span class="bound">B</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">A</span><span class="main">,</span> <span class="bound">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> Neg <span class="main">(</span>Or <span class="bound">A</span> <span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="bound">A</span><span class="main">,</span> Neg <span class="bound">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> Or <span class="bound">A</span> <span class="bound">B</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">A</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∨</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> Neg <span class="main">(</span>And <span class="bound">A</span> <span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="bound">A</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∨</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="bound">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> Impl <span class="bound">A</span> <span class="bound">B</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="bound">A</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∨</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> Neg <span class="main">(</span>Impl <span class="bound">A</span> <span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">A</span><span class="main">,</span> Neg <span class="bound">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">P</span> <span class="bound">t</span><span class="main">.</span> closedt <span class="main">0</span> <span class="bound">t</span> <span class="main">⟶</span> Forall <span class="bound">P</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">P</span><span class="main">[</span><span class="bound">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">P</span> <span class="bound">t</span><span class="main">.</span> closedt <span class="main">0</span> <span class="bound">t</span> <span class="main">⟶</span> Neg <span class="main">(</span>Exists <span class="bound">P</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="bound">P</span><span class="main">[</span><span class="bound">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">P</span><span class="main">.</span> Exists <span class="bound">P</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">P</span><span class="main">[</span>App <span class="bound">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">P</span><span class="main">.</span> Neg <span class="main">(</span>Forall <span class="bound">P</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="bound">P</span><span class="main">[</span>App <span class="bound">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In \secref{sec:finiteness}, we will show how to extend a consistency property
to one that is of {\em finite character}. However, the above
definition of a consistency property cannot be used for this, since there is
a problem with the treatment of formulae of the form <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Exists P›</span></span></span></span> and
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Neg (Forall P)›</span></span></span></span>. Fitting therefore suggests to define an {\em alternative
consistency property} as follows:
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">alt_consistency</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form set set <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">alt_consistency</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟶</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">p</span> <span class="bound">ts</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>Pred <span class="bound">p</span> <span class="bound">ts</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">∧</span> Neg <span class="main">(</span>Pred <span class="bound">p</span> <span class="bound">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
     FF <span class="main">∉</span> <span class="bound">S</span> <span class="main">∧</span> Neg TT <span class="main">∉</span> <span class="bound">S</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">Z</span><span class="main">.</span> Neg <span class="main">(</span>Neg <span class="bound">Z</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">Z</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> And <span class="bound">A</span> <span class="bound">B</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">A</span><span class="main">,</span> <span class="bound">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> Neg <span class="main">(</span>Or <span class="bound">A</span> <span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="bound">A</span><span class="main">,</span> Neg <span class="bound">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> Or <span class="bound">A</span> <span class="bound">B</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">A</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∨</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> Neg <span class="main">(</span>And <span class="bound">A</span> <span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="bound">A</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∨</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="bound">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> Impl <span class="bound">A</span> <span class="bound">B</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="bound">A</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∨</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> Neg <span class="main">(</span>Impl <span class="bound">A</span> <span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">A</span><span class="main">,</span> Neg <span class="bound">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">P</span> <span class="bound">t</span><span class="main">.</span> closedt <span class="main">0</span> <span class="bound">t</span> <span class="main">⟶</span> Forall <span class="bound">P</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">P</span><span class="main">[</span><span class="bound">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">P</span> <span class="bound">t</span><span class="main">.</span> closedt <span class="main">0</span> <span class="bound">t</span> <span class="main">⟶</span> Neg <span class="main">(</span>Exists <span class="bound">P</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="bound">P</span><span class="main">[</span><span class="bound">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">P</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> params <span class="bound">a</span><span class="main">)</span> <span class="main">⟶</span> Exists <span class="bound">P</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span>
       <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">P</span><span class="main">[</span>App <span class="bound">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">P</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> params <span class="bound">a</span><span class="main">)</span> <span class="main">⟶</span> Neg <span class="main">(</span>Forall <span class="bound">P</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span>
       <span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="bound">P</span><span class="main">[</span>App <span class="bound">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Note that in the clauses for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Exists P›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Neg (Forall P)›</span></span></span></span>,
the first definition requires the existence of a parameter <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> with a certain
property, whereas the second definition requires that all parameters <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> that
are new for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>S›</span></span></span></span> have a certain property. A consistency property can easily be
turned into an alternative consistency property by applying a suitable parameter
substitution:
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_alt_consistency</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form set set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form set set›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">mk_alt_consistency</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span> <span class="main">∃</span><span class="bound">f</span><span class="main">.</span> psubst <span class="bound">f</span> <span class="main">`</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">}</span>›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> alt_consistency<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> conc<span class="main">:</span> <span class="quoted"><span class="quoted">‹consistency <span class="free">C</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹alt_consistency <span class="main">(</span>mk_alt_consistency <span class="free">C</span><span class="main">)</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹alt_consistency <span class="var">?C'</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form set›</span></span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∈</span> mk_alt_consistency <span class="free">C</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> sc<span class="main">:</span> <span class="quoted"><span class="quoted">‹psubst <span class="skolem">f</span> <span class="main">`</span> <span class="skolem">S</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> mk_alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">ts</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∧</span> Neg <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹Pred <span class="skolem">p</span> <span class="skolem">ts</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∧</span> Neg <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="skolem">f</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?S'</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Pred <span class="skolem">p</span> <span class="main">(</span>psubstts <span class="skolem">f</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?S'</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Pred <span class="skolem">p</span> <span class="main">(</span>psubstts <span class="skolem">f</span> <span class="skolem">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="var">?S'</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> conc sc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> consistency_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">S</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹FF <span class="main">∉</span> <span class="var">?S'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Neg TT <span class="main">∉</span> <span class="var">?S'</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> conc sc <span class="keyword1"><span class="command">unfolding</span></span> consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹FF <span class="main">∉</span> <span class="skolem">S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Neg TT <span class="main">∉</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Z</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Neg <span class="skolem">Z</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="skolem">f</span> <span class="main">(</span>Neg <span class="main">(</span>Neg <span class="skolem">Z</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?S'</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>psubst <span class="skolem">f</span> <span class="skolem">Z</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> conc sc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> consistency_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">Z</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C'</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mk_alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹And <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="skolem">f</span> <span class="main">(</span>And <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?S'</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>psubst <span class="skolem">f</span> <span class="skolem">A</span><span class="main">,</span> psubst <span class="skolem">f</span> <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> conc sc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> consistency_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C'</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mk_alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="skolem">f</span> <span class="main">(</span>Neg <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?S'</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>psubst <span class="skolem">f</span> <span class="skolem">A</span><span class="main">)</span><span class="main">,</span> Neg <span class="main">(</span>psubst <span class="skolem">f</span> <span class="skolem">B</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> conc sc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> consistency_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C'</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mk_alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="skolem">f</span> <span class="main">(</span>Neg <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?S'</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>psubst <span class="skolem">f</span> <span class="skolem">A</span><span class="main">,</span> Neg <span class="main">(</span>psubst <span class="skolem">f</span> <span class="skolem">B</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> conc sc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> consistency_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C'</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mk_alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Or <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="skolem">f</span> <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?S'</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>psubst <span class="skolem">f</span> <span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∨</span> <span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>psubst <span class="skolem">f</span> <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> conc sc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> consistency_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C'</span> <span class="main">∨</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C'</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mk_alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>And <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="skolem">f</span> <span class="main">(</span>Neg <span class="main">(</span>And <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?S'</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>psubst <span class="skolem">f</span> <span class="skolem">A</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∨</span> <span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>psubst <span class="skolem">f</span> <span class="skolem">B</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> conc sc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> consistency_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C'</span> <span class="main">∨</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C'</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mk_alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Impl <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="skolem">f</span> <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?S'</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>psubst <span class="skolem">f</span> <span class="skolem">A</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∨</span> <span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>psubst <span class="skolem">f</span> <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> conc sc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> consistency_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C'</span> <span class="main">∨</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C'</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mk_alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="skolem">t</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Forall <span class="skolem">P</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="skolem">f</span> <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?S'</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>psubst <span class="skolem">f</span> <span class="skolem">P</span><span class="main">[</span>psubstt <span class="skolem">f</span> <span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="skolem">t</span>›</span></span> conc sc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> consistency_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C'</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mk_alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="skolem">t</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Exists <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="skolem">f</span> <span class="main">(</span>Neg <span class="main">(</span>Exists <span class="skolem">P</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?S'</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>psubst <span class="skolem">f</span> <span class="skolem">P</span><span class="main">[</span>psubstt <span class="skolem">f</span> <span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="skolem">t</span>›</span></span> conc sc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> consistency_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C'</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mk_alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span> <span class="skolem">f'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∉</span> params <span class="bound">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Exists <span class="skolem">P</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="skolem">f</span> <span class="main">(</span>Exists <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?S'</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>psubst <span class="skolem">f</span> <span class="skolem">P</span><span class="main">[</span>App <span class="bound">y</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> conc sc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> consistency_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>psubst <span class="skolem">f</span> <span class="skolem">P</span><span class="main">[</span>App <span class="skolem">y</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span> <span class="main">=</span> <span class="var">?S'</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span>
        <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>psubst <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="skolem">P</span><span class="main">[</span>App <span class="main">(</span><span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> psubst <span class="bound">f</span> <span class="main">`</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>psubst <span class="bound">f</span> <span class="skolem">P</span><span class="main">[</span>App <span class="main">(</span><span class="bound">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C'</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mk_alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∉</span> params <span class="bound">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="skolem">f</span> <span class="main">(</span>Neg <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?S'</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>psubst <span class="skolem">f</span> <span class="skolem">P</span><span class="main">[</span>App <span class="bound">y</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> conc sc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> consistency_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>psubst <span class="skolem">f</span> <span class="skolem">P</span><span class="main">[</span>App <span class="skolem">y</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span> <span class="main">=</span> <span class="var">?S'</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span>
    <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>psubst <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="skolem">P</span><span class="main">[</span>App <span class="main">(</span><span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> psubst <span class="bound">f</span> <span class="main">`</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>psubst <span class="bound">f</span> <span class="skolem">P</span><span class="main">[</span>App <span class="main">(</span><span class="bound">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C'</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mk_alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> mk_alt_consistency_subset<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">⊆</span> mk_alt_consistency <span class="free">C</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mk_alt_consistency_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst id <span class="main">`</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> psubst <span class="bound">f</span> <span class="main">`</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span> <span class="main">∃</span><span class="bound">f</span><span class="main">.</span> psubst <span class="bound">f</span> <span class="main">`</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free">C</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Closure under subsets›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\label{sec:closure}
We now show that a consistency property can be extended to one
that is closed under subsets.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">close</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form set set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form set set›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">close</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span> <span class="main">∃</span><span class="bound">S'</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="bound">S'</span><span class="main">}</span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subset_closed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> set set <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">subset_closed</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">S'</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="bound">S'</span> <span class="main">⟶</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subset_in_close<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">⊆</span> <span class="free">S'</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S'</span> <span class="main">∪</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">⟶</span> <span class="free">S</span> <span class="main">∪</span> <span class="free">x</span> <span class="main">∈</span> close <span class="free">C</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S'</span> <span class="main">∪</span> <span class="free">x</span> <span class="main">∈</span> close <span class="free">C</span> <span class="main">⟶</span> <span class="free">S</span> <span class="main">∪</span> <span class="free">x</span> <span class="main">∈</span> close <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> close_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">⊆</span> <span class="free">S'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> close_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> close_consistency<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> conc<span class="main">:</span> <span class="quoted"><span class="quoted">‹consistency <span class="free">C</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹consistency <span class="main">(</span>close <span class="free">C</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> consistency_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∈</span> close <span class="free">C</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> close_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">ts</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span> <span class="main">∈</span> <span class="skolem">x</span> <span class="main">∧</span> Neg <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">x</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> conc <span class="keyword1"><span class="command">unfolding</span></span> consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∧</span> Neg <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹FF <span class="main">∉</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> conc <span class="keyword1"><span class="command">unfolding</span></span> consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹FF <span class="main">∉</span> <span class="skolem">S</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg TT <span class="main">∉</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> conc <span class="keyword1"><span class="command">unfolding</span></span> consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹Neg TT <span class="main">∉</span> <span class="skolem">S</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Z</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Neg <span class="skolem">Z</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Neg <span class="skolem">Z</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">Z</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> conc <span class="keyword1"><span class="command">unfolding</span></span> consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">Z</span><span class="main">}</span> <span class="main">∈</span> close <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> subset_in_close <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹And <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹And <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> conc <span class="keyword1"><span class="command">unfolding</span></span> consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> close <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> subset_in_close <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> conc <span class="keyword1"><span class="command">unfolding</span></span> consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> close <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> subset_in_close <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Or <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Or <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> conc <span class="keyword1"><span class="command">unfolding</span></span> consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> close <span class="free">C</span> <span class="main">∨</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> close <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> subset_in_close <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>And <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>And <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> conc <span class="keyword1"><span class="command">unfolding</span></span> consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> close <span class="free">C</span> <span class="main">∨</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> close <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> subset_in_close <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Impl <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Impl <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> conc <span class="keyword1"><span class="command">unfolding</span></span> consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> close <span class="free">C</span> <span class="main">∨</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> close <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> subset_in_close <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> conc <span class="keyword1"><span class="command">unfolding</span></span> consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> close <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> subset_in_close <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="skolem">t</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Forall <span class="skolem">P</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Forall <span class="skolem">P</span> <span class="main">∈</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="skolem">t</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> conc <span class="keyword1"><span class="command">unfolding</span></span> consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> close <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> subset_in_close <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="skolem">t</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Exists <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Exists <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="skolem">t</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> conc <span class="keyword1"><span class="command">unfolding</span></span> consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> close <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> subset_in_close <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Exists <span class="skolem">P</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Exists <span class="skolem">P</span> <span class="main">∈</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span>App <span class="bound">c</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> conc <span class="keyword1"><span class="command">unfolding</span></span> consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span>App <span class="bound">c</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> close <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> subset_in_close <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>App <span class="bound">c</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> conc <span class="keyword1"><span class="command">unfolding</span></span> consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>App <span class="bound">c</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> close <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> subset_in_close <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> close_closed<span class="main">:</span> <span class="quoted"><span class="quoted">‹subset_closed <span class="main">(</span>close <span class="free">C</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> close_def subset_closed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">theorem</span></span> close_subset<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">⊆</span> close <span class="free">C</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> close_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
If a consistency property <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>C›</span></span></span></span> is closed under subsets, so is the
corresponding alternative consistency property:
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> mk_alt_consistency_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹subset_closed <span class="free">C</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹subset_closed <span class="main">(</span>mk_alt_consistency <span class="free">C</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> subset_closed_def mk_alt_consistency_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI allI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="skolem">S'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form set›</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">S'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span> <span class="main">∃</span><span class="bound">f</span><span class="main">.</span> psubst <span class="bound">f</span> <span class="main">`</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free">C</span><span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹psubst <span class="skolem">f</span> <span class="main">`</span> <span class="skolem">S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="skolem">f</span> <span class="main">`</span> <span class="skolem">S</span> <span class="main">⊆</span> psubst <span class="skolem">f</span> <span class="main">`</span> <span class="skolem">S'</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">S'</span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">S</span></span> <span class="main">⊆</span> <span class="bound">S'</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹subset_closed <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subset_closed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="skolem">f</span> <span class="main">`</span> <span class="skolem">S</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span> <span class="main">∃</span><span class="bound">f</span><span class="main">.</span> psubst <span class="bound">f</span> <span class="main">`</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free">C</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Finite character›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\label{sec:finiteness}
In this section, we show that an alternative consistency property can
be extended to one of finite character. A set of sets <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>C›</span></span></span></span> is said
to be of finite character, provided that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>S›</span></span></span></span> is a member of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>C›</span></span></span></span>
if and only if every subset of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>S›</span></span></span></span> is.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">finite_char</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> set set <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">finite_char</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">S'</span><span class="main">.</span> finite <span class="bound">S'</span> <span class="main">⟶</span> <span class="bound">S'</span> <span class="main">⊆</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">S'</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_finite_char</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> set set <span class="main">⇒</span> <span class="tfree">'a</span> set set›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">mk_finite_char</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">S'</span><span class="main">.</span> <span class="bound">S'</span> <span class="main">⊆</span> <span class="bound">S</span> <span class="main">⟶</span> finite <span class="bound">S'</span> <span class="main">⟶</span> <span class="bound">S'</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">}</span>›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> finite_alt_consistency<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> altconc<span class="main">:</span> <span class="quoted"><span class="quoted">‹alt_consistency <span class="free">C</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹subset_closed <span class="free">C</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹alt_consistency <span class="main">(</span>mk_finite_char <span class="free">C</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∈</span> mk_finite_char <span class="free">C</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> finc<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound"><span class="bound">S'</span></span> <span class="main">⊆</span> <span class="skolem">S</span><span class="main">.</span> finite <span class="bound">S'</span> <span class="main">⟶</span> <span class="bound">S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mk_finite_char_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">S'</span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">S</span></span> <span class="main">⊆</span> <span class="bound">S'</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹subset_closed <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subset_closed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sc<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">S'</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">S'</span> <span class="main">∪</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">S</span></span> <span class="main">⊆</span> <span class="bound">S'</span> <span class="main">∪</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free">C</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">ts</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∧</span> Neg <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Pred <span class="skolem">p</span> <span class="skolem">ts</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∧</span> Neg <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">,</span> Neg <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> finc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> altconc <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹FF <span class="main">∉</span> <span class="skolem">S</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹FF <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span>FF<span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> finc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> altconc <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹Neg TT <span class="main">∉</span> <span class="skolem">S</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg TT <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span>Neg TT<span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> finc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> altconc <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Z</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Neg <span class="skolem">Z</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">Z</span><span class="main">}</span> <span class="main">∈</span> mk_finite_char <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mk_finite_char_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI CollectI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S'</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">Z</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>Neg <span class="skolem">Z</span><span class="main">)</span><span class="main">}</span>›</span></span>

      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">Z</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S'</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">⊆</span> <span class="skolem">S</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?S'</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> finc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">Z</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> altconc <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> sc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹And <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> mk_finite_char <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mk_finite_char_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI CollectI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S'</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span>And <span class="skolem">A</span> <span class="skolem">B</span><span class="main">}</span>›</span></span>

      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S'</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">⊆</span> <span class="skolem">S</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?S'</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> finc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> altconc <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> sc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> mk_finite_char <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mk_finite_char_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI CollectI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S'</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">-</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span><span class="main">}</span>›</span></span>

      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S'</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">⊆</span> <span class="skolem">S</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?S'</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> finc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> altconc <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> sc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> mk_finite_char <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mk_finite_char_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI CollectI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S'</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span><span class="main">}</span>›</span></span>

      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S'</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">⊆</span> <span class="skolem">S</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?S'</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> finc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> altconc <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> sc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹Or <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> mk_finite_char <span class="free">C</span> <span class="main">∨</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> mk_finite_char <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?thesis</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Sa</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">Sb</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sa</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Sa</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sa</span> <span class="main">∉</span> <span class="free">C</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sb</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Sb</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sb</span> <span class="main">∉</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> mk_finite_char_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Sa</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">A</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">Sb</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">}</span>›</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">⊆</span> <span class="skolem">S</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sa</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sb</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>›</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?S'</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Sa</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Sb</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> finc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∨</span> <span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> altconc <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sa</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∨</span> <span class="skolem">Sb</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> sc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sa</span> <span class="main">∉</span> <span class="free">C</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sb</span> <span class="main">∉</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>And <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> mk_finite_char <span class="free">C</span> <span class="main">∨</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> mk_finite_char <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?thesis</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Sa</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">Sb</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sa</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Sa</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sa</span> <span class="main">∉</span> <span class="free">C</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sb</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">B</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Sb</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sb</span> <span class="main">∉</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> mk_finite_char_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Sa</span> <span class="main">-</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">Sb</span> <span class="main">-</span> <span class="main">{</span>Neg <span class="skolem">B</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>And <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span><span class="main">}</span>›</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">⊆</span> <span class="skolem">S</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sa</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sb</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">B</span><span class="main">}</span>›</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?S'</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Sa</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Sb</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> finc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∨</span> <span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> altconc <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sa</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∨</span> <span class="skolem">Sb</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> sc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sa</span> <span class="main">∉</span> <span class="free">C</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sb</span> <span class="main">∉</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹Impl <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> mk_finite_char <span class="free">C</span> <span class="main">∨</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> mk_finite_char <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?thesis</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Sa</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">Sb</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sa</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Sa</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sa</span> <span class="main">∉</span> <span class="free">C</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sb</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Sb</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sb</span> <span class="main">∉</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> mk_finite_char_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Sa</span> <span class="main">-</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">Sb</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">}</span>›</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">⊆</span> <span class="skolem">S</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sa</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sb</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span>›</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?S'</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Sa</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Sb</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> finc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∨</span> <span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> altconc <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sa</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∨</span> <span class="skolem">Sb</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> sc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sa</span> <span class="main">∉</span> <span class="free">C</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Sb</span> <span class="main">∉</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹Forall <span class="skolem">P</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="skolem">t</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> mk_finite_char <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mk_finite_char_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI CollectI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S'</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span>Forall <span class="skolem">P</span><span class="main">}</span>›</span></span>

      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S'</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">⊆</span> <span class="skolem">S</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?S'</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> finc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> altconc <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> sc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Exists <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="skolem">t</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> mk_finite_char <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mk_finite_char_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI CollectI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S'</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">-</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>Exists <span class="skolem">P</span><span class="main">)</span><span class="main">}</span>›</span></span>

      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S'</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">⊆</span> <span class="skolem">S</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?S'</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> finc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> altconc <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> sc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹Exists <span class="skolem">P</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∉</span> params <span class="bound">a</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> mk_finite_char <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mk_finite_char_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI CollectI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S'</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span>Exists <span class="skolem">P</span><span class="main">}</span>›</span></span>

      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S'</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">⊆</span> <span class="skolem">S</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?S'</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> finc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="var">?S'</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∉</span> params <span class="bound">a</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∉</span> params <span class="bound">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">⊆</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> altconc <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∉</span> params <span class="bound">a</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> sc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∉</span> params <span class="bound">a</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> mk_finite_char <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mk_finite_char_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI CollectI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S'</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">-</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span><span class="main">}</span>›</span></span>

      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S'</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">⊆</span> <span class="skolem">S</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?S'</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> finc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="var">?S'</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∉</span> params <span class="bound">a</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∉</span> params <span class="bound">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">⊆</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> altconc <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∉</span> params <span class="bound">a</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> sc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> finite_char<span class="main">:</span> <span class="quoted"><span class="quoted">‹finite_char <span class="main">(</span>mk_finite_char <span class="free">C</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> finite_char_def mk_finite_char_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">theorem</span></span> finite_char_closed<span class="main">:</span> <span class="quoted"><span class="quoted">‹finite_char <span class="free">C</span> <span class="main">⟹</span> subset_closed <span class="free">C</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> finite_char_def subset_closed_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI allI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="skolem">S'</span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">S</span><span class="main">.</span> <span class="main">(</span><span class="bound">S</span> <span class="main">∈</span> <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">S'</span><span class="main">.</span> finite <span class="bound">S'</span> <span class="main">⟶</span> <span class="bound">S'</span> <span class="main">⊆</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">S'</span> <span class="main">∈</span> <span class="free">C</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">S'</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">S'</span><span class="main">.</span> finite <span class="bound">S'</span> <span class="main">⟶</span> <span class="bound">S'</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">⟶</span> <span class="bound">S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> finite_char_subset<span class="main">:</span> <span class="quoted"><span class="quoted">‹subset_closed <span class="free">C</span> <span class="main">⟹</span> <span class="free">C</span> <span class="main">⊆</span> mk_finite_char <span class="free">C</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mk_finite_char_def subset_closed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Enumerating datatypes›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\label{sec:enumeration}
As has already been mentioned earlier, the proof of the model existence theorem
relies on the fact that the set of formulae is enumerable. Using the infrastructure
for datatypes, the types <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> term<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> form<span class="antiquote"><span class="antiquote">}</span></span></span></span> can automatically be shown to
be a member of the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">class</span></span> countable<span class="antiquote"><span class="antiquote">}</span></span></span></span> type class:
›</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="quoted">‹term›</span> <span class="main">::</span> <span class="main">(</span><span class="quoted">countable</span><span class="main">)</span> <span class="quoted">countable</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">countable_datatype</span>

<span class="keyword1"><span class="command">instance</span></span> form <span class="main">::</span> <span class="main">(</span><span class="quoted">countable</span><span class="main">,</span> <span class="quoted">countable</span><span class="main">)</span> <span class="quoted">countable</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">countable_datatype</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Extension to maximal consistent sets›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\label{sec:extend}
Given a set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>C›</span></span></span></span> of finite character, we show that
the least upper bound of a chain of sets that are elements
of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>C›</span></span></span></span> is again an element of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>C›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_chain</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span> set<span class="main">)</span> <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">is_chain</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> is_chainD<span class="main">:</span> <span class="quoted"><span class="quoted">‹is_chain <span class="free">f</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_chain_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> is_chainD'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹is_chain <span class="free">f</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="free">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">≤</span> <span class="free">k</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="free">k</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">k</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="bound">n</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">≤</span> <span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_add<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="skolem">n</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="free">k</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_chain <span class="free">f</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="free">m</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_chainD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> chain_index<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ch<span class="main">:</span> <span class="quoted"><span class="quoted">‹is_chain <span class="free">f</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">‹finite <span class="free">F</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">F</span> <span class="main">⊆</span> <span class="free">f</span> <span class="bound">n</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> fin
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">F</span> <span class="main">⊆</span> <span class="free">f</span> <span class="bound">n</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="bound">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ch <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">⊆</span> <span class="free">f</span> <span class="skolem">n</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="skolem">m</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≤</span> max <span class="skolem">n</span> <span class="skolem">m</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≤</span> max <span class="skolem">n</span> <span class="skolem">m</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">(</span>max <span class="skolem">n</span> <span class="skolem">m</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_chainD' ch <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="skolem">m</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≤</span> max <span class="skolem">n</span> <span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">⊆</span> <span class="free">f</span> <span class="main">(</span>max <span class="skolem">n</span> <span class="skolem">m</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_chainD' ch <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">⊆</span> <span class="free">f</span> <span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≤</span> max <span class="skolem">n</span> <span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">(</span>max <span class="skolem">n</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">F</span> <span class="main">⊆</span> <span class="free">f</span> <span class="main">(</span>max <span class="skolem">n</span> <span class="skolem">m</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> chain_union_closed'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹is_chain <span class="free">f</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">C</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">S'</span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">S</span></span> <span class="main">⊆</span> <span class="bound">S'</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">S'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S'</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">S'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S'</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S'</span> <span class="main">⊆</span> <span class="free">f</span> <span class="skolem">n</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> chain_index <span class="quoted"><span class="quoted">‹is_chain <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">S'</span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">S</span></span> <span class="main">⊆</span> <span class="bound">S'</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> chain_union_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹finite_char <span class="free">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_chain <span class="free">f</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹subset_closed <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_char_closed <span class="quoted"><span class="quoted">‹finite_char <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">S'</span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">S</span></span> <span class="main">⊆</span> <span class="bound">S'</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> subset_closed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">S'</span><span class="main">.</span> finite <span class="bound">S'</span> <span class="main">⟶</span> <span class="bound">S'</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> chain_union_closed' assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">S'</span><span class="main">.</span> finite <span class="bound">S'</span> <span class="main">⟶</span> <span class="bound">S'</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">S'</span> <span class="main">∈</span> <span class="free">C</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite_char <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> finite_char_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We can now define a function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Extend›</span></span></span></span> that extends a consistent
set to a maximal consistent set. To this end, we first define an auxiliary
function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>extend›</span></span></span></span> that produces the elements of an ascending chain of
consistent sets.
›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="main">(</span>nonexhaustive<span class="main">)</span> <span class="entity">dest_Neg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">dest_Neg</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="main">(</span>nonexhaustive<span class="main">)</span> <span class="entity">dest_Forall</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">dest_Forall</span> <span class="main">(</span>Forall <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="main">(</span>nonexhaustive<span class="main">)</span> <span class="entity">dest_Exists</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">dest_Exists</span> <span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">extend</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>nat<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form set <span class="main">⇒</span> <span class="main">(</span>nat<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form set set <span class="main">⇒</span>
    <span class="main">(</span>nat <span class="main">⇒</span> <span class="main">(</span>nat<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form<span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span>nat<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form set›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">extend</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">extend</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">extend</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∪</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span>
     <span class="keyword1">then</span>
       <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> Exists <span class="bound">p</span><span class="main">)</span>
        <span class="keyword1">then</span> <span class="free">extend</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∪</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span>subst <span class="main">(</span>dest_Exists <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span>App <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">extend</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∪</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">}</span>
        <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> Neg <span class="main">(</span>Forall <span class="bound">p</span><span class="main">)</span><span class="main">)</span>
        <span class="keyword1">then</span> <span class="free">extend</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∪</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>subst <span class="main">(</span>dest_Forall <span class="main">(</span>dest_Neg <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span>App <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">extend</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∪</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>
        <span class="keyword1">else</span> <span class="free">extend</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∪</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span><span class="main">)</span>
     <span class="keyword1">else</span> <span class="free">extend</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Extend</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>nat<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form set <span class="main">⇒</span> <span class="main">(</span>nat<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form set set <span class="main">⇒</span>
    <span class="main">(</span>nat <span class="main">⇒</span> <span class="main">(</span>nat<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>nat<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form set›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">Extend</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> extend <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> is_chain_extend<span class="main">:</span> <span class="quoted"><span class="quoted">‹is_chain <span class="main">(</span>extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_chain_def<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">theorem</span></span> finite_paramst <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>paramst <span class="main">(</span><span class="free">t</span> <span class="main">::</span> <span class="tfree">'a</span> term<span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>paramsts <span class="main">(</span><span class="free">ts</span> <span class="main">::</span> <span class="tfree">'a</span> term list<span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> paramst.induct paramsts.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> sum.split<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> finite_params <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>params <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">theorem</span></span> finite_params_extend <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">⋂</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">-</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">⟹</span> infinite <span class="main">(</span><span class="main">⋂</span><span class="bound">p</span> <span class="main">∈</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="free">n</span><span class="main">.</span> <span class="main">-</span> params <span class="bound">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> infinite_params_available<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="free">n</span><span class="main">}</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="var">?S'</span><span class="main">.</span> params <span class="bound">x</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="var">?S'</span><span class="main">.</span> params <span class="bound">x</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> infinite_imp_nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="var">?S'</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∉</span> params <span class="bound">a</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> extend_in_C_Exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹alt_consistency <span class="free">C</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="free">n</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span> <span class="main">=</span> Exists <span class="bound">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">n</span> <span class="main">=</span> Exists <span class="skolem">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span> <span class="main">=</span> Exists <span class="bound">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="var">?S'</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span> infinite_params_available
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Exists <span class="skolem">p</span> <span class="main">∈</span> <span class="var">?S'</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="var">?S'</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">p</span><span class="main">[</span>App <span class="bound">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="quoted"><span class="quoted">‹alt_consistency <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">p</span><span class="main">[</span>App <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="var">?S'</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> someI2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> extend_in_C_Neg_Forall<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹alt_consistency <span class="free">C</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="free">n</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span> <span class="main">≠</span> Exists <span class="bound">p</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span> <span class="main">=</span> Neg <span class="main">(</span>Forall <span class="bound">p</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">n</span> <span class="main">=</span> Neg <span class="main">(</span>Forall <span class="skolem">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span> <span class="main">=</span> Neg <span class="main">(</span>Forall <span class="bound">p</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="var">?S'</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span> infinite_params_available
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Forall <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?S'</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="var">?S'</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">p</span><span class="main">[</span>App <span class="bound">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="quoted"><span class="quoted">‹alt_consistency <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">p</span><span class="main">[</span>App <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="var">?S'</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> someI2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> extend_in_C_no_delta<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="free">n</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span> <span class="main">≠</span> Exists <span class="bound">p</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span> <span class="main">≠</span> Neg <span class="main">(</span>Forall <span class="bound">p</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> extend_in_C_stop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="free">n</span><span class="main">}</span> <span class="main">∉</span> <span class="free">C</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">theorem</span></span> extend_in_C<span class="main">:</span> <span class="quoted"><span class="quoted">‹alt_consistency <span class="free">C</span> <span class="main">⟹</span>
  <span class="free">S</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">⟹</span> infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> extend_in_C_Exists extend_in_C_Neg_Forall
      extend_in_C_no_delta extend_in_C_stop
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The main theorem about <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Extend›</span></span></span></span> says that if <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>C›</span></span></span></span> is an
alternative consistency property that is of finite character,
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>S›</span></span></span></span> is consistent and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>S›</span></span></span></span> uses only finitely many
parameters, then <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Extend S C f›</span></span></span></span> is again consistent.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Extend_in_C<span class="main">:</span> <span class="quoted"><span class="quoted">‹alt_consistency <span class="free">C</span> <span class="main">⟹</span> finite_char <span class="free">C</span> <span class="main">⟹</span>
  <span class="free">S</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">⟹</span> infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> Extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Extend_def
  <span class="keyword1"><span class="command">using</span></span> chain_union_closed is_chain_extend extend_in_C
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">theorem</span></span> Extend_subset<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">⊆</span> Extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="bound">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> Extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Extend_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Extend›</span></span></span></span> function yields a maximal set:
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">maximal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set set <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">maximal</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">S'</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⊆</span> <span class="bound">S'</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="bound">S'</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> extend_maximal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">n</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite_char <span class="free">C</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="main">(</span>Extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span><span class="main">)</span> <span class="free">C</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> maximal_def Extend_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">.</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">S'</span>›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">.</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">S'</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">.</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="skolem">S'</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">.</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">S'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">.</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">n</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">.</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">S'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">S'</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="skolem">n</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite_char <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹subset_closed <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> finite_char_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">S'</span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">S</span></span> <span class="main">⊆</span> <span class="bound">S'</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> subset_closed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound"><span class="bound">S</span></span> <span class="main">⊆</span> <span class="skolem">S'</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="skolem">n</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="skolem">n</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">S'</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">.</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">n</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">.</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">S'</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Hintikka sets and Herbrand models›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\label{sec:hintikka}
A Hintikka set is defined as follows:
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hintikka</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form set <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">hintikka</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">p</span> <span class="bound">ts</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>Pred <span class="bound">p</span> <span class="bound">ts</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">∧</span> Neg <span class="main">(</span>Pred <span class="bound">p</span> <span class="bound">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
     FF <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">∧</span> Neg TT <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">Z</span><span class="main">.</span> Neg <span class="main">(</span>Neg <span class="bound">Z</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">⟶</span> <span class="bound">Z</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> And <span class="bound">A</span> <span class="bound">B</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">⟶</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">∧</span> <span class="bound">B</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> Neg <span class="main">(</span>Or <span class="bound">A</span> <span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">⟶</span> Neg <span class="bound">A</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">∧</span> Neg <span class="bound">B</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> Or <span class="bound">A</span> <span class="bound">B</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">⟶</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">∨</span> <span class="bound">B</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> Neg <span class="main">(</span>And <span class="bound">A</span> <span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">⟶</span> Neg <span class="bound">A</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">∨</span> Neg <span class="bound">B</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> Impl <span class="bound">A</span> <span class="bound">B</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">⟶</span> Neg <span class="bound">A</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">∨</span> <span class="bound">B</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> Neg <span class="main">(</span>Impl <span class="bound">A</span> <span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">⟶</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">∧</span> Neg <span class="bound">B</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">P</span> <span class="bound">t</span><span class="main">.</span> closedt <span class="main">0</span> <span class="bound">t</span> <span class="main">⟶</span> Forall <span class="bound">P</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">⟶</span> subst <span class="bound">P</span> <span class="bound">t</span> <span class="main">0</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">P</span> <span class="bound">t</span><span class="main">.</span> closedt <span class="main">0</span> <span class="bound">t</span> <span class="main">⟶</span> Neg <span class="main">(</span>Exists <span class="bound">P</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">⟶</span> Neg <span class="main">(</span>subst <span class="bound">P</span> <span class="bound">t</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">P</span><span class="main">.</span> Exists <span class="bound">P</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> closedt <span class="main">0</span> <span class="bound">t</span> <span class="main">∧</span> subst <span class="bound">P</span> <span class="bound">t</span> <span class="main">0</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">P</span><span class="main">.</span> Neg <span class="main">(</span>Forall <span class="bound">P</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> closedt <span class="main">0</span> <span class="bound">t</span> <span class="main">∧</span> Neg <span class="main">(</span>subst <span class="bound">P</span> <span class="bound">t</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In Herbrand models, each {\em closed} term is interpreted by itself.
We introduce a new datatype <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>hterm›</span></span></span></span> (``Herbrand terms''), which
is similar to the datatype <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>term›</span></span></span></span> introduced in \secref{sec:terms},
but without variables. We also define functions for converting between
closed terms and Herbrand terms.
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> hterm <span class="main">=</span> HApp <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> hterm list›</span></span>

<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">term_of_hterm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> hterm <span class="main">⇒</span> <span class="tfree">'a</span> term›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="entity">terms_of_hterms</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> hterm list <span class="main">⇒</span> <span class="tfree">'a</span> term list›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">term_of_hterm</span> <span class="main">(</span>HApp <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">hts</span></span></span><span class="main">)</span> <span class="main">=</span> App <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free">terms_of_hterms</span> <span class="free"><span class="bound"><span class="entity">hts</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">terms_of_hterms</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">terms_of_hterms</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ht</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">hts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">term_of_hterm</span> <span class="free"><span class="bound"><span class="entity">ht</span></span></span> <span class="main">#</span> <span class="free">terms_of_hterms</span> <span class="free"><span class="bound"><span class="entity">hts</span></span></span>›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> herbrand_evalt <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="free">t</span> <span class="main">⟹</span> term_of_hterm <span class="main">(</span>evalt <span class="free">e</span> HApp <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>›</span></span>
  <span class="quoted"><span class="quoted">‹closedts <span class="main">0</span> <span class="free">ts</span> <span class="main">⟹</span> terms_of_hterms <span class="main">(</span>evalts <span class="free">e</span> HApp <span class="free">ts</span><span class="main">)</span> <span class="main">=</span> <span class="free">ts</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> closedt.induct closedts.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">theorem</span></span> herbrand_evalt' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹evalt <span class="free">e</span> HApp <span class="main">(</span>term_of_hterm <span class="free">ht</span><span class="main">)</span> <span class="main">=</span> <span class="free">ht</span>›</span></span>
  <span class="quoted"><span class="quoted">‹evalts <span class="free">e</span> HApp <span class="main">(</span>terms_of_hterms <span class="free">hts</span><span class="main">)</span> <span class="main">=</span> <span class="free">hts</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ht</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">hts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> term_of_hterm.induct terms_of_hterms.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">theorem</span></span> closed_hterm <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="main">(</span>term_of_hterm <span class="main">(</span><span class="free">ht</span><span class="main">::</span><span class="tfree">'a</span> hterm<span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="quoted"><span class="quoted">‹closedts <span class="main">0</span> <span class="main">(</span>terms_of_hterms <span class="main">(</span><span class="free">hts</span><span class="main">::</span><span class="tfree">'a</span> hterm list<span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ht</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">hts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> term_of_hterm.induct terms_of_hterms.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We can prove that Hintikka sets are satisfiable in Herbrand models.
Note that this theorem cannot be proved by a simple structural induction
(as claimed in Fitting's book), since a parameter substitution has
to be applied in the cases for quantifiers. However, since parameter
substitution does not change the size of formulae, the theorem can
be proved by well-founded induction on the size of the formula <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hintikka_model<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hin<span class="main">:</span> <span class="quoted"><span class="quoted">‹hintikka <span class="free">H</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">p</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟶</span> closed <span class="main">0</span> <span class="free">p</span> <span class="main">⟶</span>
    eval <span class="free">e</span> HApp <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">ts</span><span class="main">.</span> Pred <span class="bound">a</span> <span class="main">(</span>terms_of_hterms <span class="bound">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span>Neg <span class="free">p</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟶</span> closed <span class="main">0</span> <span class="free">p</span> <span class="main">⟶</span>
    eval <span class="free">e</span> HApp <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">ts</span><span class="main">.</span> Pred <span class="bound">a</span> <span class="main">(</span>terms_of_hterms <span class="bound">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span><span class="main">)</span> <span class="main">(</span>Neg <span class="free">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> r<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">‹measure size_form›</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹wf <span class="main">(</span>measure size_form<span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?eval</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹eval <span class="free">e</span> HApp <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">ts</span><span class="main">.</span> Pred <span class="bound">a</span> <span class="main">(</span>terms_of_hterms <span class="bound">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span><span class="main">)</span>›</span></span>

  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> measure size_form <span class="main">⟶</span>
                  <span class="main">(</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟶</span> closed <span class="main">0</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="var">?eval</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">(</span>Neg <span class="bound">y</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟶</span> closed <span class="main">0</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="var">?eval</span> <span class="main">(</span>Neg <span class="bound">y</span><span class="main">)</span><span class="main">)</span>›</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟶</span> closed <span class="main">0</span> <span class="skolem">x</span> <span class="main">⟶</span> <span class="var">?eval</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>Neg <span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟶</span> closed <span class="main">0</span> <span class="skolem">x</span> <span class="main">⟶</span> <span class="var">?eval</span> <span class="main">(</span>Neg <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> FF
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eval</span> <span class="skolem">x</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> FF hin <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hintikka_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eval</span> <span class="main">(</span>Neg <span class="skolem">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> FF <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> TT
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eval</span> <span class="skolem">x</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> TT <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eval</span> <span class="main">(</span>Neg <span class="skolem">x</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> TT hin <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hintikka_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eval</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Pred <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Pred <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Pred <span class="skolem">p</span> <span class="skolem">ts</span> <span class="main">∉</span> <span class="free">H</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> hin <span class="keyword1"><span class="command">unfolding</span></span> hintikka_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eval</span> <span class="main">(</span>Neg <span class="skolem">x</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Pred <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Neg <span class="skolem">Z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eval</span> <span class="skolem">x</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Neg wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Z</span> <span class="main">∈</span> <span class="free">H</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Neg hin <span class="keyword1"><span class="command">unfolding</span></span> hintikka_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">Z</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eval</span> <span class="skolem">Z</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Neg wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eval</span> <span class="main">(</span>Neg <span class="skolem">x</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹And <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span>And <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> And <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">∧</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="free">H</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> And hin <span class="keyword1"><span class="command">unfolding</span></span> hintikka_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eval</span> <span class="skolem">x</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> And wf <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span>And <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>And <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span>And <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> And <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">A</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">∨</span> Neg <span class="skolem">B</span> <span class="main">∈</span> <span class="free">H</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> hin <span class="keyword1"><span class="command">unfolding</span></span> hintikka_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eval</span> <span class="main">(</span>Neg <span class="skolem">x</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> And wf <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span>And <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Or <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Or <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">∨</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="free">H</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> hin <span class="keyword1"><span class="command">unfolding</span></span> hintikka_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eval</span> <span class="skolem">x</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Or wf <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Or <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">A</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">∧</span> Neg <span class="skolem">B</span> <span class="main">∈</span> <span class="free">H</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> hin <span class="keyword1"><span class="command">unfolding</span></span> hintikka_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eval</span> <span class="main">(</span>Neg <span class="skolem">x</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Or wf <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Impl <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Impl <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">A</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">∨</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="free">H</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> hin <span class="keyword1"><span class="command">unfolding</span></span> hintikka_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eval</span> <span class="skolem">x</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Impl wf <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Impl <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">∧</span> Neg <span class="skolem">B</span> <span class="main">∈</span> <span class="free">H</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> hin <span class="keyword1"><span class="command">unfolding</span></span> hintikka_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eval</span> <span class="main">(</span>Neg <span class="skolem">x</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Impl wf <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> eval <span class="main">(</span><span class="free">e</span><span class="main">⟨</span><span class="main">0</span><span class="main">:</span><span class="bound">z</span><span class="main">⟩</span><span class="main">)</span> HApp <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">ts</span><span class="main">.</span> Pred <span class="bound">a</span> <span class="main">(</span>terms_of_hterms <span class="bound">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span><span class="main">)</span> <span class="skolem">P</span>›</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">x</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Forall <span class="skolem">P</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> Forall <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">P</span> <span class="bound">t</span><span class="main">.</span> closedt <span class="main">0</span> <span class="bound">t</span> <span class="main">⟶</span> Forall <span class="bound">P</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟶</span> <span class="bound">P</span><span class="main">[</span><span class="bound">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span> <span class="main">∈</span> <span class="free">H</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> hin <span class="keyword1"><span class="command">unfolding</span></span> hintikka_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">P</span><span class="main">[</span>term_of_hterm <span class="skolem">z</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">,</span> Forall <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> measure size_form <span class="main">⟶</span>
              <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>term_of_hterm <span class="skolem">z</span><span class="main">/</span><span class="main">0</span><span class="main">]</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟶</span> closed <span class="main">0</span> <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>term_of_hterm <span class="skolem">z</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">⟶</span>
              <span class="var">?eval</span> <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>term_of_hterm <span class="skolem">z</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> Forall wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹eval <span class="main">(</span><span class="free">e</span><span class="main">⟨</span><span class="main">0</span><span class="main">:</span><span class="skolem">z</span><span class="main">⟩</span><span class="main">)</span> HApp <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">ts</span><span class="main">.</span> Pred <span class="bound">a</span> <span class="main">(</span>terms_of_hterms <span class="bound">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span><span class="main">)</span> <span class="skolem">P</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹Forall <span class="skolem">P</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eval</span> <span class="skolem">x</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Forall <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Forall <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> closedt <span class="main">0</span> <span class="bound">t</span> <span class="main">∧</span> Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="bound">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Forall hin <span class="keyword1"><span class="command">unfolding</span></span> hintikka_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="skolem">t</span> <span class="main">∧</span> Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Forall <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">P</span> <span class="skolem">t</span> <span class="main">0</span><span class="main">,</span> Forall <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> measure size_form <span class="main">⟶</span>
              <span class="main">(</span>Neg <span class="main">(</span>subst <span class="skolem">P</span> <span class="skolem">t</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟶</span> closed <span class="main">0</span> <span class="main">(</span>subst <span class="skolem">P</span> <span class="skolem">t</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟶</span>
              <span class="var">?eval</span> <span class="main">(</span>Neg <span class="main">(</span>subst <span class="skolem">P</span> <span class="skolem">t</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Forall wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eval</span> <span class="main">(</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Forall * <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="main">¬</span> eval <span class="main">(</span><span class="free">e</span><span class="main">⟨</span><span class="main">0</span><span class="main">:</span><span class="bound">z</span><span class="main">⟩</span><span class="main">)</span> HApp <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">ts</span><span class="main">.</span> Pred <span class="bound">a</span> <span class="main">(</span>terms_of_hterms <span class="bound">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span><span class="main">)</span> <span class="skolem">P</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eval</span> <span class="main">(</span>Neg <span class="skolem">x</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Forall <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Exists <span class="skolem">P</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI allI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> closedt <span class="main">0</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="bound">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Exists hin <span class="keyword1"><span class="command">unfolding</span></span> hintikka_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Exists <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>subst <span class="skolem">P</span> <span class="skolem">t</span> <span class="main">0</span><span class="main">,</span> Exists <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> measure size_form <span class="main">⟶</span>
              <span class="main">(</span><span class="main">(</span>subst <span class="skolem">P</span> <span class="skolem">t</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟶</span> closed <span class="main">0</span> <span class="main">(</span>subst <span class="skolem">P</span> <span class="skolem">t</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟶</span>
              <span class="var">?eval</span> <span class="main">(</span>subst <span class="skolem">P</span> <span class="skolem">t</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Exists wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eval</span> <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Exists * <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> eval <span class="main">(</span><span class="free">e</span><span class="main">⟨</span><span class="main">0</span><span class="main">:</span><span class="bound">z</span><span class="main">⟩</span><span class="main">)</span> HApp <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">ts</span><span class="main">.</span> Pred <span class="bound">a</span> <span class="main">(</span>terms_of_hterms <span class="bound">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span><span class="main">)</span> <span class="skolem">P</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eval</span> <span class="skolem">x</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="main">¬</span> eval <span class="main">(</span><span class="free">e</span><span class="main">⟨</span><span class="main">0</span><span class="main">:</span><span class="bound">z</span><span class="main">⟩</span><span class="main">)</span> HApp <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">ts</span><span class="main">.</span> Pred <span class="bound">a</span> <span class="main">(</span>terms_of_hterms <span class="bound">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span><span class="main">)</span> <span class="skolem">P</span>›</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">x</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Exists <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span>Neg <span class="main">(</span>Exists <span class="skolem">P</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> Exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">P</span> <span class="bound">t</span><span class="main">.</span> closedt <span class="main">0</span> <span class="bound">t</span> <span class="main">⟶</span> Neg <span class="main">(</span>Exists <span class="bound">P</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟶</span> Neg <span class="main">(</span><span class="bound">P</span><span class="main">[</span><span class="bound">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> hin <span class="keyword1"><span class="command">unfolding</span></span> hintikka_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span>Neg <span class="main">(</span>Exists <span class="skolem">P</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">P</span><span class="main">[</span>term_of_hterm <span class="skolem">z</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">,</span> Exists <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> measure size_form <span class="main">⟶</span>
              <span class="main">(</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>term_of_hterm <span class="skolem">z</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟶</span> closed <span class="main">0</span> <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>term_of_hterm <span class="skolem">z</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">⟶</span>
              <span class="var">?eval</span> <span class="main">(</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>term_of_hterm <span class="skolem">z</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> Exists wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> eval <span class="main">(</span><span class="free">e</span><span class="main">⟨</span><span class="main">0</span><span class="main">:</span><span class="skolem">z</span><span class="main">⟩</span><span class="main">)</span> HApp <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">ts</span><span class="main">.</span> Pred <span class="bound">a</span> <span class="main">(</span>terms_of_hterms <span class="bound">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span><span class="main">)</span> <span class="skolem">P</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Exists <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?eval</span> <span class="main">(</span>Neg <span class="skolem">x</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Using the maximality of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹Extend <span class="free"><span class="free">S</span></span> <span class="free"><span class="free">C</span></span> <span class="free"><span class="free">f</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, we can show
that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹Extend <span class="free"><span class="free">S</span></span> <span class="free"><span class="free">C</span></span> <span class="free"><span class="free">f</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> yields Hintikka sets:
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Exists_in_extend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="free">n</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Exists <span class="free">P</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P</span><span class="main">[</span><span class="main">(</span>App <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span><span class="main">/</span><span class="main">0</span><span class="main">]</span> <span class="main">∈</span>
          extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>›</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹subst <span class="free">P</span> <span class="var">?t</span> <span class="main">0</span> <span class="main">∈</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span> <span class="main">=</span> Exists <span class="bound">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Exists <span class="free">P</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span>dest_Exists <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="var">?t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span>dest_Exists <span class="main">(</span>Exists <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="var">?t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Exists <span class="free">P</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span><span class="free">P</span><span class="main">[</span><span class="var">?t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Neg_Forall_in_extend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="free">n</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Forall <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span><span class="free">P</span><span class="main">[</span><span class="main">(</span>App <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span>  <span class="main">∈</span>
          extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>›</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>subst <span class="free">P</span> <span class="var">?t</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">n</span> <span class="main">≠</span> Exists <span class="free">P</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Forall <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span> <span class="main">=</span> Neg <span class="main">(</span>Forall <span class="bound">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Forall <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>dest_Forall <span class="main">(</span>dest_Neg <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="var">?t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S'</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">n</span> <span class="main">≠</span> Exists <span class="free">P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>dest_Forall <span class="main">(</span>dest_Neg <span class="main">(</span>Neg <span class="main">(</span>Forall <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="var">?t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Forall <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="var">?S'</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="free">P</span><span class="main">[</span><span class="var">?t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> extend_hintikka<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin_ch<span class="main">:</span> <span class="quoted"><span class="quoted">‹finite_char <span class="free">C</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> infin_p<span class="main">:</span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> surj<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">n</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> altc<span class="main">:</span> <span class="quoted"><span class="quoted">‹alt_consistency <span class="free">C</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹hintikka <span class="main">(</span>Extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span><span class="main">)</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹hintikka <span class="var">?H</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> hintikka_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="var">?H</span> <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> extend_maximal fin_ch surj<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Extend_in_C assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">S'</span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> <span class="var">?H</span> <span class="main">⊆</span> <span class="bound">S'</span> <span class="main">⟶</span> <span class="var">?H</span> <span class="main">=</span> <span class="bound">S'</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="var">?H</span> <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> maximal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">ts</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span> <span class="main">∈</span> <span class="var">?H</span> <span class="main">∧</span> Neg <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?H</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> altc <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹FF <span class="main">∉</span> <span class="var">?H</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> altc <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹Neg TT <span class="main">∉</span> <span class="var">?H</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> altc <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Z</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Neg <span class="skolem">Z</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">Z</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> altc <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Z</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="var">?H</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹And <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> altc <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="var">?H</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> altc <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">A</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">B</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="var">?H</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> altc <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">B</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="var">?H</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Or <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∨</span> <span class="var">?H</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> altc <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">∈</span> <span class="var">?H</span> <span class="main">∨</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="var">?H</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>And <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∨</span> <span class="var">?H</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> altc <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">A</span> <span class="main">∈</span> <span class="var">?H</span> <span class="main">∨</span> Neg <span class="skolem">B</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="var">?H</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Impl <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∨</span> <span class="var">?H</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> altc <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">A</span> <span class="main">∈</span> <span class="var">?H</span> <span class="main">∨</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="var">?H</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹nat term›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Forall <span class="skolem">P</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="skolem">t</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> altc <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="var">?H</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹nat term›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Exists <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="skolem">t</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> altc <span class="keyword1"><span class="command">unfolding</span></span> alt_consistency_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹maximal <span class="var">?H</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> maximal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Exists <span class="skolem">P</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹Exists <span class="skolem">P</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">n</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> surj <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹App <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="skolem">n</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">[]</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="var">?t</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Exists <span class="skolem">P</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Exists <span class="skolem">P</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span> Extend_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="skolem">n</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UN_upper<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="skolem">n</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Extend_def <span class="quoted"><span class="quoted">‹Extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> fin_ch finite_char_closed
      <span class="keyword1"><span class="command">unfolding</span></span> subset_closed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">[</span><span class="var">?t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span> <span class="main">∈</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * Exists_in_extend <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">[</span><span class="var">?t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Extend_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> closedt <span class="main">0</span> <span class="bound">t</span> <span class="main">∧</span> <span class="skolem">P</span><span class="main">[</span><span class="bound">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="var">?t</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">n</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> surj <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹App <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="skolem">n</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">[]</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="var">?t</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span> Extend_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="skolem">n</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UN_upper<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="skolem">n</span> <span class="main">∪</span> <span class="main">{</span><span class="free">f</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Extend_def <span class="quoted"><span class="quoted">‹Extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> fin_ch finite_char_closed
      <span class="keyword1"><span class="command">unfolding</span></span> subset_closed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="var">?t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> extend <span class="free">S</span> <span class="free">C</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * Neg_Forall_in_extend <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="var">?t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Extend_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> closedt <span class="main">0</span> <span class="bound">t</span> <span class="main">∧</span> Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="bound">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?H</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="var">?t</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Model existence theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\label{sec:model-existence}
Since the result of extending <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>S›</span></span></span></span> is a superset of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>S›</span></span></span></span>,
it follows that each consistent set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>S›</span></span></span></span> has a Herbrand model:
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hintikka_Extend_S<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹consistency <span class="free">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹hintikka <span class="main">(</span>Extend <span class="free">S</span> <span class="main">(</span>mk_finite_char <span class="main">(</span>mk_alt_consistency <span class="main">(</span>close <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> from_nat<span class="main">)</span>›</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹hintikka <span class="main">(</span>Extend <span class="free">S</span> <span class="var">?C'</span> from_nat<span class="main">)</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite_char <span class="var">?C'</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_char <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> from_nat <span class="main">(</span>to_nat <span class="bound">y</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> from_nat <span class="bound">n</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹alt_consistency <span class="var">?C'</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> alt_consistency close_closed close_consistency <span class="quoted"><span class="quoted">‹consistency <span class="free">C</span>›</span></span>
      finite_alt_consistency mk_alt_consistency_closed
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">∈</span> close <span class="free">C</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> close_subset <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">∈</span> mk_alt_consistency <span class="main">(</span>close <span class="free">C</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> mk_alt_consistency_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">∈</span> <span class="var">?C'</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> close_closed finite_char_subset mk_alt_consistency_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> extend_hintikka <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> model_existence<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹consistency <span class="free">C</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">∈</span> <span class="free">C</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> <span class="free">S</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹eval <span class="free">e</span> HApp <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">ts</span><span class="main">.</span> Pred <span class="bound">a</span> <span class="main">(</span>terms_of_hterms <span class="bound">ts</span><span class="main">)</span> <span class="main">∈</span> Extend <span class="free">S</span>
        <span class="main">(</span>mk_finite_char <span class="main">(</span>mk_alt_consistency <span class="main">(</span>close <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> from_nat<span class="main">)</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms hintikka_model hintikka_Extend_S Extend_subset
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Completeness for Natural Deduction›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Thanks to the model existence theorem, we can now show the completeness
of the natural deduction calculus introduced in \secref{sec:proof-calculus}.
In order for the model existence theorem to be applicable, we have to prove
that the set of sets that are consistent with respect to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⊢›</span></span></span></span> is a
consistency property:
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> deriv_consistency<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inf_param<span class="main">:</span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹consistency <span class="main">{</span><span class="bound">S</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form set<span class="main">.</span> <span class="main">∃</span><span class="bound">G</span><span class="main">.</span> <span class="bound">S</span> <span class="main">=</span> set <span class="bound">G</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">G</span> <span class="main">⊢</span> FF<span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> consistency_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI allI impI notI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form set›</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∈</span> <span class="main">{</span>set <span class="bound">G</span> <span class="main">|</span> <span class="bound">G</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">G</span> <span class="main">⊢</span> FF<span class="main">}</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form list›</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">=</span> set <span class="skolem">G</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">ts</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Pred <span class="skolem">p</span> <span class="skolem">ts</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∧</span> Neg <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Pred <span class="skolem">p</span> <span class="skolem">ts</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Assum * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">using</span></span> NegE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹FF <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Assum * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg TT <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Neg TT›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Assum * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> TT›</span></span>
      <span class="keyword1"><span class="command">using</span></span> TTI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">using</span></span> NegE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Z</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Neg <span class="skolem">Z</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="main">(</span>Neg <span class="skolem">Z</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Assum * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Z</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="skolem">Z</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> NegI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
        <span class="keyword1"><span class="command">using</span></span> NegE <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="main">(</span>Neg <span class="skolem">Z</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">Z</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">Z</span><span class="main">}</span> <span class="main">=</span> set <span class="main">(</span><span class="skolem">Z</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">Z</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹And <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> And <span class="skolem">A</span> <span class="skolem">B</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Assum * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> <span class="skolem">A</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> <span class="skolem">B</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> AndE1 AndE2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="skolem">A</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> NegI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="skolem">A</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> cut <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> <span class="skolem">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
        <span class="keyword1"><span class="command">using</span></span> NegE <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">}</span> <span class="main">=</span> set <span class="main">(</span><span class="skolem">A</span> <span class="main">#</span> <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Assum * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> <span class="skolem">A</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Or <span class="skolem">A</span> <span class="skolem">B</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> OrI1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">using</span></span> NegE <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="skolem">A</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> NegI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> <span class="skolem">B</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Or <span class="skolem">A</span> <span class="skolem">B</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> OrI2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">using</span></span> NegE <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="skolem">B</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> NegI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="main">(</span>Neg <span class="skolem">A</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> NegI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
        <span class="keyword1"><span class="command">using</span></span> NegE <span class="quoted"><span class="quoted">‹Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
        <span class="keyword1"><span class="command">using</span></span> cut <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="skolem">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Neg <span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">=</span> set <span class="main">(</span>Neg <span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> <span class="skolem">A</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="skolem">A</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">using</span></span> NegE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> <span class="skolem">B</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> FFE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Impl <span class="skolem">A</span> <span class="skolem">B</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ImplI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">using</span></span> NegE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> <span class="skolem">A</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Class <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> <span class="skolem">B</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Impl <span class="skolem">A</span> <span class="skolem">B</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ImplI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">using</span></span> NegE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="skolem">B</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> NegI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="skolem">A</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> NegI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
        <span class="keyword1"><span class="command">using</span></span> NegE <span class="quoted"><span class="quoted">‹Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
        <span class="keyword1"><span class="command">using</span></span> cut <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="skolem">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">S</span> <span class="main">=</span> set <span class="main">(</span><span class="skolem">A</span> <span class="main">#</span> Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Or <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Or <span class="skolem">A</span> <span class="skolem">B</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * Assum <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">G'</span><span class="main">.</span> set <span class="bound">G'</span> <span class="main">=</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="main">⟶</span> <span class="bound">G'</span> <span class="main">⊢</span> FF<span class="main">)</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">G'</span><span class="main">.</span> set <span class="bound">G'</span> <span class="main">=</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">⟶</span> <span class="bound">G'</span> <span class="main">⊢</span> FF<span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
        <span class="keyword1"><span class="command">using</span></span> OrE <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Or <span class="skolem">A</span> <span class="skolem">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">∨</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>And <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Or <span class="main">(</span>Neg <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span>Neg <span class="skolem">B</span><span class="main">)</span>›</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">#</span> <span class="skolem">A</span> <span class="main">#</span> Neg <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> <span class="skolem">A</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">#</span> <span class="skolem">A</span> <span class="main">#</span> Neg <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> <span class="skolem">B</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">#</span> <span class="skolem">A</span> <span class="main">#</span> Neg <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> And <span class="skolem">A</span> <span class="skolem">B</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> AndI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">#</span> <span class="skolem">A</span> <span class="main">#</span> Neg <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="main">(</span>And <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>And <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">#</span> <span class="skolem">A</span> <span class="main">#</span> Neg <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">using</span></span> NegE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> Neg <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="skolem">B</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> NegI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> Neg <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> <span class="var">?x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> OrI2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> Neg <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="var">?x</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> Neg <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">using</span></span> NegE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="skolem">A</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> NegI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> <span class="var">?x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> OrI1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Or <span class="main">(</span>Neg <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span>Neg <span class="skolem">B</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Class' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">G'</span><span class="main">.</span> set <span class="bound">G'</span> <span class="main">=</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span> <span class="main">⟶</span> <span class="bound">G'</span> <span class="main">⊢</span> FF<span class="main">)</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">G'</span><span class="main">.</span> set <span class="bound">G'</span> <span class="main">=</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">⟶</span> <span class="bound">G'</span> <span class="main">⊢</span> FF<span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
        <span class="keyword1"><span class="command">using</span></span> OrE <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Or <span class="main">(</span>Neg <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span>Neg <span class="skolem">B</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">∨</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Impl <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Or <span class="main">(</span>Neg <span class="skolem">A</span><span class="main">)</span> <span class="skolem">B</span>›</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> Neg <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> <span class="skolem">A</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> Neg <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Impl <span class="skolem">A</span> <span class="skolem">B</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹Impl <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> Neg <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> <span class="skolem">B</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ImplE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> Neg <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> <span class="var">?x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> OrI2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> Neg <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="var">?x</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">#</span> Neg <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">using</span></span> NegE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="skolem">A</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> NegI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> <span class="var">?x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> OrI1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Or <span class="main">(</span>Neg <span class="skolem">A</span><span class="main">)</span> <span class="skolem">B</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Class' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">G'</span><span class="main">.</span> set <span class="bound">G'</span> <span class="main">=</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span> <span class="main">⟶</span> <span class="bound">G'</span> <span class="main">⊢</span> FF<span class="main">)</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">G'</span><span class="main">.</span> set <span class="bound">G'</span> <span class="main">=</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">⟶</span> <span class="bound">G'</span> <span class="main">⊢</span> FF<span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="skolem">A</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
        <span class="keyword1"><span class="command">using</span></span> OrE <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Or <span class="main">(</span>Neg <span class="skolem">A</span><span class="main">)</span> <span class="skolem">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">∨</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="skolem">t</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Forall <span class="skolem">P</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Forall <span class="skolem">P</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Assum * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> <span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ForallE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
        <span class="keyword1"><span class="command">using</span></span> cut <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> <span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">=</span> set <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹closedt <span class="main">0</span> <span class="skolem">t</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Exists <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="main">(</span>Exists <span class="skolem">P</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Assum * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> <span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Assum <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Exists <span class="skolem">P</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ExistsI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="main">(</span>Exists <span class="skolem">P</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Exists <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">using</span></span> NegE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> NegI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
        <span class="keyword1"><span class="command">using</span></span> cut <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> set <span class="main">(</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Exists <span class="skolem">P</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Exists <span class="skolem">P</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * Assum <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> params <span class="skolem">P</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> params <span class="skolem">P</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_param Diff_infinite_finite finite_compl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> params <span class="skolem">P</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Compl_eq_Diff_UNIV<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> params <span class="skolem">P</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> infinite_imp_nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∉</span> params <span class="bound">p</span><span class="main">)</span> <span class="skolem">G</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> params <span class="skolem">P</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> params FF›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
        <span class="keyword1"><span class="command">using</span></span> ExistsE <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Exists <span class="skolem">P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">=</span> set <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span>App <span class="bound">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * Assum <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> params <span class="skolem">P</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> params <span class="skolem">P</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_param Diff_infinite_finite finite_compl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> params <span class="skolem">P</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Compl_eq_Diff_UNIV<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">G</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> params <span class="skolem">P</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> infinite_imp_nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Exists <span class="main">(</span>Neg <span class="skolem">P</span><span class="main">)</span><span class="main">)</span>›</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">#</span> <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">#</span> <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Exists <span class="main">(</span>Neg <span class="skolem">P</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ExistsI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">#</span> <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> <span class="var">?x</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">#</span> <span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">using</span></span> NegE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> <span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Class <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∉</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">(</span><span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> params <span class="skolem">P</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Forall <span class="skolem">P</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ForallI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> Neg <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?x</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">using</span></span> NegE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Exists <span class="main">(</span>Neg <span class="skolem">P</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Class <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∉</span> params <span class="bound">p</span><span class="main">)</span> <span class="skolem">G</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> params <span class="skolem">P</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> params FF›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
        <span class="keyword1"><span class="command">using</span></span> ExistsE <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊢</span> Exists <span class="main">(</span>Neg <span class="skolem">P</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span> <span class="main">⊢</span> FF›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> set <span class="main">(</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>App <span class="bound">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Hence, by contradiction, we have completeness of natural deduction:
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> natded_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="free">p</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span>closed <span class="main">0</span><span class="main">)</span> <span class="free">ps</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mod<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">e</span><span class="main">,</span><span class="main">(</span><span class="bound">f</span> <span class="main">::</span> nat <span class="main">⇒</span> nat hterm list <span class="main">⇒</span> nat hterm<span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="bound">g</span> <span class="main">::</span> nat <span class="main">⇒</span> nat hterm list <span class="main">⇒</span> bool<span class="main">)</span><span class="main">,</span><span class="free">ps</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ps</span> <span class="main">⊢</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Class<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Neg <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span> <span class="main">⊢</span> FF›</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span>Neg <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">{</span>set <span class="main">(</span><span class="bound">G</span> <span class="main">::</span> <span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> form list<span class="main">)</span> <span class="main">|</span> <span class="bound">G</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">G</span> <span class="main">⊢</span> FF<span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted">HApp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">ts</span><span class="main">.</span> Pred <span class="bound">a</span> <span class="main">(</span>terms_of_hterms <span class="bound">ts</span><span class="main">)</span> <span class="main">∈</span> Extend <span class="var">?S</span>
              <span class="main">(</span>mk_finite_char <span class="main">(</span>mk_alt_consistency <span class="main">(</span>close <span class="var">?C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> from_nat<span class="main">)</span>›</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span>closed <span class="main">0</span><span class="main">)</span> <span class="free">ps</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> set <span class="free">ps</span><span class="main">.</span> closed <span class="main">0</span> <span class="bound">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?S</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistency <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> deriv_consistency <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Neg <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span> <span class="main">⊢</span> FF›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="var">?S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Compl_eq_Diff_UNIV<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="free">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> set <span class="free">ps</span><span class="main">.</span> closed <span class="main">0</span> <span class="bound">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹eval <span class="skolem">e</span> <span class="var">?f</span> <span class="var">?g</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> model_existence <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span>eval <span class="skolem">e</span> <span class="var">?f</span> <span class="var">?g</span><span class="main">)</span> <span class="main">(</span>Neg <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹eval <span class="skolem">e</span> <span class="var">?f</span> <span class="var">?g</span> <span class="main">(</span>Neg <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span>eval <span class="skolem">e</span> <span class="var">?f</span> <span class="var">?g</span><span class="main">)</span> <span class="free">ps</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹eval <span class="skolem">e</span> <span class="var">?f</span> <span class="var">?g</span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> mod <span class="keyword1"><span class="command">unfolding</span></span> model_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹L\"owenheim-Skolem theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Another application of the model existence theorem presented in \secref{sec:model-existence}
is the L\"owenheim-Skolem theorem. It says that a set of formulae that is satisfiable in an
{\em arbitrary model} is also satisfiable in a {\em Herbrand model}. The main idea behind the
proof is to show that satisfiable sets are consistent, hence they must be satisfiable in a
Herbrand model.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> sat_consistency<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹consistency <span class="main">{</span><span class="bound">S</span><span class="main">.</span> infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="main">(</span><span class="bound">p</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span>form<span class="main">)</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">.</span> eval <span class="free">e</span> <span class="bound">f</span> <span class="free">g</span> <span class="bound">p</span><span class="main">)</span><span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> consistency_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">S</span><span class="main">.</span> infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">.</span> eval <span class="free">e</span> <span class="bound">f</span> <span class="free">g</span> <span class="bound">p</span><span class="main">)</span><span class="main">}</span>›</span></span>

  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form set›</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> inf_params<span class="main">:</span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> eval <span class="free">e</span> <span class="bound">f</span> <span class="free">g</span> <span class="bound">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">ts</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∧</span> Neg <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Pred <span class="skolem">p</span> <span class="skolem">ts</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∧</span> Neg <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">∧</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="main">(</span>Neg <span class="main">(</span>Pred <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹FF <span class="main">∉</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹Neg TT <span class="main">∉</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Z</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Neg <span class="skolem">Z</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>Neg <span class="skolem">Z</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">Z</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">Z</span><span class="main">}</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">Z</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹And <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>And <span class="skolem">A</span> <span class="skolem">B</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">}</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span> Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Or <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Or <span class="skolem">A</span> <span class="skolem">B</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∨</span>
               <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">}</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">∨</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>And <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>And <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∨</span>
               <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">B</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">B</span><span class="main">}</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">∨</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Impl <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Impl <span class="skolem">A</span> <span class="skolem">B</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∨</span>
               <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="skolem">A</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">∨</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Forall <span class="skolem">P</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Forall <span class="skolem">P</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Exists <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>Exists <span class="skolem">P</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span><span class="skolem">t</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Exists <span class="skolem">P</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Exists <span class="skolem">P</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="main">(</span>Exists <span class="skolem">P</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹eval <span class="main">(</span><span class="free">e</span><span class="main">⟨</span><span class="main">0</span><span class="main">:</span><span class="skolem">z</span><span class="main">⟩</span><span class="main">)</span> <span class="skolem">f</span> <span class="free">g</span> <span class="skolem">P</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_params infinite_imp_nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> params <span class="skolem">P</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Exists <span class="skolem">P</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹eval <span class="main">(</span><span class="free">e</span><span class="main">⟨</span><span class="main">0</span><span class="main">:</span><span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">[]</span><span class="main">⟩</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="skolem">P</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> eval <span class="free">e</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="bound">p</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span>  <span class="main">∈</span>
                      <span class="main">{</span><span class="bound">S</span><span class="main">.</span> infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">.</span> eval <span class="free">e</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="bound">p</span><span class="main">)</span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span>App <span class="bound">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="bound">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹eval <span class="free">e</span> <span class="skolem">f</span> <span class="free">g</span> <span class="main">(</span>Neg <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> eval <span class="main">(</span><span class="free">e</span><span class="main">⟨</span><span class="main">0</span><span class="main">:</span><span class="skolem">z</span><span class="main">⟩</span><span class="main">)</span> <span class="skolem">f</span> <span class="free">g</span> <span class="skolem">P</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_params infinite_imp_nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> params <span class="skolem">P</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Neg <span class="main">(</span>Forall <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> eval <span class="main">(</span><span class="free">e</span><span class="main">⟨</span><span class="main">0</span><span class="main">:</span><span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">[]</span><span class="main">⟩</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="skolem">P</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">.</span> eval <span class="free">e</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="bound">p</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">}</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>App <span class="skolem">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span>  <span class="main">∈</span>
                      <span class="main">{</span><span class="bound">S</span><span class="main">.</span> infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">.</span> eval <span class="free">e</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="bound">p</span><span class="main">)</span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="main">(</span><span class="skolem">P</span><span class="main">[</span>App <span class="bound">x</span> <span class="main">[]</span><span class="main">/</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> doublep_infinite_params<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> psubst <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> infinite_super<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> inj_onI Suc_1 Suc_mult_cancel1 add_right_imp_eq finite_imageD infinite_UNIV_char_0
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span> Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≠</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹range <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>
    <span class="main">⊆</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span><span class="main">::</span><span class="main">(</span>nat<span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> form <span class="main">∈</span> psubst <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
When applying the model existence theorem, there is a technical
complication. We must make sure that there are infinitely many
unused parameters. In order to achieve this, we encode parameters
as natural numbers and multiply each parameter occurring in the
set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>S›</span></span></span></span> by <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>2›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> loewenheim_skolem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> evalS<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="bound">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> closed <span class="main">0</span> <span class="bound">p</span> <span class="main">⟶</span> eval <span class="free">e'</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> HApp <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">ts</span><span class="main">.</span>
      Pred <span class="bound">a</span> <span class="main">(</span>terms_of_hterms <span class="bound">ts</span><span class="main">)</span> <span class="main">∈</span> Extend <span class="main">(</span>psubst <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>
        <span class="main">(</span>mk_finite_char <span class="main">(</span>mk_alt_consistency <span class="main">(</span>close
          <span class="main">{</span><span class="bound">S</span><span class="main">.</span> infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">.</span> eval <span class="free">e</span> <span class="bound">f</span> <span class="free">g</span> <span class="bound">p</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> from_nat<span class="main">)</span> <span class="bound">p</span>›</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main"><span class="bound">_</span></span> <span class="main">∈</span> <span class="main">_</span><span class="main">.</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">⟶</span> eval <span class="main">_</span> <span class="main">_</span> <span class="var">?g</span> <span class="main">_</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> evalS
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">S</span><span class="main">.</span> infinite <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">.</span> eval <span class="free">e</span> <span class="bound">f</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>›</span></span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="free">S</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">p</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="skolem">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> evalS <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="bound">x</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> evalS <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> psubst <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">.</span> eval <span class="free">e</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="bound">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> psubst_eval<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> doublep_infinite_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">∈</span> psubst <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span>psubst <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹consistency <span class="var">?C</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> sat_consistency <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹eval <span class="free">e'</span> HApp <span class="var">?g</span> <span class="main">(</span>psubst <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> model_existence <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹eval <span class="free">e'</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> HApp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="var">?g</span> <span class="skolem">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> psubst_eval <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Completeness for open formulas›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">new_term</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∉</span> paramst <span class="free"><span class="bound"><span class="entity">t</span></span></span>›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">new_list</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∉</span> paramsts <span class="free"><span class="bound"><span class="entity">ts</span></span></span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">new</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∉</span> params <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">news</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">≡</span> list_all <span class="main">(</span>new <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span>›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Renaming›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> new_psubst_image'<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹new_term <span class="free">c</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">d</span> <span class="main">∉</span> image <span class="free">f</span> <span class="main">(</span>paramst <span class="free">t</span><span class="main">)</span> <span class="main">⟹</span> new_term <span class="free">d</span> <span class="main">(</span>psubstt <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">c</span> <span class="main">:=</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span>›</span></span>
  <span class="quoted"><span class="quoted">‹new_list <span class="free">c</span> <span class="free">l</span> <span class="main">⟹</span> <span class="free">d</span> <span class="main">∉</span> image <span class="free">f</span> <span class="main">(</span>paramsts <span class="free">l</span><span class="main">)</span> <span class="main">⟹</span> new_list <span class="free">d</span> <span class="main">(</span>psubstts <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">c</span> <span class="main">:=</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> paramst.induct paramsts.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> new_psubst_image<span class="main">:</span> <span class="quoted"><span class="quoted">‹new <span class="free">c</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">d</span> <span class="main">∉</span> image <span class="free">f</span> <span class="main">(</span>params <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> new <span class="free">d</span> <span class="main">(</span>psubst <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">c</span> <span class="main">:=</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> new_psubst_image' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> news_psubst<span class="main">:</span> <span class="quoted"><span class="quoted">‹news <span class="free">c</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">d</span> <span class="main">∉</span> image <span class="free">f</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="free">z</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">⟹</span>
    news <span class="free">d</span> <span class="main">(</span>map <span class="main">(</span>psubst <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">c</span> <span class="main">:=</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> new_psubst_image <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">z</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> member_psubst<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> set <span class="free">z</span> <span class="main">⟹</span> psubst <span class="free">f</span> <span class="free">p</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span>psubst <span class="free">f</span><span class="main">)</span> <span class="free">z</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">z</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> deriv_psubst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inf_params<span class="main">:</span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">⊢</span> <span class="free">p</span> <span class="main">⟹</span> map <span class="main">(</span>psubst <span class="free">f</span><span class="main">)</span> <span class="free">z</span> <span class="main">⊢</span> psubst <span class="free">f</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">z</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> deriv.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assum <span class="skolem">a</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.Assum member_psubst <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TTI <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.TTI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>FFE <span class="skolem">G</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.FFE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NegI <span class="skolem">a</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.NegI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NegE <span class="skolem">G</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.NegE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Class <span class="skolem">a</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.Class <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImplE <span class="skolem">G</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="skolem">f</span><span class="main">)</span> <span class="skolem">G</span> <span class="main">⊢</span> Impl <span class="main">(</span>psubst <span class="skolem">f</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>psubst <span class="skolem">f</span> <span class="skolem">b</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="skolem">f</span><span class="main">)</span> <span class="skolem">G</span> <span class="main">⊢</span> psubst <span class="skolem">f</span> <span class="skolem">a</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.ImplE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImplI <span class="skolem">G</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.ImplI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrE <span class="skolem">G</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="skolem">f</span><span class="main">)</span> <span class="skolem">G</span> <span class="main">⊢</span> Or <span class="main">(</span>psubst <span class="skolem">f</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>psubst <span class="skolem">f</span> <span class="skolem">b</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="skolem">f</span> <span class="skolem">a</span> <span class="main">#</span> map <span class="main">(</span>psubst <span class="skolem">f</span><span class="main">)</span> <span class="skolem">G</span> <span class="main">⊢</span> psubst <span class="skolem">f</span> <span class="skolem">c</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="skolem">f</span> <span class="skolem">b</span> <span class="main">#</span> map <span class="main">(</span>psubst <span class="skolem">f</span><span class="main">)</span> <span class="skolem">G</span> <span class="main">⊢</span> psubst <span class="skolem">f</span> <span class="skolem">c</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.OrE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrI1 <span class="skolem">G</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.OrI1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrI2 <span class="skolem">G</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.OrI2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndE1 <span class="skolem">G</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.AndE1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndE2 <span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.AndE2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndI <span class="skolem">G</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.AndI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ExistsE <span class="skolem">z</span> <span class="skolem">p</span> <span class="skolem">c</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹params <span class="skolem">p</span> <span class="main">∪</span> params <span class="skolem">q</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">z</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?params</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fresh</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">fresh</span> <span class="main">∉</span> <span class="var">?params</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">c</span><span class="main">}</span> <span class="main">∪</span> image <span class="skolem">f</span> <span class="var">?params</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_new_if_finite inf_params
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite.emptyI finite.insertI finite_UnI finite_imageI<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span><span class="main">(</span><span class="skolem">c</span> <span class="main">:=</span> <span class="skolem">fresh</span><span class="main">)</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">c</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">#</span> <span class="skolem">q</span> <span class="main">#</span> <span class="skolem">z</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ExistsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">fresh</span> <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">fresh</span> <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">q</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="main">(</span>map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">z</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> * new_psubst_image news_psubst <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_Un<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> map <span class="main">(</span>psubst <span class="skolem">f</span><span class="main">)</span> <span class="skolem">z</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ExistsE <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Ball_set map_eq_conv psubst_upd<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">⊢</span> psubst <span class="var">?f</span> <span class="main">(</span>Exists <span class="skolem">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ExistsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">⊢</span> Exists <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>App <span class="skolem">c</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span> <span class="main">#</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">⊢</span> psubst <span class="var">?f</span> <span class="skolem">q</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ExistsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹subst <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span> <span class="main">#</span> map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">⊢</span> psubst <span class="var">?f</span> <span class="skolem">q</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="main">(</span>map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">#</span> <span class="skolem">q</span> <span class="main">#</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">fresh</span> <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">fresh</span> <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">q</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="main">(</span>map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">z</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">fresh</span> <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">fresh</span> <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">q</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="main">(</span>map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">z</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">⊢</span> psubst <span class="var">?f</span> <span class="skolem">q</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.ExistsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ExistsE <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> map <span class="main">(</span>psubst <span class="skolem">f</span><span class="main">)</span> <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ExistsI <span class="skolem">z</span> <span class="skolem">p</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.ExistsI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ForallE <span class="skolem">z</span> <span class="skolem">p</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.ForallE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ForallI <span class="skolem">z</span> <span class="skolem">p</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹params <span class="skolem">p</span> <span class="main">∪</span><span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">z</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?params</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fresh</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">fresh</span> <span class="main">∉</span> <span class="var">?params</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">c</span><span class="main">}</span> <span class="main">∪</span> image <span class="skolem">f</span> <span class="var">?params</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_new_if_finite inf_params
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite.emptyI finite.insertI finite_UnI finite_imageI<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span><span class="main">(</span><span class="skolem">c</span> <span class="main">:=</span> <span class="skolem">fresh</span><span class="main">)</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">c</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">#</span> <span class="skolem">z</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ForallI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">fresh</span> <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="main">(</span>map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">z</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> * new_psubst_image news_psubst <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_Un<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> map <span class="main">(</span>psubst <span class="skolem">f</span><span class="main">)</span> <span class="skolem">z</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ForallI <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Ball_set map_eq_conv psubst_upd<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">⊢</span> psubst <span class="var">?f</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>App <span class="skolem">c</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ForallI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">⊢</span> subst <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="main">(</span>map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">#</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">fresh</span> <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="main">(</span>map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">z</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">fresh</span> <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="main">(</span>map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">z</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">⊢</span> Forall <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.ForallI <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ForallI <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> map <span class="main">(</span>psubst <span class="skolem">f</span><span class="main">)</span> <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Substitution for constants›</span></span>

<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">subc_term</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> term <span class="main">⇒</span> <span class="tfree">'a</span> term <span class="main">⇒</span> <span class="tfree">'a</span> term›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="entity">subc_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> term <span class="main">⇒</span> <span class="tfree">'a</span> term list <span class="main">⇒</span> <span class="tfree">'a</span> term list›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">subc_term</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> Var <span class="free"><span class="bound"><span class="entity">n</span></span></span>›</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">‹<span class="free">subc_term</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>App <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">else</span> App <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free">subc_list</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">‹<span class="free">subc_list</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>›</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">‹<span class="free">subc_list</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">subc_term</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free">subc_list</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span>›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">subc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> term <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">subc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> FF <span class="main">=</span> FF›</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">‹<span class="free">subc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> TT <span class="main">=</span> TT›</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">‹<span class="free">subc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Pred <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">=</span> Pred <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>subc_list <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>›</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">‹<span class="free">subc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> Neg <span class="main">(</span><span class="free">subc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">‹<span class="free">subc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Impl <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> Impl <span class="main">(</span><span class="free">subc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">subc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">‹<span class="free">subc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> Or <span class="main">(</span><span class="free">subc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">subc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">‹<span class="free">subc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> And <span class="main">(</span><span class="free">subc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">subc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">‹<span class="free">subc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> Exists <span class="main">(</span><span class="free">subc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>liftt <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">‹<span class="free">subc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Forall <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> Forall <span class="main">(</span><span class="free">subc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>liftt <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">subcs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> term <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form list›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">subcs</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>›</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">‹<span class="free">subcs</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">=</span> subc <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">#</span> <span class="free">subcs</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subst_0_lift<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹substt <span class="main">(</span>liftt <span class="free">t</span><span class="main">)</span> <span class="free">s</span> <span class="main">0</span> <span class="main">=</span> <span class="free">t</span>›</span></span>
  <span class="quoted"><span class="quoted">‹substts <span class="main">(</span>liftts <span class="free">l</span><span class="main">)</span> <span class="free">s</span> <span class="main">0</span> <span class="main">=</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> substt.induct substts.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> params_lift <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term list›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">‹paramst <span class="main">(</span>liftt <span class="free">t</span><span class="main">)</span> <span class="main">=</span> paramst <span class="free">t</span>›</span></span>
    <span class="quoted"><span class="quoted">‹paramsts <span class="main">(</span>liftts <span class="free">ts</span><span class="main">)</span> <span class="main">=</span> paramsts <span class="free">ts</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> paramst.induct paramsts.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_new' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹new_term <span class="free">c</span> <span class="free">s</span> <span class="main">⟹</span> new_term <span class="free">c</span> <span class="free">t</span> <span class="main">⟹</span> new_term <span class="free">c</span> <span class="main">(</span>substt <span class="free">t</span> <span class="free">s</span> <span class="free">m</span><span class="main">)</span>›</span></span>
  <span class="quoted"><span class="quoted">‹new_term <span class="free">c</span> <span class="free">s</span> <span class="main">⟹</span> new_list <span class="free">c</span> <span class="free">l</span> <span class="main">⟹</span> new_list <span class="free">c</span> <span class="main">(</span>substts <span class="free">l</span> <span class="free">s</span> <span class="free">m</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> substt.induct substts.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_new <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹new_term <span class="free">c</span> <span class="free">s</span> <span class="main">⟹</span> new <span class="free">c</span> <span class="free">p</span> <span class="main">⟹</span> new <span class="free">c</span> <span class="main">(</span>subst <span class="free">p</span> <span class="free">s</span> <span class="free">m</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_new_all<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∉</span> set <span class="free">cs</span>›</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> new <span class="bound">c</span> <span class="free">p</span><span class="main">)</span> <span class="free">cs</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> new <span class="bound">c</span> <span class="main">(</span>subst <span class="free">p</span> <span class="main">(</span>App <span class="free">a</span> <span class="main">[]</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="free">cs</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subc_new' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹new_term <span class="free">c</span> <span class="free">t</span> <span class="main">⟹</span> subc_term <span class="free">c</span> <span class="free">s</span> <span class="free">t</span> <span class="main">=</span> <span class="free">t</span>›</span></span>
  <span class="quoted"><span class="quoted">‹new_list <span class="free">c</span> <span class="free">l</span> <span class="main">⟹</span> subc_list <span class="free">c</span> <span class="free">s</span> <span class="free">l</span> <span class="main">=</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> subc_term.induct subc_list.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subc_new <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹new <span class="free">c</span> <span class="free">p</span> <span class="main">⟹</span> subc <span class="free">c</span> <span class="free">s</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> subcs_news<span class="main">:</span> <span class="quoted"><span class="quoted">‹news <span class="free">c</span> <span class="free">z</span> <span class="main">⟹</span> subcs <span class="free">c</span> <span class="free">s</span> <span class="free">z</span> <span class="main">=</span> <span class="free">z</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> subc_psubst' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> paramst <span class="free">t</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">f</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟹</span>
    psubstt <span class="free">f</span> <span class="main">(</span>subc_term <span class="free">c</span> <span class="free">s</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> subc_term <span class="main">(</span><span class="free">f</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>psubstt <span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span>psubstt <span class="free">f</span> <span class="free">t</span><span class="main">)</span>›</span></span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> paramsts <span class="free">l</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">f</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟹</span>
    psubstts <span class="free">f</span> <span class="main">(</span>subc_list <span class="free">c</span> <span class="free">s</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> subc_list <span class="main">(</span><span class="free">f</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>psubstt <span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span>psubstts <span class="free">f</span> <span class="free">l</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> psubstt.induct psubstts.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> subc_psubst<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> params <span class="free">p</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">f</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟹</span>
    psubst <span class="free">f</span> <span class="main">(</span>subc <span class="free">c</span> <span class="free">s</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> subc <span class="main">(</span><span class="free">f</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>psubstt <span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span>psubst <span class="free">f</span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> subcs_psubst<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="free">z</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">f</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟹</span>
    map <span class="main">(</span>psubst <span class="free">f</span><span class="main">)</span> <span class="main">(</span>subcs <span class="free">c</span> <span class="free">s</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> subcs <span class="main">(</span><span class="free">f</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>psubstt <span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>psubst <span class="free">f</span><span class="main">)</span> <span class="free">z</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">z</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subc_psubst<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> new_lift<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹new_term <span class="free">c</span> <span class="free">t</span> <span class="main">⟹</span> new_term <span class="free">c</span> <span class="main">(</span>liftt <span class="free">t</span><span class="main">)</span>›</span></span>
  <span class="quoted"><span class="quoted">‹new_list <span class="free">c</span> <span class="free">l</span> <span class="main">⟹</span> new_list <span class="free">c</span> <span class="main">(</span>liftts <span class="free">l</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> liftt.induct liftts.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> new_subc' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹new_term <span class="free">d</span> <span class="free">s</span> <span class="main">⟹</span> new_term <span class="free">d</span> <span class="free">t</span> <span class="main">⟹</span> new_term <span class="free">d</span> <span class="main">(</span>subc_term <span class="free">c</span> <span class="free">s</span> <span class="free">t</span><span class="main">)</span>›</span></span>
  <span class="quoted"><span class="quoted">‹new_term <span class="free">d</span> <span class="free">s</span> <span class="main">⟹</span> new_list <span class="free">d</span> <span class="free">l</span> <span class="main">⟹</span> new_list <span class="free">d</span> <span class="main">(</span>subc_list <span class="free">c</span> <span class="free">s</span> <span class="free">l</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> substt.induct substts.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> new_subc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹new_term <span class="free">d</span> <span class="free">s</span> <span class="main">⟹</span> new <span class="free">d</span> <span class="free">p</span> <span class="main">⟹</span> new <span class="free">d</span> <span class="main">(</span>subc <span class="free">c</span> <span class="free">s</span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> news_subcs<span class="main">:</span> <span class="quoted"><span class="quoted">‹new_term <span class="free">d</span> <span class="free">s</span> <span class="main">⟹</span> news <span class="free">d</span> <span class="free">z</span> <span class="main">⟹</span> news <span class="free">d</span> <span class="main">(</span>subcs <span class="free">c</span> <span class="free">s</span> <span class="free">z</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_new_free'<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">≠</span> <span class="free">n</span> <span class="main">⟹</span> new_term <span class="free">n</span> <span class="main">(</span>psubstt <span class="main">(</span>id<span class="main">(</span><span class="free">n</span> <span class="main">:=</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span>›</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">≠</span> <span class="free">n</span> <span class="main">⟹</span> new_list <span class="free">n</span> <span class="main">(</span>psubstts <span class="main">(</span>id<span class="main">(</span><span class="free">n</span> <span class="main">:=</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> paramst.induct paramsts.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_new_free<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">≠</span> <span class="free">n</span> <span class="main">⟹</span> new <span class="free">n</span> <span class="main">(</span>psubst <span class="main">(</span>id<span class="main">(</span><span class="free">n</span> <span class="main">:=</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> psubst_new_free' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_psubst_new_free<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">≠</span> <span class="free">n</span> <span class="main">⟹</span> news <span class="free">n</span> <span class="main">(</span>map <span class="main">(</span>psubst <span class="main">(</span>id<span class="main">(</span><span class="free">n</span> <span class="main">:=</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> psubst_new_free <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">z</span></span><span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_new_away' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹new_term <span class="free">fresh</span> <span class="free">t</span> <span class="main">⟹</span> psubstt <span class="main">(</span>id<span class="main">(</span><span class="free">fresh</span> <span class="main">:=</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>psubstt <span class="main">(</span>id<span class="main">(</span><span class="free">c</span> <span class="main">:=</span> <span class="free">fresh</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>›</span></span>
  <span class="quoted"><span class="quoted">‹new_list <span class="free">fresh</span> <span class="free">l</span> <span class="main">⟹</span> psubstts <span class="main">(</span>id<span class="main">(</span><span class="free">fresh</span> <span class="main">:=</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>psubstts <span class="main">(</span>id<span class="main">(</span><span class="free">c</span> <span class="main">:=</span> <span class="free">fresh</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> psubstt.induct psubstts.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_new_away <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹new <span class="free">fresh</span> <span class="free">p</span> <span class="main">⟹</span> psubst <span class="main">(</span>id<span class="main">(</span><span class="free">fresh</span> <span class="main">:=</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>psubst <span class="main">(</span>id<span class="main">(</span><span class="free">c</span> <span class="main">:=</span> <span class="free">fresh</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> map_psubst_new_away<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹news <span class="free">fresh</span> <span class="free">z</span> <span class="main">⟹</span> map <span class="main">(</span>psubst <span class="main">(</span>id<span class="main">(</span><span class="free">fresh</span> <span class="main">:=</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>psubst <span class="main">(</span>id<span class="main">(</span><span class="free">c</span> <span class="main">:=</span> <span class="free">fresh</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_new'<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹new_term <span class="free">c</span> <span class="free">t</span> <span class="main">⟹</span> psubstt <span class="main">(</span>id<span class="main">(</span><span class="free">c</span> <span class="main">:=</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">t</span>›</span></span>
  <span class="quoted"><span class="quoted">‹new_list <span class="free">c</span> <span class="free">l</span> <span class="main">⟹</span> psubstts <span class="main">(</span>id<span class="main">(</span><span class="free">c</span> <span class="main">:=</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span> <span class="main">=</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> psubstt.induct psubstts.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_new<span class="main">:</span> <span class="quoted"><span class="quoted">‹new <span class="free">c</span> <span class="free">p</span> <span class="main">⟹</span> psubst <span class="main">(</span>id<span class="main">(</span><span class="free">c</span> <span class="main">:=</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> psubst_new' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_psubst_new<span class="main">:</span> <span class="quoted"><span class="quoted">‹news <span class="free">c</span> <span class="free">z</span> <span class="main">⟹</span> map <span class="main">(</span>psubst <span class="main">(</span>id<span class="main">(</span><span class="free">c</span> <span class="main">:=</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="free">z</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> psubst_new <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">z</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lift_subst <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹liftt <span class="main">(</span>substt <span class="free">t</span> <span class="free">u</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> substt <span class="main">(</span>liftt <span class="free">t</span><span class="main">)</span> <span class="main">(</span>liftt <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>›</span></span>
  <span class="quoted"><span class="quoted">‹liftts <span class="main">(</span>substts <span class="free">l</span> <span class="free">u</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> substts <span class="main">(</span>liftts <span class="free">l</span><span class="main">)</span> <span class="main">(</span>liftt <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> substt.induct substts.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> new_subc_same' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹new_term <span class="free">c</span> <span class="free">s</span> <span class="main">⟹</span> new_term <span class="free">c</span> <span class="main">(</span>subc_term <span class="free">c</span> <span class="free">s</span> <span class="free">t</span><span class="main">)</span>›</span></span>
  <span class="quoted"><span class="quoted">‹new_term <span class="free">c</span> <span class="free">s</span> <span class="main">⟹</span> new_list <span class="free">c</span> <span class="main">(</span>subc_list <span class="free">c</span> <span class="free">s</span> <span class="free">l</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> subc_term.induct subc_list.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> new_subc_same<span class="main">:</span> <span class="quoted"><span class="quoted">‹new_term <span class="free">c</span> <span class="free">s</span> <span class="main">⟹</span> new <span class="free">c</span> <span class="main">(</span>subc <span class="free">c</span> <span class="free">s</span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> lift_subc<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹liftt <span class="main">(</span>subc_term <span class="free">c</span> <span class="free">s</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> subc_term <span class="free">c</span> <span class="main">(</span>liftt <span class="free">s</span><span class="main">)</span> <span class="main">(</span>liftt <span class="free">t</span><span class="main">)</span>›</span></span>
  <span class="quoted"><span class="quoted">‹liftts <span class="main">(</span>subc_list <span class="free">c</span> <span class="free">s</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> subc_list <span class="free">c</span> <span class="main">(</span>liftt <span class="free">s</span><span class="main">)</span> <span class="main">(</span>liftts <span class="free">l</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> liftt.induct liftts.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> new_subc_put'<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹new_term <span class="free">c</span> <span class="free">s</span> <span class="main">⟹</span> subc_term <span class="free">c</span> <span class="free">s</span> <span class="main">(</span>substt <span class="free">t</span> <span class="free">u</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> subc_term <span class="free">c</span> <span class="free">s</span> <span class="main">(</span>substt <span class="free">t</span> <span class="main">(</span>subc_term <span class="free">c</span> <span class="free">s</span> <span class="free">u</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>›</span></span>
  <span class="quoted"><span class="quoted">‹new_term <span class="free">c</span> <span class="free">s</span> <span class="main">⟹</span> subc_list <span class="free">c</span> <span class="free">s</span> <span class="main">(</span>substts <span class="free">l</span> <span class="free">u</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> subc_list <span class="free">c</span> <span class="free">s</span> <span class="main">(</span>substts <span class="free">l</span> <span class="main">(</span>subc_term <span class="free">c</span> <span class="free">s</span> <span class="free">u</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> subc_term.induct subc_list.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> new_subc_put<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹new_term <span class="free">c</span> <span class="free">s</span> <span class="main">⟹</span> subc <span class="free">c</span> <span class="free">s</span> <span class="main">(</span>subst <span class="free">p</span> <span class="free">t</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> subc <span class="free">c</span> <span class="free">s</span> <span class="main">(</span>subst <span class="free">p</span> <span class="main">(</span>subc_term <span class="free">c</span> <span class="free">s</span> <span class="free">t</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> FF
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> TT
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pred <span class="skolem">i</span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> new_subc_put' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Neg <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subc.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> subst.simps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Impl <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subc.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> subst.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subc.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> subst.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subc.simps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> subst.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Exists <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹subc <span class="free">c</span> <span class="skolem">s</span> <span class="main">(</span>subst <span class="main">(</span>Exists <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>subc_term <span class="free">c</span> <span class="skolem">s</span> <span class="skolem">t</span><span class="main">)</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span>
      Exists <span class="main">(</span>subc <span class="free">c</span> <span class="main">(</span>liftt <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>subc_term <span class="free">c</span> <span class="main">(</span>liftt <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span>liftt <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_subc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">=</span> Exists <span class="main">(</span>subc <span class="free">c</span> <span class="main">(</span>liftt <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>liftt <span class="skolem">t</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Exists new_lift<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Forall <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹subc <span class="free">c</span> <span class="skolem">s</span> <span class="main">(</span>subst <span class="main">(</span>Forall <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>subc_term <span class="free">c</span> <span class="skolem">s</span> <span class="skolem">t</span><span class="main">)</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span>
      Forall <span class="main">(</span>subc <span class="free">c</span> <span class="main">(</span>liftt <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>subc_term <span class="free">c</span> <span class="main">(</span>liftt <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span>liftt <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_subc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">=</span> Forall <span class="main">(</span>subc <span class="free">c</span> <span class="main">(</span>liftt <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>liftt <span class="skolem">t</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Forall new_lift<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subc_subst_new'<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹new_term <span class="free">c</span> <span class="free">u</span> <span class="main">⟹</span> subc_term <span class="free">c</span> <span class="main">(</span>substt <span class="free">s</span> <span class="free">u</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span>substt <span class="free">t</span> <span class="free">u</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> substt <span class="main">(</span>subc_term <span class="free">c</span> <span class="free">s</span> <span class="free">t</span><span class="main">)</span> <span class="free">u</span> <span class="free">m</span>›</span></span>
  <span class="quoted"><span class="quoted">‹new_term <span class="free">c</span> <span class="free">u</span> <span class="main">⟹</span> subc_list <span class="free">c</span> <span class="main">(</span>substt <span class="free">s</span> <span class="free">u</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span>substts <span class="free">l</span> <span class="free">u</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> substts <span class="main">(</span>subc_list <span class="free">c</span> <span class="free">s</span> <span class="free">l</span><span class="main">)</span> <span class="free">u</span> <span class="free">m</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> subc_term.induct subc_list.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> subc_subst_new<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹new_term <span class="free">c</span> <span class="free">t</span> <span class="main">⟹</span> subc <span class="free">c</span> <span class="main">(</span>substt <span class="free">s</span> <span class="free">t</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">p</span> <span class="free">t</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> subst <span class="main">(</span>subc <span class="free">c</span> <span class="free">s</span> <span class="free">p</span><span class="main">)</span> <span class="free">t</span> <span class="free">m</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> subc_subst_new' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subc_sub_0_new <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹new_term <span class="free">c</span> <span class="free">t</span> <span class="main">⟹</span> subc <span class="free">c</span> <span class="free">s</span> <span class="main">(</span>subst <span class="free">p</span> <span class="free">t</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> subst <span class="main">(</span>subc <span class="free">c</span> <span class="main">(</span>liftt <span class="free">s</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="free">t</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> subc_subst_new subst_0_lift<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> member_subc<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> set <span class="free">z</span> <span class="main">⟹</span> subc <span class="free">c</span> <span class="free">s</span> <span class="free">p</span> <span class="main">∈</span> set <span class="main">(</span>subcs <span class="free">c</span> <span class="free">s</span> <span class="free">z</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">z</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> deriv_subc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inf_params<span class="main">:</span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">⊢</span> <span class="free">p</span> <span class="main">⟹</span> subcs <span class="free">c</span> <span class="free">s</span> <span class="free">z</span> <span class="main">⊢</span> subc <span class="free">c</span> <span class="free">s</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">z</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> deriv.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assum <span class="skolem">p</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> member_subc deriv.Assum <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> TTI
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.TTI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">case</span></span> FFE
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.FFE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NegI <span class="skolem">z</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.NegI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NegE <span class="skolem">z</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.NegE <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Class <span class="skolem">p</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.Class <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImplE <span class="skolem">z</span> <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.ImplE <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImplI <span class="skolem">z</span> <span class="skolem">q</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.ImplI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrE <span class="skolem">z</span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.OrE <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrI1 <span class="skolem">z</span> <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.OrI1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrI2 <span class="skolem">z</span> <span class="skolem">q</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.OrI2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndE1 <span class="skolem">z</span> <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.AndE1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndE2 <span class="skolem">z</span> <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.AndE2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndI <span class="skolem">p</span> <span class="skolem">z</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.AndI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ExistsE <span class="skolem">z</span> <span class="skolem">p</span> <span class="skolem">d</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">d</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">⊢</span> <span class="skolem">q</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ExistsE deriv.ExistsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">c</span> <span class="skolem">q</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">c</span> <span class="skolem">z</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ExistsE True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> subc_new subcs_news <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹params <span class="skolem">p</span> <span class="main">∪</span> params <span class="skolem">q</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">z</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> paramst <span class="skolem">s</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">c</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">d</span><span class="main">}</span>›</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?params</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fresh</span></span> <span class="keyword2"><span class="keyword">where</span></span> fresh<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">fresh</span> <span class="main">∉</span> <span class="var">?params</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_params <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ex_new_if_finite infinite_UNIV_listI<span class="main">)</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹psubstt <span class="main">(</span>id<span class="main">(</span><span class="skolem">d</span> <span class="main">:=</span> <span class="skolem">fresh</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>›</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹id<span class="main">(</span><span class="skolem">d</span> <span class="main">:=</span> <span class="skolem">fresh</span><span class="main">,</span> <span class="skolem">fresh</span> <span class="main">:=</span> <span class="skolem">d</span><span class="main">)</span>›</span></span>

    <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="var">?params</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">⟶</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="var">?f</span> <span class="skolem">c</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">d</span> <span class="var">?s</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh psubst_new_free'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubstt <span class="var">?f</span> <span class="var">?s</span> <span class="main">=</span> psubstt <span class="main">(</span>id<span class="main">(</span><span class="skolem">fresh</span> <span class="main">:=</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="var">?s</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fun_upd_twist psubstt_upd<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> psubst_s<span class="main">:</span> <span class="quoted"><span class="quoted">‹psubstt <span class="var">?f</span> <span class="var">?s</span> <span class="main">=</span> <span class="skolem">s</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?f</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="main">(</span><span class="var">?f</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> False fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹subcs <span class="skolem">c</span> <span class="main">(</span>psubstt <span class="var">?f</span> <span class="var">?s</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">⊢</span> subc <span class="skolem">c</span> <span class="main">(</span>psubstt <span class="var">?f</span> <span class="var">?s</span><span class="main">)</span> <span class="main">(</span>Exists <span class="skolem">p</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ExistsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> exi_p<span class="main">:</span>
      <span class="quoted"><span class="quoted">‹subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">z</span> <span class="main">⊢</span> Exists <span class="main">(</span>subc <span class="skolem">c</span> <span class="main">(</span>liftt <span class="main">(</span>psubstt <span class="var">?f</span> <span class="var">?s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> psubst_s <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">d</span> <span class="skolem">z</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ExistsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="skolem">z</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">z</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">z</span><span class="main">.</span> params <span class="bound">p</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">⟶</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="var">?f</span> <span class="skolem">c</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> psubst_z<span class="main">:</span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">z</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?f</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span> psubst_s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subcs_psubst<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="var">?f</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>App <span class="skolem">d</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        subc <span class="main">(</span><span class="var">?f</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>psubstt <span class="var">?f</span> <span class="var">?s</span><span class="main">)</span> <span class="main">(</span>psubst <span class="var">?f</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>App <span class="skolem">d</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subc_psubst<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">=</span> subc <span class="skolem">c</span> <span class="skolem">s</span> <span class="main">(</span>subst <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> psubst_subst psubst_s <span class="quoted"><span class="quoted">‹<span class="var">?f</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">=</span> subc <span class="skolem">c</span> <span class="skolem">s</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ExistsE fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> psubst_p<span class="main">:</span> <span class="quoted"><span class="quoted">‹psubst <span class="var">?f</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>App <span class="skolem">d</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        subst <span class="main">(</span>subc <span class="skolem">c</span> <span class="main">(</span>liftt <span class="skolem">s</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> subc_sub_0_new <span class="quoted"><span class="quoted">‹new_term <span class="main">(</span><span class="var">?f</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?f</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> params <span class="skolem">q</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">⟶</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="var">?f</span> <span class="skolem">c</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> psubst_q<span class="main">:</span> <span class="quoted"><span class="quoted">‹psubst <span class="var">?f</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> subc <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">q</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ExistsE fresh <span class="quoted"><span class="quoted">‹<span class="var">?f</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span> psubst_s f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subc_psubst<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>App <span class="skolem">d</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span> <span class="main">#</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">⊢</span> subc <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">q</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ExistsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>App <span class="skolem">d</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">z</span> <span class="main">⊢</span> subc <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">q</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="var">?f</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>App <span class="skolem">d</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">z</span><span class="main">)</span>
        <span class="main">⊢</span> psubst <span class="var">?f</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">q</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> deriv_psubst inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">‹subst <span class="main">(</span>subc <span class="skolem">c</span> <span class="main">(</span>liftt <span class="skolem">s</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span> <span class="main">#</span> subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">z</span> <span class="main">⊢</span> subc <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">q</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> psubst_q psubst_z psubst_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">fresh</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="main">(</span>liftt <span class="skolem">s</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh new_subc new_lift <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">fresh</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">q</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh new_subc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="main">(</span>subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">z</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> news_subcs<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">z</span> <span class="main">⊢</span> subc <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">q</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> deriv.ExistsE exi_p q psubst_s <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ExistsI <span class="skolem">z</span> <span class="skolem">p</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹params <span class="skolem">p</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">z</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> paramst <span class="skolem">s</span> <span class="main">∪</span> paramst <span class="skolem">t</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">c</span><span class="main">}</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?params</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fresh</span></span> <span class="keyword2"><span class="keyword">where</span></span> fresh<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">fresh</span> <span class="main">∉</span> <span class="var">?params</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_params <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ex_new_if_finite infinite_UNIV_listI<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹id<span class="main">(</span><span class="skolem">c</span> <span class="main">:=</span> <span class="skolem">fresh</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹id<span class="main">(</span><span class="skolem">fresh</span> <span class="main">:=</span> <span class="skolem">c</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹psubstt <span class="var">?f</span> <span class="skolem">s</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="var">?g</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">‹psubstt <span class="var">?g</span> <span class="var">?s</span> <span class="main">=</span> <span class="skolem">s</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">‹psubst <span class="var">?g</span> <span class="main">(</span>Exists <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> Exists <span class="skolem">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">z</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">⟶</span> <span class="var">?g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="var">?g</span> <span class="skolem">c</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?g</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">z</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?g</span><span class="main">)</span> <span class="main">(</span>subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">z</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subcs_psubst<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">c</span> <span class="var">?s</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh psubst_new_free' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">z</span> <span class="main">⊢</span> subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>subc_term <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ExistsI new_subc_put <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">c</span> <span class="main">(</span>subc_term <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">t</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">c</span> <span class="var">?s</span>›</span></span> new_subc_same' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">z</span> <span class="main">⊢</span> subst <span class="main">(</span>subc <span class="skolem">c</span> <span class="main">(</span>liftt <span class="var">?s</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>subc_term <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> subc_sub_0_new <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">z</span> <span class="main">⊢</span> subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>Exists <span class="skolem">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.ExistsI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?g</span><span class="main">)</span> <span class="main">(</span>subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">⊢</span> psubst <span class="var">?g</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>Exists <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv_psubst inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> params <span class="main">(</span>Exists <span class="skolem">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">⟶</span> <span class="var">?g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="var">?g</span> <span class="skolem">c</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">z</span> <span class="main">⊢</span> subc <span class="skolem">c</span> <span class="skolem">s</span> <span class="main">(</span>Exists <span class="skolem">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> c s p z <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subc_psubst<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ForallE <span class="skolem">z</span> <span class="skolem">p</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹params <span class="skolem">p</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">z</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> paramst <span class="skolem">s</span> <span class="main">∪</span> paramst <span class="skolem">t</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">c</span><span class="main">}</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?params</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fresh</span></span> <span class="keyword2"><span class="keyword">where</span></span> fresh<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">fresh</span> <span class="main">∉</span> <span class="var">?params</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_params <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ex_new_if_finite infinite_UNIV_listI<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹id<span class="main">(</span><span class="skolem">c</span> <span class="main">:=</span> <span class="skolem">fresh</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹id<span class="main">(</span><span class="skolem">fresh</span> <span class="main">:=</span> <span class="skolem">c</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹psubstt <span class="var">?f</span> <span class="skolem">s</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="var">?g</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">‹psubstt <span class="var">?g</span> <span class="var">?s</span> <span class="main">=</span> <span class="skolem">s</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">‹psubst <span class="var">?g</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="skolem">t</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> subst <span class="skolem">p</span> <span class="skolem">t</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh psubst_new psubst_subst subst_new psubst_new'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">z</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">⟶</span> <span class="var">?g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="var">?g</span> <span class="skolem">c</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?g</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">z</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?g</span><span class="main">)</span> <span class="main">(</span>subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">z</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subcs_psubst<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">c</span> <span class="var">?s</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh psubst_new_free' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">z</span> <span class="main">⊢</span> Forall <span class="main">(</span>subc <span class="skolem">c</span> <span class="main">(</span>liftt <span class="var">?s</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ForallE <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">z</span> <span class="main">⊢</span> subst <span class="main">(</span>subc <span class="skolem">c</span> <span class="main">(</span>liftt <span class="var">?s</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>subc_term <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.ForallE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">c</span> <span class="main">(</span>subc_term <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">t</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">c</span> <span class="var">?s</span>›</span></span> new_subc_same' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">z</span> <span class="main">⊢</span> subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>subc_term <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">z</span> <span class="main">⊢</span> subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="skolem">t</span> <span class="main">0</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> new_subc_put <span class="quoted"><span class="quoted">‹new_term <span class="skolem">c</span> <span class="var">?s</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?g</span><span class="main">)</span> <span class="main">(</span>subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">⊢</span> psubst <span class="var">?g</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="skolem">t</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv_psubst inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> params <span class="main">(</span>subst <span class="skolem">p</span> <span class="skolem">t</span> <span class="main">0</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">⟶</span> <span class="var">?g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="var">?g</span> <span class="skolem">c</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh p psubst_new_free <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fun_upd_apply id_apply<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">z</span> <span class="main">⊢</span> subc <span class="skolem">c</span> <span class="skolem">s</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="skolem">t</span> <span class="main">0</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> c s p z <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subc_psubst<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ForallI <span class="skolem">z</span> <span class="skolem">p</span> <span class="skolem">d</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">d</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">⊢</span> Forall <span class="skolem">p</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ForallI deriv.ForallI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">c</span> <span class="skolem">p</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">c</span> <span class="skolem">z</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ForallI True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subcs_news<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹params <span class="skolem">p</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">z</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> paramst <span class="skolem">s</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">c</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">d</span><span class="main">}</span>›</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?params</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fresh</span></span> <span class="keyword2"><span class="keyword">where</span></span> fresh<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">fresh</span> <span class="main">∉</span> <span class="var">?params</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_params <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ex_new_if_finite infinite_UNIV_listI<span class="main">)</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹psubstt <span class="main">(</span>id<span class="main">(</span><span class="skolem">d</span> <span class="main">:=</span> <span class="skolem">fresh</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>›</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹id<span class="main">(</span><span class="skolem">d</span> <span class="main">:=</span> <span class="skolem">fresh</span><span class="main">,</span> <span class="skolem">fresh</span> <span class="main">:=</span> <span class="skolem">d</span><span class="main">)</span>›</span></span>

    <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="var">?params</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">⟶</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="var">?f</span> <span class="skolem">c</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">d</span> <span class="var">?s</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh psubst_new_free' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubstt <span class="var">?f</span> <span class="var">?s</span> <span class="main">=</span> psubstt <span class="main">(</span>id<span class="main">(</span><span class="skolem">fresh</span> <span class="main">:=</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="var">?s</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fun_upd_twist psubstt_upd<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> psubst_s<span class="main">:</span> <span class="quoted"><span class="quoted">‹psubstt <span class="var">?f</span> <span class="var">?s</span> <span class="main">=</span> <span class="skolem">s</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?f</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">c</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> False fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="var">?f</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>App <span class="skolem">d</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      subc <span class="main">(</span><span class="var">?f</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>psubstt <span class="var">?f</span> <span class="var">?s</span><span class="main">)</span> <span class="main">(</span>psubst <span class="var">?f</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>App <span class="skolem">d</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subc_psubst<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">=</span> subc <span class="skolem">c</span> <span class="skolem">s</span> <span class="main">(</span>subst <span class="main">(</span>psubst <span class="var">?f</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?f</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span> psubst_subst psubst_s <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">=</span> subc <span class="skolem">c</span> <span class="skolem">s</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ForallI fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> psubst_p<span class="main">:</span> <span class="quoted"><span class="quoted">‹psubst <span class="var">?f</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>App <span class="skolem">d</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        subst <span class="main">(</span>subc <span class="skolem">c</span> <span class="main">(</span>liftt <span class="skolem">s</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> subc_sub_0_new <span class="quoted"><span class="quoted">‹new_term <span class="skolem">c</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">d</span> <span class="skolem">z</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ForallI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="skolem">z</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">z</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">z</span><span class="main">.</span> params <span class="bound">p</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">⟶</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="var">?f</span> <span class="skolem">c</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> psubst_z<span class="main">:</span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">z</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?f</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span> psubst_s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subcs_psubst<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">z</span> <span class="main">⊢</span> subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>App <span class="skolem">d</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ForallI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>subcs <span class="skolem">c</span> <span class="var">?s</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">⊢</span> psubst <span class="var">?f</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>App <span class="skolem">d</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> deriv_psubst inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">z</span> <span class="main">⊢</span> psubst <span class="var">?f</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="var">?s</span> <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>App <span class="skolem">d</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> psubst_z <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sub_p<span class="main">:</span> <span class="quoted"><span class="quoted">‹subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">z</span> <span class="main">⊢</span> subst <span class="main">(</span>subc <span class="skolem">c</span> <span class="main">(</span>liftt <span class="skolem">s</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>App <span class="skolem">fresh</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> psubst_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">fresh</span> <span class="skolem">s</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">fresh</span> <span class="main">(</span>liftt <span class="skolem">s</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> new_lift <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">fresh</span> <span class="main">(</span>subc <span class="skolem">c</span> <span class="main">(</span>liftt <span class="skolem">s</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> fresh new_subc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="main">(</span>subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">z</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">fresh</span> <span class="skolem">z</span>›</span></span> <span class="quoted"><span class="quoted">‹new_term <span class="skolem">fresh</span> <span class="skolem">s</span>›</span></span> news_subcs <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹subcs <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">z</span> <span class="main">⊢</span> subc <span class="skolem">c</span> <span class="skolem">s</span> <span class="main">(</span>Forall <span class="skolem">p</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> deriv.ForallI sub_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Weakening assumptions›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_new_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">z</span> <span class="main">⊆</span> set <span class="free">z'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="free">z</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">z</span> <span class="main">⊆</span> set <span class="main">(</span>map <span class="main">(</span>psubst <span class="main">(</span>id<span class="main">(</span><span class="free">c</span> <span class="main">:=</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">z'</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> subset_cons<span class="main">:</span> <span class="quoted"><span class="quoted">‹set <span class="free">z</span> <span class="main">⊆</span> set <span class="free">z'</span> <span class="main">⟹</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">z'</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> weaken_assumptions<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inf_params<span class="main">:</span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">⊢</span> <span class="free">p</span> <span class="main">⟹</span> set <span class="free">z</span> <span class="main">⊆</span> set <span class="free">z'</span> <span class="main">⟹</span> <span class="free">z'</span> <span class="main">⊢</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">z</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">z'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> deriv.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assum <span class="skolem">p</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.Assum <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> TTI
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.TTI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> FFE
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.FFE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NegI <span class="skolem">p</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.NegI subset_cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NegE <span class="skolem">p</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.NegE <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Class <span class="skolem">z</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.Class subset_cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImplE <span class="skolem">z</span> <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.ImplE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImplI <span class="skolem">z</span> <span class="skolem">q</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.ImplI subset_cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrE <span class="skolem">z</span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">z</span> <span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.OrE subset_cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrI1 <span class="skolem">z</span> <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.OrI1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrI2 <span class="skolem">z</span> <span class="skolem">q</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.OrI2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndE1 <span class="skolem">z</span> <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.AndE1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndE2 <span class="skolem">z</span> <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.AndE2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndI <span class="skolem">z</span> <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.AndI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ExistsE <span class="skolem">z</span> <span class="skolem">p</span> <span class="skolem">c</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹params <span class="skolem">p</span> <span class="main">∪</span> params <span class="skolem">q</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">z'</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">c</span><span class="main">}</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?params</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fresh</span></span> <span class="keyword2"><span class="keyword">where</span></span> fresh<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">fresh</span> <span class="main">∉</span> <span class="var">?params</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_params <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ex_new_if_finite List.finite_set infinite_UNIV_listI<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="main">(</span>id<span class="main">(</span><span class="skolem">c</span> <span class="main">:=</span> <span class="skolem">fresh</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">z'</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">c</span> <span class="skolem">z</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ExistsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">z</span> <span class="main">⊆</span> set <span class="var">?z'</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ExistsE psubst_new_subset <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ball_set<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?z'</span> <span class="main">⊢</span> Exists <span class="skolem">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ExistsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>App <span class="skolem">c</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span> <span class="main">#</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>subst <span class="skolem">p</span> <span class="main">(</span>App <span class="skolem">c</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span> <span class="main">#</span> <span class="var">?z'</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">z</span> <span class="main">⊆</span> set <span class="var">?z'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹subst <span class="skolem">p</span> <span class="main">(</span>App <span class="skolem">c</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span> <span class="main">#</span> <span class="var">?z'</span> <span class="main">⊢</span> <span class="skolem">q</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ExistsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">c</span> <span class="var">?z'</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_psubst_new_free<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">c</span> <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">c</span> <span class="skolem">q</span>›</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">c</span> <span class="var">?z'</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ExistsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?z'</span> <span class="main">⊢</span> <span class="skolem">q</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ExistsE deriv.ExistsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="main">(</span>id<span class="main">(</span><span class="skolem">fresh</span> <span class="main">:=</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="var">?z'</span> <span class="main">⊢</span> psubst <span class="main">(</span>id<span class="main">(</span><span class="skolem">fresh</span> <span class="main">:=</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="skolem">q</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv_psubst inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="main">(</span>id<span class="main">(</span><span class="skolem">fresh</span> <span class="main">:=</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="var">?z'</span> <span class="main">=</span> <span class="skolem">z'</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh map_psubst_new_away Ball_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="main">(</span>id<span class="main">(</span><span class="skolem">fresh</span> <span class="main">:=</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">q</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z'</span> <span class="main">⊢</span> <span class="skolem">q</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ExistsI <span class="skolem">z</span> <span class="skolem">p</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.ExistsI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ForallE <span class="skolem">p</span> <span class="skolem">z</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv.ForallE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ForallI <span class="skolem">z</span> <span class="skolem">p</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹params <span class="skolem">p</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">z'</span><span class="main">.</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">c</span><span class="main">}</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?params</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fresh</span></span> <span class="keyword2"><span class="keyword">where</span></span> fresh<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">fresh</span> <span class="main">∉</span> <span class="var">?params</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_params <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ex_new_if_finite List.finite_set infinite_UNIV_listI<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="main">(</span>id<span class="main">(</span><span class="skolem">c</span> <span class="main">:=</span> <span class="skolem">fresh</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">z'</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">c</span> <span class="skolem">z</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ForallI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">z</span> <span class="main">⊆</span> set <span class="var">?z'</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ForallI psubst_new_subset <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Ball_set UN_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?z'</span> <span class="main">⊢</span> subst <span class="skolem">p</span> <span class="main">(</span>App <span class="skolem">c</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ForallI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> set <span class="var">?z'</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">∉</span> params <span class="bound">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh psubst_new_free <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">∉</span> params <span class="bound">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">#</span> <span class="var">?z'</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ForallI <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹new <span class="skolem">c</span> <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹news <span class="skolem">c</span> <span class="var">?z'</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?z'</span> <span class="main">⊢</span> Forall <span class="skolem">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ForallI deriv.ForallI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="main">(</span>id<span class="main">(</span><span class="skolem">fresh</span> <span class="main">:=</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="var">?z'</span> <span class="main">⊢</span> psubst <span class="main">(</span>id<span class="main">(</span><span class="skolem">fresh</span> <span class="main">:=</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Forall <span class="skolem">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv_psubst inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹map <span class="main">(</span>psubst <span class="main">(</span>id<span class="main">(</span><span class="skolem">fresh</span> <span class="main">:=</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="var">?z'</span> <span class="main">=</span> <span class="skolem">z'</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh map_psubst_new_away Ball_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹psubst <span class="main">(</span>id<span class="main">(</span><span class="skolem">fresh</span> <span class="main">:=</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Forall <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> Forall <span class="skolem">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> fresh ForallI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z'</span> <span class="main">⊢</span> Forall <span class="skolem">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Implications and assumptions›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">put_imps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">put_imps</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">‹<span class="free">put_imps</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">=</span> Impl <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span><span class="free">put_imps</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> semantics_put_imps<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">e</span><span class="main">,</span><span class="free">f</span><span class="main">,</span><span class="free">g</span><span class="main">,</span><span class="free">z</span> <span class="main">⊨</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>put_imps <span class="free">p</span> <span class="free">z</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> model_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">z</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> shift_imp_assum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inf_params<span class="main">:</span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">⊢</span> Impl <span class="free">p</span> <span class="free">q</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">#</span> <span class="free">z</span> <span class="main">⊢</span> <span class="free">q</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">z</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">#</span> <span class="free">z</span> <span class="main">⊢</span> Impl <span class="free">p</span> <span class="free">q</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms weaken_assumptions inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">#</span> <span class="free">z</span> <span class="main">⊢</span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assum<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">#</span> <span class="free">z</span> <span class="main">⊢</span> <span class="free">q</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ImplE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> remove_imps<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> params <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z'</span> <span class="main">⊢</span> put_imps <span class="free">p</span> <span class="free">z</span> <span class="main">⟹</span> rev <span class="free">z</span> <span class="main">@</span> <span class="free">z'</span> <span class="main">⊢</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms shift_imp_assum <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">z</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">z'</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Closure elimination›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subc_sub_closed_var' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹new_term <span class="free">c</span> <span class="free">t</span> <span class="main">⟹</span> closedt <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="free">t</span> <span class="main">⟹</span> subc_term <span class="free">c</span> <span class="main">(</span>Var <span class="free">m</span><span class="main">)</span> <span class="main">(</span>substt <span class="free">t</span> <span class="main">(</span>App <span class="free">c</span> <span class="main">[]</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>›</span></span>
  <span class="quoted"><span class="quoted">‹new_list <span class="free">c</span> <span class="free">l</span> <span class="main">⟹</span> closedts <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span> subc_list <span class="free">c</span> <span class="main">(</span>Var <span class="free">m</span><span class="main">)</span> <span class="main">(</span>substts <span class="free">l</span> <span class="main">(</span>App <span class="free">c</span> <span class="main">[]</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> substt.induct substts.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subc_sub_closed_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹new <span class="free">c</span> <span class="free">p</span> <span class="main">⟹</span> closed <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="free">p</span> <span class="main">⟹</span>
    subc <span class="free">c</span> <span class="main">(</span>Var <span class="free">m</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">p</span> <span class="main">(</span>App <span class="free">c</span> <span class="main">[]</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">put_unis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">put_unis</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">‹<span class="free">put_unis</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Forall <span class="main">(</span><span class="free">put_unis</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sub_put_unis <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹subst <span class="main">(</span>put_unis <span class="free">k</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>App <span class="free">c</span> <span class="main">[]</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> put_unis <span class="free">k</span> <span class="main">(</span>subst <span class="free">p</span> <span class="main">(</span>App <span class="free">c</span> <span class="main">[]</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> closed_put_unis <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹closed <span class="free">m</span> <span class="main">(</span>put_unis <span class="free">k</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> closed <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> valid_put_unis<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">e</span> <span class="main">::</span> nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> eval <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span> <span class="free">p</span> <span class="main">⟹</span>
    eval <span class="main">(</span><span class="free">e</span> <span class="main">::</span> nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>put_unis <span class="free">m</span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> put_unis_collapse<span class="main">:</span> <span class="quoted"><span class="quoted">‹put_unis <span class="free">m</span> <span class="main">(</span>put_unis <span class="free">n</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> put_unis <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">consts_for_unis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">consts_for_unis</span> <span class="main">(</span>Forall <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">consts_for_unis</span> <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>App <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span>›</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">‹<span class="free">consts_for_unis</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> consts_for_unis<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">[]</span> <span class="main">⊢</span> put_unis <span class="main">(</span>length <span class="free">cs</span><span class="main">)</span> <span class="free">p</span> <span class="main">⟹</span>
  <span class="main">[]</span> <span class="main">⊢</span> consts_for_unis <span class="main">(</span>put_unis <span class="main">(</span>length <span class="free">cs</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="free">cs</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">c</span> <span class="skolem">cs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[]</span> <span class="main">⊢</span> Forall <span class="main">(</span>put_unis <span class="main">(</span>length <span class="skolem">cs</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[]</span> <span class="main">⊢</span> subst <span class="main">(</span>put_unis <span class="main">(</span>length <span class="skolem">cs</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>App <span class="skolem">c</span> <span class="main">[]</span><span class="main">)</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ForallE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">vars_for_consts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">vars_for_consts</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">‹<span class="free">vars_for_consts</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="main">=</span> subc <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>Var <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">vars_for_consts</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vars_for_consts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> params <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[]</span> <span class="main">⊢</span> <span class="free">p</span> <span class="main">⟹</span> <span class="main">[]</span> <span class="main">⊢</span> vars_for_consts <span class="free">p</span> <span class="free">xs</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms deriv_subc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vars_for_consts_for_unis<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹closed <span class="main">(</span>length <span class="free">cs</span><span class="main">)</span> <span class="free">p</span> <span class="main">⟹</span> list_all <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> new <span class="bound">c</span> <span class="free">p</span><span class="main">)</span> <span class="free">cs</span> <span class="main">⟹</span> distinct <span class="free">cs</span> <span class="main">⟹</span>
   vars_for_consts <span class="main">(</span>consts_for_unis <span class="main">(</span>put_unis <span class="main">(</span>length <span class="free">cs</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="free">cs</span><span class="main">)</span> <span class="free">cs</span> <span class="main">=</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_new_all<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fresh_constant<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∉</span> set <span class="free">cs</span> <span class="main">∧</span> new <span class="bound">c</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>set <span class="free">cs</span> <span class="main">∪</span> params <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ex_new_if_finite UnI1 UnI2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fresh_constants<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> form›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">cs</span><span class="main">.</span> length <span class="bound">cs</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> list_all <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> new <span class="bound">c</span> <span class="free">p</span><span class="main">)</span> <span class="bound">cs</span> <span class="main">∧</span> distinct <span class="bound">cs</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">cs</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">∧</span> list_all <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> new <span class="bound">c</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">cs</span> <span class="main">∧</span> distinct <span class="skolem">cs</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">∉</span> set <span class="skolem">cs</span> <span class="main">∧</span> new <span class="skolem">c</span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc assms fresh_constant <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span><span class="skolem">c</span> <span class="main">#</span> <span class="skolem">cs</span><span class="main">)</span> <span class="main">=</span> Suc <span class="skolem">m</span> <span class="main">∧</span> list_all <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> new <span class="bound">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">#</span> <span class="skolem">cs</span><span class="main">)</span> <span class="main">∧</span> distinct <span class="main">(</span><span class="skolem">c</span> <span class="main">#</span> <span class="skolem">cs</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> closed_max<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹closed <span class="free">m</span> <span class="free">p</span>›</span></span> <span class="quoted"><span class="quoted">‹closed <span class="free">n</span> <span class="free">q</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">(</span>max <span class="free">m</span> <span class="free">n</span><span class="main">)</span> <span class="free">p</span> <span class="main">∧</span> closed <span class="main">(</span>max <span class="free">m</span> <span class="free">n</span><span class="main">)</span> <span class="free">q</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">≤</span> max <span class="free">m</span> <span class="free">n</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">≤</span> max <span class="free">m</span> <span class="free">n</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms closed_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ex_closed' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">l</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> term list›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> closedt <span class="bound">m</span> <span class="free">t</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> closedts <span class="bound">n</span> <span class="free">l</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> closedt.induct closedts.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons_term <span class="skolem">t</span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹closedt <span class="skolem">m</span> <span class="skolem">t</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closedts <span class="skolem">n</span> <span class="skolem">l</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≤</span> max <span class="skolem">m</span> <span class="skolem">n</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≤</span> max <span class="skolem">m</span> <span class="skolem">n</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹closedt <span class="main">(</span>max <span class="skolem">m</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">t</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closedts <span class="main">(</span>max <span class="skolem">m</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">l</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> closedt_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ex_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> closed <span class="bound">m</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> FF
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> TT
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Neg <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Impl <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> closed_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> closed_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> closed_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Exists <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹closed <span class="skolem">m</span> <span class="skolem">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="skolem">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> closed_mono Suc_n_not_le_n nat_le_linear <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Forall <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹closed <span class="skolem">m</span> <span class="skolem">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="skolem">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> closed_mono Suc_n_not_le_n nat_le_linear <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> ex_closure<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> closed <span class="main">0</span> <span class="main">(</span>put_unis <span class="bound">m</span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> remove_unis_sentence<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inf_params<span class="main">:</span> <span class="quoted"><span class="quoted">‹infinite <span class="main">(</span><span class="main">-</span> params <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span>put_unis <span class="free">m</span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[]</span> <span class="main">⊢</span> put_unis <span class="free">m</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[]</span> <span class="main">⊢</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> list›</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">cs</span> <span class="main">=</span> <span class="free">m</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹distinct <span class="skolem">cs</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> new <span class="bound">c</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">cs</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms finite_compl finite_params fresh_constants inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[]</span> <span class="main">⊢</span> consts_for_unis <span class="main">(</span>put_unis <span class="main">(</span>length <span class="skolem">cs</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">cs</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms consts_for_unis <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[]</span> <span class="main">⊢</span> vars_for_consts <span class="main">(</span>consts_for_unis <span class="main">(</span>put_unis <span class="main">(</span>length <span class="skolem">cs</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">cs</span><span class="main">)</span> <span class="skolem">cs</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> vars_for_consts inf_params <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹closed <span class="main">(</span>length <span class="skolem">cs</span><span class="main">)</span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹length <span class="skolem">cs</span> <span class="main">=</span> <span class="free">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[]</span> <span class="main">⊢</span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> vars_for_consts_for_unis * ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Completeness›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> completeness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> form›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">e</span> <span class="main">::</span> nat <span class="main">⇒</span> nat hterm<span class="main">)</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">e</span><span class="main">,</span> <span class="bound">f</span><span class="main">,</span> <span class="bound">g</span><span class="main">,</span> <span class="free">z</span> <span class="main">⊨</span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">⊢</span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹put_imps <span class="free">p</span> <span class="main">(</span>rev <span class="free">z</span><span class="main">)</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">e</span> <span class="main">::</span> nat <span class="main">⇒</span> nat hterm<span class="main">)</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> eval <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span> <span class="var">?p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms semantics_put_imps <span class="keyword1"><span class="command">unfolding</span></span> model_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">‹closed <span class="main">0</span> <span class="main">(</span>put_unis <span class="skolem">m</span> <span class="var">?p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_closure <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹list_all <span class="main">(</span>closed <span class="main">0</span><span class="main">)</span> <span class="main">[]</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">e</span> <span class="main">::</span> nat <span class="main">⇒</span> nat hterm<span class="main">)</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">e</span><span class="main">,</span> <span class="bound">f</span><span class="main">,</span> <span class="bound">g</span><span class="main">,</span> <span class="main">[]</span> <span class="main">⊨</span> put_unis <span class="skolem">m</span> <span class="var">?p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> * valid_put_unis <span class="keyword1"><span class="command">unfolding</span></span> model_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[]</span> <span class="main">⊢</span> put_unis <span class="skolem">m</span> <span class="var">?p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> natded_complete <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[]</span> <span class="main">⊢</span> <span class="var">?p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ** remove_unis_sentence <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">⊢</span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> remove_imps <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">valid</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="main">(</span><span class="bound">e</span> <span class="main">::</span> nat <span class="main">⇒</span> nat hterm<span class="main">)</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> eval <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1"><span class="command">proposition</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> form›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹valid <span class="free">p</span> <span class="main">⟹</span> eval <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> completeness correctness
  <span class="keyword1"><span class="command">unfolding</span></span> model_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.pred_inject<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">proposition</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>nat<span class="main">,</span> nat<span class="main">)</span> form›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">[]</span> <span class="main">⊢</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> valid <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> completeness correctness
  <span class="keyword1"><span class="command">unfolding</span></span> model_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">corollary</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">e</span> <span class="main">(</span><span class="bound">f</span><span class="main">::</span>nat <span class="main">⇒</span> nat hterm list <span class="main">⇒</span> nat hterm<span class="main">)</span> <span class="main">(</span><span class="bound">g</span><span class="main">::</span>nat <span class="main">⇒</span> nat hterm list <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span>
    <span class="bound">e</span><span class="main">,</span><span class="bound">f</span><span class="main">,</span><span class="bound">g</span><span class="main">,</span><span class="free">ps</span> <span class="main">⊨</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">ps</span> <span class="main">⊢</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> completeness<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>