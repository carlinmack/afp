<div id="Formulas">
<div class="head">
<h1>Theory Formulas</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Formulas›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Formulas
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Countable.html">HOL-Library.Countable</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* unrelated, but I need this in too many places. *)</span>
<span class="keyword1"><span class="command">notation</span></span> insert <span class="main">(</span><span class="quoted">"_ <span class="keyword1">▹</span> _"</span> <span class="main">[</span>56<span class="main">,</span>55<span class="main">]</span> 55<span class="main">)</span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span>atoms<span class="main">:</span> <span class="tfree">'a</span><span class="main">)</span> formula <span class="main">=</span> 
    Atom <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="main">|</span> Bot                              <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⊥</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>  
  <span class="main">|</span> Not <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span>                 <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">❙</span><b>¬</b></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
  <span class="main">|</span> And <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span>    <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">❙</span><b>∧</b></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 68<span class="main">)</span>
  <span class="main">|</span> Or <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span>     <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">❙</span><b>∨</b></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 68<span class="main">)</span>
  <span class="main">|</span> Imp <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span>    <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">❙</span><b>→</b></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 68<span class="main">)</span>
<span class="comment1">(* In a standard Isabelle/jEdit config, bold can be done with C-e rightarrow.
   I learned that way too late. *)</span>
<span class="comment1">(* I'm not sure I'm happy about the definition of what is an atom.
   I'm inclined to treat 'a as our atom type and call an Atom k an "atom formula",
   but this goes against anything the literature does. So, Atom k will be an atom,
   k its index, but there are probably a few cases where I call 'a an atom… *)</span>
<span class="comment1">(* like here: *)</span>
<span class="keyword1" id="Formulas-atoms_finite"><span class="command">lemma</span></span> atoms_finite<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>atoms <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">subformulae</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">subformulae</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">[</span><span class="main">⊥</span><span class="main">]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">subformulae</span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">subformulae</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">=</span> Not <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">#</span> <span class="free">subformulae</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">subformulae</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">#</span> <span class="free">subformulae</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">@</span> <span class="free">subformulae</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">subformulae</span> <span class="main">(</span>Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">#</span> <span class="free">subformulae</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">@</span> <span class="free">subformulae</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">subformulae</span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">#</span> <span class="free">subformulae</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">@</span> <span class="free">subformulae</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>

<span class="keyword1" id="Formulas-atoms_are_subformulae"><span class="command">lemma</span></span> atoms_are_subformulae<span class="main">:</span> <span class="quoted"><span class="quoted">"Atom <span class="main">`</span> atoms <span class="free">F</span> <span class="main">⊆</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main">)</span> <span class="operator">auto</span>
    
<span class="keyword1" id="Formulas-subsubformulae"><span class="command">lemma</span></span> subsubformulae<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">H</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">H</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span>
    
<span class="keyword1" id="Formulas-subformula_atoms"><span class="command">lemma</span></span> subformula_atoms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> atoms <span class="free">G</span> <span class="main">⊆</span> atoms <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main">)</span> <span class="operator">auto</span>
    
<span class="keyword1" id="Formulas-subformulae_self"><span class="command">lemma</span></span> subformulae_self<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Formulas-subformulas_in_subformulas"><span class="command">lemma</span></span> subformulas_in_subformulas<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free">H</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">G</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span> <span class="main">∧</span> <span class="free">H</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">H</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">G</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span> <span class="main">∧</span> <span class="free">H</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">H</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">G</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span> <span class="main">∧</span> <span class="free">H</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">G</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">G</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> subsubformulae<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Formulas-length_subformulae"><span class="command">lemma</span></span> length_subformulae<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span> <span class="main">=</span> size <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Derived Connectives›</span></span>
    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Top</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊤</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊤</span></span> <span class="main">≡</span> <span class="main">⊥</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>"</span></span>
<span class="keyword1" id="Formulas-top_atoms_simp"><span class="command">lemma</span></span> top_atoms_simp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"atoms <span class="main">⊤</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Top_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">BigAnd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula list <span class="main">⇒</span> <span class="tfree">'a</span> formula"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>⋀</b></span>_"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free"><span class="hidden">❙</span><b>⋀</b></span></span>Nil <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">⊥</span><span class="main">)</span>"</span></span> <span class="comment1">― ‹essentially, it doesn't matter what I use here. But since I want to use this in CNFs, implication is not a nice thing to have.›</span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free"><span class="hidden">❙</span><b>⋀</b></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Fs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>⋀</b></span></span><span class="free"><span class="bound"><span class="entity">Fs</span></span></span>"</span></span>

<span class="keyword1" id="Formulas-atoms_BigAnd"><span class="command">lemma</span></span> atoms_BigAnd<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"atoms <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="free">Fs</span><span class="main">)</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span>atoms <span class="main">`</span> set <span class="free">Fs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Fs</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">BigOr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula list <span class="main">⇒</span> <span class="tfree">'a</span> formula"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>⋁</b></span>_"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free"><span class="hidden">❙</span><b>⋁</b></span></span>Nil <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free"><span class="hidden">❙</span><b>⋁</b></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Fs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>⋁</b></span></span><span class="free"><span class="bound"><span class="entity">Fs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Formulas are countable if their atoms are, and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> countable_datatype<span class="antiquote"><span class="antiquote">}</span></span></span></span> is really helpful with that.›</span></span> 
<span class="keyword1"><span class="command">instance</span></span> formula <span class="main">::</span> <span class="main">(</span><span class="quoted">countable</span><span class="main">)</span> <span class="quoted">countable</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">countable_datatype</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">prod_unions</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">⇒</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">a</span> <span class="main">∪</span> <span class="bound">c</span><span class="main">,</span> <span class="bound">b</span> <span class="main">∪</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">pn_atoms</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">pn_atoms</span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">}</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pn_atoms</span> Bot <span class="main">=</span> <span class="main">(</span><span class="main">{}</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pn_atoms</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">=</span> prod.swap <span class="main">(</span><span class="free">pn_atoms</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pn_atoms</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> prod_unions <span class="main">(</span><span class="free">pn_atoms</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">pn_atoms</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pn_atoms</span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> prod_unions <span class="main">(</span><span class="free">pn_atoms</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">pn_atoms</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pn_atoms</span> <span class="main">(</span>Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> prod_unions <span class="main">(</span>prod.swap <span class="main">(</span><span class="free">pn_atoms</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">pn_atoms</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1" id="Formulas-pn_atoms_atoms"><span class="command">lemma</span></span> pn_atoms_atoms<span class="main">:</span> <span class="quoted"><span class="quoted">"atoms <span class="free">F</span> <span class="main">=</span> fst <span class="main">(</span>pn_atoms <span class="free">F</span><span class="main">)</span> <span class="main">∪</span> snd <span class="main">(</span>pn_atoms <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_unions_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A very trivial simplifier.
Does wonders as a postprocessor for the Harrison-style Craig interpolations.›</span></span>
<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">isstop</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">⊥</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">simplify_consts</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">simplify_consts</span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span> Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">simplify_consts</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">simplify_consts</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">S</span> <span class="main">=</span> <span class="free">simplify_consts</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="keyword1">in</span> <span class="keyword1">case</span> <span class="bound">S</span> <span class="keyword1">of</span> <span class="main">(</span>Not <span class="bound">G</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">G</span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span>
  <span class="keyword1">if</span> isstop <span class="bound">S</span> <span class="keyword1">then</span> <span class="main">⊥</span> <span class="keyword1">else</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="bound">S</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">simplify_consts</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">S</span> <span class="main">=</span> <span class="free">simplify_consts</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">;</span> <span class="bound">T</span> <span class="main">=</span> <span class="free">simplify_consts</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="keyword1">in</span> <span class="main">(</span>
  <span class="keyword1">if</span> <span class="bound">S</span> <span class="main">=</span> <span class="main">⊥</span> <span class="keyword1">then</span> <span class="main">⊥</span> <span class="keyword1">else</span>
  <span class="keyword1">if</span> isstop <span class="bound">S</span> <span class="keyword1">then</span> <span class="bound">T</span> <span class="comment1">― ‹not <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>⊤›</span></span>, <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>T›</span></span>›</span> <span class="keyword1">else</span>
  <span class="keyword1">if</span> <span class="bound">T</span> <span class="main">=</span> <span class="main">⊥</span> <span class="keyword1">then</span> <span class="main">⊥</span> <span class="keyword1">else</span>
  <span class="keyword1">if</span> isstop <span class="bound">T</span> <span class="keyword1">then</span> <span class="bound">S</span> <span class="keyword1">else</span>
  <span class="keyword1">if</span> <span class="bound">S</span> <span class="main">=</span> <span class="bound">T</span> <span class="keyword1">then</span> <span class="bound">S</span> <span class="keyword1">else</span>
  <span class="bound">S</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="bound">T</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">simplify_consts</span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">S</span> <span class="main">=</span> <span class="free">simplify_consts</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">;</span> <span class="bound">T</span> <span class="main">=</span> <span class="free">simplify_consts</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="keyword1">in</span> <span class="main">(</span>
  <span class="keyword1">if</span> <span class="bound">S</span> <span class="main">=</span> <span class="main">⊥</span> <span class="keyword1">then</span> <span class="bound">T</span> <span class="keyword1">else</span>
  <span class="keyword1">if</span> isstop <span class="bound">S</span> <span class="keyword1">then</span> <span class="main">⊤</span> <span class="keyword1">else</span>
  <span class="keyword1">if</span> <span class="bound">T</span> <span class="main">=</span> <span class="main">⊥</span> <span class="keyword1">then</span> <span class="bound">S</span> <span class="keyword1">else</span>
  <span class="keyword1">if</span> isstop <span class="bound">T</span> <span class="keyword1">then</span> <span class="main">⊤</span> <span class="keyword1">else</span>
  <span class="keyword1">if</span> <span class="bound">S</span> <span class="main">=</span> <span class="bound">T</span> <span class="keyword1">then</span> <span class="bound">S</span> <span class="keyword1">else</span>
  <span class="bound">S</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="bound">T</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">simplify_consts</span> <span class="main">(</span>Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">S</span> <span class="main">=</span> <span class="free">simplify_consts</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">;</span> <span class="bound">T</span> <span class="main">=</span> <span class="free">simplify_consts</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="keyword1">in</span> <span class="main">(</span>
  <span class="keyword1">if</span> <span class="bound">S</span> <span class="main">=</span> <span class="main">⊥</span> <span class="keyword1">then</span> <span class="main">⊤</span> <span class="keyword1">else</span>
  <span class="keyword1">if</span> isstop <span class="bound">S</span> <span class="keyword1">then</span> <span class="bound">T</span> <span class="keyword1">else</span>
  <span class="keyword1">if</span> isstop <span class="bound">T</span> <span class="keyword1">then</span> <span class="main">⊤</span> <span class="keyword1">else</span>
  <span class="keyword1">if</span> <span class="bound">T</span> <span class="main">=</span> <span class="main">⊥</span> <span class="keyword1">then</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="bound">S</span> <span class="keyword1">else</span>
  <span class="keyword1">if</span> <span class="bound">S</span> <span class="main">=</span> <span class="bound">T</span> <span class="keyword1">then</span> <span class="main">⊤</span> <span class="keyword1">else</span>
  <span class="keyword1">case</span> <span class="bound">S</span> <span class="keyword1">of</span> Not <span class="bound">H</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">T</span> <span class="keyword1">of</span> Not <span class="bound">I</span> <span class="main">⇒</span> 
    <span class="bound">I</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="bound">H</span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> 
    <span class="bound">H</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="bound">T</span><span class="main">)</span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span>
    <span class="bound">S</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="bound">T</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Formulas-simplify_consts_size_le"><span class="command">lemma</span></span> simplify_consts_size_le<span class="main">:</span> <span class="quoted"><span class="quoted">"size <span class="main">(</span>simplify_consts <span class="free">F</span><span class="main">)</span> <span class="main">≤</span> size <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> size <span class="skolem">F</span> <span class="main">+</span> size <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">G</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def isstop_def Top_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> formula.splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Formulas-simplify_const"><span class="command">lemma</span></span> simplify_const<span class="main">:</span> <span class="quoted"><span class="quoted">"atoms <span class="free">F</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> isstop <span class="main">(</span>simplify_consts <span class="free">F</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>simplify_consts <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def isstop_def Top_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> formula.splits<span class="main">)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>size <span class="main">⊤</span><span class="main">,</span> size <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">⊥</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="comment1">(* this is why I need isstop in this lemma and can't write simplify_consts
  in a way that this lemma can say ∈ {⊤, ⊥} *)</span>

<span class="keyword2"><span class="keyword">end</span></span>
  
<span class="comment1">(*
Here's a useful little function for testing a conjecture on "a few" examples: 
*)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">all_formulas_of_size</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">all_formulas_of_size</span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">{</span><span class="main">⊥</span><span class="main">}</span> <span class="main">∪</span> Atom <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">K</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">all_formulas_of_size</span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
  <span class="keyword1">let</span> <span class="bound">af</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span>set <span class="main">[</span><span class="free">all_formulas_of_size</span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="bound">m</span><span class="main">.</span> m <span class="main">←</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">]</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">in</span>
  <span class="main">(</span><span class="main">⋃</span><span class="bound">F</span><span class="main">∈</span><span class="bound">af</span><span class="main">.</span>
    <span class="main">(</span><span class="main">⋃</span><span class="bound">G</span><span class="main">∈</span><span class="bound">af</span><span class="main">.</span> <span class="keyword1">if</span> size <span class="bound">F</span> <span class="main">+</span> size <span class="bound">G</span> <span class="main">≤</span> Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="main">{</span>And <span class="bound">F</span> <span class="bound">G</span><span class="main">,</span> Or <span class="bound">F</span> <span class="bound">G</span><span class="main">,</span> Imp <span class="bound">F</span> <span class="bound">G</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span> 
   <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> size <span class="bound">F</span> <span class="main">≤</span> Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="main">{</span>Not <span class="bound">F</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">∪</span> <span class="bound">af</span><span class="main">)</span>"</span></span>
<span class="comment1">(* this set obviously grows exponentially (with a base of 5 approximately).
   size 7 produces 26032 formulas, which is probably the last value
   where I can test anything meaningfully with this implementation. *)</span>

<span class="keyword1" id="Formulas-all_formulas_of_size"><span class="command">lemma</span></span> all_formulas_of_size<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> all_formulas_of_size <span class="free">K</span> <span class="free">n</span> <span class="main">⟷</span> <span class="main">(</span>size <span class="free">F</span> <span class="main">≤</span> Suc <span class="free">n</span> <span class="main">∧</span> atoms <span class="free">F</span> <span class="main">⊆</span> <span class="free">K</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟷</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> rl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">⟹</span> <span class="var">?l</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">x</span> <span class="main">∈</span> all_formulas_of_size <span class="free">K</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Atom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">x</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span>all_formulas_of_size <span class="free">K</span> <span class="main">`</span> set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">m</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> atLeastLessThan_iff le_zero_eq not_le<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Bot
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Bot <span class="main">∈</span> all_formulas_of_size <span class="free">K</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"Bot <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span>all_formulas_of_size <span class="free">K</span> <span class="main">`</span> set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">m</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> atLeastLessThan_iff le_zero_eq not_le<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Bot <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Not <span class="skolem">F</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"size <span class="skolem">F</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Not <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Suc <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_1 formula.size_neq leD neq0_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Not <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> all_formulas_of_size <span class="free">K</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bexI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">F</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> And <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"size <span class="skolem">F</span> <span class="main">+</span> size <span class="skolem">G</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Suc <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_1 add_is_0 formula.size_neq le_zero_eq neq0_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nF</span></span> <span class="skolem"><span class="skolem">nG</span></span> <span class="keyword2"><span class="keyword">where</span></span> nFG<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"size <span class="skolem">F</span> <span class="main">≤</span> <span class="skolem">nF</span>"</span></span> <span class="quoted"><span class="quoted">"size <span class="skolem">G</span> <span class="main">≤</span> <span class="skolem">nG</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">nF</span> <span class="main">+</span> <span class="skolem">nG</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> * add.assoc nat_le_iff_add order_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mF</span></span> <span class="skolem"><span class="skolem">mG</span></span> <span class="keyword2"><span class="keyword">where</span></span> mFG<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nF</span> <span class="main">=</span> Suc <span class="skolem">mF</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nG</span> <span class="main">=</span> Suc <span class="skolem">mG</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_1 formula.size_neq leD neq0_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> And <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> all_formulas_of_size <span class="free">K</span> <span class="skolem">mF</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">∈</span> all_formulas_of_size <span class="free">K</span> <span class="skolem">mG</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> nFG <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?af</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>set <span class="main">[</span>all_formulas_of_size <span class="free">K</span> <span class="bound">m</span><span class="main">.</span> m <span class="main">←</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">m</span><span class="main">]</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> all_formulas_of_size <span class="free">K</span> <span class="skolem">mF</span> <span class="main">⟹</span> <span class="skolem">mF</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">(</span>set <span class="main">(</span>map <span class="main">(</span>all_formulas_of_size <span class="free">K</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">mF</span> <span class="skolem">n</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> af<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="var">?af</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">∈</span> <span class="var">?af</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nFG<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> IH<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> r<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">if</span> size <span class="skolem">F</span> <span class="main">+</span> size <span class="skolem">G</span> <span class="main">≤</span> Suc <span class="skolem">m</span> <span class="keyword1">then</span> <span class="main">{</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> IH * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> af <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> n all_formulas_of_size.simps Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> m<span class="main">)</span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Imp <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span> <span class="comment1">― ‹analogous›</span> <span class="comment1">(*&lt;*)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Or <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"size <span class="skolem">F</span> <span class="main">+</span> size <span class="skolem">G</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Suc <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_1 add_is_0 formula.size_neq le_zero_eq neq0_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nF</span></span> <span class="skolem"><span class="skolem">nG</span></span> <span class="keyword2"><span class="keyword">where</span></span> nFG<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"size <span class="skolem">F</span> <span class="main">≤</span> <span class="skolem">nF</span>"</span></span> <span class="quoted"><span class="quoted">"size <span class="skolem">G</span> <span class="main">≤</span> <span class="skolem">nG</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">nF</span> <span class="main">+</span> <span class="skolem">nG</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> * add.assoc nat_le_iff_add order_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mF</span></span> <span class="skolem"><span class="skolem">mG</span></span> <span class="keyword2"><span class="keyword">where</span></span> mFG<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nF</span> <span class="main">=</span> Suc <span class="skolem">mF</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nG</span> <span class="main">=</span> Suc <span class="skolem">mG</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_1 formula.size_neq leD neq0_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Or <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> all_formulas_of_size <span class="free">K</span> <span class="skolem">mF</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">∈</span> all_formulas_of_size <span class="free">K</span> <span class="skolem">mG</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> nFG <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?af</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>set <span class="main">[</span>all_formulas_of_size <span class="free">K</span> <span class="bound">m</span><span class="main">.</span> m <span class="main">←</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">m</span><span class="main">]</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> all_formulas_of_size <span class="free">K</span> <span class="skolem">mF</span> <span class="main">⟹</span> <span class="skolem">mF</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">(</span>set <span class="main">(</span>map <span class="main">(</span>all_formulas_of_size <span class="free">K</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">mF</span> <span class="skolem">n</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> af<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="var">?af</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">∈</span> <span class="var">?af</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nFG<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> IH<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> r<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"Or <span class="skolem">F</span> <span class="skolem">G</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">if</span> size <span class="skolem">F</span> <span class="main">+</span> size <span class="skolem">G</span> <span class="main">≤</span> Suc <span class="skolem">m</span> <span class="keyword1">then</span> <span class="main">{</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> IH * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> af <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> n all_formulas_of_size.simps Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> m<span class="main">)</span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Imp <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Imp <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"size <span class="skolem">F</span> <span class="main">+</span> size <span class="skolem">G</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Suc <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_1 add_is_0 formula.size_neq le_zero_eq neq0_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nF</span></span> <span class="skolem"><span class="skolem">nG</span></span> <span class="keyword2"><span class="keyword">where</span></span> nFG<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"size <span class="skolem">F</span> <span class="main">≤</span> <span class="skolem">nF</span>"</span></span> <span class="quoted"><span class="quoted">"size <span class="skolem">G</span> <span class="main">≤</span> <span class="skolem">nG</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">nF</span> <span class="main">+</span> <span class="skolem">nG</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> * add.assoc nat_le_iff_add order_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mF</span></span> <span class="skolem"><span class="skolem">mG</span></span> <span class="keyword2"><span class="keyword">where</span></span> mFG<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nF</span> <span class="main">=</span> Suc <span class="skolem">mF</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nG</span> <span class="main">=</span> Suc <span class="skolem">mG</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_1 formula.size_neq leD neq0_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Imp <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> all_formulas_of_size <span class="free">K</span> <span class="skolem">mF</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">∈</span> all_formulas_of_size <span class="free">K</span> <span class="skolem">mG</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> nFG <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?af</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>set <span class="main">[</span>all_formulas_of_size <span class="free">K</span> <span class="bound">m</span><span class="main">.</span> m <span class="main">←</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">m</span><span class="main">]</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> all_formulas_of_size <span class="free">K</span> <span class="skolem">mF</span> <span class="main">⟹</span> <span class="skolem">mF</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">(</span>set <span class="main">(</span>map <span class="main">(</span>all_formulas_of_size <span class="free">K</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">mF</span> <span class="skolem">n</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> af<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="var">?af</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">∈</span> <span class="var">?af</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nFG<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> IH<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> r<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"Imp <span class="skolem">F</span> <span class="skolem">G</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">if</span> size <span class="skolem">F</span> <span class="main">+</span> size <span class="skolem">G</span> <span class="main">≤</span> Suc <span class="skolem">m</span> <span class="keyword1">then</span> <span class="main">{</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> IH * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> af <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> n all_formulas_of_size.simps Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> m<span class="main">)</span> <span class="operator">fast</span>
  <span class="comment1">(*&gt;*)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> lr<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword2"><span class="keyword">if</span></span> l<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> all_formulas_of_size <span class="free">K</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">∈</span> all_formulas_of_size <span class="free">K</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"size <span class="free">F</span> <span class="main">≤</span> Suc <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"*"</span> le_SucI le_eq_less_or_eq le_iff_add<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"atoms <span class="free">F</span> <span class="main">⊆</span> <span class="free">K</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">x</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">with</span></span> less <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">y</span><span class="main">)</span> <span class="keyword1"><span class="command">with</span></span> less <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> all_formulas_of_size.simps Let_def<span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_Suc_eq <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> lr rl <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="comment1">(* At first I thought: why would I prove anything about all_formulas_of_size, I only want to test a conjecture with it.
   Guess why: it was broken.
   Granted, I spent too much time on this. *)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Sema">
<div class="head">
<h1>Theory Sema</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Semantics›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Sema
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Formulas.html">Formulas</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> valuation <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The implicit statement here is that an assignment or valuation is always defined on all atoms (because HOL is a total logic).
Thus, there are no unsuitable assignments.›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">formula_semantics</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> valuation <span class="main">⇒</span> <span class="tfree">'a</span> formula <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨</span>"</span> 51<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main"><span class="free">⊨</span></span> Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="main">⊥</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main"><span class="free">⊨</span></span> Not <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main"><span class="free">⊨</span></span> And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main"><span class="free">⊨</span></span> Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main"><span class="free">⊨</span></span> Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">valid</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊨</span> _"</span> 51<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊨</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span>

<span class="keyword1" id="Sema-irrelevant_atom"><span class="command">lemma</span></span> irrelevant_atom<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∉</span> atoms <span class="free">F</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">𝒜</span><span class="main">(</span><span class="free">A</span> <span class="main">:=</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span> <span class="main">⊨</span> <span class="free">F</span> <span class="main">⟷</span> <span class="free">𝒜</span> <span class="main">⊨</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1" id="Sema-relevant_atoms_same_semantics"><span class="command">lemma</span></span> relevant_atoms_same_semantics<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> atoms <span class="free">F</span><span class="main">.</span> <span class="free">𝒜<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">k</span> <span class="main">=</span> <span class="free">𝒜<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">k</span> <span class="main">⟹</span> <span class="free">𝒜<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊨</span> <span class="free">F</span> <span class="main">⟷</span> <span class="free">𝒜<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊨</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Just a definition more similar to~\cite[p. 5]{schoening1987logik}.
Unfortunately, using this as the main definition would get in the way of automated reasoning all the time.›</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">formula_semantics_alt</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">formula_semantics_alt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">formula_semantics_alt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">(</span>Bot<span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">formula_semantics_alt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">formula_semantics_alt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> False <span class="keyword1">else</span> True<span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">formula_semantics_alt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">formula_semantics_alt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="free">formula_semantics_alt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">else</span> False<span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">formula_semantics_alt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">formula_semantics_alt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> True <span class="keyword1">else</span> <span class="free">formula_semantics_alt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">formula_semantics_alt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">(</span>Imp <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">formula_semantics_alt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="free">formula_semantics_alt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">else</span> True<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"formula_semantics_alt <span class="free">𝒜</span> <span class="free">F</span> <span class="main">⟷</span> <span class="free">𝒜</span> <span class="main">⊨</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹If you fancy a definition more similar to~\cite[p. 39]{gallier2015logic},
this is probably the closest you can go without going incredibly ugly.›</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">formula_semantics_tt</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">formula_semantics_tt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">formula_semantics_tt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">(</span>Bot<span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">formula_semantics_tt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">formula_semantics_tt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">of</span> True <span class="main">⇒</span> False <span class="main">|</span> False <span class="main">⇒</span> True<span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">formula_semantics_tt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="free">formula_semantics_tt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> <span class="free">formula_semantics_tt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="keyword1">of</span>
  <span class="main">(</span>False<span class="main">,</span> False<span class="main">)</span> <span class="main">⇒</span> False
<span class="main">|</span> <span class="main">(</span>False<span class="main">,</span> True<span class="main">)</span> <span class="main">⇒</span> False
<span class="main">|</span> <span class="main">(</span>True<span class="main">,</span> False<span class="main">)</span> <span class="main">⇒</span> False
<span class="main">|</span> <span class="main">(</span>True<span class="main">,</span> True<span class="main">)</span> <span class="main">⇒</span> True<span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">formula_semantics_tt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="free">formula_semantics_tt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> <span class="free">formula_semantics_tt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="keyword1">of</span>
  <span class="main">(</span>False<span class="main">,</span> False<span class="main">)</span> <span class="main">⇒</span> False
<span class="main">|</span> <span class="main">(</span>False<span class="main">,</span> True<span class="main">)</span> <span class="main">⇒</span> True
<span class="main">|</span> <span class="main">(</span>True<span class="main">,</span> False<span class="main">)</span> <span class="main">⇒</span> True
<span class="main">|</span> <span class="main">(</span>True<span class="main">,</span> True<span class="main">)</span> <span class="main">⇒</span> True<span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">formula_semantics_tt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">(</span>Imp <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="free">formula_semantics_tt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> <span class="free">formula_semantics_tt</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="keyword1">of</span>
  <span class="main">(</span>False<span class="main">,</span> False<span class="main">)</span> <span class="main">⇒</span> True
<span class="main">|</span> <span class="main">(</span>False<span class="main">,</span> True<span class="main">)</span> <span class="main">⇒</span> True
<span class="main">|</span> <span class="main">(</span>True<span class="main">,</span> False<span class="main">)</span> <span class="main">⇒</span> False
<span class="main">|</span> <span class="main">(</span>True<span class="main">,</span> True<span class="main">)</span> <span class="main">⇒</span> True<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊨</span> <span class="free">F</span> <span class="main">⟷</span> formula_semantics_tt <span class="free">A</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits bool.splits<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">entailment</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula set <span class="main">⇒</span> <span class="tfree">'a</span> formula <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">⊫</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="comment1">(* \TTurnstile *)</span> <span class="main">[</span>53<span class="main">,</span>53<span class="main">]</span> 53<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊫</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">𝒜</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">G</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">.</span> <span class="bound">𝒜</span> <span class="main">⊨</span> <span class="bound">G</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">𝒜</span> <span class="main">⊨</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We write entailment differently than semantics (<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⊨›</span></span></span></span> vs. <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⊫›</span></span></span></span>).
For humans, it is usually pretty clear what is meant in a specific situation, 
but it often needs to be decided from context that Isabelle/HOL does not have.›</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Some helpers for the derived connectives›</span></span>
<span class="keyword1" id="Sema-top_semantics"><span class="command">lemma</span></span> top_semantics<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊨</span> <span class="main">⊤</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Top_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1" id="Sema-BigAnd_semantics"><span class="command">lemma</span></span> BigAnd_semantics<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="free">F</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> set <span class="free">F</span><span class="main">.</span> <span class="free">A</span> <span class="main">⊨</span> <span class="bound">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1" id="Sema-BigOr_semantics"><span class="command">lemma</span></span> BigOr_semantics<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⋁</b></span><span class="free">F</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span> <span class="main">∈</span> set <span class="free">F</span><span class="main">.</span> <span class="free">A</span> <span class="main">⊨</span> <span class="bound">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Definitions for sets of formulae, used for compactness and model existence.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">𝒜</span><span class="main">.</span> <span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="bound">𝒜</span> <span class="main">⊨</span> <span class="bound">F</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">fin_sat</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">s</span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> finite <span class="bound">s</span> <span class="main">⟶</span> sat <span class="bound">s</span><span class="main">)</span>"</span></span>
  
<span class="keyword1" id="Sema-entail_sat"><span class="command">lemma</span></span> entail_sat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊫</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="main">¬</span> sat <span class="free">Γ</span>"</span></span> <span class="comment1">(* btw. *)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> sat_def entailment_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Sema-pn_atoms_updates"><span class="command">lemma</span></span> pn_atoms_updates<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∉</span> snd <span class="main">(</span>pn_atoms <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∉</span> fst <span class="main">(</span>pn_atoms <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span><span class="free">M</span> <span class="main">⊨</span> <span class="free">F</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">M</span><span class="main">(</span><span class="free">p</span> <span class="main">:=</span> True<span class="main">)</span> <span class="main">⊨</span> <span class="free">F</span> <span class="main">∧</span> <span class="free">M</span><span class="main">(</span><span class="free">n</span> <span class="main">:=</span> False<span class="main">)</span> <span class="main">⊨</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="free">M</span> <span class="main">⊨</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span><span class="main">(</span><span class="free">M</span><span class="main">(</span><span class="free">n</span> <span class="main">:=</span> True<span class="main">)</span> <span class="main">⊨</span> <span class="free">F</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="free">M</span><span class="main">(</span><span class="free">p</span> <span class="main">:=</span> False<span class="main">)</span> <span class="main">⊨</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Imp <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Imp.prems <span class="keyword1"><span class="command">have</span></span> prems<span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> fst <span class="main">(</span>pn_atoms <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> snd <span class="main">(</span>pn_atoms <span class="skolem">G</span><span class="main">)</span>"</span></span>
     <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> snd <span class="main">(</span>pn_atoms <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> fst <span class="main">(</span>pn_atoms <span class="skolem">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_unions_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> IH1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> True<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> False<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">M</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> True<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">M</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> False<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Imp.IH<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> IH2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊨</span> <span class="skolem">G</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> True<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊨</span> <span class="skolem">G</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> False<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M</span> <span class="main">⊨</span> <span class="skolem">G</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">M</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> True<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M</span> <span class="main">⊨</span> <span class="skolem">G</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">M</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> False<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">G</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Imp.IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
   <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> conjI<span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> impI<span class="main">)</span>
     <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span>"</span></span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊨</span><span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> True<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span> <span class="main">∧</span> <span class="free">M</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> False<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH1<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> IH2<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">cases</span> <span class="operator">simp_all</span>
   <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">M</span> <span class="main">⊨</span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
     <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> True<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">M</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> False<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH1<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> IH2<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> And.prems <span class="keyword1"><span class="command">have</span></span> prems<span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> snd <span class="main">(</span>pn_atoms <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> snd <span class="main">(</span>pn_atoms <span class="skolem">G</span><span class="main">)</span>"</span></span>
     <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> fst <span class="main">(</span>pn_atoms <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> fst <span class="main">(</span>pn_atoms <span class="skolem">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_unions_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> IH1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> True<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> False<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">M</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> True<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">M</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> False<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> And.IH<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> IH2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊨</span> <span class="skolem">G</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> True<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊨</span> <span class="skolem">G</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> False<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M</span> <span class="main">⊨</span> <span class="skolem">G</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">M</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> True<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M</span> <span class="main">⊨</span> <span class="skolem">G</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">M</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> False<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">G</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> And.IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> conjI<span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M</span> <span class="main">⊨</span><span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> True<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">M</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> False<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH1 IH2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">cases</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊨</span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> True<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span> <span class="main">∧</span> <span class="free">M</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> False<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> IH1 IH2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Or.prems <span class="keyword1"><span class="command">have</span></span> prems<span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> snd <span class="main">(</span>pn_atoms <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> snd <span class="main">(</span>pn_atoms <span class="skolem">G</span><span class="main">)</span>"</span></span>
     <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> fst <span class="main">(</span>pn_atoms <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> fst <span class="main">(</span>pn_atoms <span class="skolem">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_unions_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> IH1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> True<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> False<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">M</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> True<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">M</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> False<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Or.IH<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> IH2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊨</span> <span class="skolem">G</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> True<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊨</span> <span class="skolem">G</span> <span class="main">⟹</span> <span class="free">M</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> False<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M</span> <span class="main">⊨</span> <span class="skolem">G</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">M</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> True<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M</span> <span class="main">⊨</span> <span class="skolem">G</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">M</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> False<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">G</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Or.IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> conjI<span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊨</span><span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> True<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span> <span class="main">∧</span> <span class="free">M</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> False<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH1 IH2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">cases</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">M</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">M</span> <span class="main">⊨</span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">M</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> True<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span> <span class="main">∧</span> <span class="main">¬</span><span class="free">M</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> False<span class="main">)</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> IH1 IH2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  
<span class="keyword1" id="Sema-const_simplifier_correct"><span class="command">lemma</span></span> const_simplifier_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊨</span> simplify_consts <span class="free">F</span> <span class="main">⟷</span> <span class="free">𝒜</span> <span class="main">⊨</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def isstop_def Top_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> formula.splits<span class="main">)</span> 
 
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Substitution">
<div class="head">
<h1>Theory Substitution</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Substitutions›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Substitution
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Formulas.html">Formulas</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">subst</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="keyword1">else</span> Atom <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">term</span></span> <span class="quoted">subst</span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">subst_syntax</span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">[</span><span class="keyword3">/</span><span class="keyword3">(</span>_<span class="keyword3">/</span><span class="keyword1">'/</span><span class="keyword3">/</span>_<span class="keyword3">)</span><span class="keyword1">]</span><span class="keyword3">)</span>"</span> <span class="main">[</span>70<span class="main">,</span>70<span class="main">]</span> 69<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main"><span class="free">/</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">≡</span> subst <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1" id="Substitution-no_subst"><span class="command">lemma</span></span> no_subst<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∉</span> atoms <span class="free">F</span> <span class="main">⟹</span> <span class="free">F</span><span class="main">[</span><span class="free">G</span> <span class="main">/</span> <span class="free">k</span><span class="main">]</span> <span class="main">=</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1" id="Substitution-subst_atoms"><span class="command">lemma</span></span> subst_atoms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> atoms <span class="free">F</span> <span class="main">⟹</span> atoms <span class="main">(</span><span class="free">F</span><span class="main">[</span><span class="free">G</span> <span class="main">/</span> <span class="free">k</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> atoms <span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="free">k</span><span class="main">}</span> <span class="main">∪</span> atoms <span class="free">G</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> atoms <span class="skolem">F</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> atoms <span class="skolem">F</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Imp <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> atoms <span class="skolem">F</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command">next</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Substitution-subst_atoms_simp"><span class="command">lemma</span></span> subst_atoms_simp<span class="main">:</span> <span class="quoted"><span class="quoted">"atoms <span class="main">(</span><span class="free">F</span><span class="main">[</span><span class="free">G</span> <span class="main">/</span> <span class="free">k</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> atoms <span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="free">k</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">k</span> <span class="main">∈</span> atoms <span class="free">F</span> <span class="keyword1">then</span> atoms <span class="free">G</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_atoms<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Substitution_Sema">
<div class="head">
<h1>Theory Substitution_Sema</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Substitution_Sema
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Substitution.html">Substitution</a> <a href="Sema.html">Sema</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Substitution_Sema-substitution_lemma"><span class="command">lemma</span></span> substitution_lemma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊨</span> <span class="free">F</span><span class="main">[</span><span class="free">G</span> <span class="main">/</span> <span class="free">n</span><span class="main">]</span> <span class="main">⟷</span> <span class="free">𝒜</span><span class="main">(</span><span class="free">n</span> <span class="main">:=</span> <span class="free">𝒜</span> <span class="main">⊨</span> <span class="free">G</span><span class="main">)</span> <span class="main">⊨</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="CNF">
<div class="head">
<h1>Theory CNF</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Conjunctive Normal Forms›</span></span>
<span class="keyword1"><span class="command">theory</span></span> CNF
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Simps_Case_Conv.html">HOL-Library.Simps_Case_Conv</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> literal <span class="main">=</span> Pos <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">⇧</span><sup>+</sup></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span> <span class="main">|</span> Neg <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">¯</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> clause <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> literal set"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">empty_clause</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">□</span>"</span> <span class="comment1">(* \box *)</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">□</span></span> <span class="main">≡</span> <span class="main">{}</span> <span class="main">::</span> <span class="tfree">'a</span> clause"</span></span>
<span class="comment1">(* unfortunately, we'll also have those as lists, occasionally. *)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">atoms_of_lit</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">atoms_of_lit</span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">atoms_of_lit</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span>
<span class="keyword1"><span class="command">case_of_simps</span></span> lit_atoms_cases<span class="main">:</span> atoms_of_lit.simps

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">atoms_of_cnf</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> atoms_of_lit <span class="main">`</span> <span class="main">⋃</span><span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="keyword1" id="CNF-atoms_of_cnf_alt"><span class="command">lemma</span></span> atoms_of_cnf_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"atoms_of_cnf <span class="free">c</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">(`)</span> atoms_of_lit<span class="main">)</span> <span class="main">`</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> atoms_of_cnf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="comment1">(* alt as in the German alt *)</span>

<span class="keyword1" id="CNF-atoms_of_cnf_Un"><span class="command">lemma</span></span> atoms_of_cnf_Un<span class="main">:</span> <span class="quoted"><span class="quoted">"atoms_of_cnf <span class="main">(</span><span class="free">S</span> <span class="main">∪</span> <span class="free">T</span><span class="main">)</span> <span class="main">=</span> atoms_of_cnf <span class="free">S</span> <span class="main">∪</span> atoms_of_cnf <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> atoms_of_cnf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* unbreak set printing *)</span>
<span class="keyword1"><span class="command">term</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">}</span><span class="main">::</span>nat clause"</span></span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> insert <span class="free">x</span> <span class="main">□</span>"</span>
<span class="keyword1"><span class="command">term</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">}</span><span class="main">::</span>nat clause"</span></span>
<span class="comment1">(* hope nobody ever loads this with some other definition for □ *)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="CNF_Formulas">
<div class="head">
<h1>Theory CNF_Formulas</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹CNFs alone are nice, but now we want to relate between CNFs and formulas.›</span></span>
<span class="keyword1"><span class="command">theory</span></span> CNF_Formulas
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Formulas.html">Formulas</a> <a href="CNF.html">CNF</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* attempts to eliminate ⊥ from formulas while converting to nnf have been made.
But that just gives you additional cases. So nnfs and cnfs will contain ⊥ *)</span> 

<span class="keyword1"><span class="command">function</span></span> <span class="main">(</span>sequential<span class="main">)</span> <span class="entity">nnf</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">nnf</span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nnf</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nnf</span> <span class="main">(</span>Not <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Or <span class="main">(</span><span class="free">nnf</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">nnf</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nnf</span> <span class="main">(</span>Not <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> And <span class="main">(</span><span class="free">nnf</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">nnf</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nnf</span> <span class="main">(</span>Not <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">nnf</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nnf</span> <span class="main">(</span>Not <span class="main">(</span>Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> And <span class="main">(</span><span class="free">nnf</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">nnf</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nnf</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nnf</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> And <span class="main">(</span><span class="free">nnf</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">nnf</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nnf</span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> Or <span class="main">(</span><span class="free">nnf</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">nnf</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nnf</span> <span class="main">(</span>Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> Or <span class="main">(</span><span class="free">nnf</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">nnf</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">pat_completeness</span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">fun</span></span> <span class="entity">nnf_cost</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">nnf_cost</span> <span class="main">(</span>Atom <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="numeral">42</span>"</span></span> <span class="main">|</span> 
<span class="quoted"><span class="quoted">"<span class="free">nnf_cost</span> <span class="main">⊥</span> <span class="main">=</span> <span class="numeral">42</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nnf_cost</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">nnf_cost</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nnf_cost</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">nnf_cost</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">+</span> <span class="free">nnf_cost</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nnf_cost</span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">nnf_cost</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">+</span> <span class="free">nnf_cost</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nnf_cost</span> <span class="main">(</span>Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">nnf_cost</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">+</span> <span class="free">nnf_cost</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="comment1">(* this is why *)</span>

<span class="keyword1"><span class="command">termination</span></span> <span class="quoted">nnf</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span><span class="main">λ</span><span class="bound">F</span><span class="main">.</span> nnf_cost <span class="bound">F</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"nnf <span class="main">(</span><span class="main">(</span>Atom <span class="main">(</span><span class="free">k</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span>Not <span class="main">(</span><span class="main">(</span>Atom <span class="free">l</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span>Not <span class="main">(</span>Atom <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="free">k</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="free">l</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> Atom <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">code_simp</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_lit_plus</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_lit_plus</span> <span class="main">⊥</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">is_lit_plus</span> <span class="main">(</span>Not <span class="main">⊥</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">is_lit_plus</span> <span class="main">(</span>Atom <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">is_lit_plus</span> <span class="main">(</span>Not <span class="main">(</span>Atom <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">is_lit_plus</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span>
<span class="keyword1"><span class="command">case_of_simps</span></span> is_lit_plus_cases<span class="main">:</span> is_lit_plus.simps
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_disj</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* It is crucial for this to be a (right) deep tree for the proof of LSC ⟹ Res
  At some point, we obtain a subset A where A is in a disjunction from (A ∨ B). 
  Now, resolution is at a loss because you can't say anything about the subset.
  If, however, that subset is sandwiched between a literal and the empty clause,
  you can just cover all the cases. *)</span>
<span class="quoted"><span class="quoted">"<span class="free">is_disj</span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>is_lit_plus <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> <span class="free">is_disj</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">is_disj</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span> is_lit_plus <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_cnf</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* here, we do want to allow arbitrary trees of ∧.
  If we do not do that, the proofs in LSC_Resolution won't work,
  since it relies on the ∧ case being just
  a simple split in LSC and union in Resolution.
  It is possible that that is fixable, but at what cost? *)</span>
<span class="quoted"><span class="quoted">"<span class="free">is_cnf</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">is_cnf</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> <span class="free">is_cnf</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">is_cnf</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> is_disj <span class="free"><span class="bound"><span class="entity">H</span></span></span>"</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_nnf</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_nnf</span> <span class="main">(</span>Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">is_nnf</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">is_nnf</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> <span class="free">is_nnf</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">is_nnf</span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">is_nnf</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> <span class="free">is_nnf</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">is_nnf</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span> is_lit_plus <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span>

<span class="keyword1" id="CNF_Formulas-is_nnf_nnf"><span class="command">lemma</span></span> is_nnf_nnf<span class="main">:</span> <span class="quoted"><span class="quoted">"is_nnf <span class="main">(</span>nnf <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nnf.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1" id="CNF_Formulas-nnf_no_imp"><span class="command">lemma</span></span> nnf_no_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">B</span> <span class="main">∉</span> set <span class="main">(</span>subformulae <span class="main">(</span>nnf <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nnf.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1" id="CNF_Formulas-subformulae_nnf"><span class="command">lemma</span></span> subformulae_nnf<span class="main">:</span> <span class="quoted"><span class="quoted">"is_nnf <span class="free">F</span> <span class="main">⟹</span> <span class="free">G</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> is_nnf <span class="free">G</span>"</span></span> <span class="comment1">(* fun fact *)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> is_nnf.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_lit_plus_cases <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> formula.splits<span class="main"><span class="keyword3">;</span></span> <span class="operator">elim</span> disjE conjE<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1" id="CNF_Formulas-is_nnf_NotD"><span class="command">lemma</span></span> is_nnf_NotD<span class="main">:</span> <span class="quoted"><span class="quoted">"is_nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="free">F</span> <span class="main">=</span> Atom <span class="bound">k</span><span class="main">)</span> <span class="main">∨</span> <span class="free">F</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">cnf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula <span class="main">⇒</span> <span class="tfree">'a</span> clause set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">cnf</span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">}</span><span class="main">}</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">cnf</span> <span class="main">(</span>Not <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">¯</span> <span class="main">}</span><span class="main">}</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">cnf</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">{</span><span class="main">□</span><span class="main">}</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">cnf</span> <span class="main">(</span>Not <span class="main">⊥</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>  <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">cnf</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">cnf</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∪</span> <span class="free">cnf</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>  <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">cnf</span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">C</span> <span class="main">∪</span> <span class="bound">D</span><span class="main">|</span> <span class="bound">C</span> <span class="bound">D</span><span class="main">.</span> <span class="bound">C</span> <span class="main">∈</span> <span class="main">(</span><span class="free">cnf</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">D</span> <span class="main">∈</span> <span class="main">(</span><span class="free">cnf</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="CNF_Formulas-cnf_fin"><span class="command">lemma</span></span> cnf_fin<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_nnf <span class="free">F</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cnf <span class="free">F</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">∈</span> cnf <span class="free">F</span> <span class="main">⟹</span> finite <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cnf <span class="free">F</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">C</span> <span class="main">∈</span> cnf <span class="free">F</span> <span class="main">⟶</span> finite <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> cnf.induct<span class="main"><span class="keyword3">;</span></span>  <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_image_set2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cnf <span class="free">F</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">∈</span> cnf <span class="free">F</span> <span class="main">⟹</span> finite <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Sets, as produced by @{const cnf} can be hard to handle.
   Less because of their infinity, more because of their lack of explicit order. *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">cnf_lists</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula <span class="main">⇒</span> <span class="tfree">'a</span> literal list list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">cnf_lists</span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="main">[</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">]</span><span class="main">]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">cnf_lists</span> <span class="main">(</span>Not <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="main">[</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">¯</span> <span class="main">]</span><span class="main">]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">cnf_lists</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">[</span><span class="main">[]</span><span class="main">]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">cnf_lists</span> <span class="main">(</span>Not <span class="main">⊥</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>  <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">cnf_lists</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">cnf_lists</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">@</span> <span class="free">cnf_lists</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>  <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">cnf_lists</span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="bound">f</span> <span class="main">@</span> <span class="bound">g</span><span class="main">.</span> f <span class="main">←</span> <span class="main">(</span><span class="free">cnf_lists</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">,</span> g <span class="main">←</span> <span class="main">(</span><span class="free">cnf_lists</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">form_of_lit</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">form_of_lit</span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span> Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">form_of_lit</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">case_of_simps</span></span> form_of_lit_cases<span class="main">:</span> form_of_lit.simps

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">disj_of_clause</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> <span class="main"><span class="hidden">❙</span><b>⋁</b></span><span class="main">[</span>form_of_lit <span class="bound">l</span><span class="main">.</span> l <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">form_of_cnf</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="main">[</span>disj_of_clause <span class="bound">c</span><span class="main">.</span> c <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">cnf_form_of</span> <span class="main">≡</span> form_of_cnf <span class="main">∘</span> cnf_lists"</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> cnf_form_of_defs <span class="main">=</span> cnf_form_of_def form_of_cnf_def disj_of_clause_def

<span class="keyword1" id="CNF_Formulas-disj_of_clause_simps"><span class="command">lemma</span></span> disj_of_clause_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"disj_of_clause <span class="main">[]</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="quoted"><span class="quoted">"disj_of_clause <span class="main">(</span><span class="free">F</span><span class="main">#</span><span class="free">FF</span><span class="main">)</span> <span class="main">=</span> form_of_lit <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="free">FF</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disj_of_clause_def<span class="main">)</span>

<span class="keyword1" id="CNF_Formulas-is_cnf_BigAnd"><span class="command">lemma</span></span> is_cnf_BigAnd<span class="main">:</span> <span class="quoted"><span class="quoted">"is_cnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="free">ls</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="main">∈</span> set <span class="free">ls</span><span class="main">.</span> is_cnf <span class="bound">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ls</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="CNF_Formulas-BigOr_is_not_cnf''"><span class="command">lemma</span></span> BigOr_is_not_cnf''<span class="main">:</span> <span class="quoted"><span class="quoted">"is_cnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⋁</b></span><span class="free">ls</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="main">∈</span> set <span class="free">ls</span><span class="main">.</span> is_lit_plus <span class="bound">l</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ls</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">l</span> <span class="skolem">ls</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_cnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⋁</b></span> <span class="skolem">ls</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BigOr.simps is_cnf.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span> is_disj.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.exhaust<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="CNF_Formulas-BigOr_is_not_cnf'"><span class="command">lemma</span></span> BigOr_is_not_cnf'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="main">∈</span> set <span class="free">ls</span><span class="main">.</span> is_lit_plus <span class="bound">l</span><span class="main">)</span> <span class="main">⟹</span> is_cnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⋁</b></span><span class="free">ls</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ls</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> BigOr.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span> 2<span class="main"><span class="main">)</span></span> formula.distinct<span class="main"><span class="main">(</span></span>25<span class="main"><span class="main">)</span></span> is_cnf.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_cnf.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list.exhaust<span class="main">)</span>
  <span class="comment1">(* ugh *)</span>
<span class="keyword1" id="CNF_Formulas-BigOr_is_not_cnf"><span class="command">lemma</span></span> BigOr_is_not_cnf<span class="main">:</span> <span class="quoted"><span class="quoted">"is_cnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⋁</b></span><span class="free">ls</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="main">∈</span> set <span class="free">ls</span><span class="main">.</span> is_lit_plus <span class="bound">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> BigOr_is_not_cnf' BigOr_is_not_cnf'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="CNF_Formulas-is_nnf_BigAnd"><span class="command">lemma</span></span> is_nnf_BigAnd<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="free">ls</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="main">∈</span> set <span class="free">ls</span><span class="main">.</span> is_nnf <span class="bound">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ls</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1" id="CNF_Formulas-is_nnf_BigOr"><span class="command">lemma</span></span> is_nnf_BigOr<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⋁</b></span><span class="free">ls</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="main">∈</span> set <span class="free">ls</span><span class="main">.</span> is_nnf <span class="bound">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ls</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1" id="CNF_Formulas-form_of_lit_is_nnf"><span class="command">lemma</span></span> form_of_lit_is_nnf<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_nnf <span class="main">(</span>form_of_lit <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1" id="CNF_Formulas-form_of_lit_is_lit"><span class="command">lemma</span></span> form_of_lit_is_lit<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_lit_plus <span class="main">(</span>form_of_lit <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1" id="CNF_Formulas-disj_of_clause_is_nnf"><span class="command">lemma</span></span> disj_of_clause_is_nnf<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_nnf <span class="main">(</span>disj_of_clause <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> disj_of_clause_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="CNF_Formulas-cnf_form_of_is"><span class="command">lemma</span></span> cnf_form_of_is<span class="main">:</span> <span class="quoted"><span class="quoted">"is_nnf <span class="free">F</span> <span class="main">⟹</span> is_cnf <span class="main">(</span>cnf_form_of <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">F</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cnf_form_of_defs is_cnf_BigAnd BigOr_is_not_cnf<span class="main">)</span>

<span class="keyword1" id="CNF_Formulas-nnf_cnf_form"><span class="command">lemma</span></span> nnf_cnf_form<span class="main">:</span> <span class="quoted"><span class="quoted">"is_nnf <span class="free">F</span> <span class="main">⟹</span> is_nnf <span class="main">(</span>cnf_form_of <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">F</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cnf_form_of_defs<span class="main">)</span>

<span class="keyword1" id="CNF_Formulas-cnf_BigAnd"><span class="command">lemma</span></span> cnf_BigAnd<span class="main">:</span> <span class="quoted"><span class="quoted">"cnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="free">ls</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> set <span class="free">ls</span><span class="main">.</span> cnf <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ls</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="CNF_Formulas-cnf_BigOr"><span class="command">lemma</span></span> cnf_BigOr<span class="main">:</span> <span class="quoted"><span class="quoted">"cnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⋁</b></span> <span class="main">(</span><span class="free">x</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="main">{</span><span class="bound">f</span> <span class="main">∪</span> <span class="bound">g</span> <span class="main">|</span><span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> cnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⋁</b></span><span class="free">x</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">g</span> <span class="main">∈</span> cnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⋁</b></span><span class="free">y</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> sup.assoc<span class="main">)</span>

<span class="keyword1" id="CNF_Formulas-cnf_cnf"><span class="command">lemma</span></span> cnf_cnf<span class="main">:</span> <span class="quoted"><span class="quoted">"is_nnf <span class="free">F</span> <span class="main">⟹</span> cnf <span class="main">(</span>cnf_form_of <span class="free">F</span><span class="main">)</span> <span class="main">=</span> cnf <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> cnf.induct<span class="main"><span class="keyword3">;</span></span> 
     <span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cnf_form_of_defs cnf_BigAnd cnf_BigOr<span class="main">)</span>
<span class="comment1">(* this is not an idempotency (is that a word?) lemma, since cnf_form_of is not idempotent. *)</span>

<span class="keyword1" id="CNF_Formulas-is_nnf_nnf_id"><span class="command">lemma</span></span> is_nnf_nnf_id<span class="main">:</span> <span class="quoted"><span class="quoted">"is_nnf <span class="free">F</span> <span class="main">⟹</span> nnf <span class="free">F</span> <span class="main">=</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> is_nnf.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> is_lit_plus.cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  
<span class="keyword1" id="CNF_Formulas-disj_of_clause_is"><span class="command">lemma</span></span> disj_of_clause_is<span class="main">:</span> <span class="quoted"><span class="quoted">"is_disj <span class="main">(</span>disj_of_clause <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">R</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
    
<span class="keyword1" id="CNF_Formulas-form_of_cnf_is_nnf"><span class="command">lemma</span></span> form_of_cnf_is_nnf<span class="main">:</span> <span class="quoted"><span class="quoted">"is_nnf <span class="main">(</span>form_of_cnf <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> form_of_cnf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
<span class="keyword1" id="CNF_Formulas-cnf_disj"><span class="command">lemma</span></span> cnf_disj<span class="main">:</span> <span class="quoted"><span class="quoted">"cnf <span class="main">(</span>disj_of_clause <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>set <span class="free">R</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">R</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> form_of_lit_cases <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> literal.splits<span class="main">)</span>
<span class="keyword1" id="CNF_Formulas-cnf_disj_ex"><span class="command">lemma</span></span> cnf_disj_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"is_disj <span class="free">F</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">R</span><span class="main">.</span> cnf <span class="free">F</span> <span class="main">=</span> <span class="main">{</span><span class="bound">R</span><span class="main">}</span> <span class="main">∨</span> cnf <span class="free">F</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> is_disj.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_lit_plus_cases <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> formula.splits<span class="main">)</span>
    
    
<span class="keyword1" id="CNF_Formulas-cnf_form_of_cnf"><span class="command">lemma</span></span> cnf_form_of_cnf<span class="main">:</span> <span class="quoted"><span class="quoted">"cnf <span class="main">(</span>form_of_cnf <span class="free">S</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>map set <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> form_of_cnf_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cnf_BigAnd cnf_disj<span class="main">)</span> <span class="operator">blast</span>
    
<span class="keyword1" id="CNF_Formulas-disj_is_nnf"><span class="command">lemma</span></span> disj_is_nnf<span class="main">:</span> <span class="quoted"><span class="quoted">"is_disj <span class="free">F</span> <span class="main">⟹</span> is_nnf <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> is_disj.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_lit_plus_cases <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> formula.splits<span class="main">)</span>
    
<span class="keyword1" id="CNF_Formulas-nnf_BigAnd"><span class="command">lemma</span></span> nnf_BigAnd<span class="main">:</span> <span class="quoted"><span class="quoted">"nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="main">(</span>map nnf <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="CNF_Sema">
<div class="head">
<h1>Theory CNF_Sema</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> CNF_Sema
<span class="keyword2"><span class="keyword">imports</span></span> <a href="CNF.html">CNF</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* 'a ⇒ bool is a valuation, but I do not want to include Sema just for that… *)</span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">lit_semantics</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> literal <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">lit_semantics</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">lit_semantics</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">¯</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span><span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">case_of_simps</span></span> lit_semantics_cases<span class="main">:</span> lit_semantics.simps
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">clause_semantics</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">clause_semantics</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">L</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">.</span> lit_semantics <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="bound">L</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cnf_semantics</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cnf_semantics</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">C</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> clause_semantics <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="bound">C</span>"</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="CNF_Formulas_Sema">
<div class="head">
<h1>Theory CNF_Formulas_Sema</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> CNF_Formulas_Sema
<span class="keyword2"><span class="keyword">imports</span></span> <a href="CNF_Sema.html">CNF_Sema</a> <a href="CNF_Formulas.html">CNF_Formulas</a> <a href="Sema.html">Sema</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="CNF_Formulas_Sema-nnf_semantics"><span class="command">lemma</span></span> nnf_semantics<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊨</span> nnf <span class="free">F</span> <span class="main">⟷</span> <span class="free">𝒜</span> <span class="main">⊨</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nnf.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  
<span class="keyword1" id="CNF_Formulas_Sema-cnf_semantics"><span class="command">lemma</span></span> cnf_semantics<span class="main">:</span> <span class="quoted"><span class="quoted">"is_nnf <span class="free">F</span> <span class="main">⟹</span> cnf_semantics <span class="free">𝒜</span> <span class="main">(</span>cnf <span class="free">F</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">𝒜</span> <span class="main">⊨</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> cnf.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cnf_semantics_def clause_semantics_def ball_Un<span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> Un_iff<span class="main">)</span>
  <span class="comment1">(* surprisingly, the solvers are smarter if this one is done on mutlisets.*)</span>

<span class="keyword1" id="CNF_Formulas_Sema-cnf_form_semantics"><span class="command">lemma</span></span> cnf_form_semantics<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nnf<span class="main">:</span> <span class="quoted"><span class="quoted">"is_nnf <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊨</span> cnf_form_of <span class="free">F</span> <span class="main">⟷</span> <span class="free">𝒜</span> <span class="main">⊨</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cnf_semantics_list</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cnf_semantics_list</span> <span class="skolem">𝒜</span> <span class="skolem">S</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="main">∈</span> set <span class="skolem">S</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l</span> <span class="main">∈</span> set <span class="bound">s</span><span class="main">.</span> lit_semantics <span class="skolem">𝒜</span> <span class="main">(</span><span class="bound">l</span> <span class="main">::</span> <span class="tfree">'a</span> literal<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝒜</span> <span class="skolem">S</span>
  <span class="keyword1"><span class="command">have</span></span> tcn<span class="main">:</span> <span class="quoted"><span class="quoted">"cnf <span class="free">F</span> <span class="main">=</span> set <span class="main">(</span>map set <span class="main">(</span>cnf_lists <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nnf
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> cnf.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_UN image_comp comp_def <span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊨</span> <span class="free">F</span> <span class="main">⟷</span> cnf_semantics <span class="free">𝒜</span> <span class="main">(</span>cnf <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cnf_semantics<span class="main">[</span><span class="operator">OF</span> nnf<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cnf_semantics <span class="free">𝒜</span> <span class="main">(</span>set <span class="main">(</span>map set <span class="main">(</span>cnf_lists <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tcn <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">cnf_semantics_list</span> <span class="free">𝒜</span> <span class="main">(</span>cnf_lists <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cnf_semantics_def clause_semantics_def cnf_semantics_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">𝒜</span> <span class="main">⊨</span> <span class="main">(</span>cnf_form_of <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nnf
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> cnf_lists.induct<span class="main"><span class="keyword3">;</span></span>
       <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cnf_semantics_list_def cnf_form_of_defs  ball_Un bex_Un<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">corollary</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">G</span><span class="main">.</span> <span class="free">𝒜</span> <span class="main">⊨</span> <span class="free">F</span> <span class="main">⟷</span> <span class="free">𝒜</span> <span class="main">⊨</span> <span class="bound">G</span> <span class="main">∧</span> is_cnf <span class="bound">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cnf_form_of_is cnf_form_semantics is_nnf_nnf nnf_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="CNF_To_Formula">
<div class="head">
<h1>Theory CNF_To_Formula</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Going back: CNFs to formulas›</span></span>
<span class="keyword1"><span class="command">theory</span></span> CNF_To_Formula
<span class="keyword2"><span class="keyword">imports</span></span> <a href="CNF_Formulas.html">CNF_Formulas</a> <span class="quoted">"<a href="../../HOL/HOL-Library/List_Lexorder.html">HOL-Library.List_Lexorder</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹One downside of CNFs is that they cannot be converted back to formulas 
as-is in full generality.
If we assume an order on the atoms, we can convert finite CNFs.›</span></span>
<span class="comment1">(* This theory was written after the theories that use the CNF, so I don't really know,
   but I suspect that you won't gain much from using this for the LSC lemmas… *)</span>

<span class="keyword1"><span class="command">instantiation</span></span> literal <span class="main">::</span> <span class="main">(</span><span class="quoted">ord</span><span class="main">)</span> <span class="quoted">ord</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  literal_less_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">⟷</span> <span class="main">(</span>
    <span class="keyword1">if</span> atoms_of_lit <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> atoms_of_lit <span class="free"><span class="bound"><span class="entity">ys</span></span></span>
    <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">of</span> Neg <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="keyword1">of</span> Pos <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> True <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">)</span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">)</span>
    <span class="keyword1">else</span> atoms_of_lit <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">&lt;</span> atoms_of_lit <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span>"</span></span>
  <span class="comment1">(* the how doesn't /really/ matter, but I still wanted something somewhat pretty. *)</span>

<span class="keyword1"><span class="command">definition</span></span>
  literal_le_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">::</span> <span class="main">_</span> literal<span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> literal <span class="main">::</span> <span class="main">(</span><span class="quoted">linorder</span><span class="main">)</span> <span class="quoted">linorder</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> literal_less_def literal_le_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> literal.splits if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">formula_of_cnf</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">formula_of_cnf</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> form_of_cnf <span class="main">(</span>sorted_list_of_set <span class="main">(</span>sorted_list_of_set <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹To use the lexicographic order on lists, we first have to convert the clauses to lists,
then the set of lists of literals to a list.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"simplify_consts <span class="main">(</span>formula_of_cnf <span class="main">(</span><span class="main">{</span><span class="main">{</span>Pos <span class="main">0</span><span class="main">}</span><span class="main">}</span> <span class="main">::</span> nat clause set<span class="main">)</span><span class="main">)</span> <span class="main">=</span> Atom <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">code_simp</span>

<span class="keyword1" id="CNF_To_Formula-cnf_formula_of_cnf"><span class="command">lemma</span></span> cnf_formula_of_cnf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> finite <span class="bound">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cnf <span class="main">(</span>formula_of_cnf <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cnf_BigAnd formula_of_cnf_def form_of_cnf_def cnf_disj<span class="main">)</span>
<span class="comment1">(* again, formula_of_cnf ∘ cnf is not an identity transformation, not even if the formula is_cnf.
   (there may be a much stricter definition of is_cnf for which that is the case) *)</span>
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Tseytin">
<div class="head">
<h1>Theory Tseytin</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Tseytin transformation›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Tseytin
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Formulas.html">Formulas</a> <a href="CNF_Formulas.html">CNF_Formulas</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> cnf<span class="antiquote"><span class="antiquote">}</span></span></span></span> transformation clearly has exponential complexity.
If the intention is to use Resolution to decide validity of a formula,
that is clearly a deal-breaker for any practical implementation,
since validity can be decided by brute force in exponential time.
This theory pair shows the Tseytin transformation, a way to transform a formula
while preserving validity.
The <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> cnf<span class="antiquote"><span class="antiquote">}</span></span></span></span> of the transformed formula will have clauses with maximally 3 atoms,
and an amount of clauses linear in the size of the formula,
at the cost of introducing one new atom for each subformula of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>F›</span></span></span></span> (i.e. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"size <span class="free"><span class="free">F</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> many).
›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">pair_fun_upd</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">⇒</span> fun_upd <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">k</span> <span class="bound">v</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Tseytin-fold_pair_upd_triv"><span class="command">lemma</span></span> fold_pair_upd_triv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∉</span> fst <span class="main">`</span> set <span class="free">U</span> <span class="main">⟹</span> foldl pair_fun_upd <span class="free">F</span> <span class="free">U</span> <span class="free">A</span> <span class="main">=</span> <span class="free">F</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">U</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="main">(</span><span class="operator">metis</span> fun_upd_apply pair_fun_upd_def prod.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> surjective_pairing<span class="main">)</span>

<span class="keyword1" id="Tseytin-distinct_pair_update_one"><span class="command">lemma</span></span> distinct_pair_update_one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">U</span> <span class="main">⟹</span> distinct <span class="main">(</span>map fst <span class="free">U</span><span class="main">)</span> <span class="main">⟹</span> foldl pair_fun_upd <span class="free">F</span> <span class="free">U</span> <span class="free">k</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">U</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pair_fun_upd_def fold_pair_upd_triv <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span> 
    <span class="main">(</span><span class="operator">insert</span> fold_pair_upd_triv<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
    
<span class="keyword1" id="Tseytin-distinct_zipunzip"><span class="command">lemma</span></span> distinct_zipunzip<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span> <span class="main">⟹</span> distinct <span class="main">(</span>map fst <span class="main">(</span>zip <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_conv_nth<span class="main">)</span>
    
<span class="comment1">(* hm, this foldl pair_fun_upd business might have been a bad idea. *)</span>
<span class="keyword1" id="Tseytin-foldl_pair_fun_upd_map_of"><span class="command">lemma</span></span> foldl_pair_fun_upd_map_of<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">U</span><span class="main">)</span> <span class="main">⟹</span> foldl pair_fun_upd <span class="free">F</span> <span class="free">U</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">case</span> map_of <span class="free">U</span> <span class="bound">k</span> <span class="keyword1">of</span> Some <span class="bound">v</span> <span class="main">⇒</span> <span class="bound">v</span> <span class="main">|</span> None <span class="main">⇒</span> <span class="free">F</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold</span> fun_eq_iff<span class="main"><span class="keyword3">;</span></span> <span class="operator">induction</span> <span class="quoted"><span class="free">U</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pair_fun_upd_def rev_image_eqI<span class="main">)</span>

<span class="keyword1" id="Tseytin-map_of_map_apsnd"><span class="command">lemma</span></span> map_of_map_apsnd<span class="main">:</span> <span class="quoted"><span class="quoted">"map_of <span class="main">(</span>map <span class="main">(</span>apsnd <span class="free">t</span><span class="main">)</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> map_option <span class="free">t</span> <span class="main">∘</span> <span class="main">(</span>map_of <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold</span> fun_eq_iff comp_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
    

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">biimp</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>↔</b></span>"</span> 67<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>↔</b></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1" id="Tseytin-atoms_biimp"><span class="command">lemma</span></span> atoms_biimp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"atoms <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> atoms <span class="free">F</span> <span class="main">∪</span> atoms <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> biimp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1" id="Tseytin-biimp_size"><span class="command">lemma</span></span> biimp_size<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"size <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>size <span class="free">F</span> <span class="main">+</span> size <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> biimp_def<span class="main">)</span>
  
<span class="keyword1"><span class="command">locale</span></span> freshstuff <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">fresh</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> isfresh<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span> <span class="main">⟹</span> <span class="free">fresh</span> <span class="free">S</span> <span class="main">∉</span> <span class="free">S</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">nfresh</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">nfresh</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nfresh</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">f</span> <span class="main">=</span> <span class="free">fresh</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1">in</span> <span class="bound">f</span> <span class="main">#</span> <span class="free">nfresh</span> <span class="main">(</span><span class="bound">f</span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Tseytin-length_nfresh"><span class="command">lemma</span></span> length_nfresh<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>nfresh <span class="free">S</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">S</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
    
<span class="keyword1" id="Tseytin-nfresh_isfresh"><span class="command">lemma</span></span> nfresh_isfresh<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span> <span class="main">⟹</span> set <span class="main">(</span>nfresh <span class="free">S</span> <span class="free">n</span><span class="main">)</span> <span class="main">∩</span> <span class="free">S</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">S</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def isfresh<span class="main">)</span>
    
<span class="keyword1" id="Tseytin-nfresh_distinct"><span class="command">lemma</span></span> nfresh_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span> <span class="main">⟹</span> distinct <span class="main">(</span>nfresh <span class="free">S</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">S</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">meson</span> disjoint_iff_not_equal finite_insert insertI1 nfresh_isfresh<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">tseytin_assmt</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="keyword1">let</span> <span class="bound">SF</span> <span class="main">=</span> remdups <span class="main">(</span>subformulae <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="keyword1">in</span> zip <span class="main">(</span>nfresh <span class="main">(</span>atoms <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">(</span>length <span class="bound">SF</span><span class="main">)</span><span class="main">)</span> <span class="bound">SF</span>"</span></span>

<span class="keyword1" id="Tseytin-tseytin_assmt_distinct"><span class="command">lemma</span></span> tseytin_assmt_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="main">(</span>tseytin_assmt <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> tseytin_assmt_def <span class="keyword1"><span class="command">using</span></span> nfresh_distinct <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def length_nfresh<span class="main">)</span>
    
<span class="keyword1" id="Tseytin-tseytin_assmt_has"><span class="command">lemma</span></span> tseytin_assmt_has<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="free">G</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>tseytin_assmt <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">G</span> <span class="main">=</span> subformulae <span class="free">F</span> <span class="main">!</span> <span class="bound">n</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">&lt;</span> length <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="free">G</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>nfresh <span class="main">(</span>atoms <span class="free">F</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> in_set_zip length_nfresh prod.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tseytin_assmt_def Let_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> fst_conv in_set_conv_nth in_set_zip length_nfresh set_remdups snd_conv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tseytin-tseytin_assmt_new_atoms"><span class="command">lemma</span></span> tseytin_assmt_new_atoms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">l</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>tseytin_assmt <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">∉</span> atoms <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> tseytin_assmt_def Let_def <span class="keyword1"><span class="command">using</span></span> nfresh_isfresh <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> set_zip_leftD<span class="main">)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">tseytin_tran1</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">tseytin_tran1</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">tseytin_tran1</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">[</span><span class="main">⊥</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⊥</span><span class="main">]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">tseytin_tran1</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> Not <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free">tseytin_tran1</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">tseytin_tran1</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> And <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free">tseytin_tran1</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">@</span> <span class="free">tseytin_tran1</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">tseytin_tran1</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> Or <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free">tseytin_tran1</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">@</span> <span class="free">tseytin_tran1</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">tseytin_tran1</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> Imp <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="free">tseytin_tran1</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">@</span> <span class="free">tseytin_tran1</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">tseytin_toatom</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> Atom <span class="main">∘</span> the <span class="main">∘</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>tseytin_assmt <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">tseytin_tran</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="main">(</span><span class="keyword1">let</span> <span class="bound">S</span> <span class="main">=</span> tseytin_toatom <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="keyword1">in</span> <span class="bound">S</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">#</span> tseytin_tran1 <span class="bound">S</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1" id="Tseytin-distinct_snd_tseytin_assmt"><span class="command">lemma</span></span> distinct_snd_tseytin_assmt<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="main">(</span>tseytin_assmt <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> tseytin_assmt_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def length_nfresh<span class="main">)</span>

<span class="keyword1" id="Tseytin-tseytin_assmt_backlookup"><span class="command">lemma</span></span> tseytin_assmt_backlookup<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>tseytin_assmt <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="free">J</span><span class="main">)</span><span class="main">,</span> <span class="free">J</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>tseytin_assmt <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="skolem">M</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">J</span> <span class="main">∈</span> snd <span class="main">`</span> set <span class="skolem">M</span> <span class="main">⟹</span> <span class="main">(</span>the <span class="main">(</span>map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="skolem">M</span><span class="main">)</span> <span class="skolem">J</span><span class="main">)</span><span class="main">,</span> <span class="skolem">J</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">J</span> <span class="skolem">M</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">M</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">J</span> <span class="main">∈</span> snd <span class="main">`</span> set <span class="main">(</span>tseytin_assmt <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">J</span> <span class="keyword1"><span class="command">using</span></span> image_iff tseytin_assmt_has <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> 1<span class="main">[</span><span class="operator">OF</span> distinct_snd_tseytin_assmt 2<span class="main">,</span> <span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tseytin-tseytin_tran_small_clauses"><span class="command">lemma</span></span> tseytin_tran_small_clauses<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span> <span class="main">∈</span> cnf <span class="main">(</span>nnf <span class="main">(</span>tseytin_tran <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> card <span class="bound">C</span> <span class="main">≤</span> <span class="numeral">3</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">S</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">⟹</span> card <span class="main">(</span><span class="skolem">a</span> <span class="main">▹</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">S</span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_insert_le_m1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">S</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span> card <span class="main">(</span><span class="skolem">a</span> <span class="main">▹</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">S</span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_insert_le_m1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">S</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> card <span class="main">(</span><span class="skolem">a</span> <span class="main">▹</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">S</span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_insert_le_m1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">G</span> <span class="main">∈</span> set <span class="main">(</span>tseytin_tran1 <span class="main">(</span>Atom <span class="main">∘</span> <span class="skolem">S</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span><span class="main">;</span> <span class="skolem">C</span> <span class="main">∈</span> cnf <span class="main">(</span>nnf <span class="skolem">G</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> card <span class="skolem">C</span> <span class="main">≤</span> <span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">G</span> <span class="skolem">C</span> <span class="skolem">S</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">G</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> biimp_def<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">elim</span> disjE exE conjE <span class="main"><span class="keyword3">|</span></span> <span class="operator">intro</span> 1 2 3 <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> tseytin_tran_def  tseytin_toatom_def Let_def
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cnf_BigAnd nnf_BigAnd comp_assoc *<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Tseytin-tseytin_tran_few_clauses"><span class="command">lemma</span></span> tseytin_tran_few_clauses<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>cnf <span class="main">(</span>nnf <span class="main">(</span>tseytin_tran <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">3</span> <span class="main">*</span> size <span class="free">F</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"size Bot <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  <span class="comment1">(* just a thing to keep in mind. *)</span>
  <span class="keyword1"><span class="command">have</span></span> ws<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">c</span> <span class="main">▹</span> <span class="bound">D</span> <span class="main">|</span><span class="bound">D</span><span class="main">.</span> <span class="bound">D</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">c1</span><span class="main">}</span> <span class="main">∨</span> <span class="bound">D</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">c2</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">c1</span><span class="main">}</span><span class="main">,</span><span class="main">{</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">c2</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">c</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> grr<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="skolem">S</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">⟹</span> card <span class="main">(</span><span class="skolem">a</span> <span class="main">▹</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">S</span> <span class="skolem">c</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_insert_le_m1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>set <span class="main">(</span>tseytin_tran1 <span class="main">(</span>Atom <span class="main">∘</span> <span class="skolem">S</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span><span class="main">.</span> cnf <span class="main">(</span>nnf <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">3</span> <span class="main">*</span> size <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">S</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> biimp_def<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">intro</span> grr card_Un_le<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> le_trans<span class="main"><span class="main">]</span></span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ws<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> tseytin_tran_def tseytin_toatom_def Let_def
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nnf_BigAnd cnf_BigAnd<span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> grr<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc *<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Tseytin-tseytin_tran_new_atom_count"><span class="command">lemma</span></span> tseytin_tran_new_atom_count<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>atoms <span class="main">(</span>tseytin_tran <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> size <span class="free">F</span> <span class="main">+</span> card <span class="main">(</span>atoms <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> tseytin_tran1_atoms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∈</span> set <span class="main">(</span>tseytin_tran1 <span class="main">(</span>tseytin_toatom <span class="free">F</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">G</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span>
    atoms <span class="skolem">H</span> <span class="main">⊆</span> atoms <span class="free">F</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">I</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span><span class="main">.</span> atoms <span class="main">(</span>tseytin_toatom <span class="free">F</span> <span class="bound">I</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">G</span> <span class="skolem">H</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">G</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">H</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> atoms <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">meson</span> formula.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rev_subsetD subformula_atoms<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Atom <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Bot <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Not <span class="skolem">G</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">insert</span> Not.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">;</span></span> 
         <span class="operator">frule</span> subformulas_in_subformulas<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">elim</span> disjE<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">elim</span> Not.IH <span class="main"><span class="keyword3">|</span></span> <span class="operator">force</span><span class="main">)</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">G1</span> <span class="skolem">G2</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">insert</span> And.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">;</span></span> 
         <span class="operator">frule</span> subformulas_in_subformulas<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">elim</span> disjE<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">elim</span> And.IH<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">force</span><span class="main">)</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">G1</span> <span class="skolem">G2</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">insert</span> Or.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">;</span></span> 
         <span class="operator">frule</span> subformulas_in_subformulas<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">elim</span> disjE<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">elim</span> Or.IH<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">force</span><span class="main">)</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Imp <span class="skolem">G1</span> <span class="skolem">G2</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">insert</span> Imp.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">;</span></span> 
         <span class="operator">frule</span> subformulas_in_subformulas<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">elim</span> disjE<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">elim</span> Imp.IH<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">force</span><span class="main">)</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> tseytin_tran1_atoms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">G</span><span class="main">∈</span>set <span class="main">(</span>tseytin_tran1 <span class="main">(</span>tseytin_toatom <span class="free">F</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span><span class="main">.</span> atoms <span class="bound">G</span><span class="main">)</span> <span class="main">⊆</span>
      atoms <span class="free">F</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">I</span><span class="main">∈</span>set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span><span class="main">.</span> atoms <span class="main">(</span>tseytin_toatom <span class="free">F</span> <span class="bound">I</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tseytin_tran1_atoms<span class="main">[</span><span class="operator">OF</span> _ subformulae_self<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>atoms <span class="main">(</span>tseytin_tran <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
  card <span class="main">(</span>atoms <span class="main">(</span>tseytin_toatom <span class="free">F</span> <span class="free">F</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span>tseytin_tran1 <span class="main">(</span>tseytin_toatom <span class="free">F</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span><span class="main">.</span> atoms <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> tseytin_tran_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def tseytin_tran1_atoms<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"atoms <span class="main">(</span>tseytin_toatom <span class="free">F</span> <span class="free">F</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span>tseytin_tran1 <span class="main">(</span>tseytin_toatom <span class="free">F</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span><span class="main">.</span> atoms <span class="bound">x</span><span class="main">)</span> <span class="main">⊆</span>
     <span class="main">(</span>atoms <span class="free">F</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">I</span><span class="main">∈</span>set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span><span class="main">.</span> atoms <span class="main">(</span>tseytin_toatom <span class="free">F</span> <span class="bound">I</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tseytin_tran1_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> twofin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>atoms <span class="free">F</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">I</span><span class="main">∈</span>set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span><span class="main">.</span> atoms <span class="main">(</span>tseytin_toatom <span class="free">F</span> <span class="bound">I</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> card_subformulae<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> size <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> length_subformulae <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_length<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> card_singleton_union<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span> <span class="main">⟹</span> card <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> <span class="main">{</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">≤</span> card <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="skolem">S</span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_insert_if<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span><span class="bound">I</span><span class="main">∈</span>set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span><span class="main">.</span> atoms <span class="main">(</span>tseytin_toatom <span class="free">F</span> <span class="bound">I</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> size <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> tseytin_toatom_def <span class="keyword1"><span class="command">using</span></span> le_trans<span class="main">[</span><span class="operator">OF</span> card_singleton_union card_subformulae<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>atoms <span class="main">(</span>tseytin_tran <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>atoms <span class="free">F</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="main">⋃</span><span class="bound">f</span><span class="main">∈</span>set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span><span class="main">.</span> atoms <span class="main">(</span>tseytin_toatom <span class="free">F</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_trans<span class="main">[</span><span class="operator">OF</span> 1 card_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> twofin 2<span class="main"><span class="main">]</span></span><span class="main">]</span> card_Un_le le_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 3 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">freshnat</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span>  Suc <span class="main">(</span>Max <span class="main">(</span><span class="main">0</span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">nfresh_natcode</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">nfresh_natcode</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nfresh_natcode</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">f</span> <span class="main">=</span> freshnat <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1">in</span> <span class="bound">f</span> <span class="main">#</span> <span class="free">nfresh_natcode</span> <span class="main">(</span><span class="bound">f</span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> freshnats<span class="main">:</span> freshstuff <span class="quoted">freshnat</span> <span class="keyword1"><span class="command">unfolding</span></span> freshnat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">meson</span> Max_ge Suc_n_not_le_n finite_insert insertCI<span class="main">)</span>
<span class="comment1">(* interpreting the locale is easy. making it executable… not so. *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"freshnats.nfresh <span class="main">=</span> nfresh_natcode"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"freshnats.nfresh <span class="skolem">S</span> <span class="skolem">n</span>  <span class="main">=</span> nfresh_natcode <span class="skolem">S</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">S</span> <span class="skolem">n</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">S</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> freshnats_code<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span> <span class="main">=</span> freshnats.tseytin_tran_def freshnats.tseytin_toatom_def freshnats.tseytin_assmt_def freshnats.nfresh.simps
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"freshnats.tseytin_tran <span class="main">(</span>Atom <span class="main">0</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="main">[</span>
  Atom <span class="numeral">2</span><span class="main">,</span>
  Atom <span class="numeral">2</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> Atom <span class="numeral">3</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> Atom <span class="numeral">4</span><span class="main">,</span>
  Atom <span class="main">0</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> Atom <span class="numeral">3</span><span class="main">,</span>
  Atom <span class="numeral">4</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="numeral">5</span><span class="main">)</span><span class="main">,</span>
  Atom <span class="main">1</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> Atom <span class="numeral">5</span>
<span class="main">]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cnf <span class="main">(</span>nnf <span class="var">?r</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">{</span><span class="main">{</span>Pos <span class="numeral">2</span><span class="main">}</span><span class="main">,</span>
     <span class="main">{</span>Neg <span class="numeral">4</span><span class="main">,</span> Pos <span class="numeral">2</span><span class="main">}</span><span class="main">,</span> <span class="main">{</span>Pos <span class="numeral">3</span><span class="main">,</span> Pos <span class="numeral">2</span><span class="main">}</span><span class="main">,</span> <span class="main">{</span>Neg <span class="numeral">2</span><span class="main">,</span> Neg <span class="numeral">3</span><span class="main">,</span> Pos <span class="numeral">4</span><span class="main">}</span><span class="main">,</span>
     <span class="main">{</span>Neg <span class="numeral">3</span><span class="main">,</span> Pos <span class="main">0</span><span class="main">}</span><span class="main">,</span> <span class="main">{</span>Neg <span class="main">0</span><span class="main">,</span> Pos <span class="numeral">3</span><span class="main">}</span><span class="main">,</span>
     <span class="main">{</span>Pos <span class="numeral">5</span><span class="main">,</span> Pos <span class="numeral">4</span><span class="main">}</span><span class="main">,</span> <span class="main">{</span>Neg <span class="numeral">4</span><span class="main">,</span> Neg <span class="numeral">5</span><span class="main">}</span><span class="main">,</span>
     <span class="main">{</span>Neg <span class="numeral">5</span><span class="main">,</span> Pos <span class="main">1</span><span class="main">}</span><span class="main">,</span> <span class="main">{</span>Neg <span class="main">1</span><span class="main">,</span> Pos <span class="numeral">5</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">code_simp</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Tseytin_Sema">
<div class="head">
<h1>Theory Tseytin_Sema</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Tseytin_Sema
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Sema.html">Sema</a> <a href="Tseytin.html">Tseytin</a>
<span class="keyword2"><span class="keyword">begin</span></span>           

<span class="keyword1" id="Tseytin_Sema-biimp_simp"><span class="command">lemma</span></span> biimp_simp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊨</span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="free">G</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">𝒜</span> <span class="main">⊨</span> <span class="free">F</span> <span class="main">⟷</span> <span class="free">𝒜</span> <span class="main">⊨</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> biimp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1"><span class="command">locale</span></span> freshstuff_sema <span class="main">=</span> freshstuff
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">tseytin_update</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">U</span> <span class="main">=</span> map <span class="main">(</span>apsnd <span class="main">(</span>formula_semantics <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>tseytin_assmt <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="keyword1">in</span> foldl pair_fun_upd <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="bound">U</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Tseytin_Sema-tseyting_update_keep_subformula_sema"><span class="command">lemma</span></span> tseyting_update_keep_subformula_sema<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> tseytin_update <span class="free">𝒜</span> <span class="free">F</span> <span class="main">⊨</span> <span class="free">G</span> <span class="main">⟷</span> <span class="free">𝒜</span> <span class="main">⊨</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"atoms <span class="free">G</span> <span class="main">⊆</span> atoms <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> subformula_atoms<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> natoms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> atoms <span class="free">F</span> <span class="main">⟹</span> <span class="skolem">k</span> <span class="main">∉</span> fst <span class="main">`</span> set <span class="main">(</span>tseytin_assmt <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">l</span> 
    <span class="keyword1"><span class="command">using</span></span> tseytin_assmt_new_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> atoms <span class="free">F</span> <span class="main">⟹</span> tseytin_update <span class="free">𝒜</span> <span class="free">F</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">𝒜</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">unfolding</span></span> tseytin_update_def Let_def 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fold_pair_upd_triv <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> natoms<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> relevant_atoms_same_semantics sub <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subsetCE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>   

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">G</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>tseytin_assmt <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> tseytin_update <span class="free">𝒜</span> <span class="free">F</span> <span class="free">k</span> <span class="main">⟷</span> tseytin_update <span class="free">𝒜</span> <span class="free">F</span> <span class="main">⊨</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tseytin_update_def tseytin_assmt_def Let_def pair_fun_upd_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Bot
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tseytin_update_def tseytin_assmt_def Let_def pair_fun_upd_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Not <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">oops</span></span>
      
<span class="keyword1" id="Tseytin_Sema-tseytin_updates"><span class="command">lemma</span></span> tseytin_updates<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">G</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>tseytin_assmt <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> tseytin_update <span class="free">𝒜</span> <span class="free">F</span> <span class="free">k</span> <span class="main">⟷</span> tseytin_update <span class="free">𝒜</span> <span class="free">F</span> <span class="main">⊨</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> tseytin_update_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tseytin_assmt_def Let_def foldl_pair_fun_upd_map_of map_of_map_apsnd distinct_zipunzip<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nfresh_distinct<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> atoms_finite<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> tseyting_update_keep_subformula_sema<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> in_set_zipE<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
  <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Tseytin_Sema-tseytin_tran1"><span class="command">lemma</span></span> tseytin_tran1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">H</span> <span class="main">∈</span> set <span class="main">(</span>tseytin_tran1 <span class="free">S</span> <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">J</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span><span class="main">.</span> tseytin_update <span class="free">𝒜</span> <span class="free">F</span> <span class="main">⊨</span> <span class="bound">J</span> <span class="main">⟷</span> tseytin_update <span class="free">𝒜</span> <span class="free">F</span> <span class="main">⊨</span> <span class="main">(</span><span class="free">S</span> <span class="bound">J</span><span class="main">)</span> <span class="main">⟹</span> tseytin_update <span class="free">𝒜</span> <span class="free">F</span> <span class="main">⊨</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">G</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">H</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Bot <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">k</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Not <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="free">S</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="free">S</span> <span class="skolem">G</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">" <span class="skolem">H</span> <span class="main">∈</span> set <span class="main">(</span>tseytin_tran1 <span class="free">S</span> <span class="skolem">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Not.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Not.prems<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Not.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> biimp_simp formula_semantics.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> set_subset_Cons subformulae.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subformulae_self subsetCE subsubformulae<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="skolem">G</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">G</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">elim</span> subsubformulae<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> D Not.IH Not.prems<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">G1</span> <span class="skolem">G2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> el<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G1</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G2</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subsubformulae And.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> And.IH And.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∈</span> set <span class="main">(</span>tseytin_tran1 <span class="free">S</span> <span class="skolem">G1</span><span class="main">)</span> <span class="main">⟹</span> tseytin_update <span class="free">𝒜</span> <span class="free">F</span> <span class="main">⊨</span> <span class="skolem">H</span>"</span></span>
                                    <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∈</span> set <span class="main">(</span>tseytin_tran1 <span class="free">S</span> <span class="skolem">G2</span><span class="main">)</span> <span class="main">⟹</span> tseytin_update <span class="free">𝒜</span> <span class="free">F</span> <span class="main">⊨</span> <span class="skolem">H</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">H</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> And.prems IH el <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">elim</span> disjE<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">insert</span> And.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> formula_semantics.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">G1</span> <span class="skolem">G2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> el<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G1</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G2</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subsubformulae Or.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> Or.IH Or.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∈</span> set <span class="main">(</span>tseytin_tran1 <span class="free">S</span> <span class="skolem">G1</span><span class="main">)</span> <span class="main">⟹</span> tseytin_update <span class="free">𝒜</span> <span class="free">F</span> <span class="main">⊨</span> <span class="skolem">H</span>"</span></span>
                                  <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∈</span> set <span class="main">(</span>tseytin_tran1 <span class="free">S</span> <span class="skolem">G2</span><span class="main">)</span> <span class="main">⟹</span> tseytin_update <span class="free">𝒜</span> <span class="free">F</span> <span class="main">⊨</span> <span class="skolem">H</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">H</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Or.prems<span class="main">(</span>3<span class="main">,</span>2<span class="main">)</span> IH el <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">elim</span> disjE<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> Or.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> formula_semantics.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Imp <span class="skolem">G1</span> <span class="skolem">G2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> el<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G1</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G2</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subsubformulae Imp.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> Imp.IH Imp.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∈</span> set <span class="main">(</span>tseytin_tran1 <span class="free">S</span> <span class="skolem">G1</span><span class="main">)</span> <span class="main">⟹</span> tseytin_update <span class="free">𝒜</span> <span class="free">F</span> <span class="main">⊨</span> <span class="skolem">H</span>"</span></span>
                                    <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∈</span> set <span class="main">(</span>tseytin_tran1 <span class="free">S</span> <span class="skolem">G2</span><span class="main">)</span> <span class="main">⟹</span> tseytin_update <span class="free">𝒜</span> <span class="free">F</span> <span class="main">⊨</span> <span class="skolem">H</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">H</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Imp.prems<span class="main">(</span>3<span class="main">,</span>2<span class="main">)</span> IH el <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">elim</span> disjE<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> Imp.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> formula_semantics.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tseytin_Sema-all_tran_formulas_validated"><span class="command">lemma</span></span> all_tran_formulas_validated<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">J</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span><span class="main">.</span> tseytin_update <span class="free">𝒜</span> <span class="free">F</span> <span class="main">⊨</span> <span class="bound">J</span> <span class="main">⟷</span> tseytin_update <span class="free">𝒜</span> <span class="free">F</span> <span class="main">⊨</span> <span class="main">(</span>tseytin_toatom <span class="free">F</span> <span class="bound">J</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tseytin_toatom_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> tseytin_updates<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> tseytin_assmt_backlookup<span class="main">)</span>
  <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Tseytin_Sema-tseytin_tran_equisat"><span class="command">lemma</span></span> tseytin_tran_equisat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊨</span> <span class="free">F</span> <span class="main">⟷</span> tseytin_update <span class="free">𝒜</span> <span class="free">F</span> <span class="main">⊨</span> <span class="main">(</span>tseytin_tran <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> all_tran_formulas_validated tseytin_tran1 all_tran_formulas_validated tseyting_update_keep_subformula_sema <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tseytin_tran_def Let_def<span class="main">)</span> <span class="operator">blast</span>
<span class="comment1">(* unfortunately, that's not enough. *)</span>
    
<span class="keyword1" id="Tseytin_Sema-tseytin_tran1_orig_connection"><span class="command">lemma</span></span> tseytin_tran1_orig_connection<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">∈</span> set <span class="main">(</span>subformulae <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">H</span><span class="main">∈</span>set <span class="main">(</span>tseytin_tran1 <span class="main">(</span>tseytin_toatom <span class="free">F</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="free">𝒜</span> <span class="main">⊨</span> <span class="bound">H</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="free">𝒜</span> <span class="main">⊨</span> <span class="free">G</span> <span class="main">⟷</span> <span class="free">𝒜</span> <span class="main">⊨</span> tseytin_toatom <span class="free">F</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">G</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">drule</span> subformulas_in_subformulas<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Tseytin_Sema-tseytin_untran"><span class="command">lemma</span></span> tseytin_untran<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊨</span> <span class="main">(</span>tseytin_tran <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">𝒜</span> <span class="main">⊨</span> <span class="free">F</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">𝒜</span> <span class="main">⊨</span> tseytin_toatom <span class="free">F</span> <span class="free">F</span><span class="main">;</span> <span class="free">𝒜</span> <span class="main">⊨</span> <span class="free">F</span><span class="main">⟧</span> <span class="main">⟹</span> tseytin_update <span class="free">𝒜</span> <span class="free">F</span> <span class="main">⊨</span> tseytin_toatom <span class="free">F</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> all_tran_formulas_validated tseyting_update_keep_subformula_sema <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">𝒜</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">H</span> <span class="main">∈</span> set <span class="main">(</span>tseytin_tran1 <span class="main">(</span>tseytin_toatom <span class="free">F</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span><span class="main">.</span> <span class="bound">𝒜</span> <span class="main">⊨</span> <span class="bound">H</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="free">𝒜</span> <span class="main">⟹</span> <span class="var">?C</span> <span class="main">(</span>tseytin_update <span class="free">𝒜</span> <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> all_tran_formulas_validated tseytin_tran1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊨</span> tseytin_tran <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"tseytin_update <span class="free">𝒜</span> <span class="free">F</span> <span class="main">⊨</span> tseytin_tran <span class="free">F</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> tseytin_tran_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> tseytin_tran1_orig_connection<span class="main"><span class="main">[</span></span><span class="operator">OF</span> subformulae_self<span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tseytin_assmt_distinct foldl_pair_fun_upd_map_of 1 2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> tseytin_tran_equisat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1" id="Tseytin_Sema-tseytin_tran_equiunsatisfiable"><span class="command">lemma</span></span> tseytin_tran_equiunsatisfiable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span> <span class="main">⟷</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>tseytin_tran <span class="free">F</span><span class="main">)</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟷</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">;</span></span> <span class="operator">erule</span> contrapos_pp<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?l</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">𝒜</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒜</span> <span class="main">⊨</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"tseytin_update <span class="skolem">𝒜</span> <span class="free">F</span> <span class="main">⊨</span> <span class="main">(</span>tseytin_tran <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tseytin_tran_equisat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?r</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">𝒜</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒜</span> <span class="main">⊨</span> tseytin_tran <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tseytin_untran <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword2"><span class="keyword">end</span></span>
  
<span class="keyword1"><span class="command">interpretation</span></span> freshsemanats<span class="main">:</span> freshstuff_sema <span class="quoted">freshnat</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> freshnats.freshstuff_axioms freshstuff_sema_def<span class="main">)</span>
<span class="keyword1"><span class="command">print_theorems</span></span>
<span class="comment1">(* Just showing that it is possible. There isn't really anything new that could be executed here. *)</span>
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="MiniFormulas">
<div class="head">
<h1>Theory MiniFormulas</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Implication-only formulas›</span></span>

<span class="keyword1"><span class="command">theory</span></span> MiniFormulas
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Formulas.html">Formulas</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_mini_formula</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_mini_formula</span> <span class="main">(</span>Atom <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">is_mini_formula</span> <span class="main">⊥</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">is_mini_formula</span> <span class="main">(</span>Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">is_mini_formula</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> <span class="free">is_mini_formula</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">is_mini_formula</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The similarity between these ``mini'' formulas and Johansson's minimal calculus of implications~\cite{johansson1937minimal} is mostly in name.
  Johansson does replace <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="hidden">❙</span><b>¬</b></span></span> <span class="free"><span class="free">F</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">F</span></span> <span class="main"><span class="main"><span class="hidden">❙</span><b>→</b></span></span> <span class="main"><span class="main">⊥</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in one place, but generally keeps it.
  The main focus of ~\cite{johansson1937minimal} is on removing rules from Calculi anyway, not on removing connectives.
  We are only borrowing the name.›</span></span>

<span class="comment1">(*lemma mini_Top[simp,intro!]: "is_mini_formula ⊤" unfolding Top_def by simp *)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">to_mini_formula</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">to_mini_formula</span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span> Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">to_mini_formula</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">to_mini_formula</span> <span class="main">(</span>Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">to_mini_formula</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">to_mini_formula</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">to_mini_formula</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">to_mini_formula</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">to_mini_formula</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">to_mini_formula</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free">to_mini_formula</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">to_mini_formula</span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">to_mini_formula</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">to_mini_formula</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>

<span class="keyword1" id="MiniFormulas-to_mini_is_mini"><span class="command">lemma</span></span> to_mini_is_mini<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_mini_formula <span class="main">(</span>to_mini_formula <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1" id="MiniFormulas-mini_to_mini"><span class="command">lemma</span></span> mini_to_mini<span class="main">:</span> <span class="quoted"><span class="quoted">"is_mini_formula <span class="free">F</span> <span class="main">⟹</span> to_mini_formula <span class="free">F</span> <span class="main">=</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> mini_mini<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"to_mini_formula <span class="main">(</span>to_mini_formula <span class="free">F</span><span class="main">)</span> <span class="main">=</span> to_mini_formula <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mini_to_mini<span class="main">[</span><span class="operator">OF</span> to_mini_is_mini<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We could have used an arbitrary other combination,
  e.g. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Atom<span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Not<span class="antiquote"><span class="antiquote">}</span></span></span></span>, and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> And<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
The choice for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Atom<span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">⊥</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Imp<span class="antiquote"><span class="antiquote">}</span></span></span></span> was made because it is
 (to the best of my knowledge) the only combination that only requires three elements and verifies:›</span></span>
<span class="keyword1" id="MiniFormulas-mini_formula_atoms"><span class="command">lemma</span></span> mini_formula_atoms<span class="main">:</span> <span class="quoted"><span class="quoted">"atoms <span class="main">(</span>to_mini_formula <span class="free">F</span><span class="main">)</span> <span class="main">=</span> atoms <span class="free">F</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹(The story would be different if we had different junctors, e.g. if we allowed a NAND.)›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="MiniFormulas_Sema">
<div class="head">
<h1>Theory MiniFormulas_Sema</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> MiniFormulas_Sema
<span class="keyword2"><span class="keyword">imports</span></span> <a href="MiniFormulas.html">MiniFormulas</a> <a href="Sema.html">Sema</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊨</span> <span class="free">F</span> <span class="main">⟷</span> <span class="free">A</span> <span class="main">⊨</span> to_mini_formula <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Consistency">
<div class="head">
<h1>Theory Consistency</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Consistency›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We follow the proofs by Melvin Fitting~\cite{fitting1990first}.›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Consistency
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Sema.html">Sema</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Hintikka</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">(</span>
  <span class="main">⊥</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> Atom <span class="bound">k</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟶</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="bound">k</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟶</span> False<span class="main">)</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span> <span class="bound">G</span><span class="main">.</span> <span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="bound">G</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟶</span> <span class="bound">F</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="bound">G</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span> <span class="bound">G</span><span class="main">.</span> <span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="bound">G</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟶</span> <span class="bound">F</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∨</span> <span class="bound">G</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span> <span class="bound">G</span><span class="main">.</span> <span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="bound">G</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟶</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="bound">F</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∨</span> <span class="bound">G</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="bound">F</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟶</span> <span class="bound">F</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span> <span class="bound">G</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="bound">G</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟶</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="bound">F</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="bound">G</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span> <span class="bound">G</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="bound">G</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟶</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="bound">F</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="bound">G</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span> <span class="bound">G</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="bound">G</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟶</span> <span class="bound">F</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="bound">G</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>
<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"Hintikka <span class="main">{</span>Atom <span class="main">0</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> Atom <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> Atom <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> Atom <span class="main">0</span><span class="main">,</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Atom <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Hintikka_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">theorem</span></span> Hintikkas_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"Hintikka <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sat <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> H<span class="main">[</span><span class="operator">unfolded</span> Hintikka_def<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> H'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">∉</span> <span class="free">S</span>"</span></span> 
    <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="skolem">k</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> False"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="skolem">G</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∨</span> <span class="skolem">G</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="skolem">F</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∨</span> <span class="skolem">G</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">F</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">F</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">G</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">F</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">G</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">G</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> Atom <span class="bound">k</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟶</span> <span class="main">(</span><span class="var">?M</span> <span class="main">⊨</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">F</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="var">?M</span> <span class="main">⊨</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">F</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> H'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> H'<span class="main"><span class="main">(</span></span>2-<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">pcp</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">S</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">.</span>
  <span class="main">⊥</span> <span class="main">∉</span> <span class="bound">S</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> Atom <span class="bound">k</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="bound">k</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> False<span class="main">)</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span> <span class="bound">G</span><span class="main">.</span> <span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="bound">G</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">F</span> <span class="main">▹</span> <span class="bound">G</span> <span class="main">▹</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span> <span class="bound">G</span><span class="main">.</span> <span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="bound">G</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">F</span> <span class="main">▹</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∨</span> <span class="bound">G</span> <span class="main">▹</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span> <span class="bound">G</span><span class="main">.</span> <span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="bound">G</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="bound">F</span> <span class="main">▹</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∨</span> <span class="bound">G</span> <span class="main">▹</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="bound">F</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">F</span> <span class="main">▹</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span> <span class="bound">G</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="bound">G</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="bound">F</span> <span class="main">▹</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="bound">G</span> <span class="main">▹</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span> <span class="bound">G</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="bound">G</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="bound">F</span> <span class="main">▹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="bound">G</span> <span class="main">▹</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span> <span class="bound">G</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="bound">G</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">F</span> <span class="main">▹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="bound">G</span> <span class="main">▹</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>
<span class="main">)</span>"</span></span>

<span class="comment1">(* just some examples *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"pcp <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"pcp <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"pcp <span class="main">{</span><span class="main">{</span>Atom <span class="main">0</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pcp_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"pcp <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> Atom <span class="numeral">2</span><span class="main">}</span><span class="main">,</span>
   <span class="main">{</span><span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> Atom <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">,</span>
  <span class="main">{</span><span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> Atom <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>  Atom <span class="main">1</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pcp_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Fitting uses uniform notation~\cite{smullyan1963unifying} for the definition of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> pcp<span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
We try to mimic this, more to see whether it works than because it is ultimately necessary.›</span></span>
<span class="comment1">(* It does help a bit, occasionally. *)</span>
    
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">Con</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula <span class="main">=&gt;</span> <span class="tfree">'a</span> formula <span class="main">=&gt;</span> <span class="tfree">'a</span> formula <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Con</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">Con</span> <span class="main">(</span>Not <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">Con</span> <span class="main">(</span>Not <span class="main">(</span>Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">Con</span> <span class="main">(</span>Not <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">Dis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula <span class="main">=&gt;</span> <span class="tfree">'a</span> formula <span class="main">=&gt;</span> <span class="tfree">'a</span> formula <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Dis</span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">Dis</span> <span class="main">(</span>Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">Dis</span> <span class="main">(</span>Not <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">Dis</span> <span class="main">(</span>Not <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span>

<span class="comment1">(* note that *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"Con <span class="main">(</span>Not <span class="main">(</span>Not <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"Dis <span class="main">(</span>Not <span class="main">(</span>Not <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> Con.intros Dis.intros<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="comment1">(* i.e. <span class="hidden">❙</span><b>¬</b><span class="hidden">❙</span><b>¬</b> is both Conjunctive and Disjunctive. I saw no reason to break this symmetry. *)</span>

<span class="keyword1" id="Consistency-con_dis_simps"><span class="command">lemma</span></span> con_dis_simps<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Con <span class="free">a1</span> <span class="free">a2</span> <span class="free">a3</span> <span class="main">=</span> <span class="main">(</span><span class="free">a1</span> <span class="main">=</span> <span class="free">a2</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free">a3</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">F</span> <span class="bound">G</span><span class="main">.</span> <span class="free">a1</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="bound">G</span><span class="main">)</span> <span class="main">∧</span> <span class="free">a2</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="bound">F</span> <span class="main">∧</span> <span class="free">a3</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="bound">G</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">G</span><span class="main">.</span> <span class="free">a1</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="free">a2</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="bound">G</span><span class="main">)</span> <span class="main">∧</span> <span class="free">a3</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="bound">G</span><span class="main">)</span> <span class="main">∨</span> <span class="free">a1</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">a2</span><span class="main">)</span> <span class="main">∧</span> <span class="free">a3</span> <span class="main">=</span> <span class="free">a2</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"Dis <span class="free">a1</span> <span class="free">a2</span> <span class="free">a3</span> <span class="main">=</span> <span class="main">(</span><span class="free">a1</span> <span class="main">=</span> <span class="free">a2</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">a3</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">F</span> <span class="bound">G</span><span class="main">.</span> <span class="free">a1</span> <span class="main">=</span> <span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="bound">G</span> <span class="main">∧</span> <span class="free">a2</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="bound">F</span> <span class="main">∧</span> <span class="free">a3</span> <span class="main">=</span> <span class="bound">G</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">F</span> <span class="bound">G</span><span class="main">.</span> <span class="free">a1</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="bound">G</span><span class="main">)</span> <span class="main">∧</span> <span class="free">a2</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="bound">F</span> <span class="main">∧</span> <span class="free">a3</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="bound">G</span><span class="main">)</span> <span class="main">∨</span> <span class="free">a1</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">a2</span><span class="main">)</span> <span class="main">∧</span> <span class="free">a3</span> <span class="main">=</span> <span class="free">a2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Con.simps Dis.simps<span class="main">)</span>

<span class="keyword1" id="Consistency-Hintikka_alt"><span class="command">lemma</span></span> Hintikka_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"Hintikka <span class="free">S</span> <span class="main">=</span> <span class="main">(</span>
  <span class="main">⊥</span> <span class="main">∉</span> <span class="free">S</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> Atom <span class="bound">k</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟶</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="bound">k</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟶</span> False<span class="main">)</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span> <span class="bound">G</span> <span class="bound">H</span><span class="main">.</span> Con <span class="bound">F</span> <span class="bound">G</span> <span class="bound">H</span> <span class="main">⟶</span> <span class="bound">F</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟶</span> <span class="bound">G</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">H</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span> <span class="bound">G</span> <span class="bound">H</span><span class="main">.</span> Dis <span class="bound">F</span> <span class="bound">G</span> <span class="bound">H</span> <span class="main">⟶</span> <span class="bound">F</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟶</span> <span class="bound">G</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∨</span> <span class="bound">H</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span>
<span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hintikka_def con_dis_simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
    <span class="comment1">(* simp only: ∅ loops. :( *)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">safe</span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Consistency-pcp_alt"><span class="command">lemma</span></span> pcp_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"pcp <span class="free">C</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">S</span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span>
  <span class="main">⊥</span> <span class="main">∉</span> <span class="bound">S</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> Atom <span class="bound">k</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="bound">k</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> False<span class="main">)</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span> <span class="bound">G</span> <span class="bound">H</span><span class="main">.</span> Con <span class="bound">F</span> <span class="bound">G</span> <span class="bound">H</span> <span class="main">⟶</span> <span class="bound">F</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">G</span> <span class="main">▹</span> <span class="bound">H</span> <span class="main">▹</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free">C</span><span class="main">)</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span> <span class="bound">G</span> <span class="bound">H</span><span class="main">.</span> Dis <span class="bound">F</span> <span class="bound">G</span> <span class="bound">H</span> <span class="main">⟶</span> <span class="bound">F</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="bound">G</span> <span class="main">▹</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∨</span> <span class="bound">H</span> <span class="main">▹</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free">C</span><span class="main">)</span>
<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pcp_def con_dis_simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">;</span></span> <span class="operator">unfold</span> Ball_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">elim</span> all_forward<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_absorb <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> formula.splits<span class="main">)</span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">subset_closed</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">S</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">s</span></span><span class="main">⊆</span><span class="bound">S</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">finite_character</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">s</span></span> <span class="main">⊆</span> <span class="bound">S</span><span class="main">.</span> finite <span class="bound">s</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Consistency-ex1"><span class="command">lemma</span></span> ex1<span class="main">:</span> <span class="quoted"><span class="quoted">"pcp <span class="free">C</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">C'</span><span class="main">.</span> <span class="free">C</span> <span class="main">⊆</span> <span class="bound">C'</span> <span class="main">∧</span> pcp <span class="bound">C'</span> <span class="main">∧</span> subset_closed <span class="bound">C'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="bound"><span class="bound">s</span></span> <span class="main"><span class="main">.</span></span> <span class="main"><span class="main">∃</span></span><span class="bound"><span class="bound">S</span></span> <span class="main"><span class="main">∈</span></span> <span class="free"><span class="free">C</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">s</span></span> <span class="main"><span class="main">⊆</span></span> <span class="bound"><span class="bound">S</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?E</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound">S</span><span class="main">∈</span><span class="free">C</span><span class="main">.</span> <span class="bound">s</span> <span class="main">⊆</span> <span class="bound">S</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> <span class="var">?E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subset_closed <span class="var">?E</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subset_closed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">‹pcp <span class="free">C</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pcp <span class="var">?E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">unfolding</span></span> pcp_alt
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ballI conjI<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">meson</span> insertI1 rev_subsetD subset_insertI subset_insertI2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Consistency-sallI"><span class="command">lemma</span></span> sallI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound"><span class="bound">s</span></span> <span class="main">⊆</span> <span class="free">S</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 

<span class="keyword1" id="Consistency-ex2"><span class="command">lemma</span></span> ex2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> fc<span class="main">:</span> <span class="quoted"><span class="quoted">"finite_character <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subset_closed <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> subset_closed_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI sallI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">S</span>
  <span class="keyword3"><span class="command">assume</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">⊆</span> <span class="skolem">S</span>›</span></span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">⊆</span> <span class="skolem">s</span> <span class="main">⟹</span> <span class="skolem">t</span> <span class="main">⊆</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> fc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">⟹</span> finite <span class="skolem">t</span> <span class="main">⟹</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span> <span class="keyword1"><span class="command">unfolding</span></span> finite_character_def <span class="keyword1"><span class="command">using</span></span> e <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">⊆</span> <span class="skolem">s</span> <span class="main">⟹</span> finite <span class="skolem">t</span> <span class="main">⟹</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> fc <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> finite_character_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"pcp <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"subset_closed <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> ex3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C'</span><span class="main">.</span> <span class="free">C</span> <span class="main">⊆</span> <span class="bound">C'</span> <span class="main">∧</span> pcp <span class="bound">C'</span> <span class="main">∧</span> finite_character <span class="bound">C'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">C</span></span> <span class="main"><span class="main">∪</span></span> <span class="main"><span class="main">{</span></span><span class="bound"><span class="bound">S</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">∀</span></span><span class="bound"><span class="bound"><span class="bound"><span class="bound">s</span></span></span></span> <span class="main"><span class="main">⊆</span></span> <span class="bound"><span class="bound">S</span></span><span class="main"><span class="main">.</span></span> finite <span class="bound"><span class="bound">s</span></span> <span class="main"><span class="main">⟶</span></span> <span class="bound"><span class="bound">s</span></span> <span class="main"><span class="main">∈</span></span> <span class="free"><span class="free">C</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?E</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">" <span class="main">{</span><span class="bound">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">s</span></span> <span class="main">⊆</span> <span class="bound">S</span><span class="main">.</span> finite <span class="bound">s</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">C</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> <span class="free">C</span> <span class="main">∪</span> <span class="var">?E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> S <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_character <span class="main">(</span><span class="free">C</span> <span class="main">∪</span> <span class="var">?E</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> finite_character_def subset_closed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">note</span></span> C'' <span class="main">=</span> C<span class="main">[</span><span class="operator">unfolded</span> pcp_alt<span class="main">,</span> <span class="operator">THEN</span> bspec<span class="main">]</span>
    
  <span class="comment1">(* uniform notation. what did I learn? only slightly more elegant… *)</span>
  <span class="keyword1"><span class="command">have</span></span> CON<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">H</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">s</span></span><span class="main">⊆</span><span class="bound">S</span><span class="main">.</span> finite <span class="bound">s</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">C</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> si<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">s</span><span class="main">⊆</span><span class="skolem">S</span><span class="main">;</span> finite <span class="bound">s</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    un<span class="main">:</span> <span class="quoted"><span class="quoted">"Con <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> el<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">F</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span> <span class="skolem">S</span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">s</span></span> <span class="main">⊆</span> <span class="skolem">S</span><span class="main">.</span> finite <span class="bound">s</span> <span class="main">⟶</span> <span class="skolem">F</span> <span class="main">∈</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">H</span> <span class="main">▹</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> si un C'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">H</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∈</span> <span class="var">?E</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mem_Collect_eq Un_iff <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊆</span> <span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">H</span> <span class="main">▹</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">▹</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">G</span><span class="main">,</span><span class="skolem">H</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> el <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> k f <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">H</span> <span class="main">▹</span> <span class="skolem">F</span> <span class="main">▹</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">G</span><span class="main">,</span><span class="skolem">H</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">▹</span> <span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">H</span> <span class="main">▹</span> <span class="skolem">s</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert_absorb <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">unfolding</span></span> subset_closed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>  
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">H</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∪</span> <span class="var">?E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> DIS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">s</span></span><span class="main">⊆</span><span class="bound">S</span><span class="main">.</span> finite <span class="bound">s</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">C</span><span class="main">}</span> <span class="main">∨</span> <span class="skolem">H</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">s</span></span><span class="main">⊆</span><span class="bound">S</span><span class="main">.</span> finite <span class="bound">s</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">C</span><span class="main">}</span>"</span></span> 
    <span class="keyword2"><span class="keyword">if</span></span> si<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span><span class="main">⊆</span><span class="skolem">S</span> <span class="main">⟹</span> finite <span class="bound">s</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> un<span class="main">:</span> <span class="quoted"><span class="quoted">"Dis <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> el<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span> <span class="skolem">S</span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">I</span><span class="main">∈</span><span class="main">{</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">H</span><span class="main">}</span><span class="main">.</span> <span class="bound">I</span> <span class="main">▹</span> <span class="skolem">s1</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∧</span> <span class="bound">I</span> <span class="main">▹</span> <span class="skolem">s2</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> 
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">⊆</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">s1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="skolem">s1</span>"</span></span> 
         <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">⊆</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">s2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="skolem">s2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s1</span> <span class="skolem">s2</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">∪</span> <span class="skolem">s2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">⊆</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span> 
      <span class="keyword1"><span class="command">with</span></span> si <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="var">?s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">I</span><span class="main">∈</span><span class="main">{</span><span class="skolem">G</span><span class="main">,</span><span class="skolem">H</span><span class="main">}</span><span class="main">.</span> <span class="bound">I</span> <span class="main">▹</span> <span class="var">?s</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> C'' un <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">I</span><span class="main">∈</span><span class="main">{</span><span class="skolem">G</span><span class="main">,</span><span class="skolem">H</span><span class="main">}</span><span class="main">.</span> <span class="bound">I</span> <span class="main">▹</span> <span class="skolem">s1</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∧</span> <span class="bound">I</span> <span class="main">▹</span> <span class="skolem">s2</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> S<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> subset_closed_def<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> bspec<span class="main"><span class="main">]</span></span> insert_mono sup.cobounded2 sup_ge1<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">s1</span> <span class="main">⊆</span> <span class="skolem">S</span><span class="main">;</span> finite <span class="skolem">s1</span><span class="main">;</span> <span class="skolem">F</span> <span class="main">∈</span> <span class="skolem">s1</span><span class="main">;</span> <span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">s1</span> <span class="main">∉</span> <span class="free">C</span><span class="main">;</span> <span class="skolem">s2</span> <span class="main">⊆</span> <span class="skolem">S</span><span class="main">;</span> finite <span class="skolem">s2</span><span class="main">;</span> <span class="skolem">F</span> <span class="main">∈</span> <span class="skolem">s2</span><span class="main">;</span> <span class="skolem">H</span> <span class="main">▹</span> <span class="skolem">s2</span> <span class="main">∉</span> <span class="free">C</span><span class="main">⟧</span> <span class="main">⟹</span> False"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s1</span> <span class="skolem">s2</span>
      <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">⊆</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">s1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">s1</span> <span class="main">∉</span> <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">⊆</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">s2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">▹</span> <span class="skolem">s2</span> <span class="main">∉</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s1</span> <span class="skolem">s2</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">▹</span> <span class="skolem">s1</span> <span class="main">⊆</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">F</span> <span class="main">▹</span> <span class="skolem">s1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">▹</span> <span class="skolem">s1</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">⊆</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">s1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s1</span>
        <span class="keyword1"><span class="command">using</span></span> that el <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">F</span> <span class="main">▹</span> <span class="skolem">s1</span> <span class="main">∉</span> <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">▹</span> <span class="skolem">F</span> <span class="main">▹</span> <span class="skolem">s2</span> <span class="main">∉</span> <span class="free">C</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> S insert_mono subset_closed_def subset_insertI that<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">from</span></span> m<span class="main">[</span><span class="operator">OF</span> *<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> *<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>4-5<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∈</span> <span class="var">?E</span> <span class="main">∨</span> <span class="skolem">H</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∈</span> <span class="var">?E</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mem_Collect_eq Un_iff
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> finite_Diff insert_Diff si subset_insert_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∪</span> <span class="var">?E</span> <span class="main">∨</span> <span class="skolem">H</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∪</span> <span class="var">?E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
    
  <span class="comment1">(* this proof does benefit from uniform notation a bit. Before it was introduced,
     the subclaims CON, DIS had to be stated as *)</span>  
  <span class="keyword1"><span class="command">have</span></span> CON'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f2</span> <span class="bound">g2</span> <span class="bound">h2</span> <span class="bound">F2</span> <span class="bound">G2</span> <span class="bound">S2</span><span class="main">.</span> <span class="main">⟦</span><span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">s</span> <span class="main">∈</span> <span class="free">C</span><span class="main">;</span> <span class="bound">h2</span> <span class="bound">F2</span> <span class="bound">G2</span> <span class="main">∈</span> <span class="bound">s</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">f2</span> <span class="bound">F2</span> <span class="main">▹</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∨</span> <span class="bound">g2</span> <span class="bound">G2</span> <span class="main">▹</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">C</span><span class="main">;</span> 
                                   <span class="main">∀</span><span class="bound"><span class="bound">s</span></span><span class="main">⊆</span><span class="bound">S2</span><span class="main">.</span> finite <span class="bound">s</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">C</span><span class="main">;</span> <span class="bound">h2</span> <span class="bound">F2</span> <span class="bound">G2</span> <span class="main">∈</span> <span class="bound">S2</span><span class="main">;</span> False<span class="main">⟧</span>
      <span class="main">⟹</span> <span class="bound">f2</span> <span class="bound">F2</span> <span class="main">▹</span> <span class="bound">S2</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">s</span></span><span class="main">⊆</span><span class="bound">S</span><span class="main">.</span> finite <span class="bound">s</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">C</span><span class="main">}</span> <span class="main">∨</span> <span class="bound">g2</span> <span class="bound">G2</span> <span class="main">▹</span> <span class="bound">S2</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">s</span></span><span class="main">⊆</span><span class="bound">S</span><span class="main">.</span> finite <span class="bound">s</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">C</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="comment1">(* (without the False, obviously). The proof of the subclaim does not change gravely, 
      but the f2 g2 h2 have to be instantiated manually upon use (with, e.g., id Not (λF G. <span class="hidden">❙</span><b>¬</b>(F <span class="hidden">❙</span><b>→</b> G))),
      and there were multiple working instantiations. Generally not as beautiful. *)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pcp <span class="main">(</span><span class="free">C</span> <span class="main">∪</span> <span class="var">?E</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pcp_alt
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> ballI conjI<span class="main"><span class="keyword3">;</span></span> <span class="operator">elim</span> UnE<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">unfold</span> mem_Collect_eq<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> C'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> C'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> C'' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span><span class="operator">fail</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> C'' empty_subsetI finite.emptyI finite_insert insert_subset subset_insertI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> C'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> CON <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> C'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> DIS <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">pcp_seq</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">pcp_seq</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pcp_seq</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
  <span class="keyword1">let</span> <span class="bound">Sn</span> <span class="main">=</span> <span class="free">pcp_seq</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">;</span> <span class="bound">Sn1</span> <span class="main">=</span> from_nat <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">▹</span> <span class="bound">Sn</span> <span class="keyword1">in</span>
  <span class="keyword1">if</span> <span class="bound">Sn1</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1">then</span> <span class="bound">Sn1</span> <span class="keyword1">else</span> <span class="bound">Sn</span>
<span class="main">)</span>"</span></span>

<span class="keyword1" id="Consistency-pcp_seq_in"><span class="command">lemma</span></span> pcp_seq_in<span class="main">:</span> <span class="quoted"><span class="quoted">"pcp <span class="free">C</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">⟹</span> pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  
<span class="keyword1" id="Consistency-pcp_seq_mono"><span class="command">lemma</span></span> pcp_seq_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">⟹</span> pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="free">n</span> <span class="main">⊆</span> pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> Suc <span class="skolem">m</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Consistency-pcp_seq_UN"><span class="command">lemma</span></span> pcp_seq_UN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">{</span>pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="bound">n</span><span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> <span class="free">m</span><span class="main">}</span> <span class="main">=</span> pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">f</span> <span class="bound">n</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> Suc <span class="skolem">m</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="main">▹</span> <span class="main">{</span><span class="skolem">f</span> <span class="bound">n</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">m</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="keyword1"><span class="command">using</span></span> le_Suc_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="bound">n</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> Suc <span class="skolem">m</span><span class="main">}</span> <span class="main">=</span> pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="main">▹</span> <span class="main">{</span>pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="bound">n</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">m</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">{</span>pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="bound">n</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> Suc <span class="skolem">m</span><span class="main">}</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">{</span>pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="bound">n</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">m</span><span class="main">}</span> <span class="main">∪</span> pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc pcp_seq_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  
<span class="keyword1" id="Consistency-wont_get_added"><span class="command">lemma</span></span> wont_get_added<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">F</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> countable<span class="main">)</span> formula<span class="main">)</span> <span class="main">∉</span> pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="main">(</span>Suc <span class="main">(</span>to_nat <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">∉</span> pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="main">(</span>Suc <span class="main">(</span>to_nat <span class="free">F</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We don't necessarily have <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span> <span class="main"><span class="main">=</span></span> to_nat <span class="main"><span class="main">(</span></span>from_nat <span class="free"><span class="free">n</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, so this doesn't hold.›</span></span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">pcp_lim</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">⋃</span><span class="main">{</span>pcp_seq <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">n</span><span class="main">|</span><span class="bound">n</span><span class="main">.</span> True<span class="main">}</span>"</span></span>
  
<span class="keyword1" id="Consistency-pcp_seq_sub"><span class="command">lemma</span></span> pcp_seq_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="free">n</span> <span class="main">⊆</span> pcp_lim <span class="free">C</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> pcp_lim_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span>
    
<span class="keyword1" id="Consistency-pcp_lim_inserted_at_ex"><span class="command">lemma</span></span> pcp_lim_inserted_at_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> pcp_lim <span class="free">C</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="free">x</span> <span class="main">∈</span> pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="bound">k</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> pcp_lim_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Consistency-pcp_lim_in"><span class="command">lemma</span></span> pcp_lim_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"pcp <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> el<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> sc<span class="main">:</span> <span class="quoted"><span class="quoted">"subset_closed <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fc<span class="main">:</span> <span class="quoted"><span class="quoted">"finite_character <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pcp_lim <span class="free">C</span> <span class="free">S</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cl</span> <span class="main">∈</span> <span class="free">C</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> pcp_seq_in<span class="main">[</span><span class="operator">OF</span> c el<span class="main">,</span> <span class="operator">THEN</span> allI<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="main">⋃</span><span class="main">{</span>pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="bound">n</span><span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> <span class="bound">m</span><span class="main">}</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pcp_seq_UN <span class="keyword1"><span class="command">.</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">s</span></span> <span class="main">⊆</span> <span class="var">?cl</span><span class="main">.</span> finite <span class="bound">s</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula set"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="main">(</span>Suc <span class="main">(</span>Max <span class="main">(</span>to_nat <span class="main">`</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> pcp_lim <span class="free">C</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pcp_seq_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">s</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">⊆</span> pcp_lim <span class="free">C</span> <span class="free">S</span>›</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">s</span> <span class="main">⊆</span> pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="bound">k</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span> 
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">s</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">s</span> <span class="main">⊆</span> pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="bound">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> k1 <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="skolem">k2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> pcp_lim_inserted_at_ex insert.prems insert_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">▹</span> <span class="skolem">s</span> <span class="main">⊆</span> pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="main">(</span>max <span class="skolem">k1</span> <span class="skolem">k2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> pcp_seq_mono dual_order.trans insert_subset max.bounded_iff order_refl subsetCE<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> pcp_seq_in<span class="main">[</span><span class="operator">OF</span> c el<span class="main">]</span> sc
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subset_closed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cl</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fc <span class="keyword1"><span class="command">unfolding</span></span> finite_character_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Consistency-cl_max"><span class="command">lemma</span></span> cl_max<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"pcp <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sc<span class="main">:</span> <span class="quoted"><span class="quoted">"subset_closed <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> el<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">K</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> su<span class="main">:</span> <span class="quoted"><span class="quoted">"pcp_lim <span class="free">C</span> <span class="free">S</span> <span class="main">⊆</span> <span class="free">K</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pcp_lim <span class="free">C</span> <span class="free">S</span> <span class="main">=</span> <span class="free">K</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="var">?e</span>›</span></span>
  <span class="keyword1"><span class="command">with</span></span> su <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pcp_lim <span class="free">C</span> <span class="free">S</span> <span class="main">⊂</span> <span class="free">K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="free">K</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∉</span> pcp_lim <span class="free">C</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> ne <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∉</span> pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="main">(</span>Suc <span class="main">(</span>to_nat <span class="skolem">F</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pcp_seq_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">▹</span> pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="main">(</span>to_nat <span class="skolem">F</span><span class="main">)</span> <span class="main">∉</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">▹</span> pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="main">(</span>to_nat <span class="skolem">F</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">K</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pcp_seq_sub e su <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">▹</span> pcp_seq <span class="free">C</span> <span class="free">S</span> <span class="main">(</span>to_nat <span class="skolem">F</span><span class="main">)</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sc <span class="keyword1"><span class="command">unfolding</span></span> subset_closed_def <span class="keyword1"><span class="command">using</span></span> el <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Consistency-cl_max'"><span class="command">lemma</span></span> cl_max'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"pcp <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sc<span class="main">:</span> <span class="quoted"><span class="quoted">"subset_closed <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">▹</span> pcp_lim <span class="free">C</span> <span class="free">S</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">∈</span> pcp_lim <span class="free">C</span> <span class="free">S</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">▹</span> <span class="free">G</span> <span class="main">▹</span> pcp_lim <span class="free">C</span> <span class="free">S</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">∈</span> pcp_lim <span class="free">C</span> <span class="free">S</span> <span class="main">∧</span> <span class="free">G</span> <span class="main">∈</span> pcp_lim <span class="free">C</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> cl_max<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Consistency-pcp_lim_Hintikka"><span class="command">lemma</span></span> pcp_lim_Hintikka<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"pcp <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sc<span class="main">:</span> <span class="quoted"><span class="quoted">"subset_closed <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fc<span class="main">:</span> <span class="quoted"><span class="quoted">"finite_character <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> el<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Hintikka <span class="main">(</span>pcp_lim <span class="free">C</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cl</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"pcp_lim <span class="free">C</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cl</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pcp_lim_in<span class="main">[</span><span class="operator">OF</span> c el sc fc<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> c<span class="main">[</span><span class="operator">unfolded</span> pcp_alt<span class="main">,</span> <span class="operator">THEN</span> bspec<span class="main">,</span> <span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">∉</span> <span class="var">?cl</span>"</span></span>
    <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span> <span class="main">∈</span> <span class="var">?cl</span> <span class="main">⟹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="skolem">k</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?cl</span> <span class="main">⟹</span> False"</span></span>
    <span class="quoted"><span class="quoted">"Con <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main">∈</span> <span class="var">?cl</span> <span class="main">⟹</span> <span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">H</span> <span class="main">▹</span> <span class="var">?cl</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
    <span class="quoted"><span class="quoted">"Dis <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main">∈</span> <span class="var">?cl</span> <span class="main">⟹</span> <span class="skolem">G</span> <span class="main">▹</span> <span class="var">?cl</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∨</span> <span class="skolem">H</span> <span class="main">▹</span> <span class="var">?cl</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"Con <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main">∈</span> <span class="var">?cl</span> <span class="main">⟹</span> <span class="skolem">G</span> <span class="main">∈</span> <span class="var">?cl</span> <span class="main">∧</span> <span class="skolem">H</span> <span class="main">∈</span> <span class="var">?cl</span>"</span></span>
    <span class="quoted"><span class="quoted">"Dis <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main">∈</span> <span class="var">?cl</span> <span class="main">⟹</span> <span class="skolem">G</span> <span class="main">∈</span> <span class="var">?cl</span> <span class="main">∨</span> <span class="skolem">H</span> <span class="main">∈</span> <span class="var">?cl</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> d<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> cl_max'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> c sc<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> d<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Hintikka_alt <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">theorem</span></span> pcp_sat<span class="main">:</span> <span class="comment1">― ‹model existence theorem›</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> countable formula set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"pcp <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> el<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sat <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">show_types</span><span class="main">]</span><span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> c <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ce</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> <span class="skolem">Ce</span>"</span></span> <span class="quoted"><span class="quoted">"pcp <span class="skolem">Ce</span>"</span></span> <span class="quoted"><span class="quoted">"subset_closed <span class="skolem">Ce</span>"</span></span> <span class="quoted"><span class="quoted">"finite_character <span class="skolem">Ce</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ex1<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span> ex2<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span> ex3<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.trans ex2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> <span class="skolem">Ce</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">⊆</span> <span class="skolem">Ce</span>›</span></span> el <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> pcp_lim_Hintikka <span class="quoted"><span class="quoted">‹pcp <span class="skolem">Ce</span>›</span></span> <span class="quoted"><span class="quoted">‹subset_closed <span class="skolem">Ce</span>›</span></span> <span class="quoted"><span class="quoted">‹finite_character <span class="skolem">Ce</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"Hintikka <span class="main">(</span>pcp_lim <span class="skolem">Ce</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> Hintikkas_lemma <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sat <span class="main">(</span>pcp_lim <span class="skolem">Ce</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> pcp_lim <span class="skolem">Ce</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pcp_seq.simps<span class="main">(</span>1<span class="main">)</span> pcp_seq_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="comment1">(* This and Hintikka's lemma are the only two where we need semantics. 
   Still, I don't think it's meaningful to separate those two into an extra theory. *)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Compactness">
<div class="head">
<h1>Theory Compactness</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Compactness›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Compactness
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Sema.html">Sema</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Compactness-fin_sat_extend"><span class="command">lemma</span></span> fin_sat_extend<span class="main">:</span> <span class="quoted"><span class="quoted">"fin_sat <span class="free">S</span> <span class="main">⟹</span> fin_sat <span class="main">(</span>insert <span class="free">F</span> <span class="free">S</span><span class="main">)</span> <span class="main">∨</span> fin_sat <span class="main">(</span>insert <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> fs<span class="main">:</span> <span class="quoted"><span class="quoted">"fin_sat <span class="free">S</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> nfs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>fin_sat <span class="main">(</span>insert <span class="free">F</span> <span class="free">S</span><span class="main">)</span> <span class="main">∨</span> fin_sat <span class="main">(</span>insert <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> nfs <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s1</span></span> <span class="keyword2"><span class="keyword">where</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">⊆</span> insert <span class="free">F</span> <span class="free">S</span>"</span></span>       <span class="quoted"><span class="quoted">"finite <span class="skolem">s1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>sat <span class="skolem">s1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fin_sat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> nfs <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s2</span></span> <span class="keyword2"><span class="keyword">where</span></span> s2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">⊆</span> insert <span class="main">(</span>Not <span class="free">F</span><span class="main">)</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">s2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>sat <span class="skolem">s2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fin_sat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s1</span> <span class="main">-</span> <span class="main">{</span><span class="free">F</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">s2</span> <span class="main">-</span> <span class="main">{</span>Not <span class="free">F</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?u</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s1 s2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sat <span class="var">?u</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fs <span class="keyword1"><span class="command">unfolding</span></span> fin_sat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> <span class="var">?u</span><span class="main">.</span> <span class="skolem">A</span> <span class="main">⊨</span> <span class="bound">F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊨</span> <span class="free">F</span> <span class="main">∨</span> <span class="skolem">A</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sat <span class="skolem">s1</span> <span class="main">∨</span> sat <span class="skolem">s2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">unfolding</span></span> sat_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">A</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> s1<span class="main">(</span>3<span class="main">)</span> s2<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Compactness-fin_sat_antimono"><span class="command">lemma</span></span> fin_sat_antimono<span class="main">:</span> <span class="quoted"><span class="quoted">"fin_sat <span class="free">F</span> <span class="main">⟹</span> <span class="free">G</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">⟹</span> fin_sat <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fin_sat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemmas</span></span> fin_sat_insert <span class="main">=</span> fin_sat_antimono<span class="main">[</span><span class="operator">OF</span> _ subset_insertI<span class="main">]</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">extender</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> countable<span class="main">)</span> formula set <span class="main">⇒</span> <span class="tfree">'a</span> formula set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">extender</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">extender</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">(</span>
  <span class="keyword1">let</span> <span class="bound">r</span> <span class="main">=</span> <span class="free">extender</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">;</span> 
  <span class="bound">rt</span> <span class="main">=</span> insert <span class="main">(</span>from_nat <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="bound">r</span><span class="main">;</span>
  <span class="bound">rf</span> <span class="main">=</span> insert <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span>from_nat <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="bound">r</span>
  <span class="keyword1">in</span> <span class="keyword1">if</span> fin_sat <span class="bound">rf</span> <span class="keyword1">then</span> <span class="bound">rf</span> <span class="keyword1">else</span> <span class="bound">rt</span>
<span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Compactness-extender_fin_sat"><span class="command">lemma</span></span> extender_fin_sat<span class="main">:</span> <span class="quoted"><span class="quoted">"fin_sat <span class="free">S</span> <span class="main">⟹</span> fin_sat <span class="main">(</span>extender <span class="free">n</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">S</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> mIH <span class="main">=</span> Suc.IH<span class="main">[</span><span class="operator">OF</span> Suc.prems<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"fin_sat <span class="main">(</span>insert <span class="main">(</span>Not <span class="main">(</span>from_nat <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>extender <span class="skolem">n</span> <span class="skolem">S</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fin_sat <span class="main">(</span>insert <span class="main">(</span><span class="main">(</span>from_nat <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>extender <span class="skolem">n</span> <span class="skolem">S</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mIH fin_sat_extend <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">extended</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">⋃</span><span class="main">{</span>extender <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">|</span><span class="bound">n</span><span class="main">.</span> True<span class="main">}</span>"</span></span>

<span class="keyword1" id="Compactness-extended_max"><span class="command">lemma</span></span> extended_max<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> extended <span class="free">S</span> <span class="main">∨</span> Not <span class="free">F</span> <span class="main">∈</span> extended <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> from_nat <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_to_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> extender <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">S</span> <span class="main">∨</span> Not <span class="free">F</span> <span class="main">∈</span> extender <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> extended_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Compactness-extender_Sucset"><span class="command">lemma</span></span> extender_Sucset<span class="main">:</span> <span class="quoted"><span class="quoted">"extender <span class="free">k</span> <span class="free">S</span> <span class="main">⊆</span> extender <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Compactness-extender_deeper"><span class="command">lemma</span></span> extender_deeper<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> extender <span class="free">k</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">l</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">∈</span> extender <span class="free">l</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> extender_Sucset le_Suc_eq
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> extender.simps<span class="main">)</span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Compactness-extender_subset"><span class="command">lemma</span></span> extender_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> extender <span class="free">k</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> extender_deeper<span class="main">[</span><span class="operator">OF</span> _ le0<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> extender <span class="main">0</span> <span class="skolem">Sa</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main">∈</span> extender <span class="skolem">l</span> <span class="skolem">Sa</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Sa</span> <span class="skolem">l</span> <span class="skolem">F</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compactness-extended_fin_sat"><span class="command">lemma</span></span> extended_fin_sat<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fin_sat <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"fin_sat <span class="main">(</span>extended <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">s</span> <span class="main">⊆</span> extender <span class="skolem">n</span> <span class="free">S</span><span class="main">;</span> finite <span class="skolem">s</span><span class="main">⟧</span> <span class="main">⟹</span> sat <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> extender_fin_sat<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> fin_sat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sat <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> su<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="main">{</span>extender <span class="bound">n</span> <span class="free">S</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> True<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> su <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">{</span>extender <span class="bound">n</span> <span class="free">S</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> True<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> extender <span class="bound">n</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Union_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> extender <span class="bound">n</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> finite_set_choice<span class="main">[</span><span class="operator">OF</span> fin this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> cf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">s</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> extender <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">s</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="main">{</span>extender <span class="bound">n</span> <span class="free">S</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> <span class="bound">k</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> exI subsetI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> cf <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> extender <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> extender <span class="main">(</span>Max <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">elim</span> extender_deeper<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e fin<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">{</span>extender <span class="bound">n</span> <span class="free">S</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> Max <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="skolem">s</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">{</span>extender <span class="bound">n</span> <span class="free">S</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">k</span><span class="main">}</span> <span class="main">=</span> extender <span class="skolem">k</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span> 
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">{</span>extender <span class="bound">n</span> <span class="free">S</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> Suc <span class="skolem">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">{</span>extender <span class="bound">n</span> <span class="free">S</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">k</span><span class="main">}</span> <span class="main">∪</span> extender <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">S</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> Union_eq le_Suc_eq
        <span class="keyword1"><span class="command">using</span></span> le_Suc_eq <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> extender.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> extender_Sucset <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> extender.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sat <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> extended_def fin_sat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compactness-extended_superset"><span class="command">lemma</span></span> extended_superset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> extended <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> extended_def <span class="keyword1"><span class="command">using</span></span> extender.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compactness-extended_complem"><span class="command">lemma</span></span> extended_complem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fs<span class="main">:</span> <span class="quoted"><span class="quoted">"fin_sat <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">F</span> <span class="main">∈</span> extended <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>Not <span class="free">F</span> <span class="main">∈</span> extended <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> fs <span class="main">=</span> fs<span class="main">[</span><span class="operator">THEN</span> extended_fin_sat<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> extended <span class="free">S</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">with</span></span> extended_max <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Not <span class="free">F</span> <span class="main">∉</span> extended <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> False<span class="main">:</span> <span class="quoted"><span class="quoted">"Not <span class="free">F</span> <span class="main">∈</span> extended <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">F</span><span class="main">,</span> Not <span class="free">F</span><span class="main">}</span> <span class="main">⊆</span> extended <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="free">F</span><span class="main">,</span> Not <span class="free">F</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sat <span class="main">{</span><span class="free">F</span><span class="main">,</span> Not <span class="free">F</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fs <span class="keyword1"><span class="command">unfolding</span></span> fin_sat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> sat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compactness-not_fin_sat_extended_UNIV"><span class="command">lemma</span></span> not_fin_sat_extended_UNIV<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> countable formula set"</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>fin_sat <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"extended <span class="free">S</span> <span class="main">=</span> UNIV"</span></span> 
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Note that this crucially depends on the fact that we check \emph{first} whether adding <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="hidden">❙</span><b>¬</b></span></span><span class="free"><span class="free">F</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> makes the set not satisfiable, 
  and add <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> otherwise \emph{without any further checks}.
  The proof of compactness does (to the best of my knowledge) depend on neither of these two facts.›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> fin_sat_def<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> countable formula set"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sat <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> sat_def<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">s</span><span class="main">.</span> <span class="main">¬</span> <span class="skolem">A</span> <span class="main">⊨</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> nfs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>fin_sat <span class="main">(</span>insert <span class="skolem">x</span> <span class="main">(</span>extender <span class="skolem">n</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="skolem">x</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> fin_sat_insert<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> fin_sat_antimono<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> extender_subset<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> notE<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">{</span>extender <span class="bound">n</span> <span class="free">S</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> True<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> extended_def extended_superset insert_absorb insert_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> extender <span class="main">(</span>Suc <span class="main">(</span>to_nat <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> extender.simps Let_def
      <span class="keyword1"><span class="command">unfolding</span></span> if_not_P<span class="main">[</span><span class="operator">OF</span> nfs<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> extended_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compactness-extended_tran"><span class="command">lemma</span></span> extended_tran<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span> <span class="main">⟹</span> extended <span class="free">S</span> <span class="main">⊆</span> extended <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This lemma doesn't hold: think of making S empty and inserting a formula into T s.t. it can never be satisfied simultaneously with the first 
non-tautological formula in the extension S. Showing that this is possible is not worth the effort, since we can't influence the ordering of formulae.
But we showed it anyway.›</span></span>
<span class="keyword1"><span class="command">oops</span></span>
<span class="keyword1" id="Compactness-extended_not_increasing"><span class="command">lemma</span></span> extended_not_increasing<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">S</span> <span class="bound">T</span><span class="main">.</span> fin_sat <span class="bound">S</span> <span class="main">∧</span> fin_sat <span class="bound">T</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">S</span> <span class="main">⊆</span> <span class="bound">T</span> <span class="main">⟶</span> extended <span class="bound">S</span> <span class="main">⊆</span> extended <span class="main">(</span><span class="bound">T</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> countable formula set<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ex_then_min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="main">::</span> nat<span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">P</span> <span class="keyword1"><span class="command">using</span></span> LeastI2_wellorder <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">F</span> <span class="main">=</span> <span class="main">(</span>from_nat <span class="skolem">x</span> <span class="main">::</span> <span class="tfree">'a</span> formula<span class="main">)</span> <span class="keyword1">in</span> <span class="main">(</span><span class="main">∃</span><span class="bound">A</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">A</span> <span class="main">⊨</span> <span class="bound">F</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊨</span> <span class="bound">F</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def Let_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"to_nat <span class="main">(</span>Atom undefined <span class="main">::</span> <span class="tfree">'a</span> formula<span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ex_then_min<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> Px<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> lessx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="skolem">P</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">using</span></span> not_less_Least <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">::</span> <span class="tfree">'a</span> formula set"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>from_nat <span class="skolem">x</span> <span class="main">::</span> <span class="tfree">'a</span> formula<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"fin_sat <span class="var">?S</span>"</span></span> <span class="quoted"><span class="quoted">"fin_sat <span class="var">?T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Px <span class="keyword1"><span class="command">unfolding</span></span> P_def fin_sat_def sat_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> reject<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">A</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">A</span><span class="main">.</span> <span class="main">¬</span> <span class="skolem">Q</span> <span class="bound">A</span> <span class="main">⟹</span> False"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span> <span class="skolem">Q</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main">∈</span> extender <span class="skolem">y</span> <span class="var">?S</span> <span class="main">⟹</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">F</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> extender <span class="skolem">y</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.IH Suc.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"from_nat <span class="skolem">y</span> <span class="main">::</span> <span class="tfree">'a</span> formula"</span></span>
    <span class="keyword1"><span class="command">have</span></span> ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">A</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">A</span> <span class="main">⊨</span> <span class="var">?Y</span><span class="main">)</span> <span class="main">∨</span> <span class="main">⊨</span> <span class="var">?Y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> formula_semantics.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> P_def Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Suc_le_lessD lessx<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">A</span> <span class="main">⊨</span> <span class="var">?Y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"fin_sat <span class="main">(</span>Not <span class="var">?Y</span> <span class="main">▹</span> extender <span class="skolem">y</span> <span class="var">?S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">note</span></span><span class="main">[</span><span class="main">[</span><span class="operator">show_types</span><span class="main">]</span><span class="main">]</span>
      <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊨</span> Not <span class="var">?Y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fin_sat_def sat_def  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">elim</span> allE<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span>Not <span class="var"><span class="var"><span class="var">?Y</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">⊨</span> <span class="var">?Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">A</span> <span class="main">⊨</span> <span class="var">?Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> fin_sat <span class="main">(</span>Not <span class="var">?Y</span> <span class="main">▹</span> extender <span class="skolem">y</span> <span class="var">?S</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">⊨</span> <span class="var">?Y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> contrapos_np<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">⊨</span> <span class="var">?Y</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">A</span> <span class="main">⊨</span> <span class="var">?Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="var">?Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"fin_sat <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="var">?Y</span> <span class="main">▹</span> extender <span class="skolem">y</span> <span class="var">?S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fin_sat_def sat_def
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">.</span> False"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rev_subsetD<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span> *<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main"><span class="keyword3">;</span></span> <span class="operator">elim</span> disjE<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> * 1 2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fin_sat <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>from_nat <span class="skolem">x</span><span class="main">)</span> <span class="main">▹</span> extender <span class="skolem">x</span> <span class="var">?S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Px <span class="keyword1"><span class="command">unfolding</span></span> P_def Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fin_sat_def sat_def<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> formula_semantics.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Not <span class="main">(</span>from_nat <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> extender <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span> <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Not <span class="main">(</span>from_nat <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> extended <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> extended_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Not <span class="main">(</span>from_nat <span class="skolem">x</span><span class="main">)</span> <span class="main">∉</span> extended <span class="var">?T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> extended_complem extended_superset s<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Compactness-not_in_extended_FE"><span class="command">lemma</span></span> not_in_extended_FE<span class="main">:</span> <span class="quoted"><span class="quoted">"fin_sat <span class="free">S</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">¬</span>sat <span class="main">(</span>insert <span class="main">(</span>Not <span class="free">F</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">∉</span> extended <span class="free">S</span> <span class="main">⟹</span> <span class="free">G</span> <span class="main">⊆</span> extended <span class="free">S</span> <span class="main">⟹</span> finite <span class="free">G</span> <span class="main">⟹</span> False"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Not <span class="free">F</span> <span class="main">∈</span> extended <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> extended_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> 1 extended_fin_sat fin_sat_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_eq_empty_iff finite.insertI insert_Diff_if<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Compactness-extended_id"><span class="command">lemma</span></span> extended_id<span class="main">:</span> <span class="quoted"><span class="quoted">"extended <span class="main">(</span>extended <span class="free">S</span><span class="main">)</span> <span class="main">=</span> extended <span class="free">S</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> extended_complem extended_fin_sat extended_max extended_superset not_fin_sat_extended_UNIV 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> equalityI<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span> extended_superset<span class="main">)</span> <span class="operator">blast</span>
  
<span class="comment1">(* This would be nicer, though… 
inductive_set extended_set :: "form set ⇒ form set" for S where
"F ∈ S ⟹ F ∈ extended_set S" |
"fin_sat (insert F (extended_set S)) ∨ F ∈ extended_set S ⟹ F ∈ extended_set S"
but it can't work, as extended is not increasing (?) *)</span>
  
<span class="keyword1" id="Compactness-ext_model"><span class="command">lemma</span></span> ext_model<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"fin_sat <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> Atom <span class="bound">k</span> <span class="main">∈</span> extended <span class="free">S</span><span class="main">)</span> <span class="main">⊨</span> <span class="free">F</span> <span class="main">⟷</span> <span class="free">F</span> <span class="main">∈</span> extended <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> fs <span class="main">=</span> r<span class="main">[</span><span class="operator">THEN</span> extended_fin_sat<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> Elim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∧</span> <span class="skolem">G</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">⟹</span> <span class="main">{</span><span class="skolem">F</span><span class="main">,</span><span class="skolem">G</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">⟹</span> <span class="main">{</span><span class="skolem">F</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">S</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Atom <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Bot
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">∈</span> extended <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">⊥</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⊥</span><span class="main">}</span> <span class="main">⊆</span> extended <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊨</span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fs <span class="keyword1"><span class="command">unfolding</span></span> fin_sat_def sat_def
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">elim</span> allE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="main"><span class="main"><span class="main">⊥</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Not <span class="skolem">F</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊨</span> <span class="skolem">F</span> <span class="main">≠</span> <span class="skolem">A</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span> <span class="skolem">F</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> extended_complem<span class="main">[</span><span class="operator">OF</span> r<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F</span> <span class="main">∈</span> extended <span class="free">S</span> <span class="main">∧</span> <span class="skolem">G</span> <span class="main">∈</span> extended <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span> <span class="main">∈</span> extended <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>sat <span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span><span class="main">)</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">G</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>sat <span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">F</span><span class="main">,</span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>sat <span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> iffI<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> *<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> not_in_extended_FE<span class="main"><span class="main"><span class="main"><span class="main"><span class="main">[</span></span></span></span></span><span class="operator"><span class="operator"><span class="operator">OF</span></span></span> r<span class="main"><span class="main"><span class="main"><span class="main"><span class="main">]</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> And<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F</span> <span class="main">∈</span> extended <span class="free">S</span> <span class="main">∨</span> <span class="skolem">G</span> <span class="main">∈</span> extended <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span> <span class="main">∈</span> extended <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>sat <span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span><span class="main">)</span><span class="main">,</span> <span class="skolem">F</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>sat <span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span><span class="main">)</span><span class="main">,</span> <span class="skolem">G</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">THEN</span> not_in_extended_FE<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">OF</span></span> r<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">F</span> <span class="main">∈</span> extended <span class="free">S</span> <span class="main">∨</span> <span class="skolem">G</span> <span class="main">∈</span> extended <span class="free">S</span><span class="main">;</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span> <span class="main">∉</span> extended <span class="free">S</span><span class="main">⟧</span> <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>sat <span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="skolem">F</span><span class="main">,</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span> <span class="main">∈</span> extended <span class="free">S</span><span class="main">;</span> <span class="skolem">F</span> <span class="main">∉</span> extended <span class="free">S</span><span class="main">;</span> <span class="skolem">G</span> <span class="main">∉</span> extended <span class="free">S</span><span class="main">⟧</span> <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">using</span></span> extended_max not_in_extended_FE<span class="main">[</span><span class="operator">OF</span> r<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> iffI<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> 1 2<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Or<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Imp <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F</span> <span class="main">∈</span> extended <span class="free">S</span> <span class="main">⟶</span> <span class="skolem">G</span> <span class="main">∈</span> extended <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span> <span class="main">∈</span> extended <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>sat <span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span> <span class="main">∈</span> extended <span class="free">S</span><span class="main">;</span> <span class="skolem">F</span> <span class="main">∈</span> extended <span class="free">S</span><span class="main">;</span> <span class="skolem">G</span> <span class="main">∉</span> extended <span class="free">S</span><span class="main">⟧</span> <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">using</span></span> extended_max not_in_extended_FE<span class="main">[</span><span class="operator">OF</span> r<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>sat <span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="skolem">F</span><span class="main">,</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span> <span class="main">∉</span> extended <span class="free">S</span><span class="main">;</span> <span class="skolem">F</span> <span class="main">∉</span> extended <span class="free">S</span><span class="main">⟧</span> <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">using</span></span> extended_max not_in_extended_FE<span class="main">[</span><span class="operator">OF</span> r<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>sat <span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">)</span><span class="main">,</span><span class="skolem">G</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span> <span class="main">∉</span> extended <span class="free">S</span><span class="main">;</span> <span class="skolem">G</span> <span class="main">∈</span> extended <span class="free">S</span><span class="main">⟧</span> <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">using</span></span> extended_max not_in_extended_FE<span class="main">[</span><span class="operator">OF</span> r<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> iffI<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> 1 2 3<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Imp<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> compactness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> countable formula set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sat <span class="free">S</span> <span class="main">⟷</span> fin_sat <span class="free">S</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sat_def fin_sat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
  <span class="keyword1"><span class="command">note</span></span> ext_model<span class="main">[</span><span class="operator">OF</span> r<span class="main">,</span> <span class="operator">THEN</span> iffD2<span class="main">]</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> Atom <span class="bound">k</span> <span class="main">∈</span> extended <span class="free">S</span><span class="main">)</span> <span class="main">⊨</span> <span class="bound">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> extended_superset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> compact_entailment<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> countable formula"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fent<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊫</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Γ'</span><span class="main">.</span> finite <span class="bound">Γ'</span> <span class="main">∧</span> <span class="bound">Γ'</span> <span class="main">⊆</span> <span class="free">Γ</span> <span class="main">∧</span> <span class="bound">Γ'</span> <span class="main">⊫</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ND_sem<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⊫</span> <span class="skolem">F</span> <span class="main">⟷</span> <span class="main">¬</span>sat <span class="main">(</span>insert <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="skolem">F</span><span class="main">)</span> <span class="skolem">Γ</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span> <span class="skolem">F</span> <span class="keyword1"><span class="command">unfolding</span></span> sat_def entailment_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">⊫</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">⊆</span> <span class="free">Γ</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> fent<span class="main">[</span><span class="operator">unfolded</span> ND_sem compactness<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> fin_sat <span class="main">(</span>insert <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span><span class="main">)</span> <span class="free">Γ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> fin_sat_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊆</span> insert<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span><span class="main">)</span> <span class="free">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>sat <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">-</span> <span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span><span class="main">}</span> <span class="main">⊫</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ND_sem <span class="keyword1"><span class="command">using</span></span> s<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> sat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">-</span> <span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">Γ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">from</span></span> 2 3 4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> 1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">s</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">{</span></span></span>Not <span class="free"><span class="free"><span class="free">F</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">corollary</span></span> compact_to_formula<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> countable formula"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fent<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊫</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">Γ'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"set <span class="free">Γ'</span> <span class="main">⊆</span> <span class="free">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="free">Γ'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">note</span></span> compact_entailment<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Γ' <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">=</span> set <span class="skolem">Γ''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_list <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> 1<span class="main">)</span>  <span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> entailment_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
    
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Compactness_Consistency">
<div class="head">
<h1>Theory Compactness_Consistency</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Compactness_Consistency
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Consistency.html">Consistency</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">theorem</span></span> <span class="quoted"><span class="quoted">"sat <span class="free">S</span> <span class="main">⟷</span> fin_sat <span class="main">(</span><span class="free">S</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> countable formula set<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">W</span> <span class="main">::</span> <span class="tfree">'a</span> formula set<span class="main">.</span> fin_sat <span class="bound">W</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">unfolding</span></span> mem_Collect_eq <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"pcp <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula set"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> <span class="var">?C</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">s</span></span><span class="main">⊆</span><span class="skolem">S</span><span class="main">.</span> finite <span class="bound">s</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">𝒜</span><span class="main">.</span> <span class="main">∀</span><span class="bound">F</span><span class="main">∈</span><span class="bound">s</span><span class="main">.</span> <span class="bound">𝒜</span> <span class="main">⊨</span> <span class="bound">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_sat_def sat_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> conj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">h</span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">;</span> <span class="skolem">s</span> <span class="main">⊆</span> <span class="skolem">f</span> <span class="skolem">F</span> <span class="main">▹</span> <span class="skolem">g</span> <span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">S</span><span class="main">;</span> finite <span class="skolem">s</span><span class="main">;</span>
        <span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊨</span> <span class="skolem">h</span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="main">⟹</span> <span class="bound">A</span> <span class="main">⊨</span> <span class="skolem">f</span> <span class="skolem">F</span> <span class="main">∧</span> <span class="bound">A</span> <span class="main">⊨</span> <span class="skolem">g</span> <span class="skolem">G</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">𝒜</span><span class="main">.</span> <span class="main">∀</span><span class="bound">F</span><span class="main">∈</span><span class="skolem">s</span><span class="main">.</span> <span class="bound">𝒜</span> <span class="main">⊨</span> <span class="bound">F</span>"</span></span> 
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">s</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula <span class="main">⇒</span> <span class="tfree">'a</span> formula"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula <span class="main">⇒</span> <span class="tfree">'a</span> formula <span class="main">⇒</span> <span class="tfree">'a</span> formula"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">s</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">f</span> <span class="skolem">F</span><span class="main">,</span><span class="skolem">g</span> <span class="skolem">G</span><span class="main">}</span><span class="main">⊆</span><span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">h</span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">s</span><span class="main">-</span><span class="main">{</span><span class="skolem">f</span> <span class="skolem">F</span><span class="main">,</span><span class="skolem">g</span> <span class="skolem">G</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">H</span><span class="main">∈</span><span class="skolem">h</span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">s</span><span class="main">-</span><span class="main">{</span><span class="skolem">f</span> <span class="skolem">F</span><span class="main">,</span><span class="skolem">g</span> <span class="skolem">G</span><span class="main">}</span><span class="main">.</span> <span class="skolem">A</span> <span class="main">⊨</span> <span class="bound">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊨</span> <span class="skolem">f</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊨</span> <span class="skolem">g</span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">H</span><span class="main">∈</span><span class="skolem">h</span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">s</span><span class="main">.</span> <span class="skolem">A</span> <span class="main">⊨</span> <span class="bound">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">h</span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">;</span> <span class="skolem">s1</span> <span class="main">⊆</span> <span class="skolem">f</span> <span class="skolem">F</span> <span class="main">▹</span> <span class="skolem">S</span><span class="main">;</span> <span class="skolem">s2</span> <span class="main">⊆</span> <span class="skolem">g</span> <span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">S</span><span class="main">;</span> finite <span class="skolem">s1</span><span class="main">;</span> <span class="main">∀</span><span class="bound">𝒜</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">s1</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">𝒜</span> <span class="main">⊨</span> <span class="bound">x</span><span class="main">;</span> finite <span class="skolem">s2</span><span class="main">;</span> <span class="main">∀</span><span class="bound">𝒜</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">s2</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">𝒜</span> <span class="main">⊨</span> <span class="bound">x</span><span class="main">;</span>
        <span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊨</span> <span class="skolem">h</span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="main">⟹</span> <span class="bound">A</span> <span class="main">⊨</span> <span class="skolem">f</span> <span class="skolem">F</span> <span class="main">∨</span> <span class="bound">A</span> <span class="main">⊨</span> <span class="skolem">g</span> <span class="skolem">G</span><span class="main">⟧</span> <span class="main">⟹</span> False"</span></span>
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">s1</span> <span class="skolem">s2</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula <span class="main">⇒</span> <span class="tfree">'a</span> formula"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula <span class="main">⇒</span> <span class="tfree">'a</span> formula <span class="main">⇒</span> <span class="tfree">'a</span> formula"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?U</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="main">▹</span> <span class="main">(</span><span class="skolem">s1</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">f</span> <span class="skolem">F</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">s2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span> <span class="skolem">G</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?U</span> <span class="main">⊆</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∈</span> <span class="var">?U</span> <span class="main">⟹</span> <span class="skolem">A</span> <span class="main">⊨</span> <span class="skolem">H</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">H</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
        <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>1<span class="main">)</span> 1<span class="main">(</span>8<span class="main">)</span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊨</span> <span class="skolem">f</span> <span class="skolem">F</span> <span class="main">∨</span> <span class="skolem">A</span> <span class="main">⊨</span> <span class="skolem">g</span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">H</span> <span class="main">∈</span> <span class="skolem">s1</span><span class="main">.</span> <span class="skolem">A</span> <span class="main">⊨</span> <span class="bound">H</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">H</span> <span class="main">∈</span> <span class="skolem">s1</span><span class="main">.</span> <span class="skolem">A</span> <span class="main">⊨</span> <span class="bound">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>7<span class="main">)</span> 2
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffI Diff_empty Diff_iff UnCI insert_iff<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">∉</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> empty_subsetI finite.emptyI finite.insertI formula_semantics.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> insertI1 insert_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">⟶</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="skolem">k</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">⟶</span> False"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="keyword1"><span class="command">using</span></span> a<span class="main">[</span><span class="operator">THEN</span> spec<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>Atom <span class="skolem">k</span><span class="main">,</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span>Atom <span class="skolem">k</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">⟶</span> <span class="skolem">F</span> <span class="main">▹</span> <span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∈</span> Collect fin_sat"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="keyword1"><span class="command">unfolding</span></span> fin_sat_def sat_def mem_Collect_eq <span class="keyword1"><span class="command">using</span></span> conj<span class="main">[</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">⟶</span> <span class="skolem">F</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∈</span> Collect fin_sat <span class="main">∨</span> <span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∈</span> Collect fin_sat"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span>
        <span class="keyword1"><span class="command">unfolding</span></span> fin_sat_def sat_def mem_Collect_eq <span class="keyword1"><span class="command">using</span></span> disj<span class="main">[</span><span class="operator">of</span> <span class="quoted">Or</span> <span class="quoted"><span class="skolem">F</span></span> <span class="quoted"><span class="skolem">G</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> formula_semantics.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">⟶</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">F</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∈</span> Collect fin_sat <span class="main">∨</span> <span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∈</span> Collect fin_sat"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span>
        <span class="keyword1"><span class="command">unfolding</span></span> fin_sat_def sat_def mem_Collect_eq <span class="keyword1"><span class="command">using</span></span> disj<span class="main">[</span><span class="operator">of</span> <span class="quoted">Imp</span> <span class="quoted"><span class="skolem">F</span></span> <span class="quoted"><span class="skolem">G</span></span> <span class="main">_</span> <span class="quoted">Not</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> formula_semantics.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">F</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">⟶</span> <span class="skolem">F</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∈</span> Collect fin_sat"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="keyword1"><span class="command">unfolding</span></span> fin_sat_def sat_def mem_Collect_eq <span class="keyword1"><span class="command">using</span></span> conj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">F</span> <span class="bound">G</span><span class="main">.</span> Not <span class="main">(</span>Not <span class="bound">F</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">F</span></span> <span class="quoted"><span class="skolem">F</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">⟶</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">F</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∈</span> Collect fin_sat <span class="main">∨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∈</span> Collect fin_sat"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span>
        <span class="keyword1"><span class="command">unfolding</span></span> fin_sat_def sat_def mem_Collect_eq <span class="keyword1"><span class="command">using</span></span> disj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">F</span> <span class="bound">G</span><span class="main">.</span> Not <span class="main">(</span>And <span class="bound">F</span> <span class="bound">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">F</span></span> <span class="quoted"><span class="skolem">G</span></span> <span class="main">_</span> <span class="quoted">Not</span> <span class="main">_</span> <span class="quoted">Not</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> formula_semantics.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span> <span class="bound">G</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="bound">G</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">⟶</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="bound">F</span> <span class="main">▹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="bound">G</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∈</span> Collect fin_sat"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fin_sat_def sat_def mem_Collect_eq <span class="keyword1"><span class="command">using</span></span> conj<span class="main">[</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span> <span class="bound">G</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="bound">G</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">⟶</span> <span class="bound">F</span> <span class="main">▹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="bound">G</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∈</span> Collect fin_sat"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fin_sat_def sat_def mem_Collect_eq <span class="keyword1"><span class="command">using</span></span> conj<span class="main">[</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">note</span></span> 1 2 3 4 5 6 7 8 9
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"pcp <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pcp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> pcp_sat 2 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sat_def fin_sat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Sema_Craig">
<div class="head">
<h1>Theory Sema_Craig</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Craig Interpolation using Semantics›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Sema_Craig
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Substitution_Sema.html">Substitution_Sema</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Semantic proof of Craig interpolation following Harrison~\cite{harrison2009handbook}.›</span></span>
  
<span class="comment1">(* we don't really need this lemma, sledgehammer would find a proof anyway. But it would be massively ugly. *)</span>
<span class="keyword1" id="Sema_Craig-subst_true_false"><span class="command">lemma</span></span> subst_true_false<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊨</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊨</span> <span class="main">(</span><span class="main">(</span><span class="free">F</span><span class="main">[</span><span class="main">⊤</span> <span class="main">/</span> <span class="free">n</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="free">F</span><span class="main">[</span><span class="main">⊥</span> <span class="main">/</span> <span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="free">n</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> substitution_lemma fun_upd_idem<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> interpolation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="free">Γ</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">Δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ρ</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="free">Γ</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ρ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="free">ρ</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">Δ</span>"</span></span>
    <span class="quoted"><span class="quoted">"atoms <span class="free">ρ</span> <span class="main">⊆</span> atoms <span class="free">Γ</span>"</span></span>
    <span class="quoted"><span class="quoted">"atoms <span class="free">ρ</span> <span class="main">⊆</span> atoms <span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?as</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"atoms <span class="free">Γ</span> <span class="main">-</span> atoms <span class="free">Δ</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> fas<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?as</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> fas assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">⊨</span> <span class="free">Γ</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="bound">ρ</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⊨</span> <span class="bound">ρ</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">Δ</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>atoms <span class="bound">ρ</span> <span class="main">⊆</span> atoms <span class="free">Γ</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>atoms <span class="bound">ρ</span> <span class="main">⊆</span> atoms <span class="free">Δ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="var"><span class="quoted"><span class="var">?as</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{}</span> <span class="main">=</span> atoms <span class="skolem">Γ</span> <span class="main">-</span> atoms <span class="free">Δ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"atoms <span class="skolem">Γ</span> <span class="main">⊆</span> atoms <span class="free">Δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊨</span> <span class="skolem">Γ</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">Δ</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">Γ</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> atoms <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> atoms <span class="free">Δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Γ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Γ</span><span class="main">[</span><span class="main">⊤</span> <span class="main">/</span> <span class="skolem">a</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="skolem">Γ</span><span class="main">[</span><span class="main">⊥</span> <span class="main">/</span> <span class="skolem">a</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> su<span class="main">:</span> <span class="quoted"><span class="quoted">"atoms <span class="skolem">Γ'</span> <span class="main">⊆</span> atoms <span class="skolem">Γ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Γ'_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> atoms <span class="skolem">Γ</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_atoms<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊨</span> <span class="skolem">Γ</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">Δ</span>›</span></span> e <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="skolem">Γ'</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">Δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> substitution_lemma Γ'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">▹</span> <span class="skolem">A</span> <span class="main">=</span> atoms <span class="skolem">Γ</span> <span class="main">-</span> atoms <span class="free">Δ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∉</span> <span class="skolem">A</span>›</span></span> e <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> atoms <span class="skolem">Γ'</span> <span class="main">-</span> atoms <span class="free">Δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_atoms Γ'_def<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> insert.hyps<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this <span class="quoted"><span class="quoted">‹<span class="main">⊨</span> <span class="skolem">Γ'</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">Δ</span>›</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ρ</span></span> <span class="keyword2"><span class="keyword">where</span></span> ρ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="skolem">Γ'</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ρ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="skolem">ρ</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">Δ</span>"</span></span> <span class="quoted"><span class="quoted">"atoms <span class="skolem">ρ</span> <span class="main">⊆</span> atoms <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"atoms <span class="skolem">ρ</span> <span class="main">⊆</span> atoms <span class="free">Δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarify</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="skolem">Γ</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ρ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ρ<span class="main">(</span>1<span class="main">)</span> subst_true_false <span class="keyword1"><span class="command">unfolding</span></span> Γ'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">with</span></span> ρ su <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ρ</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The above proof is constructive, and it is actually very easy to write a procedure down.›</span></span>
<span class="keyword1"><span class="command">function</span></span> <span class="entity">interpolate</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">interpolate</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> <span class="main">(</span>
<span class="keyword1">let</span> <span class="bound">K</span> <span class="main">=</span> atoms <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">-</span> atoms <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="keyword1">in</span>
  <span class="keyword1">if</span> <span class="bound">K</span> <span class="main">=</span> <span class="main">{}</span>
  <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>
  <span class="keyword1">else</span> <span class="main">(</span>
    <span class="keyword1">let</span> <span class="bound">k</span> <span class="main">=</span> Min <span class="bound">K</span>
    <span class="keyword1">in</span> <span class="free">interpolate</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">[</span><span class="main">⊤</span> <span class="main">/</span> <span class="bound">k</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">[</span><span class="main">⊥</span> <span class="main">/</span> <span class="bound">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span>
  <span class="main">)</span>
<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">simp</span>
<span class="comment1">(* I tried Inf instead of Min first. Only has downsides. *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Showing termination is slightly technical\dots›</span></span>
<span class="keyword1"><span class="command">termination</span></span> <span class="quoted">interpolate</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">F</span><span class="main">,</span><span class="bound">H</span><span class="main">)</span><span class="main">.</span> card <span class="main">(</span>atoms <span class="bound">F</span> <span class="main">-</span> atoms <span class="bound">H</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> 
              <span class="comment1">(* "measure (λ(F,H). card (atoms F))" also works, but doesn't make things more beautiful *)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_atoms_simp<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> psubset_card_mono<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Min <span class="main">(</span>atoms <span class="improper">F</span> <span class="main">-</span> atoms <span class="improper">H</span><span class="main">)</span> <span class="main">∉</span> atoms <span class="improper">H</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> atoms_finite Diff_eq_empty_iff Diff_iff Min_in finite_Diff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Surprisingly, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> interpolate<span class="antiquote"><span class="antiquote">}</span></span></span></span> is even executable,
  despite all the set operations involving <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> atoms<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"interpolate <span class="main">(</span>And <span class="main">(</span>Atom <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">(</span>Atom <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Or <span class="main">(</span>Atom <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Atom <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">⊤</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> Atom <span class="main">1</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="main">⊥</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> Atom <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"simplify_consts <span class="main">(</span>interpolate <span class="main">(</span>And <span class="main">(</span>Atom <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">(</span>Atom <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Or <span class="main">(</span>Atom <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Atom <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="comment1">(* and the wikipedia example: *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">P</span> <span class="main">=</span> Atom <span class="main">(</span><span class="main">0</span> <span class="main">::</span> nat<span class="main">)</span><span class="main">;</span> <span class="bound">Q</span> <span class="main">=</span> Atom <span class="main">1</span><span class="main">;</span> <span class="bound">R</span> <span class="main">=</span> Atom <span class="numeral">2</span><span class="main">;</span> <span class="bound">T</span> <span class="main">=</span> Atom <span class="numeral">3</span><span class="main">;</span>
<span class="bound">φ</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="bound">P</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="bound">Q</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="bound">R</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="bound">Q</span><span class="main">)</span><span class="main">;</span>
<span class="bound">ψ</span> <span class="main">=</span> <span class="main">(</span><span class="bound">T</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="bound">P</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="bound">T</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="bound">R</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
<span class="bound">I</span> <span class="main">=</span> interpolate <span class="bound">φ</span> <span class="bound">ψ</span> <span class="keyword1">in</span>
<span class="main">(</span>size <span class="bound">I</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">23</span> <span class="main">∧</span> simplify_consts <span class="bound">I</span> <span class="main">=</span> Atom <span class="numeral">2</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> Atom <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">code_simp</span>

<span class="keyword1"><span class="command">theorem</span></span> nonexistential_interpolation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> interpolate <span class="free">F</span> <span class="free">H</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t1</span>"</span></span><span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> interpolate <span class="free">F</span> <span class="free">H</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">H</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t2</span>"</span></span><span class="main">)</span>
    <span class="quoted"><span class="quoted">"atoms <span class="main">(</span>interpolate <span class="free">F</span> <span class="free">H</span><span class="main">)</span> <span class="main">⊆</span> atoms <span class="free">F</span> <span class="main">∩</span> atoms <span class="free">H</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?as</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"atoms <span class="free">F</span> <span class="main">-</span> atoms <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> fas<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?as</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t1</span> <span class="main">∧</span> <span class="var">?t2</span> <span class="main">∧</span> <span class="var">?s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"card <span class="var">?as</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">H</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?inf</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Min <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">F</span><span class="main">[</span><span class="main">⊤</span> <span class="main">/</span> <span class="var">?inf</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="skolem">F</span><span class="main">[</span><span class="main">⊥</span> <span class="main">/</span> <span class="var">?inf</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"Min <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span> <span class="main">∈</span> atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Min_in Suc.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> card.empty nat.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> card <span class="main">(</span>atoms <span class="skolem">G</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G_def subst_atoms_simp
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">=</span> card <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Min <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span> <span class="main">∈</span> atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"Min <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span> <span class="main">∈</span> atoms <span class="skolem">F</span> <span class="main">∧</span> Min <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span> <span class="main">∉</span> atoms <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> card <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> card <span class="main">(</span>atoms <span class="main">(</span><span class="skolem">F</span><span class="main">[</span><span class="main">⊤</span> <span class="main">/</span> Min <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∪</span> atoms <span class="main">(</span><span class="skolem">F</span><span class="main">[</span><span class="main">⊥</span> <span class="main">/</span> Min <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> formula.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Diff_insert Diff_insert2 Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Un_absorb Un_empty_right card_Diff_singleton e subst_atoms top_atoms_simp<span class="main">)</span>
        <span class="comment1">(* you need to tell sledgehammer about formula.set if you want it to find a proof here… *)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> card <span class="main">(</span>atoms <span class="main">(</span><span class="main">(</span><span class="skolem">F</span><span class="main">[</span><span class="main">⊤</span> <span class="main">/</span> Min <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="skolem">F</span><span class="main">[</span><span class="main">⊥</span> <span class="main">/</span> Min <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>atoms <span class="skolem">G</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>3-<span class="main">)</span> e
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G_def substitution_lemma<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> interpolate <span class="skolem">G</span> <span class="skolem">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> interpolate <span class="skolem">G</span> <span class="skolem">H</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">H</span>"</span></span> 
        <span class="quoted"><span class="quoted">"atoms <span class="main">(</span>interpolate <span class="skolem">G</span> <span class="skolem">H</span><span class="main">)</span> <span class="main">⊆</span> atoms <span class="skolem">G</span> <span class="main">∩</span> atoms <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G_def 
      <span class="keyword1"><span class="command">using</span></span> subst_true_false <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span> <span class="comment1">(* sledgehammer… *)</span>
        <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"atoms <span class="main">(</span>interpolate <span class="main">(</span><span class="main">(</span><span class="skolem">F</span><span class="main">[</span><span class="main">⊤</span><span class="main">/</span>Min <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="skolem">F</span><span class="main">[</span><span class="main">⊥</span><span class="main">/</span>Min <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="skolem">H</span><span class="main">)</span> <span class="main">⊆</span> atoms <span class="main">(</span><span class="skolem">F</span><span class="main">[</span><span class="main">⊤</span><span class="main">/</span>Min <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∪</span> atoms <span class="main">(</span><span class="skolem">F</span><span class="main">[</span><span class="main">⊥</span><span class="main">/</span>Min <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> atoms <span class="main">(</span>interpolate <span class="main">(</span><span class="main">(</span><span class="skolem">F</span><span class="main">[</span><span class="main">⊤</span><span class="main">/</span>Min <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="skolem">F</span><span class="main">[</span><span class="main">⊥</span><span class="main">/</span>Min <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="skolem">H</span><span class="main">)</span> <span class="main">⊆</span> atoms <span class="skolem">H</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"atoms <span class="main">(</span><span class="main">(</span><span class="main">⊥</span><span class="main">::</span><span class="tfree">'a</span> formula<span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main">=</span> atoms <span class="main">⊥</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"atoms <span class="skolem">F</span> <span class="main">-</span> <span class="main">{</span>Min <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> atoms <span class="main">(</span><span class="skolem">F</span><span class="main">[</span><span class="main">⊤</span><span class="main">/</span>Min <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> DiffD1 Top_def Un_empty_right e formula.simps<span class="main"><span class="main">(</span></span>91<span class="main"><span class="main">)</span></span> subst_atoms<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"atoms <span class="main">(</span><span class="skolem">F</span><span class="main">[</span><span class="main">⊥</span><span class="main">/</span>Min <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> atoms <span class="main">(</span><span class="skolem">F</span><span class="main">[</span><span class="main">⊤</span><span class="main">/</span>Min <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> DiffD1 Top_def e subst_atoms<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> atoms <span class="skolem">F</span> <span class="main">⊆</span> atoms <span class="skolem">H</span> <span class="main">⟶</span> atoms <span class="main">(</span>interpolate <span class="main">(</span><span class="main">(</span><span class="skolem">F</span><span class="main">[</span><span class="main">⊤</span><span class="main">/</span>Min <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="skolem">F</span><span class="main">[</span><span class="main">⊥</span><span class="main">/</span>Min <span class="main">(</span>atoms <span class="skolem">F</span> <span class="main">-</span> atoms <span class="skolem">H</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="skolem">H</span><span class="main">)</span> <span class="main">⊆</span> atoms <span class="skolem">F</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f3 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main"><span class="keyword3">;</span></span> <span class="operator">subst</span> interpolate.simps<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> interpolate.simps <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def G_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹So no, the proof is by no means easier this way.
  Admittedly, part of the fuzz is due to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Min<span class="antiquote"><span class="antiquote">}</span></span></span></span>,
  but replacing atoms with something that returns lists doesn't make it better.›</span></span>
    

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SC">
<div class="head">
<h1>Theory SC</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Proof Systems›</span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Sequent Calculus›</span></span>

<span class="keyword1"><span class="command">theory</span></span> SC
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Formulas.html">Formulas</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Multiset.html">HOL-Library.Multiset</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">msins</span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">,</span> _"</span> <span class="main">[</span>56<span class="main">,</span>56<span class="main">]</span> 56<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">==</span> add_mset <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span>"</span></span>  

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We do not formalize the concept of sequents, only that of sequent calculus derivations.›</span></span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">SCp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula multiset <span class="main">⇒</span> <span class="tfree">'a</span> formula multiset <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">⇒</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>53<span class="main">]</span> 53<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
BotL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">∈#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main"><span class="free">⇒</span></span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span>"</span></span> <span class="main">|</span>
Ax<span class="main">:</span> <span class="quoted"><span class="quoted">"Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∈#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">⟹</span> Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∈#</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main"><span class="free">⇒</span></span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span>"</span></span> <span class="main">|</span>
NotL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main">⟹</span> Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span>"</span></span> <span class="main">|</span>
NotR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span>"</span></span> <span class="main">|</span>
AndL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main">⟹</span> And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span>"</span></span> <span class="main">|</span>
AndR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span>"</span></span> <span class="main">|</span>
OrL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span>"</span></span> <span class="main">|</span>
OrR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span>"</span></span> <span class="main">|</span>
ImpL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span>"</span></span> <span class="main">|</span>
ImpR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Many of the proofs here are inspired Troelstra and Schwichtenberg~\cite{troelstra2000basic}.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> BotL_canonical<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span><span class="main">,</span><span class="free">Γ</span><span class="main">⇒</span><span class="free">Δ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Ax_canonical<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Atom <span class="free">k</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> Atom <span class="free">k</span><span class="main">,</span><span class="free">Δ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> SCp.intros union_single_eq_member<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    

<span class="keyword1" id="SC-lem1"><span class="command">lemma</span></span> lem1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">,</span> <span class="free">M</span> <span class="main">=</span> <span class="free">y</span><span class="main">,</span><span class="free">N</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈#</span> <span class="free">N</span> <span class="main">∧</span> <span class="free">M</span> <span class="main">=</span> <span class="free">y</span><span class="main">,</span><span class="main">(</span><span class="free">N</span> <span class="main">-</span> <span class="main">{#</span><span class="free">x</span><span class="main">#}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add_eq_conv_ex add_mset_remove_trivial add_mset_remove_trivial_eq<span class="main">)</span>

<span class="keyword1" id="SC-lem2"><span class="command">lemma</span></span> lem2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">,</span> <span class="free">M</span> <span class="main">=</span> <span class="free">y</span><span class="main">,</span> <span class="free">N</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">∈#</span> <span class="free">M</span> <span class="main">∧</span> <span class="free">N</span> <span class="main">=</span> <span class="free">x</span><span class="main">,</span> <span class="main">(</span><span class="free">M</span> <span class="main">-</span> <span class="main">{#</span><span class="free">y</span><span class="main">#}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lem1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This is here to deal with a technical problem: the way the simplifier uses <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> add_mset_commute<span class="antiquote"><span class="antiquote">}</span></span></span></span> is really suboptimal for the unification of SC rules.›</span></span>
  
<span class="keyword1" id="SC-sc_insertion_ordering"><span class="command">lemma</span></span> sc_insertion_ordering<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"NO_MATCH <span class="main">(</span><span class="free">I</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">J</span><span class="main">)</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">H</span><span class="main">,</span><span class="free">F</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">G</span><span class="main">,</span><span class="free">S</span> <span class="main">=</span> <span class="free">F</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">G</span><span class="main">,</span><span class="free">H</span><span class="main">,</span><span class="free">S</span>"</span></span>
  <span class="quoted"><span class="quoted">"NO_MATCH <span class="main">(</span><span class="free">I</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">J</span><span class="main">)</span> <span class="free">H</span> <span class="main">⟹</span> NO_MATCH <span class="main">(</span><span class="free">I</span><span class="main"><span class="hidden">❙</span><b>∨</b></span><span class="free">J</span><span class="main">)</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">H</span><span class="main">,</span><span class="free">F</span><span class="main"><span class="hidden">❙</span><b>∨</b></span><span class="free">G</span><span class="main">,</span><span class="free">S</span> <span class="main">=</span> <span class="free">F</span><span class="main"><span class="hidden">❙</span><b>∨</b></span><span class="free">G</span><span class="main">,</span><span class="free">H</span><span class="main">,</span><span class="free">S</span>"</span></span>
  <span class="quoted"><span class="quoted">"NO_MATCH <span class="main">(</span><span class="free">I</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">J</span><span class="main">)</span> <span class="free">H</span> <span class="main">⟹</span> NO_MATCH <span class="main">(</span><span class="free">I</span><span class="main"><span class="hidden">❙</span><b>∨</b></span><span class="free">J</span><span class="main">)</span> <span class="free">H</span> <span class="main">⟹</span> NO_MATCH <span class="main">(</span><span class="free">I</span><span class="main"><span class="hidden">❙</span><b>∧</b></span><span class="free">J</span><span class="main">)</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">H</span><span class="main">,</span><span class="free">F</span><span class="main"><span class="hidden">❙</span><b>∧</b></span><span class="free">G</span><span class="main">,</span><span class="free">S</span> <span class="main">=</span> <span class="free">F</span><span class="main"><span class="hidden">❙</span><b>∧</b></span><span class="free">G</span><span class="main">,</span><span class="free">H</span><span class="main">,</span><span class="free">S</span>"</span></span>
  <span class="quoted"><span class="quoted">"NO_MATCH <span class="main">(</span><span class="free">I</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">J</span><span class="main">)</span> <span class="free">H</span> <span class="main">⟹</span> NO_MATCH <span class="main">(</span><span class="free">I</span><span class="main"><span class="hidden">❙</span><b>∨</b></span><span class="free">J</span><span class="main">)</span> <span class="free">H</span> <span class="main">⟹</span> NO_MATCH <span class="main">(</span><span class="free">I</span><span class="main"><span class="hidden">❙</span><b>∧</b></span><span class="free">J</span><span class="main">)</span> <span class="free">H</span> <span class="main">⟹</span> NO_MATCH <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">J</span><span class="main">)</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">H</span><span class="main">,</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">G</span><span class="main">,</span><span class="free">S</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">G</span><span class="main">,</span><span class="free">H</span><span class="main">,</span><span class="free">S</span>"</span></span>
  <span class="quoted"><span class="quoted">"NO_MATCH <span class="main">(</span><span class="free">I</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">J</span><span class="main">)</span> <span class="free">H</span> <span class="main">⟹</span> NO_MATCH <span class="main">(</span><span class="free">I</span><span class="main"><span class="hidden">❙</span><b>∨</b></span><span class="free">J</span><span class="main">)</span> <span class="free">H</span> <span class="main">⟹</span> NO_MATCH <span class="main">(</span><span class="free">I</span><span class="main"><span class="hidden">❙</span><b>∧</b></span><span class="free">J</span><span class="main">)</span> <span class="free">H</span> <span class="main">⟹</span> NO_MATCH <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">J</span><span class="main">)</span> <span class="free">H</span> <span class="main">⟹</span> NO_MATCH <span class="main">(</span><span class="main">⊥</span><span class="main">)</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">H</span><span class="main">,</span><span class="main">⊥</span><span class="main">,</span><span class="free">S</span> <span class="main">=</span> <span class="main">⊥</span><span class="main">,</span><span class="free">H</span><span class="main">,</span><span class="free">S</span>"</span></span>
  <span class="quoted"><span class="quoted">"NO_MATCH <span class="main">(</span><span class="free">I</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">J</span><span class="main">)</span> <span class="free">H</span> <span class="main">⟹</span> NO_MATCH <span class="main">(</span><span class="free">I</span><span class="main"><span class="hidden">❙</span><b>∨</b></span><span class="free">J</span><span class="main">)</span> <span class="free">H</span> <span class="main">⟹</span> NO_MATCH <span class="main">(</span><span class="free">I</span><span class="main"><span class="hidden">❙</span><b>∧</b></span><span class="free">J</span><span class="main">)</span> <span class="free">H</span> <span class="main">⟹</span> NO_MATCH <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">J</span><span class="main">)</span> <span class="free">H</span> <span class="main">⟹</span> NO_MATCH <span class="main">(</span><span class="main">⊥</span><span class="main">)</span> <span class="free">H</span> <span class="main">⟹</span> NO_MATCH <span class="main">(</span>Atom <span class="free">k</span><span class="main">)</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">H</span><span class="main">,</span>Atom <span class="free">l</span><span class="main">,</span><span class="free">S</span> <span class="main">=</span> Atom <span class="free">l</span><span class="main">,</span><span class="free">H</span><span class="main">,</span><span class="free">S</span>"</span></span>
  <span class="comment1">(* I have decided that ⊥ and atoms should be pulled outwards with the lowest priorities. this may not always be smart. *)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    
<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">shows</span></span>
     inR1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">G</span><span class="main">,</span> <span class="free">H</span><span class="main">,</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">H</span><span class="main">,</span> <span class="free">G</span><span class="main">,</span> <span class="free">Δ</span>"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> inL1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">,</span> <span class="free">H</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">H</span><span class="main">,</span> <span class="free">G</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> inR2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span> <span class="free">G</span><span class="main">,</span> <span class="free">H</span><span class="main">,</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">G</span><span class="main">,</span> <span class="free">H</span><span class="main">,</span> <span class="free">F</span><span class="main">,</span> <span class="free">Δ</span>"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> inL2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span> <span class="free">G</span><span class="main">,</span> <span class="free">H</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">G</span><span class="main">,</span> <span class="free">H</span><span class="main">,</span> <span class="free">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
<span class="keyword1"><span class="command">lemmas</span></span> SCp_swap_applies<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span> <span class="main">=</span> inL1 inL2 inR1 inR2

<span class="keyword1" id="SC-NotL_inv"><span class="command">lemma</span></span> NotL_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"Not <span class="free">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span><span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"Not <span class="free">F</span><span class="main">,</span> <span class="free">Γ</span>"</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotL <span class="skolem">Γ'</span> <span class="skolem">G</span> <span class="skolem">Δ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Not <span class="free">F</span> <span class="main">=</span> Not <span class="skolem">G</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lem1 lem2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SCp.intros lem1 lem2<span class="main">)</span>

<span class="keyword1" id="SC-AndL_inv"><span class="command">lemma</span></span> AndL_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"And <span class="free">F</span> <span class="free">G</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">F</span><span class="main">,</span><span class="free">G</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"And <span class="free">F</span> <span class="free">G</span><span class="main">,</span> <span class="free">Γ</span>"</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndL <span class="skolem">F'</span> <span class="skolem">G'</span> <span class="skolem">Γ'</span> <span class="skolem">Δ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"And <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> And <span class="skolem">F'</span> <span class="skolem">G'</span>"</span></span><span class="main"><span class="keyword3">;</span></span> 
       <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lem1 lem2<span class="main"><span class="keyword3">;</span></span>
       <span class="operator">metis</span> add_mset_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SCp.intros lem1 lem2 inL2<span class="main">)</span>

<span class="keyword1" id="SC-OrL_inv"><span class="command">lemma</span></span> OrL_inv<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Or <span class="free">F</span> <span class="free">G</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">∧</span> <span class="free">G</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">induction</span> <span class="quoted"><span class="quoted">"Or <span class="free">F</span> <span class="free">G</span><span class="main">,</span> <span class="free">Γ</span>"</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrL <span class="skolem">F'</span> <span class="skolem">Γ'</span> <span class="skolem">Δ</span> <span class="skolem">G'</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Or <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> Or <span class="skolem">F'</span> <span class="skolem">G'</span>"</span></span><span class="main"><span class="keyword3">;</span></span> 
       <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lem1 lem2<span class="main"><span class="keyword3">;</span></span>
       <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SCp.intros lem1 lem2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="SC-ImpL_inv"><span class="command">lemma</span></span> ImpL_inv<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Imp <span class="free">F</span> <span class="free">G</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span><span class="free">Δ</span> <span class="main">∧</span> <span class="free">G</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">induction</span> <span class="quoted"><span class="quoted">"Imp <span class="free">F</span> <span class="free">G</span><span class="main">,</span> <span class="free">Γ</span>"</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpL <span class="skolem">Γ'</span> <span class="skolem">F'</span> <span class="skolem">Δ</span> <span class="skolem">G'</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Or <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> Or <span class="skolem">F'</span> <span class="skolem">G'</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="comment1">(* oops, I didn't pay attention and used the wrong constructor… doesn't matter! *)</span>
       <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lem1 lem2<span class="main"><span class="keyword3">;</span></span>
       <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SCp.intros lem1 lem2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  
<span class="keyword1" id="SC-ImpR_inv"><span class="command">lemma</span></span> ImpR_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> Imp <span class="free">F</span> <span class="free">G</span><span class="main">,</span><span class="free">Δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">G</span><span class="main">,</span><span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">induction</span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="quoted">"Imp <span class="free">F</span> <span class="free">G</span><span class="main">,</span> <span class="free">Δ</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpR  <span class="skolem">F'</span> <span class="skolem">Γ</span> <span class="skolem">G'</span> <span class="skolem">Δ'</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Or <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> Or <span class="skolem">F'</span> <span class="skolem">G'</span>"</span></span><span class="main"><span class="keyword3">;</span></span> 
       <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lem1 lem2<span class="main"><span class="keyword3">;</span></span>
       <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SCp.intros lem1 lem2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="SC-AndR_inv"><span class="command">lemma</span></span> AndR_inv<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> And <span class="free">F</span> <span class="free">G</span><span class="main">,</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span> <span class="free">Δ</span> <span class="main">∧</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">G</span><span class="main">,</span> <span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="quoted">"And <span class="free">F</span> <span class="free">G</span><span class="main">,</span> <span class="free">Δ</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndR  <span class="skolem">Γ</span> <span class="skolem">F'</span> <span class="skolem">Δ'</span> <span class="skolem">G'</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Or <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> Or <span class="skolem">F'</span> <span class="skolem">G'</span>"</span></span><span class="main"><span class="keyword3">;</span></span> 
       <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lem1 lem2<span class="main"><span class="keyword3">;</span></span>
       <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SCp.intros lem1 lem2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="SC-OrR_inv"><span class="command">lemma</span></span> OrR_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> Or <span class="free">F</span> <span class="free">G</span><span class="main">,</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span><span class="free">G</span><span class="main">,</span><span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="quoted">"Or <span class="free">F</span> <span class="free">G</span><span class="main">,</span> <span class="free">Δ</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrR  <span class="skolem">Γ</span> <span class="skolem">F'</span> <span class="skolem">G'</span> <span class="skolem">Δ'</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Or <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> Or <span class="skolem">F'</span> <span class="skolem">G'</span>"</span></span><span class="main"><span class="keyword3">;</span></span> 
       <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lem1 lem2<span class="main"><span class="keyword3">;</span></span>
       <span class="operator">metis</span> add_mset_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SCp.intros lem1 lem2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="SC-NotR_inv"><span class="command">lemma</span></span> NotR_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> Not <span class="free">F</span><span class="main">,</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">F</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="quoted">"Not <span class="free">F</span><span class="main">,</span> <span class="free">Δ</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotR  <span class="skolem">G</span> <span class="skolem">Γ</span> <span class="skolem">Δ'</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Not <span class="free">F</span> <span class="main">=</span> Not <span class="skolem">G</span>"</span></span><span class="main"><span class="keyword3">;</span></span> 
       <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lem1 lem2<span class="main"><span class="keyword3">;</span></span>
       <span class="operator">metis</span> add_mset_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SCp.intros lem1 lem2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="SC-weakenL"><span class="command">lemma</span></span> weakenL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">F</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span> 
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="SC-weakenR"><span class="command">lemma</span></span> weakenR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span><span class="free">Δ</span> "</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="SC-weakenL_set"><span class="command">lemma</span></span> weakenL_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">+</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> weakenL<span class="main">)</span> 
<span class="keyword1" id="SC-weakenR_set"><span class="command">lemma</span></span> weakenR_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span> <span class="main">+</span> <span class="free">Δ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> weakenR<span class="main">)</span>

<span class="keyword1" id="SC-extended_Ax"><span class="command">lemma</span></span> extended_Ax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∩#</span> <span class="free">Δ</span> <span class="main">≠</span> <span class="main">{#}</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∩#</span> <span class="free">Δ</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈#</span> <span class="free">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈#</span> <span class="free">Δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">W</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="free">Δ</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Not <span class="skolem">W</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Not.prems <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ'</span></span> <span class="skolem"><span class="skolem">Δ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> Not <span class="skolem">W</span><span class="main">,</span><span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">=</span> Not <span class="skolem">W</span><span class="main">,</span><span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_DiffM<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈#</span> <span class="skolem">W</span><span class="main">,</span><span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈#</span> <span class="skolem">W</span><span class="main">,</span><span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> Not.IH<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">W</span><span class="main">,</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Not <span class="skolem">W</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> Not <span class="skolem">W</span><span class="main">,</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> SCp.intros<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> add_mset_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">G</span> <span class="skolem">H</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> And.prems <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ'</span></span> <span class="skolem"><span class="skolem">Δ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> And <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span><span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">=</span> And <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span><span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_DiffM<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">∈#</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">∈#</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">with</span></span> And.IH<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> IH1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∈#</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∈#</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">with</span></span> And.IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> IH2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> IH1 IH2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> SCp.intros<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">G</span> <span class="skolem">H</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Imp <span class="skolem">G</span> <span class="skolem">H</span><span class="main">)</span>
    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹analogously›</span></span> <span class="comment1">(*&lt;*)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">G</span> <span class="skolem">H</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Or.prems <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ'</span></span> <span class="skolem"><span class="skolem">Δ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> Or <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span><span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">=</span> Or <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span><span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_DiffM<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Or.IH <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCp.intros<span class="main">(</span>7<span class="main">,</span>8<span class="main">)</span><span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Imp <span class="skolem">G</span> <span class="skolem">H</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Imp.prems <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ'</span></span> <span class="skolem"><span class="skolem">Δ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> Imp <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span><span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">=</span> Imp <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span><span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_DiffM<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Imp.IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Δ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span><span class="main">,</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="comment1">(*&gt;*)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SC-Bot_delR"><span class="command">lemma</span></span> Bot_delR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span><span class="main">-</span><span class="main">{#</span><span class="main">⊥</span><span class="main">#}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> BotL
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SCp.BotL<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Ax
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SCp.Ax diff_union_swap formula.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> insert_DiffM union_single_eq_member<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NotL
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SCp.NotL diff_single_trivial diff_union_swap2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NotR
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SCp.NotR<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> AndL
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SCp.AndL<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> AndR
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SCp.AndR diff_single_trivial diff_union_swap diff_union_swap2 formula.distinct<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> OrL
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SCp.OrL<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> OrR
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SCp.OrR diff_single_trivial diff_union_swap2 formula.distinct<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span> insert_iff set_mset_add_mset_insert<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> ImpL
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SCp.ImpL diff_single_trivial diff_union_swap2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> ImpR
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SCp.ImpR diff_single_trivial diff_union_swap diff_union_swap2 formula.distinct<span class="main"><span class="main">(</span></span>17<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">corollary</span></span> Bot_delR_simp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">,</span><span class="free">Δ</span> <span class="main">=</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Bot_delR weakenR <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SC_Cut">
<div class="head">
<h1>Theory SC_Cut</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SC_Cut
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SC.html">SC</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Contraction›</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹First, we need contraction:›</span></span>
<span class="keyword1" id="SC_Cut-contract"><span class="command">lemma</span></span> contract<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">F</span><span class="main">,</span><span class="free">F</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟶</span> <span class="free">F</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span><span class="free">F</span><span class="main">,</span><span class="free">Δ</span> <span class="main">⟶</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span><span class="free">Δ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="free">Δ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span><span class="main">,</span> Atom <span class="skolem">k</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">⟹</span> Atom <span class="skolem">k</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span><span class="main">,</span> Atom <span class="skolem">k</span><span class="main">,</span> <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="skolem">Δ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">Γ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lem2 lem1 SCp.intros<span class="main">)</span>  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> Atom <span class="skolem">k</span><span class="main">,</span> Atom <span class="skolem">k</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">⟹</span> <span class="skolem">Γ</span> <span class="main">⇒</span> Atom <span class="skolem">k</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span><span class="main">,</span> Atom <span class="skolem">k</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">Δ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lem2 lem1 SCp.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Bot
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span><span class="main">,</span> <span class="main">⊥</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">⟹</span> <span class="main">⊥</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span><span class="main">,</span> <span class="main">⊥</span><span class="main">,</span> <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="skolem">Δ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Γ</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">,</span> <span class="main">⊥</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">⟹</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">,</span> <span class="skolem">Δ</span><span class="main">)</span>"</span></span>    
    <span class="keyword1"><span class="command">using</span></span> Bot_delR <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Not <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> NotL_inv NotR_inv SCp.NotL SCp.NotR<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">F1</span> <span class="skolem">F2</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> AndR_inv AndL_inv<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> add_mset_commute<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">F1</span> <span class="skolem">F2</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> OrR_inv OrL_inv<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> add_mset_commute<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="comment1">(* Okay, so the induction hypothesis is poison for the simplifier. 
     For some reason, this didn't cause trouble for the other two cases, but here, it does. *)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Imp <span class="skolem">F1</span> <span class="skolem">F2</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ImpR_inv ImpL_inv <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> Imp.IH<span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">corollary</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> contractL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span> <span class="free">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> contractR<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span> <span class="free">F</span><span class="main">,</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span> <span class="free">Δ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> contract <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Cut›</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Which cut rule we show is up to us:›</span></span>
<span class="keyword1" id="SC_Cut-cut_cs_cf"><span class="command">lemma</span></span> cut_cs_cf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> context_sharing_Cut<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">A</span><span class="main">::</span><span class="tfree">'a</span> formula<span class="main">)</span> <span class="bound">Γ</span> <span class="bound">Δ</span><span class="main">.</span> <span class="bound">Γ</span> <span class="main">⇒</span> <span class="bound">A</span><span class="main">,</span><span class="bound">Δ</span> <span class="main">⟹</span> <span class="bound">A</span><span class="main">,</span><span class="bound">Γ</span> <span class="main">⇒</span> <span class="bound">Δ</span> <span class="main">⟹</span> <span class="bound">Γ</span> <span class="main">⇒</span> <span class="bound">Δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> context_free_Cut<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="main">(</span><span class="free">A</span><span class="main">::</span><span class="tfree">'a</span> formula<span class="main">)</span><span class="main">,</span><span class="free">Δ</span> <span class="main">⟹</span> <span class="free">A</span><span class="main">,</span><span class="free">Γ'</span> <span class="main">⇒</span> <span class="free">Δ'</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">+</span> <span class="free">Γ'</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">+</span> <span class="free">Δ'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> context_sharing_Cut<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">Γ</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="free"><span class="free"><span class="free">Γ'</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">Δ</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="free"><span class="free"><span class="free">Δ'</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">metis</span> add.commute union_mset_add_mset_left weakenL_set weakenR_set<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1" id="SC_Cut-cut_cf_cs"><span class="command">lemma</span></span> cut_cf_cs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> context_free_Cut<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">A</span><span class="main">::</span><span class="tfree">'a</span> formula<span class="main">)</span> <span class="bound">Γ</span> <span class="bound">Γ'</span> <span class="bound">Δ</span> <span class="bound">Δ'</span><span class="main">.</span> <span class="bound">Γ</span> <span class="main">⇒</span> <span class="bound">A</span><span class="main">,</span><span class="bound">Δ</span> <span class="main">⟹</span> <span class="bound">A</span><span class="main">,</span><span class="bound">Γ'</span> <span class="main">⇒</span> <span class="bound">Δ'</span> <span class="main">⟹</span> <span class="bound">Γ</span> <span class="main">+</span> <span class="bound">Γ'</span> <span class="main">⇒</span> <span class="bound">Δ</span> <span class="main">+</span> <span class="bound">Δ'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> context_sharing_Cut<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="main">(</span><span class="free">A</span><span class="main">::</span><span class="tfree">'a</span> formula<span class="main">)</span><span class="main">,</span><span class="free">Δ</span> <span class="main">⟹</span> <span class="free">A</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> contractΓΓ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span><span class="main">+</span><span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">⟹</span> <span class="skolem">Γ'</span> <span class="main">⊆#</span> <span class="skolem">Γ</span> <span class="main">⟹</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span> <span class="skolem">Γ'</span> <span class="skolem">Δ</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">Γ</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> weakenL_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>add <span class="skolem">x</span> <span class="skolem">Γ'</span> <span class="skolem">Γ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> add.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈#</span> <span class="skolem">Γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_subset_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ''</span></span> <span class="keyword2"><span class="keyword">where</span></span> Γ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">,</span><span class="skolem">Γ''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> multi_member_split<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> add.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">,</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">Γ''</span> <span class="main">+</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> contractL <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">,</span> <span class="skolem">Γ''</span> <span class="main">+</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> add.IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Γ</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Γ  add.prems<span class="main">(</span>2<span class="main">)</span> subset_mset.order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> contractΔΔ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span><span class="main">+</span><span class="skolem">Δ'</span> <span class="main">⟹</span> <span class="skolem">Δ'</span> <span class="main">⊆#</span> <span class="skolem">Δ</span> <span class="main">⟹</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span> <span class="skolem">Δ</span> <span class="skolem">Δ'</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ'</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">Δ</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> weakenL_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>add <span class="skolem">x</span> <span class="skolem">Δ'</span> <span class="skolem">Δ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> add.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈#</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_subset_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Δ''</span></span> <span class="keyword2"><span class="keyword">where</span></span> Δ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">,</span><span class="skolem">Δ''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> multi_member_split<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> add.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">x</span><span class="main">,</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">Δ''</span> <span class="main">+</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> contractR <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">x</span><span class="main">,</span> <span class="skolem">Δ''</span> <span class="main">+</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> add.IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Δ</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Δ add.prems<span class="main">(</span>2<span class="main">)</span> subset_mset.order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">A</span><span class="main">,</span><span class="free">Δ</span> <span class="main">⟹</span> <span class="free">A</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> context_free_Cut<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="free">Δ</span></span><span class="main">]</span> contractΓΓ contractΔΔ
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="comment1">(* since these are the only lemmas that need contraction on sets, I've decided to transfer those in place *)</span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹According to Troelstra and Schwichtenberg~\cite{troelstra2000basic}, the sharing variant is the one we want to prove.›</span></span>
  
<span class="keyword1" id="SC_Cut-Cut_Atom_pre"><span class="command">lemma</span></span> Cut_Atom_pre<span class="main">:</span> <span class="quoted"><span class="quoted">"Atom <span class="free">k</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> Atom <span class="free">k</span><span class="main">,</span><span class="free">Δ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"Atom <span class="free">k</span><span class="main">,</span><span class="free">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> BotL
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">∈#</span> <span class="skolem">Γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCp.BotL <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ax <span class="skolem">l</span> <span class="skolem">Δ</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Atom <span class="skolem">l</span> <span class="main">∈#</span> <span class="skolem">Δ</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Δ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">=</span> Atom <span class="free">k</span><span class="main">,</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> multi_member_split<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Γ</span> <span class="main">⇒</span> Atom <span class="free">k</span><span class="main">,</span> <span class="skolem">Δ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> contractR <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≠</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Atom <span class="skolem">l</span> <span class="main">∈#</span> Atom <span class="free">k</span><span class="main">,</span> <span class="skolem">Γ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">l</span> <span class="main">∈#</span> <span class="skolem">Γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Atom <span class="skolem">l</span> <span class="main">∈#</span> <span class="skolem">Δ</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCp.Ax<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NotL
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_eq_conv_ex <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.NotL <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> NotL_inv<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NotR
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.NotR <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> NotR_inv<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> AndL
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_eq_conv_ex <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.AndL <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> AndL_inv<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> AndR
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.AndR <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> AndR_inv<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> OrL
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_eq_conv_ex <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.OrL <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> OrL_inv<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> OrR
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.OrR <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> OrR_inv<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> ImpL
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_eq_conv_ex <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.ImpL <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ImpL_inv<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> ImpR
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ImpR_inv <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.ImpR<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We can show the admissibility of the cut rule by induction on the cut formula 
(or, if you will, as a procedure that splits the cut into smaller formulas that get cut).
The only mildly complicated case is that of cutting in an <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Atom <span class="free"><span class="free">k</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
It is, contrary to the general case, only mildly complicated, since the cut formula can only appear principal in the axiom rules.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> cut<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span><span class="free">Δ</span> <span class="main">⟹</span> <span class="free">F</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="free">Δ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Atom <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cut_Atom_pre <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Bot <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Bot_delR <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Not <span class="keyword1"><span class="command">with</span></span>  NotL_inv NotR_inv <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> And <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> AndL_inv AndR_inv weakenL<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Or <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> OrL_inv OrR_inv weakenR<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Imp <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
<span class="comment1">(* an automatic proof:
  thus ?case by (meson ImpL_inv ImpR_inv weakenR)
   a readable one: *)</span>
  <span class="keyword1"><span class="command">from</span></span> ImpR_inv <span class="quoted"><span class="quoted">‹<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> ImpL_inv <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> L<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> weakenR add_ac<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> R <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Imp.IH<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> L<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Imp.IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command">qed</span></span>
  <span class="comment1">(* For this proof to work with FOL, I think we would need very special inversion rules.
  For example, for ∀R, we would need that there's a (finite!) multiset of substitutions S, such that
  instead of having ∀x.F,Δ, having {F[s/x] | s ∈ S} + Δ is enough. I don't think that holds,
  but we may be able to cheat ourselves around it… *)</span>
  
<span class="keyword1"><span class="command">corollary</span></span> cut_cf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">A</span><span class="main">,</span> <span class="free">Δ</span><span class="main">;</span> <span class="free">A</span><span class="main">,</span> <span class="free">Γ'</span> <span class="main">⇒</span> <span class="free">Δ'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">+</span> <span class="free">Γ'</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">+</span> <span class="free">Δ'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cut_cs_cf cut <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> cut<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">Γ'</span> <span class="bound">Δ'</span> <span class="main">(</span><span class="bound">A</span><span class="main">::</span><span class="tfree">'a</span> formula<span class="main">)</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">Γ'</span> <span class="main">⇒</span> <span class="bound">A</span><span class="main">,</span> <span class="bound">Δ'</span><span class="main">;</span> <span class="bound">A</span><span class="main">,</span> <span class="bound">Γ'</span> <span class="main">⇒</span> <span class="bound">Δ'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">Γ'</span> <span class="main">⇒</span> <span class="bound">Δ'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> contraction_admissibility<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span><span class="free">F</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">F</span><span class="main">::</span><span class="tfree">'a</span> formula<span class="main">)</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> cut<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">F</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="free"><span class="free"><span class="free">Γ</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">Δ</span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> extended_Ax<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="comment1">(* yes, unpublished Chapman p 2/5, second to last paragraph. that's right. we can prove contraction with cut. but what's that good for? *)</span>
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SC_Depth">
<div class="head">
<h1>Theory SC_Depth</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SC_Depth
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SC.html">SC</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Many textbook arguments about SC use the depth of the derivation tree as basis for inductions.
We had originally thought that this is mandatory for the proof of contraction,
but found out it is not.
It remains unclear to us whether there is any proof on SC that requires an argument using depth.
›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
We keep our formalization of SC with depth for didactic reasons:
we think that arguments about depth do not need much meta-explanation,
but structural induction and rule induction usually need extra explanation
for students unfamiliar with Isabelle/HOL.
They are also a lot harder to execute.
We dare the reader to write down (a few of) the cases for, e.g. <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>AndL_inv'›</span></span></span></span>, by hand.
›</span></span>

<span class="comment1">(* Warning: This theory may have name collisions with SC.thy… *)</span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">SCc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula multiset <span class="main">⇒</span> <span class="tfree">'a</span> formula multiset <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword3">(</span>_ <span class="keyword1">⇒</span><span class="keyword3">/ </span>_<span class="keyword3">)</span> <span class="keyword1">↓</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>53<span class="main">,</span>53<span class="main">]</span> 53<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
BotL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">∈#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main"><span class="free">⇒</span></span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">↓</span></span> Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span> <span class="main">|</span>
Ax<span class="main">:</span> <span class="quoted"><span class="quoted">"Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∈#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">⟹</span> Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∈#</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main"><span class="free">⇒</span></span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">↓</span></span> Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span> <span class="main">|</span>
NotL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟹</span> Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">↓</span></span> Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span> <span class="main">|</span>
NotR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">↓</span></span> Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span> <span class="main">|</span>
AndL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟹</span> And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">↓</span></span> Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span> <span class="main">|</span>
AndR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">↓</span></span> Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span> <span class="main">|</span>
OrL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">↓</span></span> Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span> <span class="main">|</span>
OrR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">↓</span></span> Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span> <span class="main">|</span>
ImpL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">↓</span></span> Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span> <span class="main">|</span>
ImpR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">↓</span></span> Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> BotL_canonical'<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span><span class="main">,</span><span class="free">Γ</span><span class="main">⇒</span><span class="free">Δ</span> <span class="main">↓</span> Suc <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Ax_canonical'<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Atom <span class="free">k</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> Atom <span class="free">k</span><span class="main">,</span><span class="free">Δ</span> <span class="main">↓</span> Suc <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> SCc.intros union_single_eq_member<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    
<span class="keyword1" id="SC_Depth-deeper"><span class="command">lemma</span></span> deeper<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">+</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCc.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">insert</span> SCc.intros<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span> 
<span class="keyword1" id="SC_Depth-deeper_suc"><span class="command">lemma</span></span> deeper_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> Suc <span class="free">n</span>"</span></span>
  <span class="comment1">(* this version is actually required more often. It can be declared as an elim!, but I want to make its usage explicit *)</span>
  <span class="keyword1"><span class="command">thm</span></span> deeper<span class="main">[</span><span class="operator">unfolded</span> Suc_eq_plus1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">drule</span> deeper<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
    
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The equivalence is obvious.›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> SC_SCp_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Γ</span> <span class="free">Δ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula multiset"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">⟷</span> <span class="var">?p</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> n <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCc.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> deeper_max<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> max <span class="skolem">m</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> max <span class="skolem">n</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="skolem">m</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">Γ</span> <span class="skolem">Δ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula multiset"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">m</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> <span class="bound">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">with</span></span> that<span class="main">[</span><span class="operator">THEN</span> deeper<span class="main">]</span> that
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> max <span class="skolem">n</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> max_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> max <span class="skolem">m</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span>
    <span class="main">(</span><span class="operator">insert</span> SCc.intros<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span> deeper_max<span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* it makes a difference whether we say Ax is 0 or any: with Ax ↓ 0 we could not prove the deepening rules.
   Also, it is important to allow only atoms in Ax, otherwise the inv-rules are not depth preserving.
  Making Ax/BotL start from ≥1 saves proving the base-cases twice
 *)</span>
<span class="keyword1" id="SC_Depth-no_0_SC"><span class="command">lemma</span></span> no_0_SC<span class="main">[</span><span class="operator">dest</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="main">0</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCc.cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">Γ</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">Δ</span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">assumption</span>
    

<span class="keyword1" id="SC_Depth-inR1'"><span class="command">lemma</span></span> inR1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">G</span><span class="main">,</span> <span class="free">H</span><span class="main">,</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">H</span><span class="main">,</span> <span class="free">G</span><span class="main">,</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
<span class="keyword1" id="SC_Depth-inL1'"><span class="command">lemma</span></span> inL1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">,</span> <span class="free">H</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">H</span><span class="main">,</span> <span class="free">G</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
<span class="keyword1" id="SC_Depth-inR2'"><span class="command">lemma</span></span> inR2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span> <span class="free">G</span><span class="main">,</span> <span class="free">H</span><span class="main">,</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">G</span><span class="main">,</span> <span class="free">H</span><span class="main">,</span> <span class="free">F</span><span class="main">,</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
<span class="keyword1" id="SC_Depth-inL2'"><span class="command">lemma</span></span> inL2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span> <span class="free">G</span><span class="main">,</span> <span class="free">H</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">G</span><span class="main">,</span> <span class="free">H</span><span class="main">,</span> <span class="free">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
<span class="keyword1" id="SC_Depth-inR3'"><span class="command">lemma</span></span> inR3'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span> <span class="free">G</span><span class="main">,</span> <span class="free">H</span><span class="main">,</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">H</span><span class="main">,</span> <span class="free">F</span><span class="main">,</span> <span class="free">G</span><span class="main">,</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
<span class="keyword1" id="SC_Depth-inR4'"><span class="command">lemma</span></span> inR4'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span> <span class="free">G</span><span class="main">,</span> <span class="free">H</span><span class="main">,</span> <span class="free">I</span><span class="main">,</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">H</span><span class="main">,</span> <span class="free">I</span><span class="main">,</span> <span class="free">F</span><span class="main">,</span> <span class="free">G</span><span class="main">,</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
<span class="keyword1" id="SC_Depth-inL3'"><span class="command">lemma</span></span> inL3'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span> <span class="free">G</span><span class="main">,</span> <span class="free">H</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">H</span><span class="main">,</span> <span class="free">F</span><span class="main">,</span> <span class="free">G</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
<span class="keyword1" id="SC_Depth-inL4'"><span class="command">lemma</span></span> inL4'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span> <span class="free">G</span><span class="main">,</span> <span class="free">H</span><span class="main">,</span> <span class="free">I</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">H</span><span class="main">,</span> <span class="free">I</span><span class="main">,</span> <span class="free">F</span><span class="main">,</span> <span class="free">G</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
<span class="keyword1"><span class="command">lemmas</span></span> SC_swap_applies<span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span></span></span><span class="main">]</span> <span class="main">=</span> inL1' inL2' inL3' inL4' inR1' inR2' inR3' inR4'
  <span class="comment1">(* these are here because they can be used for more careful reasoning with intro *)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"Atom <span class="free">C</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> Atom <span class="free">D</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> Atom <span class="free">E</span><span class="main">,</span>
       Atom <span class="free">k</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> Atom <span class="free">C</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> Atom <span class="free">D</span><span class="main">,</span> 
       Atom <span class="free">k</span><span class="main">,</span> <span class="main">{#}</span> 
<span class="main">⇒</span> <span class="main">{#</span> Atom <span class="free">E</span> <span class="main">#}</span> <span class="main">↓</span> Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="SC_Depth-Bot_delR'"><span class="command">lemma</span></span> Bot_delR'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span><span class="main">-</span><span class="main">{#</span><span class="main">⊥</span><span class="main">#}</span> <span class="main">↓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCc.induct<span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> BotL <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> SCc.BotL<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="comment1">(* SC.BotL refers to SC.SCp.BotL. Even more interestingly, there used to be a SCc.SC.BotL (which was not reffered to). I'll just leave this here and see how long till someone breaks it. *)</span>
<span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ax <span class="skolem">k</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> SCc.Ax<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">k</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> diff_single_trivial formula.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> insert_DiffM lem1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> NotL <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCc.NotL <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_mset_remove_trivial diff_single_trivial diff_union_swap insert_DiffM<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> NotR <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCc.NotR <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_union_swap formula.distinct<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> AndR <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCc.AndR <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_single_trivial diff_union_swap diff_union_swap2 formula.distinct<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> OrR <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCc.OrR <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_single_trivial diff_union_swap2 formula.distinct<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span> insert_iff set_mset_add_mset_insert<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> ImpL <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCc.ImpL <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_single_trivial diff_union_swap2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> ImpR <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCc.ImpR <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_single_trivial diff_union_swap diff_union_swap2 formula.distinct<span class="main"><span class="main">(</span></span>17<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main">)</span>
  
<span class="keyword1" id="SC_Depth-NotL_inv'"><span class="command">lemma</span></span> NotL_inv'<span class="main">:</span> <span class="quoted"><span class="quoted">"Not <span class="free">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span><span class="free">Δ</span>  <span class="main">↓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"Not <span class="free">F</span><span class="main">,</span> <span class="free">Γ</span>"</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCc.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotL <span class="skolem">Γ'</span> <span class="skolem">G</span> <span class="skolem">Δ</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Not <span class="free">F</span> <span class="main">=</span> Not <span class="skolem">G</span>"</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lem1 lem2 deeper_suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SCp.intros lem1 lem2<span class="main">)</span>

<span class="keyword1" id="SC_Depth-AndL_inv'"><span class="command">lemma</span></span> AndL_inv'<span class="main">:</span> <span class="quoted"><span class="quoted">"And <span class="free">F</span> <span class="free">G</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">F</span><span class="main">,</span><span class="free">G</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"And <span class="free">F</span> <span class="free">G</span><span class="main">,</span> <span class="free">Γ</span>"</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCc.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndL <span class="skolem">F'</span> <span class="skolem">G'</span> <span class="skolem">Γ'</span> <span class="skolem">Δ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"And <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> And <span class="skolem">F'</span> <span class="skolem">G'</span>"</span></span><span class="main"><span class="keyword3">;</span></span> 
       <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lem1 lem2 deeper_suc<span class="main"><span class="keyword3">;</span></span>
       <span class="operator">metis</span> add_mset_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SCc.intros lem1 lem2 inL2'<span class="main">)</span>

<span class="keyword1" id="SC_Depth-OrL_inv'"><span class="command">lemma</span></span> OrL_inv'<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Or <span class="free">F</span> <span class="free">G</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">G</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">induction</span> <span class="quoted"><span class="quoted">"Or <span class="free">F</span> <span class="free">G</span><span class="main">,</span> <span class="free">Γ</span>"</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCc.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrL <span class="skolem">F'</span> <span class="skolem">Γ'</span> <span class="skolem">Δ</span> <span class="skolem">n</span> <span class="skolem">G'</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Or <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> Or <span class="skolem">F'</span> <span class="skolem">G'</span>"</span></span><span class="main"><span class="keyword3">;</span></span> 
       <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lem1 lem2 deeper_suc<span class="main"><span class="keyword3">;</span></span>
       <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SCc.intros lem1 lem2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="SC_Depth-ImpL_inv'"><span class="command">lemma</span></span> ImpL_inv'<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Imp <span class="free">F</span> <span class="free">G</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span><span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">G</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">induction</span> <span class="quoted"><span class="quoted">"Imp <span class="free">F</span> <span class="free">G</span><span class="main">,</span> <span class="free">Γ</span>"</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCc.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpL <span class="skolem">Γ'</span> <span class="skolem">F'</span> <span class="skolem">Δ</span> <span class="skolem">n</span> <span class="skolem">G'</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Or <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> Or <span class="skolem">F'</span> <span class="skolem">G'</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="comment1">(* oops, I didn't pay attention and used the wrong constructor… doesn't matter! *)</span>
       <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lem1 lem2 deeper_suc<span class="main"><span class="keyword3">;</span></span>
       <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SCc.intros lem1 lem2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  
<span class="keyword1" id="SC_Depth-ImpR_inv'"><span class="command">lemma</span></span> ImpR_inv'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> Imp <span class="free">F</span> <span class="free">G</span><span class="main">,</span><span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">G</span><span class="main">,</span><span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">induction</span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="quoted">"Imp <span class="free">F</span> <span class="free">G</span><span class="main">,</span> <span class="free">Δ</span>"</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCc.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpR  <span class="skolem">F'</span> <span class="skolem">Γ</span> <span class="skolem">G'</span> <span class="skolem">Δ'</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Or <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> Or <span class="skolem">F'</span> <span class="skolem">G'</span>"</span></span><span class="main"><span class="keyword3">;</span></span> 
       <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lem1 lem2 deeper_suc<span class="main"><span class="keyword3">;</span></span>
       <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SCc.intros lem1 lem2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="SC_Depth-AndR_inv'"><span class="command">lemma</span></span> AndR_inv'<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> And <span class="free">F</span> <span class="free">G</span><span class="main">,</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">G</span><span class="main">,</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="quoted">"And <span class="free">F</span> <span class="free">G</span><span class="main">,</span> <span class="free">Δ</span>"</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCc.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndR  <span class="skolem">Γ</span> <span class="skolem">F'</span> <span class="skolem">Δ'</span> <span class="skolem">n</span> <span class="skolem">G'</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Or <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> Or <span class="skolem">F'</span> <span class="skolem">G'</span>"</span></span><span class="main"><span class="keyword3">;</span></span> 
       <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lem1 lem2 deeper_suc<span class="main"><span class="keyword3">;</span></span>
       <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SCc.intros lem1 lem2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="SC_Depth-OrR_inv'"><span class="command">lemma</span></span> OrR_inv'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> Or <span class="free">F</span> <span class="free">G</span><span class="main">,</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span><span class="free">G</span><span class="main">,</span><span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="quoted">"Or <span class="free">F</span> <span class="free">G</span><span class="main">,</span> <span class="free">Δ</span>"</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCc.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrR  <span class="skolem">Γ</span> <span class="skolem">F'</span> <span class="skolem">G'</span> <span class="skolem">Δ'</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Or <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> Or <span class="skolem">F'</span> <span class="skolem">G'</span>"</span></span><span class="main"><span class="keyword3">;</span></span> 
       <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lem1 lem2 deeper_suc<span class="main"><span class="keyword3">;</span></span>
       <span class="operator">metis</span> add_mset_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SCc.intros lem1 lem2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="SC_Depth-NotR_inv'"><span class="command">lemma</span></span> NotR_inv'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> Not <span class="free">F</span><span class="main">,</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">F</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="quoted">"Not <span class="free">F</span><span class="main">,</span> <span class="free">Δ</span>"</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCc.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotR  <span class="skolem">G</span> <span class="skolem">Γ</span> <span class="skolem">Δ'</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Not <span class="free">F</span> <span class="main">=</span> Not <span class="skolem">G</span>"</span></span><span class="main"><span class="keyword3">;</span></span> 
       <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lem1 lem2 deeper_suc<span class="main"><span class="keyword3">;</span></span>
       <span class="operator">metis</span> add_mset_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multi_member_split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SCc.intros lem1 lem2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="SC_Depth-weakenL'"><span class="command">lemma</span></span> weakenL'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">F</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>  <span class="main">↓</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCc.induct<span class="main">)</span> 
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="SC_Depth-weakenR'"><span class="command">lemma</span></span> weakenR'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>  <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span><span class="free">Δ</span>  <span class="main">↓</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCc.induct<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="SC_Depth-contract'"><span class="command">lemma</span></span> contract'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">F</span><span class="main">,</span><span class="free">F</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟶</span> <span class="free">F</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span><span class="free">F</span><span class="main">,</span><span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟶</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span><span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="free">Δ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">Γ</span> <span class="skolem">Δ</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> conjI allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ffs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">Γ</span><span class="main">.</span> <span class="bound">Γ</span> <span class="main">-</span> <span class="main">{#</span> <span class="skolem">F</span> <span class="main">#}</span> <span class="main">-</span> <span class="main">{#</span> <span class="skolem">F</span> <span class="main">#}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">insert</span> 1<span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCc.cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">F</span></span><span class="main"><span class="main">,</span></span><span class="skolem"><span class="skolem">F</span></span><span class="main"><span class="main">,</span></span><span class="skolem"><span class="skolem">Γ</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">Δ</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem">n</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotL  <span class="skolem">Γ'</span> <span class="skolem">G</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="skolem">G</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> NotL <span class="keyword1"><span class="command">have</span></span> Γ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> NotL_inv' NotL<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Γ' <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">with</span></span> IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">with</span></span> SCc.NotL <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> e <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">≠</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="skolem">G</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> NotL<span class="main">(</span>2<span class="main">)</span> IH<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">F</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ffs</span> <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span><span class="main">]</span> SCc.NotL<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">-</span> <span class="main">{#</span> <span class="skolem">F</span> <span class="main">#}</span> <span class="main">-</span> <span class="main">{#</span> <span class="skolem">F</span> <span class="main">#}</span>"</span></span> <span class="quoted"><span class="skolem">G</span></span> <span class="quoted"><span class="skolem">Δ</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> e NotL<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> insert_DiffM lem2<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> e NotL<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> Γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Γ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> lem1<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> NotL<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> Γ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span><span class="skolem">F</span><span class="main">,</span><span class="var">?ffs</span> <span class="skolem">Γ'</span> <span class="main">=</span> <span class="skolem">Γ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> NotL<span class="main">(</span>2<span class="main">)</span> IH<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">F</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ffs</span> <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span><span class="main">]</span> SCc.NotL<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="skolem">G</span></span> <span class="quoted"><span class="skolem">Δ</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> Suc <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndL <span class="skolem">G</span> <span class="skolem">H</span> <span class="skolem">Γ'</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> And <span class="skolem">G</span> <span class="skolem">H</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> AndL<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> Γ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">=</span> And <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> AndL<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> Γ' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> AndL_inv'<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inL1' inL3'<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e SCc.AndL <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">≠</span> And <span class="skolem">G</span> <span class="skolem">H</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> AndL<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> Γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> And <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Γ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> diff_diff_add lem2<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> AndL<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Γ inL4' local.AndL<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>1<span class="main">)</span> inL2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCc.AndL <span class="keyword1"><span class="command">unfolding</span></span> Γ <span class="keyword1"><span class="command">using</span></span> inL1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrL <span class="skolem">G</span> <span class="skolem">Γ'</span> <span class="skolem">H</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> Or <span class="skolem">G</span> <span class="skolem">H</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> OrL<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> Γ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">=</span> Or <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Or <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"Or <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> OrL<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> Γ' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> OrL_inv' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> e <span class="keyword1"><span class="command">using</span></span> SCc.OrL <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">≠</span> Or <span class="skolem">G</span> <span class="skolem">H</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> OrL<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> Γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> Or <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Γ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> diff_diff_add lem2<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">G</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span><span class="var">?ffs</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> OrL Γ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> add_mset_commute<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCc.OrL <span class="keyword1"><span class="command">unfolding</span></span> Γ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpL <span class="skolem">Γ'</span> <span class="skolem">G</span> <span class="skolem">H</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> Imp <span class="skolem">G</span> <span class="skolem">H</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> ImpL<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> Γ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">=</span> Imp <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">G</span><span class="main">,</span><span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH ImpL_inv' ImpL<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> Γ'
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_mset_commute<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> e <span class="keyword1"><span class="command">using</span></span> SCc.ImpL<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">≠</span> Imp <span class="skolem">G</span> <span class="skolem">H</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> ImpL<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> Γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> Imp <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Γ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> diff_diff_add lem2<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ImpL Γ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCc.ImpL IH <span class="keyword1"><span class="command">unfolding</span></span> Γ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inL1'<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> ImpR <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IH<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> SCc.intros<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> add_mset_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotR <span class="skolem">G</span> <span class="skolem">Δ'</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SCc.NotR add_mset_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> IH SCc.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>3-10<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ffs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">Γ</span><span class="main">.</span> <span class="bound">Γ</span> <span class="main">-</span> <span class="main">{#</span> <span class="skolem">F</span> <span class="main">#}</span> <span class="main">-</span> <span class="main">{#</span> <span class="skolem">F</span> <span class="main">#}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> not_principal<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">F</span> <span class="main">≠</span> <span class="skolem">f</span> <span class="skolem">G</span> <span class="skolem">H</span><span class="main">;</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Δ'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">Δ</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Δ'</span> <span class="main">∧</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Δ'</span> <span class="main">=</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="skolem">G</span> <span class="skolem">H</span> <span class="skolem">Δ'</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈#</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> lem1<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Δ''</span></span> <span class="keyword2"><span class="keyword">where</span></span> Δ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ'</span> <span class="main">=</span> <span class="skolem">F</span><span class="main">,</span><span class="skolem">Δ''</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_DiffM<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Δ''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈#</span> <span class="skolem">Δ''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> lem1<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Δ'''</span></span> <span class="keyword2"><span class="keyword">where</span></span> Δ''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ''</span> <span class="main">=</span> <span class="skolem">F</span><span class="main">,</span><span class="skolem">Δ'''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_DiffM<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Δ' Δ'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> Δ' Δ'' <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> principal<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Δ'</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">G</span> <span class="skolem">H</span> <span class="main">⟹</span> <span class="skolem">Δ'</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="skolem">G</span> <span class="skolem">H</span> <span class="skolem">Δ'</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCc.cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">Γ</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">F</span></span><span class="main"><span class="main">,</span></span><span class="skolem"><span class="skolem">F</span></span><span class="main"><span class="main">,</span></span><span class="skolem"><span class="skolem">Δ</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem">n</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpR <span class="skolem">G</span> <span class="skolem">H</span> <span class="skolem">Δ'</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> e<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> Imp <span class="skolem">G</span> <span class="skolem">H</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> ImpR<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> Δ'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ'</span> <span class="main">=</span> Imp <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> Imp <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ImpR<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> ImpR_inv'<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">↓</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> SCc.ImpR <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">≠</span> Imp <span class="skolem">G</span> <span class="skolem">H</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> ImpR<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> Δ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">=</span> Imp <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> diff_diff_add lem2<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span><span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Δ'</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ImpR Δ <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCc.ImpR IH <span class="keyword1"><span class="command">unfolding</span></span> Δ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inR1'<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndR <span class="skolem">G</span> <span class="skolem">Δ'</span> <span class="skolem">H</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> And <span class="skolem">G</span> <span class="skolem">H</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> AndR <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> AndR_inv' <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> IH<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False 
        <span class="keyword1"><span class="command">hence</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">=</span> And <span class="skolem">G</span> <span class="skolem">H</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> AndR<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> diff_diff_add lem2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Δ'</span> <span class="main">=</span> <span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> AndR<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">G</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Δ'</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Δ'</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> AndR<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> add_left_imp_eq inR2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Δ'</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Δ'</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> e <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> SCc.AndR<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> inR1'<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrR <span class="skolem">G</span> <span class="skolem">H</span> <span class="skolem">Δ'</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> Or <span class="skolem">G</span> <span class="skolem">H</span>"</span></span> 
      <span class="keyword1"><span class="command">hence</span></span> Δ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ'</span> <span class="main">=</span> <span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> OrR<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> principal<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inR3'<span class="main">[</span><span class="operator">THEN</span> OrR_inv'<span class="main">]</span> OrR<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Γ</span></span> <span class="quoted"><span class="skolem">G</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span><span class="main">,</span><span class="skolem">H</span><span class="main">,</span><span class="skolem">Δ</span>"</span></span><span class="main">]</span> IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Γ</span></span> <span class="quoted"><span class="skolem">H</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span><span class="skolem">Δ</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> add_ac<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span><span class="skolem">H</span><span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span><span class="skolem">G</span><span class="main">#}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> inR2  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">elim</span> SC_swap_applies<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SCc.OrR<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">≠</span> Or <span class="skolem">G</span> <span class="skolem">H</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> not_principal <span class="keyword1"><span class="command">have</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">=</span> <span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">H</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Δ'</span> <span class="main">∧</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Δ'</span> <span class="main">=</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> OrR<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> OrR<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Δ'</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inR2' inR4'<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">H</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Δ'</span> <span class="main">↓</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> SCc.OrR<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> inR1'<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> np <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotR <span class="skolem">G</span> <span class="skolem">Δ'</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> Not <span class="skolem">G</span>"</span></span><span class="main">)</span> 
        <span class="keyword3"><span class="command">case</span></span> True 
        <span class="keyword1"><span class="command">with</span></span> principal NotR<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ'</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">with</span></span> NotR_inv' NotR<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> IH<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">↓</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> SCc.NotR<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False 
        <span class="keyword1"><span class="command">with</span></span> not_principal <span class="keyword1"><span class="command">have</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ'</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="main">{#</span><span class="skolem">F</span><span class="main">#}</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ'</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="main">{#</span><span class="skolem">F</span><span class="main">#}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> NotR<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Δ'</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> NotR<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="var">?ffs</span> <span class="skolem">Δ'</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">elim</span> IH<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> np SCc.NotR inR1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> BotL <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">elim</span> SCc.BotL<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ax <span class="skolem">k</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> SCc.Ax<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">k</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> NotL <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SCc.NotL Suc.IH add_mset_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> AndL <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCc.AndL Suc.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> OrL <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCc.OrL Suc.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> ImpL <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SCc.ImpL Suc.IH add_mset_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>

<span class="comment1">(* depth for cut? *)</span>
<span class="keyword1" id="SC_Depth-Cut_Atom_depth"><span class="command">lemma</span></span> Cut_Atom_depth<span class="main">:</span> <span class="quoted"><span class="quoted">"Atom <span class="free">k</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> Atom <span class="free">k</span><span class="main">,</span><span class="free">Δ</span> <span class="main">↓</span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">+</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"Atom <span class="free">k</span><span class="main">,</span><span class="free">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span>"</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCc.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>BotL <span class="skolem">Δ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">∈#</span> <span class="skolem">Γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCc.BotL  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ax <span class="skolem">l</span> <span class="skolem">Δ</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Atom <span class="skolem">l</span> <span class="main">∈#</span> <span class="skolem">Δ</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Δ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">=</span> Atom <span class="free">k</span><span class="main">,</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> multi_member_split<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Γ</span> <span class="main">⇒</span> Atom <span class="free">k</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> contract' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute deeper<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≠</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Atom <span class="skolem">l</span> <span class="main">∈#</span> Atom <span class="free">k</span><span class="main">,</span> <span class="skolem">Γ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">l</span> <span class="main">∈#</span> <span class="skolem">Γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Atom <span class="skolem">l</span> <span class="main">∈#</span> <span class="skolem">Δ</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCc.Ax<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotL <span class="skolem">Γ</span> <span class="skolem">F</span> <span class="skolem">Δ</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> Γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> Not <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> NotL.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> add_eq_conv_ex formula.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Γ
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> plus_nat.add_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> SCc.NotL<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> NotL.hyps <span class="comment1">(* IH *)</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> NotL Γ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lem2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> Γ NotL.prems NotL_inv' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotR <span class="skolem">F</span> <span class="skolem">Δ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.NotR <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> NotR_inv'<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndL <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">Γ</span> <span class="skolem">Δ</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> Γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> And <span class="skolem">F</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AndL.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> add_eq_conv_diff formula.distinct<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Γ
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> plus_nat.add_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> SCc.AndL<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> AndL.hyps <span class="comment1">(* IH *)</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> AndL Γ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lem2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> Γ AndL.prems AndL_inv' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndR <span class="skolem">F</span> <span class="skolem">Δ</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> AndR_inv' SCc.AndR <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_Suc inR1'<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrL <span class="skolem">F</span> <span class="skolem">Γ'</span> <span class="skolem">Δ</span> <span class="skolem">n</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ''</span></span> <span class="keyword2"><span class="keyword">where</span></span> Γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> Or <span class="skolem">F</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> OrL.hyps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> add_eq_conv_ex formula.simps<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ihm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">=</span> Atom <span class="free">k</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">=</span> Atom <span class="free">k</span><span class="main">,</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> OrL Γ  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lem2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Γ
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> plus_nat.add_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> SCc.OrL OrL.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> ihm<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> OrL.hyps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> ihm<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> Γ OrL.prems OrL_inv' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> Γ OrL.prems OrL_inv' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrR <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">Δ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> OrR_inv'<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpL <span class="skolem">Γ'</span> <span class="skolem">F</span> <span class="skolem">Δ</span> <span class="skolem">n</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ''</span></span> <span class="keyword2"><span class="keyword">where</span></span> Γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> Imp <span class="skolem">F</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ImpL.hyps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> add_eq_conv_ex formula.simps<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Γ
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> plus_nat.add_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> SCc.ImpL ImpL.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ImpL.hyps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> ImpL Γ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lem2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> Γ ImpL.prems <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ImpL_inv'<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> ImpL Γ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lem2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> Γ ImpL.prems ImpL_inv' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpR <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">Δ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ImpR_inv' <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCc.ImpR<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">cut_bound</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> formula <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cut_bound</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Atom <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">cut_bound</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> Bot <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">cut_bound</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">cut_bound</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">cut_bound</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">cut_bound</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free">cut_bound</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">cut_bound</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">cut_bound</span> <span class="main">(</span><span class="free">cut_bound</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">cut_bound</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">cut_bound</span> <span class="main">(</span><span class="free">cut_bound</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>
<span class="keyword1"><span class="command">theorem</span></span> cut_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span><span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">F</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>  <span class="main">↓</span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> cut_bound <span class="free">n</span> <span class="free">m</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">k</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cut_Atom_depth <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Bot <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Bot_delR' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Not <span class="keyword1"><span class="command">from</span></span> Not.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> NotL_inv' NotR_inv' <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Not.IH <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> weakenL<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span> <span class="keyword1"><span class="command">from</span></span> And.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> AndL_inv' AndR_inv' <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> And.IH <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> weakenR' weakenL'<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span> <span class="keyword1"><span class="command">from</span></span> Or.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> OrL_inv' OrR_inv' <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Or.IH <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>  weakenR' weakenL'<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Imp <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ImpR_inv' <span class="quoted"><span class="quoted">‹<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> ImpL_inv' <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> L<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> weakenR' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> Imp.IH<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this R<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">↓</span> cut_bound <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> Imp.IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this L<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> cut_bound <span class="main">(</span>cut_bound <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">F</span><span class="main">)</span> <span class="skolem">m</span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> cut_bound <span class="skolem">n</span> <span class="skolem">m</span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">cut_bound'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> formula <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cut_bound'</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>Atom <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">cut_bound'</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> Bot <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">cut_bound'</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">cut_bound'</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">cut_bound'</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">cut_bound'</span> <span class="main">(</span><span class="free">cut_bound'</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">cut_bound'</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">cut_bound'</span> <span class="main">(</span><span class="free">cut_bound'</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">cut_bound'</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">cut_bound'</span> <span class="main">(</span><span class="free">cut_bound'</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>
  
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="SC_Depth-cut_bound'_mono"><span class="command">lemma</span></span> cut_bound'_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> cut_bound' <span class="free">a</span> <span class="free">F</span> <span class="main">≤</span> cut_bound' <span class="free">b</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
    
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="SC_Depth-cut_bound_mono"><span class="command">lemma</span></span> cut_bound_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span> cut_bound <span class="free">a</span> <span class="free">b</span> <span class="free">F</span> <span class="main">≤</span> cut_bound <span class="free">c</span> <span class="free">d</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">d</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
    
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="SC_Depth-cut_bound_max"><span class="command">lemma</span></span> cut_bound_max<span class="main">:</span> <span class="quoted"><span class="quoted">"max <span class="free">n</span> <span class="main">(</span>cut_bound' <span class="main">(</span>max <span class="free">n</span> <span class="free">m</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> cut_bound' <span class="main">(</span>max <span class="free">n</span> <span class="free">m</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="SC_Depth-cut_bound_max'"><span class="command">lemma</span></span> cut_bound_max'<span class="main">:</span> <span class="quoted"><span class="quoted">"max <span class="free">n</span> <span class="main">(</span>cut_bound' <span class="free">n</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> cut_bound' <span class="free">n</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> max.assoc<span class="main">)</span>
    
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="SC_Depth-cut_bound_'"><span class="command">lemma</span></span> cut_bound_'<span class="main">:</span> <span class="quoted"><span class="quoted">"cut_bound <span class="free">n</span> <span class="free">m</span> <span class="free">F</span> <span class="main">≤</span> cut_bound' <span class="main">(</span>max <span class="free">n</span> <span class="free">m</span><span class="main">)</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Not <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> max.commute<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">F1</span> <span class="skolem">F2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> And.IH<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"cut_bound <span class="skolem">n</span> <span class="main">(</span>cut_bound <span class="skolem">n</span> <span class="skolem">m</span> <span class="skolem">F1</span><span class="main">)</span> <span class="skolem">F2</span> <span class="main">≤</span> cut_bound <span class="skolem">n</span> <span class="main">(</span>cut_bound' <span class="main">(</span>max <span class="skolem">n</span> <span class="skolem">m</span><span class="main">)</span> <span class="skolem">F1</span><span class="main">)</span> <span class="skolem">F2</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> cut_bound_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> order.refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> And.IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> cut_bound' <span class="main">(</span>max <span class="skolem">n</span> <span class="main">(</span>cut_bound' <span class="main">(</span>max <span class="skolem">n</span> <span class="skolem">m</span><span class="main">)</span> <span class="skolem">F1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">F2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cut_bound' <span class="main">(</span>cut_bound' <span class="main">(</span>max <span class="skolem">n</span> <span class="skolem">m</span><span class="main">)</span> <span class="skolem">F1</span><span class="main">)</span> <span class="skolem">F2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_bound_max<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">F1</span> <span class="skolem">F2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Or.IH<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"cut_bound <span class="main">(</span>cut_bound <span class="skolem">n</span> <span class="skolem">m</span> <span class="skolem">F1</span><span class="main">)</span> <span class="skolem">m</span> <span class="skolem">F2</span> <span class="main">≤</span> cut_bound <span class="main">(</span>cut_bound' <span class="main">(</span>max <span class="skolem">n</span> <span class="skolem">m</span><span class="main">)</span> <span class="skolem">F1</span><span class="main">)</span> <span class="skolem">m</span> <span class="skolem">F2</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> cut_bound_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ order.refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> Or.IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cut_bound' <span class="main">(</span>max <span class="skolem">n</span> <span class="skolem">m</span><span class="main">)</span> <span class="skolem">F1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> cut_bound' <span class="main">(</span>max <span class="main">(</span>cut_bound' <span class="main">(</span>max <span class="skolem">n</span> <span class="skolem">m</span><span class="main">)</span> <span class="skolem">F1</span><span class="main">)</span> <span class="skolem">m</span><span class="main">)</span> <span class="skolem">F2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cut_bound' <span class="main">(</span>cut_bound' <span class="main">(</span>max <span class="skolem">n</span> <span class="skolem">m</span><span class="main">)</span> <span class="skolem">F1</span><span class="main">)</span> <span class="skolem">F2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_bound_max max.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Imp <span class="skolem">F1</span> <span class="skolem">F2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Imp.IH<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"cut_bound <span class="main">(</span>cut_bound <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">F1</span><span class="main">)</span> <span class="skolem">m</span> <span class="skolem">F2</span> <span class="main">≤</span> cut_bound <span class="main">(</span>cut_bound' <span class="main">(</span>max <span class="skolem">m</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">F1</span><span class="main">)</span> <span class="skolem">m</span> <span class="skolem">F2</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> cut_bound_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ order.refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> Imp.IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cut_bound' <span class="main">(</span>max <span class="skolem">m</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">F1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> cut_bound' <span class="main">(</span>max <span class="main">(</span>cut_bound' <span class="main">(</span>max <span class="skolem">m</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">F1</span><span class="main">)</span> <span class="skolem">m</span><span class="main">)</span> <span class="skolem">F2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cut_bound' <span class="main">(</span>cut_bound' <span class="main">(</span>max <span class="skolem">n</span> <span class="skolem">m</span><span class="main">)</span> <span class="skolem">F1</span><span class="main">)</span> <span class="skolem">F2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_bound_max max.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
    
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">depth</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">depth</span> <span class="main">(</span>Atom <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">depth</span> Bot <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">depth</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">depth</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">depth</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>max <span class="main">(</span><span class="free">depth</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">depth</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">depth</span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>max <span class="main">(</span><span class="free">depth</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">depth</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">depth</span> <span class="main">(</span>Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>max <span class="main">(</span><span class="free">depth</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">depth</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">primrec</span></span> <span class="comment1">(* primrec works, but fun would give me a nicer induction rule *)</span> <span class="entity">cbnd</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cbnd</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">cbnd</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">cbnd</span> <span class="main">(</span><span class="free">cbnd</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
  
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="SC_Depth-cbnd_grow"><span class="command">lemma</span></span> cbnd_grow<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span> <span class="main">::</span> nat<span class="main">)</span> <span class="main">≤</span> cbnd <span class="free">k</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">d</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> le_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="SC_Depth-cbnd_mono"><span class="command">lemma</span></span> cbnd_mono<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cbnd <span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span> <span class="free">b</span> <span class="main">≤</span> cbnd <span class="free">a</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cbnd <span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span> <span class="skolem">b</span> <span class="main">≤</span> cbnd <span class="free">a</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">+</span> <span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span> <span class="skolem">d</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">d</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> le_trans cbnd_grow<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">using</span></span> le_Suc_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="SC_Depth-cut_bound'_cbnd"><span class="command">lemma</span></span> cut_bound'_cbnd<span class="main">:</span> <span class="quoted"><span class="quoted">"cut_bound' <span class="free">n</span> <span class="free">F</span> <span class="main">≤</span> cbnd <span class="free">n</span> <span class="main">(</span>depth <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Not <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> cbnd_grow dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">F1</span> <span class="skolem">F2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?md</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>depth <span class="skolem">F1</span><span class="main">)</span> <span class="main">(</span>depth <span class="skolem">F2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cut_bound' <span class="main">(</span>cut_bound' <span class="skolem">n</span> <span class="skolem">F1</span><span class="main">)</span> <span class="skolem">F2</span> <span class="main">≤</span> cut_bound' <span class="main">(</span>cbnd <span class="skolem">n</span> <span class="main">(</span>depth <span class="skolem">F1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">F2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> And.IH<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> cut_bound'_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> cut_bound' <span class="main">(</span>cbnd <span class="skolem">n</span> <span class="var">?md</span><span class="main">)</span> <span class="skolem">F2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cbnd_mono cut_bound'_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> cbnd <span class="main">(</span>cbnd <span class="skolem">n</span> <span class="var">?md</span><span class="main">)</span> <span class="main">(</span>depth <span class="skolem">F2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> And.IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> cbnd <span class="main">(</span>cbnd <span class="skolem">n</span> <span class="var">?md</span><span class="main">)</span> <span class="var">?md</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cbnd_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Imp <span class="skolem">F1</span> <span class="skolem">F2</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">F1</span> <span class="skolem">F2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹analogous›</span></span> <span class="comment1">(*&lt;*)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?md</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>depth <span class="skolem">F1</span><span class="main">)</span> <span class="main">(</span>depth <span class="skolem">F2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cut_bound' <span class="main">(</span>cut_bound' <span class="skolem">n</span> <span class="skolem">F1</span><span class="main">)</span> <span class="skolem">F2</span> <span class="main">≤</span> cut_bound' <span class="main">(</span>cbnd <span class="skolem">n</span> <span class="main">(</span>depth <span class="skolem">F1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">F2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Or.IH<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> cut_bound'_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> cut_bound' <span class="main">(</span>cbnd <span class="skolem">n</span> <span class="var">?md</span><span class="main">)</span> <span class="skolem">F2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cbnd_mono cut_bound'_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> cbnd <span class="main">(</span>cbnd <span class="skolem">n</span> <span class="var">?md</span><span class="main">)</span> <span class="main">(</span>depth <span class="skolem">F2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Or.IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> cbnd <span class="main">(</span>cbnd <span class="skolem">n</span> <span class="var">?md</span><span class="main">)</span> <span class="var">?md</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cbnd_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Imp <span class="skolem">F1</span> <span class="skolem">F2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?md</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>depth <span class="skolem">F1</span><span class="main">)</span> <span class="main">(</span>depth <span class="skolem">F2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cut_bound' <span class="main">(</span>cut_bound' <span class="skolem">n</span> <span class="skolem">F1</span><span class="main">)</span> <span class="skolem">F2</span> <span class="main">≤</span> cut_bound' <span class="main">(</span>cbnd <span class="skolem">n</span> <span class="main">(</span>depth <span class="skolem">F1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">F2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Imp.IH<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> cut_bound'_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> cut_bound' <span class="main">(</span>cbnd <span class="skolem">n</span> <span class="var">?md</span><span class="main">)</span> <span class="skolem">F2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cbnd_mono cut_bound'_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> cbnd <span class="main">(</span>cbnd <span class="skolem">n</span> <span class="var">?md</span><span class="main">)</span> <span class="main">(</span>depth <span class="skolem">F2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Imp.IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> cbnd <span class="main">(</span>cbnd <span class="skolem">n</span> <span class="var">?md</span><span class="main">)</span> <span class="var">?md</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cbnd_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="comment1">(*&gt;*)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>cbnd <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>cbnd <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span>"</span></span> <span class="comment1">(* int, because that's easier to read… *)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>cbnd <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>cbnd <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>int<span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>nbe<span class="main">]</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>int <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">div</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">∘</span> cut_bound <span class="numeral">3</span> <span class="numeral">3</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">F</span><span class="main">.</span> And <span class="bound">F</span> <span class="bound">F</span><span class="main">)</span> <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>Atom <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>nbe<span class="main">]</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>int <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">div</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">∘</span> cut_bound' <span class="numeral">3</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">F</span><span class="main">.</span> And <span class="bound">F</span> <span class="bound">F</span><span class="main">)</span> <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>Atom <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span>"</span></span>
<span class="comment1">(* TODO: hm *)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>nbe<span class="main">]</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>int <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">div</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">∘</span> cut_bound <span class="numeral">3</span> <span class="numeral">3</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">F</span><span class="main">.</span> Imp <span class="main">(</span>Or <span class="bound">F</span> <span class="bound">F</span><span class="main">)</span> <span class="main">(</span>And <span class="bound">F</span> <span class="bound">F</span><span class="main">)</span><span class="main">)</span> <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>Atom <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>nbe<span class="main">]</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>int <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">div</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">∘</span> cut_bound' <span class="numeral">3</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">F</span><span class="main">.</span> Imp <span class="main">(</span>Or <span class="bound">F</span> <span class="bound">F</span><span class="main">)</span> <span class="main">(</span>And <span class="bound">F</span> <span class="bound">F</span><span class="main">)</span><span class="main">)</span> <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>Atom <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span>"</span></span>
<span class="comment1">(* Hmhm *)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>nbe<span class="main">]</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">F</span><span class="main">.</span> And <span class="main">(</span>Or <span class="bound">F</span> <span class="bound">F</span><span class="main">)</span> <span class="main">(</span>Or <span class="bound">F</span> <span class="bound">F</span><span class="main">)</span><span class="main">)</span> <span class="main">^^</span> <span class="numeral">2</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="free">F</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">+</span> 
      <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">m</span> <span class="main">+</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="free">F</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="free">G</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>
    <span class="main">≤</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">(</span><span class="free">m</span> <span class="main">::</span> nat<span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="free">F</span> <span class="main">+</span> size <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">oops</span></span>
    <span class="comment1">(* so the proof below won't work. *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"cut_bound <span class="main">(</span><span class="free">n</span> <span class="main">::</span> nat<span class="main">)</span> <span class="free">m</span> <span class="free">F</span> <span class="main">≤</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="free">F</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Not <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cut_bound.simps <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Not<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> size <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> And<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cut_bound <span class="skolem">n</span> <span class="main">(</span>cut_bound <span class="skolem">n</span> <span class="skolem">m</span> <span class="skolem">F</span><span class="main">)</span> <span class="skolem">G</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">(</span>cut_bound <span class="skolem">n</span> <span class="skolem">m</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="skolem">G</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> And<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="skolem">F</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="skolem">G</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> add_le_cancel_left mult_le_mono1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">oops</span></span>
      
<span class="comment1">(* Oh! Look: *)</span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="SC_Depth-cbnd_comm"><span class="command">lemma</span></span> cbnd_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"cbnd <span class="main">(</span><span class="free">l</span> <span class="main">*</span> <span class="free">k</span><span class="main">::</span>nat<span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="free">l</span> <span class="main">*</span> cbnd <span class="main">(</span><span class="free">k</span><span class="main">::</span>nat<span class="main">)</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="SC_Depth-cbnd_closed"><span class="command">lemma</span></span> cbnd_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"cbnd <span class="main">(</span><span class="free">k</span><span class="main">::</span>nat<span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="free">k</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="keyword3">;</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>26<span class="main"><span class="main">)</span></span><span class="main">)</span>
    
<span class="keyword1"><span class="command">theorem</span></span> cut'<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span><span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> depth <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> cut_bound<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> cut_bound <span class="free">n</span> <span class="free">n</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"cut_bound <span class="free">n</span> <span class="free">n</span> <span class="free">F</span> <span class="main">≤</span> max <span class="free">n</span> <span class="free">n</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> depth <span class="free">F</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> cut_bound_' cut_bound'_cbnd cbnd_closed <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order_trans<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c d le_Suc_ex deeper <span class="keyword1"><span class="command">unfolding</span></span> max.idem <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SC_Gentzen">
<div class="head">
<h1>Theory SC_Gentzen</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Mimicking the original›</span></span>

<span class="keyword1"><span class="command">theory</span></span> SC_Gentzen
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SC_Depth.html">SC_Depth</a> <a href="SC_Cut.html">SC_Cut</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This system attempts to mimic the original sequent calculus 
  (``Reihen von Formeln, durch Kommata getrennt'', translates roughly to sequences of formulas, separated by a comma)~\cite{gentzen1935untersuchungen}.›</span></span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">SCg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula list <span class="main">⇒</span> <span class="tfree">'a</span> formula list <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⇒</span>"</span> 30<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
Anfang<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free"><span class="bound"><span class="entity">𝔇</span></span></span><span class="main">]</span> <span class="main"><span class="free">⇒</span></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">𝔇</span></span></span><span class="main">]</span>"</span></span> <span class="main">|</span>
FalschA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">⊥</span><span class="main">]</span> <span class="main"><span class="free">⇒</span></span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
VerduennungA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Θ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝔇</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Θ</span></span></span>"</span></span> <span class="main">|</span>
VerduennungS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Θ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">𝔇</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Θ</span></span></span>"</span></span> <span class="main">|</span>
ZusammenziehungA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝔇</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">𝔇</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Θ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝔇</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Θ</span></span></span>"</span></span> <span class="main">|</span>
ZusammenziehungS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">𝔇</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">𝔇</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Θ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">𝔇</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Θ</span></span></span>"</span></span> <span class="main">|</span>
VertauschungA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Δ</span></span></span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">𝔇</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">𝔈</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Θ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">𝔈</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">𝔇</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Θ</span></span></span>"</span></span> <span class="main">|</span>
VertauschungS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Θ</span></span></span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">𝔈</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">𝔇</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Λ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Θ</span></span></span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">𝔇</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">𝔈</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Λ</span></span></span>"</span></span> <span class="main">|</span>
Schnitt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">𝔇</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Θ</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">𝔇</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Λ</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Θ</span></span></span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">Λ</span></span></span>"</span></span> <span class="main">|</span>
UES<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">𝔄</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Θ</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">𝔅</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Θ</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">𝔄</span></span></span><span class="main"><span class="hidden">❙</span><b>∧</b></span><span class="free"><span class="bound"><span class="entity">𝔅</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Θ</span></span></span>"</span></span> <span class="main">|</span>
UEA1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝔄</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Θ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝔄</span></span></span><span class="main"><span class="hidden">❙</span><b>∧</b></span><span class="free"><span class="bound"><span class="entity">𝔅</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Θ</span></span></span>"</span></span> <span class="main">|</span> UEA2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝔅</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Θ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝔄</span></span></span><span class="main"><span class="hidden">❙</span><b>∧</b></span><span class="free"><span class="bound"><span class="entity">𝔅</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Θ</span></span></span>"</span></span> <span class="main">|</span>
OEA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">𝔄</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Θ</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">𝔅</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Θ</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝔄</span></span></span><span class="main"><span class="hidden">❙</span><b>∨</b></span><span class="free"><span class="bound"><span class="entity">𝔅</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Θ</span></span></span>"</span></span> <span class="main">|</span>
OES1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">𝔄</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Θ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">𝔄</span></span></span><span class="main"><span class="hidden">❙</span><b>∨</b></span><span class="free"><span class="bound"><span class="entity">𝔅</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Θ</span></span></span>"</span></span> <span class="main">|</span> OES2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">𝔅</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Θ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">𝔄</span></span></span><span class="main"><span class="hidden">❙</span><b>∨</b></span><span class="free"><span class="bound"><span class="entity">𝔅</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Θ</span></span></span>"</span></span> <span class="main">|</span>
FES<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝔄</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">𝔅</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Θ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">𝔄</span></span></span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free"><span class="bound"><span class="entity">𝔅</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Θ</span></span></span>"</span></span> <span class="main">|</span>
FEA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">𝔄</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Θ</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">𝔅</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Λ</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">𝔄</span></span></span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free"><span class="bound"><span class="entity">𝔅</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Θ</span></span></span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">Λ</span></span></span>"</span></span> <span class="main">|</span>
NES<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝔄</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Θ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free"><span class="bound"><span class="entity">𝔄</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Θ</span></span></span>"</span></span> <span class="main">|</span>
NEA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">𝔄</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Θ</span></span></span> <span class="main">⟹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free"><span class="bound"><span class="entity">𝔄</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Θ</span></span></span>"</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Nota bene: E here stands for ``Einführung'', which is introduction and not elemination.›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The rule for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">⊥</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is not part of the original calculus. Its addition is necessary to show equivalence to our <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> SCp<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Note that we purposefully did not recreate the fact that Gentzen sometimes puts his principal formulas on end and sometimes on the beginning of the list.›</span></span>

<span class="keyword1" id="SC_Gentzen-AnfangTauschA"><span class="command">lemma</span></span> AnfangTauschA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝔇</span><span class="main">#</span><span class="free">Δ</span><span class="main">@</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span> <span class="main">⟹</span> <span class="free">Δ</span><span class="main">@</span><span class="free">𝔇</span><span class="main">#</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Δ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> List.rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> VertauschungA<span class="main">)</span>
<span class="keyword1" id="SC_Gentzen-AnfangTauschS"><span class="command">lemma</span></span> AnfangTauschS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">𝔇</span><span class="main">#</span><span class="free">Δ</span><span class="main">@</span><span class="free">Θ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span><span class="main">@</span><span class="free">𝔇</span><span class="main">#</span><span class="free">Θ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Δ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Θ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> List.rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> VertauschungS<span class="main">)</span>
<span class="keyword1" id="SC_Gentzen-MittenTauschA"><span class="command">lemma</span></span> MittenTauschA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span><span class="main">@</span><span class="free">𝔇</span><span class="main">#</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span> <span class="main">⟹</span> <span class="free">𝔇</span><span class="main">#</span><span class="free">Δ</span><span class="main">@</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Δ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> List.rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> VertauschungA<span class="main">)</span>
<span class="keyword1" id="SC_Gentzen-MittenTauschS"><span class="command">lemma</span></span> MittenTauschS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span><span class="main">@</span><span class="free">𝔇</span><span class="main">#</span><span class="free">Θ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">𝔇</span><span class="main">#</span><span class="free">Δ</span><span class="main">@</span><span class="free">Θ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Δ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Θ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> List.rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> VertauschungS<span class="main">)</span>

<span class="keyword1" id="SC_Gentzen-BotLe"><span class="command">lemma</span></span> BotLe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span><span class="main">∈</span>set <span class="free">Γ</span> <span class="main">⟹</span> <span class="free">Γ</span><span class="main">⇒</span><span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span><span class="main">#</span><span class="skolem">Γ</span><span class="main">⇒</span><span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">Γ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FalschA VerduennungA VertauschungA<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Δ<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">Nil</span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span><span class="main">#</span><span class="skolem">Γ</span><span class="main">⇒</span><span class="free">Δ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Δ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A VerduennungS<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span><span class="main">∈</span>set <span class="free">Γ</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ1</span></span> <span class="skolem"><span class="skolem">Γ2</span></span> <span class="keyword2"><span class="keyword">where</span></span> Γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">=</span> <span class="skolem">Γ1</span><span class="main">@</span><span class="main">⊥</span><span class="main">#</span><span class="skolem">Γ2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> split_list<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Γ <span class="keyword1"><span class="command">using</span></span> AnfangTauschA * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SC_Gentzen-Axe"><span class="command">lemma</span></span> Axe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> set <span class="free">Γ</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">∈</span> set <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">#</span><span class="skolem">Γ</span> <span class="main">⇒</span> <span class="main">[</span><span class="free">A</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">Γ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Anfang VertauschungA<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Δ<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">Nil</span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span> VerduennungA<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">#</span><span class="skolem">Γ</span> <span class="main">⇒</span> <span class="free">A</span><span class="main">#</span><span class="skolem">Δ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span> <span class="skolem">Δ</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">Δ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A Anfang VertauschungS<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Θ<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">Nil</span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span> VerduennungS<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> set <span class="free">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> set <span class="free">Δ</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">-</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> split_list<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> AnfangTauschA AnfangTauschS<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> S<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SC_Gentzen-VerduennungListeA"><span class="command">lemma</span></span> VerduennungListeA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span> <span class="main">⟹</span> <span class="free">Γ</span><span class="main">@</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">Γ''</span><span class="main">.</span> <span class="free">Γ</span><span class="main">=</span><span class="bound">Γ''</span><span class="main">@</span><span class="skolem">Γ'</span> <span class="main">⟹</span> <span class="skolem">Γ'</span><span class="main">@</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ'</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">Γ'</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">as</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Γ''</span><span class="main">.</span> <span class="free">Γ</span> <span class="main">=</span> <span class="bound">Γ''</span> <span class="main">@</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Γ'' <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Γ''</span><span class="main">.</span> <span class="free">Γ</span> <span class="main">=</span> <span class="bound">Γ''</span> <span class="main">@</span> <span class="skolem">as</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">Γ''</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="main"><span class="main"><span class="main">[</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">a</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Cons.IH<span class="main">[</span><span class="operator">OF</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">@</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> VerduennungA <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span> <span class="main">⟹</span> <span class="free">Γ</span><span class="main">@</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1" id="SC_Gentzen-VerduennungListeS"><span class="command">lemma</span></span> VerduennungListeS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span><span class="main">@</span><span class="free">Θ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">Θ''</span><span class="main">.</span> <span class="free">Θ</span><span class="main">=</span><span class="bound">Θ''</span><span class="main">@</span><span class="skolem">Θ'</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="skolem">Θ'</span><span class="main">@</span><span class="free">Θ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Θ'</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">Θ'</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">as</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Θ''</span><span class="main">.</span> <span class="free">Θ</span> <span class="main">=</span> <span class="bound">Θ''</span> <span class="main">@</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Θ'' <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Θ''</span><span class="main">.</span> <span class="free">Θ</span> <span class="main">=</span> <span class="bound">Θ''</span> <span class="main">@</span> <span class="skolem">as</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">Θ''</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="main"><span class="main"><span class="main">[</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">a</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Cons.IH<span class="main">[</span><span class="operator">OF</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="free">Γ</span> <span class="main">⇒</span> <span class="skolem">as</span> <span class="main">@</span> <span class="free">Θ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> VerduennungS <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span><span class="main">@</span><span class="free">Θ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="comment1">(* wak, those weren't the droids I was looking for. *)</span>
<span class="keyword1" id="SC_Gentzen-ZusammenziehungListeA"><span class="command">lemma</span></span> ZusammenziehungListeA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">@</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span><span class="main">@</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">Γ''</span><span class="main">.</span> <span class="free">Γ</span><span class="main">=</span><span class="bound">Γ''</span><span class="main">@</span><span class="skolem">Γ'</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ'</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">Γ'</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">Γ'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Γ''</span><span class="main">.</span> <span class="free">Γ</span> <span class="main">=</span> <span class="bound">Γ''</span> <span class="main">@</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">Γ'</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Γ'' <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">note</span></span> Γ'' <span class="main">=</span> this
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ1</span></span> <span class="skolem"><span class="skolem">Γ2</span></span> <span class="keyword2"><span class="keyword">where</span></span> Γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">=</span> <span class="skolem">Γ1</span> <span class="main">@</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">Γ2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> Γ'' <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Γ''</span><span class="main">.</span> <span class="free">Γ</span> <span class="main">=</span> <span class="bound">Γ''</span> <span class="main">@</span> <span class="skolem">Γ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">Γ''</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="main"><span class="main"><span class="main">[</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">a</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">Γ'</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">Γ1</span> <span class="main">@</span> <span class="skolem">Γ2</span> <span class="main">⇒</span> <span class="free">Θ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Γ  <span class="keyword1"><span class="command">using</span></span> MittenTauschA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">Γ'</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">Γ1</span> <span class="main">@</span> <span class="skolem">Γ2</span> <span class="main">⇒</span> <span class="free">Θ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ZusammenziehungA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">@</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Γ  <span class="keyword1"><span class="command">using</span></span> AnfangTauschA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Cons append_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons.IH<span class="main">[</span><span class="operator">OF</span> this **<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">@</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1" id="SC_Gentzen-ZusammenziehungListeS"><span class="command">lemma</span></span> ZusammenziehungListeS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span><span class="main">@</span><span class="free">Θ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="skolem">Θ'</span><span class="main">@</span><span class="free">Θ</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">Θ''</span><span class="main">.</span> <span class="free">Θ</span><span class="main">=</span><span class="bound">Θ''</span><span class="main">@</span><span class="skolem">Θ'</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Θ'</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">Θ'</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">Θ'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Θ''</span><span class="main">.</span> <span class="free">Θ</span> <span class="main">=</span> <span class="bound">Θ''</span> <span class="main">@</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">Θ'</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Θ'' <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">note</span></span> Θ'' <span class="main">=</span> this
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Θ1</span></span> <span class="skolem"><span class="skolem">Θ2</span></span> <span class="keyword2"><span class="keyword">where</span></span> Θ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Θ</span> <span class="main">=</span> <span class="skolem">Θ1</span> <span class="main">@</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">Θ2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> Θ'' <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Θ''</span><span class="main">.</span> <span class="free">Θ</span> <span class="main">=</span> <span class="bound">Θ''</span> <span class="main">@</span> <span class="skolem">Θ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">Θ''</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="main"><span class="main"><span class="main">[</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">a</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="skolem">a</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">Θ'</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">Θ1</span> <span class="main">@</span> <span class="skolem">Θ2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Θ  <span class="keyword1"><span class="command">using</span></span> MittenTauschS <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">Θ'</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">Θ1</span> <span class="main">@</span> <span class="skolem">Θ2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ZusammenziehungS <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="skolem">Θ'</span> <span class="main">@</span> <span class="free">Θ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Θ  <span class="keyword1"><span class="command">using</span></span> AnfangTauschS <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Cons append_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons.IH<span class="main">[</span><span class="operator">OF</span> this **<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Θ</span><span class="main">@</span><span class="free">Θ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span><span class="free">Θ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> gentzen_sc_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"mset <span class="free">Γ</span> <span class="main">⇒</span> mset <span class="free">Δ</span> <span class="main">⟷</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"mset <span class="free">Γ</span> <span class="main">⇒</span> mset <span class="free">Δ</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mset <span class="free">Γ</span> <span class="main">⇒</span> mset <span class="free">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> SC_SCp_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
  <span class="comment1">(* structural induction not necessary at all. I still don't get it. *)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> sr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Γ1</span> <span class="bound">Γ2</span><span class="main">.</span> <span class="skolem">Γ</span> <span class="main">=</span> <span class="bound">Γ1</span> <span class="main">@</span> <span class="skolem">F</span> <span class="main">#</span> <span class="bound">Γ2</span> <span class="main">∧</span> <span class="skolem">Γ'</span> <span class="main">=</span> mset <span class="main">(</span><span class="bound">Γ1</span><span class="main">@</span><span class="bound">Γ2</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"mset <span class="skolem">Γ</span> <span class="main">=</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span> <span class="skolem">Γ'</span> <span class="skolem">F</span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> that <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ1</span></span> <span class="skolem"><span class="skolem">Γ2</span></span> <span class="keyword2"><span class="keyword">where</span></span> Γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> <span class="skolem">Γ1</span> <span class="main">@</span> <span class="skolem">F</span> <span class="main">#</span> <span class="skolem">Γ2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> split_list add.commute ex_mset list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mset.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> set_mset_mset<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> Γ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">=</span> mset <span class="main">(</span><span class="skolem">Γ1</span><span class="main">@</span><span class="skolem">Γ2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="keyword1"><span class="command">using</span></span> Γ Γ' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> Suc.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCc.cases<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> BotL <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> BotLe <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Ax <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Axe <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotL <span class="skolem">Γ'</span> <span class="skolem">F</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹mset <span class="skolem">Γ</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ'</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ1</span></span> <span class="skolem"><span class="skolem">Γ2</span></span> <span class="keyword2"><span class="keyword">where</span></span> Γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> <span class="skolem">Γ1</span> <span class="main">@</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">F</span> <span class="main">#</span> <span class="skolem">Γ2</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> split_list add.commute ex_mset list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mset.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> set_mset_mset<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> Γ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">=</span> mset <span class="main">(</span><span class="skolem">Γ1</span><span class="main">@</span><span class="skolem">Γ2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> NotL<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> mset <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset <span class="main">(</span><span class="skolem">Γ1</span><span class="main">@</span><span class="skolem">Γ2</span><span class="main">)</span> <span class="main">⇒</span> mset <span class="main">(</span><span class="skolem">F</span><span class="main">#</span><span class="skolem">Δ</span><span class="main">)</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Γ' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Suc.IH<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Γ <span class="keyword1"><span class="command">using</span></span> AnfangTauschA NEA <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotR <span class="skolem">F</span> <span class="skolem">Δ'</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> sr<span class="main">[</span><span class="operator">OF</span> NotR<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Δ1 <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Δ2 <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">note</span></span> Δ <span class="main">=</span> this
      <span class="keyword1"><span class="command">with</span></span> NotR <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset <span class="main">(</span><span class="skolem">F</span><span class="main">#</span><span class="skolem">Γ</span><span class="main">)</span> <span class="main">⇒</span> mset <span class="main">(</span><span class="skolem">Δ1</span><span class="main">@</span><span class="skolem">Δ2</span><span class="main">)</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Suc.IH<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Δ <span class="keyword1"><span class="command">using</span></span> AnfangTauschS NES <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndR <span class="skolem">F</span> <span class="skolem">Δ'</span> <span class="skolem">G</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> sr<span class="main">[</span><span class="operator">OF</span> AndR<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Δ1 <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Δ2 <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">note</span></span> Δ <span class="main">=</span> this
      <span class="keyword1"><span class="command">with</span></span> AndR <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset <span class="skolem">Γ</span> <span class="main">⇒</span> mset <span class="main">(</span><span class="skolem">F</span> <span class="main">#</span> <span class="skolem">Δ1</span><span class="main">@</span><span class="skolem">Δ2</span><span class="main">)</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"mset <span class="skolem">Γ</span> <span class="main">⇒</span> mset <span class="main">(</span><span class="skolem">G</span> <span class="main">#</span> <span class="skolem">Δ1</span><span class="main">@</span><span class="skolem">Δ2</span><span class="main">)</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">THEN</span> Suc.IH<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Δ <span class="keyword1"><span class="command">using</span></span> AnfangTauschS UES <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrR <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">Δ'</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> sr<span class="main">[</span><span class="operator">OF</span> OrR<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Δ1 <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Δ2 <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">note</span></span> Δ <span class="main">=</span> this
      <span class="keyword1"><span class="command">with</span></span> OrR <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset <span class="skolem">Γ</span> <span class="main">⇒</span> mset <span class="main">(</span><span class="skolem">G</span> <span class="main">#</span> <span class="skolem">F</span> <span class="main">#</span> <span class="skolem">Δ1</span><span class="main">@</span><span class="skolem">Δ2</span><span class="main">)</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute add.left_commute add_mset_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">THEN</span> Suc.IH<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">G</span> <span class="main">#</span> <span class="skolem">F</span> <span class="main">#</span> <span class="skolem">Δ1</span> <span class="main">@</span> <span class="skolem">Δ2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> OES2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span> <span class="main">#</span> <span class="skolem">F</span> <span class="main">#</span> <span class="skolem">Δ1</span> <span class="main">@</span> <span class="skolem">Δ2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> VertauschungS<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Θ<span class="main"><span class="main">=</span></span><span class="quoted">Nil</span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span> <span class="main">#</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span> <span class="main">#</span> <span class="skolem">Δ1</span> <span class="main">@</span> <span class="skolem">Δ2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> OES1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span> <span class="main">#</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span> <span class="main">#</span> <span class="skolem">Δ1</span> <span class="main">@</span> <span class="skolem">Δ2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span> <span class="main">#</span> <span class="skolem">Δ1</span> <span class="main">@</span> <span class="skolem">Δ2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ZusammenziehungS <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span> 
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Δ<span class="main">[</span><span class="operator">THEN</span> conjunct1<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> AnfangTauschS <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpR <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">Δ'</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> sr<span class="main">[</span><span class="operator">OF</span> ImpR<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Δ1 <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Δ2 <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">note</span></span> Δ <span class="main">=</span> this
      <span class="keyword1"><span class="command">with</span></span> ImpR <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset <span class="main">(</span><span class="skolem">F</span><span class="main">#</span><span class="skolem">Γ</span><span class="main">)</span> <span class="main">⇒</span> mset <span class="main">(</span><span class="skolem">G</span> <span class="main">#</span> <span class="skolem">Δ1</span><span class="main">@</span><span class="skolem">Δ2</span><span class="main">)</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">THEN</span> Suc.IH<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Δ <span class="keyword1"><span class="command">using</span></span> AnfangTauschS FES <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndL <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">Γ'</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> sr<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Γ1 <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Γ2 <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">note</span></span> Γ <span class="main">=</span> this
      <span class="keyword1"><span class="command">with</span></span> AndL <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset <span class="main">(</span><span class="skolem">G</span> <span class="main">#</span> <span class="skolem">F</span> <span class="main">#</span> <span class="skolem">Γ1</span><span class="main">@</span><span class="skolem">Γ2</span><span class="main">)</span> <span class="main">⇒</span> mset <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute add.left_commute add_mset_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">THEN</span> Suc.IH<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">#</span> <span class="skolem">F</span> <span class="main">#</span> <span class="skolem">Γ1</span> <span class="main">@</span> <span class="skolem">Γ2</span> <span class="main">⇒</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> UEA2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span> <span class="main">#</span> <span class="skolem">F</span> <span class="main">#</span> <span class="skolem">Γ1</span> <span class="main">@</span> <span class="skolem">Γ2</span> <span class="main">⇒</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> VertauschungA<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Δ<span class="main"><span class="main">=</span></span><span class="quoted">Nil</span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">#</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span> <span class="main">#</span> <span class="skolem">Γ1</span> <span class="main">@</span> <span class="skolem">Γ2</span> <span class="main">⇒</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> UEA1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span> <span class="main">#</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span> <span class="main">#</span> <span class="skolem">Γ1</span> <span class="main">@</span> <span class="skolem">Γ2</span> <span class="main">⇒</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span> <span class="main">#</span> <span class="skolem">Γ1</span> <span class="main">@</span> <span class="skolem">Γ2</span> <span class="main">⇒</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ZusammenziehungA <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span> 
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Γ<span class="main">[</span><span class="operator">THEN</span> conjunct1<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> AnfangTauschA <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrL <span class="skolem">F</span> <span class="skolem">Δ'</span> <span class="skolem">G</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> sr<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Γ1 <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Γ2 <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">note</span></span> Γ <span class="main">=</span> this
      <span class="keyword1"><span class="command">with</span></span> OrL <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset <span class="main">(</span><span class="skolem">F</span> <span class="main">#</span> <span class="skolem">Γ1</span><span class="main">@</span><span class="skolem">Γ2</span><span class="main">)</span> <span class="main">⇒</span> mset <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"mset <span class="main">(</span><span class="skolem">G</span> <span class="main">#</span> <span class="skolem">Γ1</span><span class="main">@</span><span class="skolem">Γ2</span><span class="main">)</span> <span class="main">⇒</span> mset <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">THEN</span> Suc.IH<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Γ <span class="keyword1"><span class="command">using</span></span> AnfangTauschA OEA <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpL <span class="skolem">Γ'</span> <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> sr<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Γ1 <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Γ2 <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">note</span></span> Γ <span class="main">=</span> this
      <span class="keyword1"><span class="command">with</span></span> ImpL <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset <span class="main">(</span><span class="skolem">Γ1</span><span class="main">@</span><span class="skolem">Γ2</span><span class="main">)</span> <span class="main">⇒</span> mset <span class="main">(</span><span class="skolem">F</span><span class="main">#</span><span class="skolem">Δ</span><span class="main">)</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"mset <span class="main">(</span><span class="skolem">G</span> <span class="main">#</span> <span class="skolem">Γ1</span><span class="main">@</span><span class="skolem">Γ2</span><span class="main">)</span> <span class="main">⇒</span> mset <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">THEN</span> Suc.IH<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ1</span> <span class="main">@</span> <span class="skolem">Γ2</span> <span class="main">⇒</span> <span class="skolem">F</span> <span class="main">#</span> <span class="skolem">Δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">#</span> <span class="skolem">Γ1</span> <span class="main">@</span> <span class="skolem">Γ2</span> <span class="main">⇒</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">from</span></span> FEA<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">Γ1</span> <span class="main">@</span> <span class="skolem">Γ2</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">Γ1</span> <span class="main">@</span> <span class="skolem">Γ2</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">@</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">Γ1</span> <span class="main">@</span> <span class="skolem">Γ2</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span> <span class="main">#</span> <span class="skolem">Γ1</span> <span class="main">@</span> <span class="skolem">Γ2</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">@</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> AnfangTauschA VerduennungA <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="comment1">(* given the form of ZusammenziehungListeA, using this intermediate step is just easier. maybe a different from for ZusammenziehungListeA would be nice? *)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">Γ1</span> <span class="main">@</span> <span class="skolem">Γ2</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">@</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ZusammenziehungListeA<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Γ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">Γ1</span> <span class="main">@</span> <span class="skolem">Γ2</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Γ<span class="main">[</span><span class="operator">THEN</span> conjunct1<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> AnfangTauschA<span class="main"><span class="keyword3">;</span></span> <span class="operator">elim</span> ZusammenziehungListeS<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> mset_Cons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mset <span class="main">(</span><span class="skolem">A</span> <span class="main">#</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">A</span><span class="main">,</span> mset <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> mset.simps<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟹</span> mset <span class="free">Γ</span> <span class="main">⇒</span> mset <span class="free">Δ</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCg.induct<span class="main">)</span>
    <span class="comment1">(*sed -n '/^\([^\\]*\):/ {N;s/_\\\?//g; s/let.*$//; s/\n//; s/[\\:]//g; s/fix //; s/  / /g; s/^.*$/case (&amp;) thus ?case sorry/; p;}' ${print_cases} *)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Anfang <span class="skolem">𝔇</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> extended_Ax SC_SCp_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>FalschA<span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCp.BotL <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>VerduennungA <span class="skolem">Γ</span> <span class="skolem">Θ</span> <span class="skolem">𝔇</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SC.weakenL<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>VerduennungS <span class="skolem">Γ</span> <span class="skolem">Θ</span> <span class="skolem">𝔇</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SC.weakenR<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ZusammenziehungA <span class="skolem">𝔇</span> <span class="skolem">Γ</span> <span class="skolem">Θ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> contractL <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ZusammenziehungS <span class="skolem">Γ</span> <span class="skolem">𝔇</span> <span class="skolem">Θ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> contract <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>VertauschungA <span class="skolem">Δ</span> <span class="skolem">𝔇</span> <span class="skolem">𝔈</span> <span class="skolem">Γ</span> <span class="skolem">Θ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>VertauschungS <span class="skolem">Γ</span> <span class="skolem">Θ</span> <span class="skolem">𝔈</span> <span class="skolem">𝔇</span> <span class="skolem">Λ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Schnitt <span class="skolem">Γ</span> <span class="skolem">𝔇</span> <span class="skolem">Θ</span> <span class="skolem">Δ</span> <span class="skolem">Λ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"mset <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">𝔇</span><span class="main">,</span>mset <span class="skolem">Θ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔇</span><span class="main">,</span>mset <span class="skolem">Δ</span> <span class="main">⇒</span> mset <span class="skolem">Λ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> SC_SCp_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> cut_cf<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> SC_SCp_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>UES <span class="skolem">Γ</span> <span class="skolem">𝔄</span> <span class="skolem">Θ</span> <span class="skolem">𝔅</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCp.AndR <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SC_SCp_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>UEA1 <span class="skolem">𝔄</span> <span class="skolem">Γ</span> <span class="skolem">Θ</span> <span class="skolem">𝔅</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹mset <span class="main">(</span><span class="skolem">𝔄</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="main">⇒</span> mset <span class="skolem">Θ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span><span class="main">,</span><span class="skolem">𝔅</span><span class="main">,</span>mset <span class="skolem">Γ</span> <span class="main">⇒</span> mset <span class="skolem">Θ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> SC.weakenL <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCp.AndL <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>UEA2 <span class="skolem">𝔅</span> <span class="skolem">Γ</span> <span class="skolem">Θ</span> <span class="skolem">𝔄</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹mset <span class="main">(</span><span class="skolem">𝔅</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="main">⇒</span> mset <span class="skolem">Θ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔄</span><span class="main">,</span><span class="skolem">𝔅</span><span class="main">,</span>mset <span class="skolem">Γ</span> <span class="main">⇒</span> mset <span class="skolem">Θ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> SC.weakenL <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCp.AndL <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OEA <span class="skolem">𝔄</span> <span class="skolem">Γ</span> <span class="skolem">Θ</span> <span class="skolem">𝔅</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> SC_SCp_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SCp.OrL<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OES1 <span class="skolem">Γ</span> <span class="skolem">𝔄</span> <span class="skolem">Θ</span> <span class="skolem">𝔅</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> SC.weakenR<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OES2 <span class="skolem">Γ</span> <span class="skolem">𝔅</span> <span class="skolem">Θ</span> <span class="skolem">𝔄</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SC.weakenR SCp.OrR<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>FES <span class="skolem">𝔄</span> <span class="skolem">Γ</span> <span class="skolem">𝔅</span> <span class="skolem">Θ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> weakenR <span class="keyword1"><span class="command">unfolding</span></span> SC_SCp_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SCp.ImpR<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>FEA <span class="skolem">Γ</span> <span class="skolem">𝔄</span> <span class="skolem">Θ</span> <span class="skolem">𝔅</span> <span class="skolem">Δ</span> <span class="skolem">Λ</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹mset <span class="skolem">Γ</span> <span class="main">⇒</span> mset <span class="main">(</span><span class="skolem">𝔄</span> <span class="main">#</span> <span class="skolem">Θ</span><span class="main">)</span>›</span></span><span class="main">[</span><span class="operator">THEN</span> weakenL_set<span class="main">,</span> <span class="operator">THEN</span> weakenR_set<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"mset <span class="skolem">Δ</span>"</span></span> <span class="quoted"><span class="quoted">"mset <span class="skolem">Λ</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"mset <span class="main">(</span><span class="skolem">Γ</span><span class="main">@</span><span class="skolem">Δ</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">𝔄</span><span class="main">,</span>mset <span class="main">(</span><span class="skolem">Θ</span><span class="main">@</span><span class="skolem">Λ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mset_append mset_Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span> <span class="comment1">(* sledgehammer comes up with some funny proof using cut… *)</span>
    <span class="keyword1"><span class="command">from</span></span> FEA <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mset <span class="main">(</span><span class="skolem">𝔅</span> <span class="main">#</span> <span class="skolem">Δ</span><span class="main">)</span> <span class="main">⇒</span> mset <span class="skolem">Λ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"mset <span class="skolem">Γ</span> <span class="main">+</span> mset <span class="main">(</span><span class="skolem">𝔅</span> <span class="main">#</span> <span class="skolem">Δ</span><span class="main">)</span> <span class="main">⇒</span> mset <span class="skolem">Θ</span> <span class="main">+</span> mset <span class="skolem">Λ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> weakenL_set weakenR_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔅</span><span class="main">,</span>mset <span class="main">(</span><span class="skolem">Γ</span><span class="main">@</span><span class="skolem">Δ</span><span class="main">)</span> <span class="main">⇒</span> mset <span class="main">(</span><span class="skolem">Θ</span><span class="main">@</span><span class="skolem">Λ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.left_commute<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> S A SC_SCp_eq SCp.ImpL <span class="keyword1"><span class="command">unfolding</span></span> mset_Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NES <span class="skolem">𝔄</span> <span class="skolem">Γ</span> <span class="skolem">Θ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCp.NotR <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SC_SCp_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NEA <span class="skolem">Γ</span> <span class="skolem">𝔄</span> <span class="skolem">Θ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCp.NotL <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SC_SCp_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SC_Sema">
<div class="head">
<h1>Theory SC_Sema</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Soundness, Completeness›</span></span>

<span class="keyword1"><span class="command">theory</span></span> SC_Sema
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SC.html">SC</a> <a href="Sema.html">Sema</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sequent_semantics</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> valuation <span class="main">⇒</span> <span class="tfree">'a</span> formula multiset <span class="main">⇒</span> <span class="tfree">'a</span> formula multiset <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">⊨</span> <span class="keyword3">(</span>_ <span class="keyword1">⇒</span><span class="keyword3">/ </span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span> <span class="main">[</span>53<span class="main">,</span> 53<span class="main">,</span>53<span class="main">]</span> 53<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">γ</span> <span class="main">∈#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">⊨</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">δ</span> <span class="main">∈#</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">⊨</span> <span class="bound">δ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">sequent_valid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula multiset <span class="main">⇒</span> <span class="tfree">'a</span> formula multiset <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">⊨</span> <span class="keyword3">(</span>_ <span class="keyword1">⇒</span><span class="keyword3">/ </span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span> <span class="main">[</span>53<span class="main">,</span>53<span class="main">]</span> 53<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊨</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">sequent_nonvalid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> valuation <span class="main">⇒</span> <span class="tfree">'a</span> formula multiset <span class="main">⇒</span> <span class="tfree">'a</span> formula multiset <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">¬⊨</span> <span class="keyword3">(</span>_ <span class="keyword1">⇒</span><span class="keyword3">/ </span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span> <span class="main">[</span>53<span class="main">,</span> 53<span class="main">,</span>53<span class="main">]</span> 53<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main"><span class="free">¬⊨</span></span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main">≡</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">𝒜</span></span></span><span class="main">⊨</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span>"</span></span>

<span class="keyword1" id="SC_Sema-sequent_intuitonistic_semantics"><span class="command">lemma</span></span> sequent_intuitonistic_semantics<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="main">{#</span><span class="free">δ</span><span class="main">#}</span> <span class="main">⟷</span> set_mset <span class="free">Γ</span> <span class="main">⊫</span> <span class="free">δ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sequent_semantics_def entailment_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="SC_Sema-SC_soundness"><span class="command">lemma</span></span> SC_soundness<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="main">⊨</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sequent_semantics_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">sequent_cost</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main">=</span> Suc <span class="main">(</span>sum_list <span class="main">(</span>sorted_list_of_multiset <span class="main">(</span>image_mset size <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">function</span></span><span class="main">(</span>sequential<span class="main">)</span>
  <span class="entity">sc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> formula list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list <span class="main">×</span> <span class="tfree">'a</span> list<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">sc</span> <span class="main">(</span><span class="main">⊥</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">sc</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> set <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∩</span> set <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">{</span><span class="main">(</span>remdups <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span>remdups <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">sc</span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>  <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="free">sc</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">sc</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="free">sc</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">sc</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="free">sc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">sc</span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="free">sc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">∪</span> <span class="free">sc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">sc</span> <span class="main">(</span>Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="free">sc</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">∪</span> <span class="free">sc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">sc</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="main">⊥</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="free">sc</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">sc</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="free">sc</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">sc</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="free">sc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">sc</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="free">sc</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">∪</span> <span class="free">sc</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">sc</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="free">sc</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">sc</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="free">sc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>
<span class="comment1">(* Paremeters 2 and 4:
   atoms are stored in lists, not sets, simply because lists are automatically finite;
   finiteness is required when we relate back to sequents, which are finite. *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">list_sequent_cost</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">Δ</span></span></span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span>sum_list <span class="main">(</span>map size <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">Δ</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">termination</span></span> <span class="quoted">sc</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">Γ</span><span class="main">,</span><span class="bound">A</span><span class="main">,</span><span class="bound">Δ</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span><span class="main">.</span> list_sequent_cost <span class="bound">Γ</span> <span class="bound">Δ</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_sequent_cost_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"sc <span class="main">[]</span> <span class="main">[]</span> <span class="main">[</span><span class="main">(</span><span class="main">(</span>Atom <span class="main">0</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> Atom <span class="main">1</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> Atom <span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> Atom <span class="main">1</span><span class="main">]</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">1</span> <span class="main">::</span> nat<span class="main">]</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="comment1">(* An atom may appear twice in one of the lists, but that is of no concern. 
     Using sets for the atoms stands in the way of automation. *)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">code_simp</span>

<span class="keyword1" id="SC_Sema-sc_sim"><span class="command">lemma</span></span> sc_sim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Γ</span> <span class="free">Δ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">G</span> <span class="free">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sc <span class="free">Γ</span> <span class="free">A</span> <span class="free">Δ</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"image_mset Atom <span class="main">(</span>mset <span class="free">A</span><span class="main">)</span> <span class="main">+</span> mset <span class="free">Γ</span> <span class="main">⇒</span> image_mset Atom <span class="main">(</span>mset <span class="free">B</span><span class="main">)</span> <span class="main">+</span> mset <span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset Atom <span class="main">(</span>mset <span class="skolem">A</span><span class="main">)</span> <span class="main">⇒</span> image_mset Atom <span class="main">(</span>mset <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> set <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> set <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_image_mset <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SCp.Ax<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sc.induct<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span>
        <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_sequent_cost_def add.assoc Bot_delR_simp
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits option.splits 
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SC_Sema-scc_ce_distinct"><span class="command">lemma</span></span> scc_ce_distinct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">E</span><span class="main">)</span> <span class="main">∈</span> sc <span class="free">Γ</span> <span class="free">G</span> <span class="free">Δ</span> <span class="free">D</span> <span class="main">⟹</span> set <span class="free">C</span> <span class="main">∩</span> set <span class="free">E</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quoted"><span class="free">D</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">E</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sc.induct<span class="main">)</span>
  <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Completeness set aside, this is an interesting fact on the side: Sequent Calculus can provide counterexamples.›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> SC_counterexample<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">D</span><span class="main">)</span> <span class="main">∈</span> sc <span class="free">Γ</span> <span class="free">A</span> <span class="free">Δ</span> <span class="free">B</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set <span class="free">C</span><span class="main">)</span> <span class="main">¬⊨</span> image_mset Atom <span class="main">(</span>mset <span class="free">A</span><span class="main">)</span> <span class="main">+</span> mset <span class="free">Γ</span> <span class="main">⇒</span> image_mset Atom <span class="main">(</span>mset <span class="free">B</span><span class="main">)</span> <span class="main">+</span> mset <span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sc.induct<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> 
   <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sequent_semantics_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main"><span class="keyword3">;</span></span> 
   <span class="comment1">(* used to be only for one, now it's four… *)</span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> SC_counterexample'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">D</span><span class="main">)</span> <span class="main">∈</span> sc <span class="free">Γ</span> <span class="main">[]</span> <span class="free">Δ</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> set <span class="free">C</span><span class="main">)</span> <span class="main">¬⊨</span> mset <span class="free">Γ</span> <span class="main">⇒</span> mset <span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> SC_counterexample<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">theorem</span></span> SC_sound_complete<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟷</span> <span class="main">⊨</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> SC_soundness <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ'</span></span> <span class="skolem"><span class="skolem">Δ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">=</span> mset  <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="main">=</span> mset <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ex_mset<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sc <span class="skolem">Γ'</span> <span class="main">[]</span> <span class="skolem">Δ'</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> contrapos_pp<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sc <span class="skolem">Γ'</span> <span class="main">[]</span> <span class="skolem">Δ'</span> <span class="main">[]</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">E</span><span class="main">)</span> <span class="main">∈</span> sc <span class="skolem">Γ'</span> <span class="main">[]</span> <span class="skolem">Δ'</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">⊨</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> SC_counterexample' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> sc_sim<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">theorem</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ'</span></span> <span class="skolem"><span class="skolem">Δ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">=</span> mset <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="main">=</span> mset <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ex_mset<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset <span class="skolem">Γ'</span> <span class="main">⇒</span> mset <span class="skolem">Δ'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span> <span class="comment1">― ‹just to show that we didn't need to show the lemma above by contraposition. It's just quicker to do so.›</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sc <span class="skolem">Γ'</span> <span class="main">[]</span> <span class="skolem">Δ'</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> sc_sim<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mset <span class="skolem">Γ'</span> <span class="main">⇒</span> mset <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sc <span class="skolem">Γ'</span> <span class="main">[]</span> <span class="skolem">Δ'</span> <span class="main">[]</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> SC_counterexample <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">⊨</span> mset <span class="skolem">Γ'</span> <span class="main">⇒</span> mset <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> s<span class="main">[</span><span class="operator">unfolded</span> p<span class="main">]</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"mset <span class="skolem">Γ'</span> <span class="main">⇒</span> mset <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*
Just as a side-note: some textbooks advertise completeness as a consequence of cut elimination.
This only makes sense if you have a cut-rule in the rules of SC to begin with.
But even if we did, this proof of completeness would not change a bit.
So… huh.
*)</span>
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SC_Depth_Limit">
<div class="head">
<h1>Theory SC_Depth_Limit</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SC_Depth_Limit
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SC_Sema.html">SC_Sema</a> <a href="SC_Depth.html">SC_Depth</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1" id="SC_Depth_Limit-SC_completeness"><span class="command">lemma</span></span> SC_completeness<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> sequent_cost <span class="free">Γ</span> <span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"sequent_cost <span class="free">Γ</span> <span class="free">Δ</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="free">Δ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sequent_cost_def<span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> SCc.cases<span class="main">[</span><span class="operator">OF</span> Suc.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">oops</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Making this proof of completeness go through should be possible,
  but finding the right way to split the cases could get verbose.
The variant with the search procedure is a lot more elegant.›</span></span>
  

<span class="keyword1" id="SC_Depth_Limit-sc_sim_depth"><span class="command">lemma</span></span> sc_sim_depth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sc <span class="free">Γ</span> <span class="free">A</span> <span class="free">Δ</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"image_mset Atom <span class="main">(</span>mset <span class="free">A</span><span class="main">)</span> <span class="main">+</span> mset <span class="free">Γ</span> <span class="main">⇒</span> image_mset Atom <span class="main">(</span>mset <span class="free">B</span><span class="main">)</span> <span class="main">+</span> mset <span class="free">Δ</span> <span class="main">↓</span> sum_list <span class="main">(</span>map size <span class="main">(</span><span class="free">Γ</span><span class="main">@</span><span class="free">Δ</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> set <span class="free">A</span> <span class="main">∩</span> set <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset Atom <span class="main">(</span>mset <span class="skolem">A</span><span class="main">)</span> <span class="main">⇒</span> image_mset Atom <span class="main">(</span>mset <span class="skolem">B</span><span class="main">)</span> <span class="main">↓</span> Suc <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">A</span> <span class="main">∩</span> set <span class="skolem">B</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span> <span class="skolem">B</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_image_mset <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SCc.Ax<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">note</span></span> SCc.intros<span class="main">(</span>3-<span class="main">)</span><span class="main">[</span><span class="operator">intro</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">m</span> <span class="main">⟹</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">↓</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span> <span class="skolem">Δ</span> <span class="skolem">n</span> <span class="skolem">m</span> <span class="keyword1"><span class="command">using</span></span> dec_induct <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> deeper_suc<span class="main">)</span> <span class="comment1">(* sledgehammer is flippin' using induction. *)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sc.induct<span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span>
      <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_sequent_cost_def add.assoc deeper_suc weakenR'
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits option.splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> sc_depth_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">↓</span> sum_mset <span class="main">(</span>image_mset size <span class="main">(</span><span class="free">Γ</span><span class="main">+</span><span class="free">Δ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ'</span></span> <span class="skolem"><span class="skolem">Δ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">=</span> mset <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="main">=</span> mset <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ex_mset<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> s <span class="keyword1"><span class="command">have</span></span> sl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> mset <span class="skolem">Γ'</span> <span class="main">⇒</span> mset <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sum_mset <span class="main">(</span>image_mset size <span class="main">(</span><span class="free">Γ</span><span class="main">+</span><span class="free">Δ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">=</span> sum_list <span class="main">(</span>map size <span class="main">(</span><span class="skolem">Γ'</span><span class="main">@</span><span class="skolem">Δ'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mset_append mset_map sum_mset_sum_list<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset <span class="skolem">Γ'</span> <span class="main">⇒</span> mset <span class="skolem">Δ'</span> <span class="main">↓</span> <span class="var">?d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sc <span class="skolem">Γ'</span> <span class="main">[]</span> <span class="skolem">Δ'</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> sc_sim_depth<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mset <span class="skolem">Γ'</span> <span class="main">⇒</span> mset <span class="skolem">Δ'</span> <span class="main">↓</span> <span class="var">?d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sc <span class="skolem">Γ'</span> <span class="main">[]</span> <span class="skolem">Δ'</span> <span class="main">[]</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> SC_counterexample <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">⊨</span> mset <span class="skolem">Γ'</span> <span class="main">⇒</span> mset <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> s<span class="main">[</span><span class="operator">unfolded</span> p<span class="main">]</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"mset <span class="skolem">Γ'</span> <span class="main">⇒</span> mset <span class="skolem">Δ'</span> <span class="main">↓</span> <span class="var">?d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SC_Compl_Consistency">
<div class="head">
<h1>Theory SC_Compl_Consistency</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SC_Compl_Consistency
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Consistency.html">Consistency</a> <a href="SC_Cut.html">SC_Cut</a> <a href="SC_Sema.html">SC_Sema</a> 
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(* We only need contraction, not cut, and we only need ⊨⇒, not the proof of completeness. :/
   And we could also separate this into two theories. But I don't think that's worth it. *)</span>
<span class="comment1">(* It's possible to do this without contraction, but let's just say that the proof gets slightly less sledgehammerous… *)</span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="SC_Compl_Consistency-reasonable"><span class="command">lemma</span></span> reasonable<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">Γ'</span><span class="main">.</span> <span class="free">F</span>    <span class="main">▹</span> set_mset <span class="free">Γ</span> <span class="main">=</span> set_mset <span class="bound">Γ'</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">Γ'</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="free">F</span><span class="main">,</span> <span class="free">Γ</span><span class="main">)</span>"</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">Γ'</span><span class="main">.</span> <span class="free">F</span> <span class="main">▹</span> <span class="free">G</span> <span class="main">▹</span> set_mset <span class="free">Γ</span> <span class="main">=</span> set_mset <span class="bound">Γ'</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">Γ'</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="free">F</span><span class="main">,</span> <span class="free">G</span><span class="main">,</span> <span class="free">Γ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="SC_Compl_Consistency-SC_consistent"><span class="command">lemma</span></span> SC_consistent<span class="main">:</span>  <span class="quoted"><span class="quoted">"pcp <span class="main">{</span>set_mset <span class="bound">Γ</span><span class="main">|</span> <span class="bound">Γ</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="bound">Γ</span> <span class="main">⇒</span> <span class="main">{#}</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> pcp_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> ballI conjI<span class="main"><span class="keyword3">;</span></span> <span class="operator">erule</span> contrapos_pp<span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">drule</span> reasonable<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> NotL_inv AndL_inv OrL_inv ImpL_inv NotR_inv AndR_inv OrR_inv ImpR_inv multi_member_split contractL contractR <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> contractR contractL<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> add_mset_commute contract<span class="main">)</span>    
<span class="comment1">(* Alternatively, sledgehammer also finds slick proofs for the individual subgoals after the initial apply of the "reasonable"  lemmas
  subgoal by (simp add: SCp.BotL)
  subgoal by (metis Ax_canonical SCp.NotL contractL mset_add)
  subgoal by (metis SCp.AndL contractL insert_DiffM)
  subgoal by (metis SCp.OrL contractL insert_DiffM)
  subgoal by (metis NotL_inv SCp.ImpL contractL insert_DiffM)
  subgoal by (metis SCp.NotL SCp.NotR contractL insert_DiffM)
  subgoal by (metis NotL_inv SCp.AndR SCp.NotL contractL insert_DiffM)
  subgoal by (metis NotL_inv SCp.NotL SCp.OrR contractL inR1' insert_DiffM)
  subgoal by (metis NotL_inv SCp.ImpR SCp.NotL contractL inL1' insert_DiffM) *)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Γ</span> <span class="free">Δ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> countable formula multiset"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> contrapos_pp<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> NotInv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">+</span> image_mset Not <span class="free">Δ</span> <span class="main">⇒</span> <span class="main">{#}</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Δ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NotL_inv<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>›</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">Γ</span> <span class="main">+</span> image_mset Not <span class="free">Δ</span> <span class="main">⇒</span> <span class="main">{#}</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> NotInv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> pcp_sat<span class="main">[</span><span class="operator">OF</span> SC_consistent<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sat <span class="main">(</span>set_mset <span class="main">(</span><span class="free">Γ</span> <span class="main">+</span> image_mset <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">Δ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">⊨</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sat_def sequent_semantics_def not_all <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ex_forward<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ND">
<div class="head">
<h1>Theory ND</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Natural Deduction›</span></span>

<span class="keyword1"><span class="command">theory</span></span> ND
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Formulas.html">Formulas</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">ND</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula set <span class="main">⇒</span> <span class="tfree">'a</span> formula <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊢</span>"</span> 30<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
Ax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span> <span class="main">|</span>
NotE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">⊥</span>"</span></span> <span class="main">|</span>
NotI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">⊥</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> Not <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span> <span class="main">|</span>
CC<span class="main">:</span> <span class="quoted"><span class="quoted">"Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">⊥</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span> <span class="main">|</span>
AndE1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span> <span class="main">|</span>
AndE2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span> <span class="main">|</span>
AndI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> And <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span> <span class="main">|</span>
OrI1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span> <span class="main">|</span>
OrI2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span> <span class="main">|</span>
OrE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> Or <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">▹</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">▹</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span>"</span></span> <span class="main">|</span>
ImpI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span> <span class="main">|</span>
ImpE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> Imp <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>

<span class="comment1">(* Note that this is not a positive inductive definition because the
predicate occurs negatively in many rules:
inductive ND :: "form ⇒ bool" ("⊢ _" [30] 30) where
NotE: "⟦⊢ Not F; ⊢ F ⟧ ⟹ ⊢ ⊥" |
NotI: "⟦⊢ F ⟹ ⊢ ⊥⟧ ⟹ ⊢ Not F" |
CC: "⟦⊢ Not F ⟹ ⊢ ⊥⟧ ⟹ ⊢ F" |
AndE1: "⊢ And F G ⟹ ⊢ F" |
AndE2: "⊢ And F G ⟹ ⊢ G" |
AndI: "⟦ ⊢ F; ⊢ G ⟧ ⟹ ⊢ And F G" |
OrI1: "⊢ F ⟹ ⊢ Or F G" |
OrI2: "⊢ G ⟹ ⊢ Or F G" |
OrE: "⟦ ⊢ Or F G; ⊢ F ⟹ ⊢ H; ⊢ G ⟹ ⊢ H ⟧ ⟹ ⊢ H" |
ImpI: "⟦⊢ F ⟹ ⊢ G⟧ ⟹ ⊢ Imp F G" |
ImpE: "⟦ ⊢ Imp F G; ⊢ F ⟧ ⟹ ⊢ G"
*)</span>

<span class="keyword1" id="ND-Weaken"><span class="command">lemma</span></span> Weaken<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">F</span><span class="main">;</span> <span class="free">Γ</span> <span class="main">⊆</span> <span class="free">Γ'</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ'</span> <span class="main">⊢</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ND.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotI <span class="skolem">F</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ND.NotI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Ax <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ND.Ax<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NotE <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ND.NotE<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> CC <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ND.CC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> AndE1 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ND.AndE1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> AndE2 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ND.AndE2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> AndI <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ND.AndI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> OrI1 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ND.OrI1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> OrI2 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ND.OrI2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrE <span class="skolem">Γ</span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> OrE.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ND.OrE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">Γ'</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">F</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">G</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> OrE.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> OrE.prems<span class="main"><span class="main">]</span></span><span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> OrE.hyps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> OrE.hyps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> ImpI <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ND.ImpI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> ImpE <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ND.ImpE <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ND-BotE"><span class="command">lemma</span></span> BotE <span class="comment1">(* ex falso *)</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="main">⊥</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> CC subset_insertI Weaken<span class="main">)</span>

<span class="keyword1" id="ND-Not2E"><span class="command">lemma</span></span> Not2E<span class="main">:</span> <span class="quoted"><span class="quoted">"Not<span class="main">(</span>Not <span class="free">F</span><span class="main">)</span><span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> CC ND.Ax NotE insertI1 insert_commute<span class="main">)</span>

<span class="keyword1" id="ND-Not2I"><span class="command">lemma</span></span> Not2I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">▹</span><span class="free">Γ</span> <span class="main">⊢</span> Not<span class="main">(</span>Not <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> CC ND.Ax NotE insertI1 insert_commute<span class="main">)</span>

<span class="keyword1" id="ND-Not2IE"><span class="command">lemma</span></span> Not2IE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">▹</span><span class="free">Γ</span> <span class="main">⊢</span> <span class="free">G</span> <span class="main">⟹</span> Not <span class="main">(</span>Not <span class="free">F</span><span class="main">)</span><span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ImpE ImpI Not2E Weaken subset_insertI<span class="main">)</span>

<span class="keyword1" id="ND-NDtrans"><span class="command">lemma</span></span> NDtrans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">F</span><span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ImpE ImpI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="ND-AndL_sim"><span class="command">lemma</span></span> AndL_sim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">▹</span> <span class="free">G</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">H</span> <span class="main">⟹</span> And <span class="free">F</span> <span class="free">G</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> Weaken<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Γ' <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"And <span class="free"><span class="free">F</span></span> <span class="free"><span class="free">G</span></span> <span class="main"><span class="main">▹</span></span> <span class="free"><span class="free">F</span></span> <span class="main"><span class="main">▹</span></span> <span class="free"><span class="free">G</span></span> <span class="main"><span class="main">▹</span></span> <span class="free"><span class="free">Γ</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AndE1 AndE2 ND.Ax NDtrans insertI1 insert_commute<span class="main">)</span>

<span class="keyword1" id="ND-NotSwap"><span class="command">lemma</span></span> NotSwap<span class="main">:</span> <span class="quoted"><span class="quoted">"Not <span class="free">F</span><span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">G</span> <span class="main">⟹</span> Not <span class="free">G</span><span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CC NotE insert_commute subset_insertI Weaken <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ax insertI1<span class="main">)</span>
<span class="keyword1" id="ND-AndR_sim"><span class="command">lemma</span></span> AndR_sim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> Not <span class="free">F</span><span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">H</span><span class="main">;</span> Not <span class="free">G</span><span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">H</span> <span class="main">⟧</span> <span class="main">⟹</span> Not<span class="main">(</span>And <span class="free">F</span> <span class="free">G</span><span class="main">)</span><span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> AndI NotSwap <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="ND-OrL_sim"><span class="command">lemma</span></span> OrL_sim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">F</span><span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">H</span><span class="main">;</span> <span class="free">G</span><span class="main">▹</span><span class="free">Γ</span> <span class="main">⊢</span> <span class="free">H</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">G</span><span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Weaken<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Γ' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">▹</span> Or <span class="free">F</span> <span class="free">G</span><span class="main">▹</span> <span class="free">Γ</span>"</span></span><span class="main">]</span> Weaken<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Γ' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">▹</span> Or <span class="free">F</span> <span class="free">G</span><span class="main">▹</span> <span class="free">Γ</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ND.Ax OrE insertI1 insert_mono subset_insertI<span class="main">)</span>

<span class="keyword1" id="ND-OrR_sim"><span class="command">lemma</span></span> OrR_sim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span><span class="main">▹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">G</span><span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="main">⊥</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">F</span><span class="main">)</span><span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="main">⊥</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main">▹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">G</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">▹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main">▹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">G</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Weaken subset_insertI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">G</span> <span class="main">▹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="bound">f</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">F</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NDtrans Not2E NotSwap OrI2 insert_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> NDtrans Not2I NotSwap OrI1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ND-ImpL_sim"><span class="command">lemma</span></span> ImpL_sim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span><span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="main">⊥</span><span class="main">;</span> <span class="free">G</span><span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="main">⊥</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">G</span><span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> CC ImpE ImpI ND.Ax Weaken insertI1 subset_insertI<span class="main">)</span>

<span class="keyword1" id="ND-ImpR_sim"><span class="command">lemma</span></span> ImpR_sim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">G</span><span class="main">▹</span> <span class="free">F</span><span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="main">⊥</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">G</span><span class="main">)</span><span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> ImpI NotSwap insert_commute<span class="main">)</span>

<span class="keyword1" id="ND-ND_lem"><span class="command">lemma</span></span> ND_lem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊢</span> Not <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> CC<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> OrE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Not <span class="free"><span class="free">F</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> OrI1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> NotI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> NotE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main"><span class="hidden">❙</span><b>¬</b></span></span> <span class="free"><span class="free">F</span></span> <span class="main"><span class="main"><span class="hidden">❙</span><b>∨</b></span></span> <span class="free"><span class="free">F</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> OrI1 OrI2 Ax<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="ND-ND_caseDistinction"><span class="command">lemma</span></span> ND_caseDistinction<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">F</span><span class="main">▹</span><span class="free">Γ</span> <span class="main">⊢</span> <span class="free">H</span><span class="main">;</span> Not <span class="free">F</span><span class="main">▹</span><span class="free">Γ</span> <span class="main">⊢</span> <span class="free">H</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ND_lem OrE empty_subsetI Weaken<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span><span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">H</span><span class="main">;</span> <span class="free">G</span><span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">H</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">G</span><span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ND_caseDistinction<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> ImpE ImpI ND.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Weaken insertI1 subset_insertI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Weaken insert_commute subset_insertI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="ND-ND_deMorganAnd"><span class="command">lemma</span></span> ND_deMorganAnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free">G</span><span class="main">)</span><span class="main">}</span> <span class="main">⊢</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> CC<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> NotE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">F</span></span> <span class="main"><span class="main"><span class="hidden">❙</span><b>∧</b></span></span> <span class="free"><span class="free">G</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ax<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> AndI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> CC<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> NotE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="hidden">❙</span><b>¬</b></span></span> <span class="free"><span class="free">F</span></span> <span class="main"><span class="main"><span class="hidden">❙</span><b>∨</b></span></span> <span class="main"><span class="main"><span class="hidden">❙</span><b>¬</b></span></span> <span class="free"><span class="free">G</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ax<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> OrI1<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ax<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> CC<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> NotE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="hidden">❙</span><b>¬</b></span></span> <span class="free"><span class="free">F</span></span> <span class="main"><span class="main"><span class="hidden">❙</span><b>∨</b></span></span> <span class="main"><span class="main"><span class="hidden">❙</span><b>¬</b></span></span> <span class="free"><span class="free">G</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ax<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> OrI2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ax<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="ND-ND_deMorganOr"><span class="command">lemma</span></span> ND_deMorganOr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">G</span><span class="main">)</span><span class="main">}</span> <span class="main">⊢</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">G</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ND_caseDistinction<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> ND_caseDistinction<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> CC<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> NotE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">F</span></span> <span class="main"><span class="main"><span class="hidden">❙</span><b>∨</b></span></span> <span class="free"><span class="free">G</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ax OrI2 OrI1<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> AndI<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ax<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="ND-sim_sim"><span class="command">lemma</span></span> sim_sim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">G</span><span class="main">▹</span><span class="free">Γ</span> <span class="main">⊢</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">G</span><span class="main">▹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ImpE ImpI Weaken subset_insertI<span class="main">)</span>
<span class="keyword1"><span class="command">thm</span></span> sim_sim<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Γ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span><span class="main">,</span> <span class="operator">rotated</span><span class="main">,</span> <span class="operator">no_vars</span><span class="main">]</span> <span class="comment1">(* a bit easier to read? *)</span>
  
<span class="keyword1" id="ND-Top_provable"><span class="command">lemma</span></span> Top_provable<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="main">⊤</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Top_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ND.ImpI ND.Ax<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1" id="ND-NotBot_provable"><span class="command">lemma</span></span> NotBot_provable<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> NotI BotE Ax <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="ND-Top_useless"><span class="command">lemma</span></span> Top_useless<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">-</span> <span class="main">{</span><span class="main">⊤</span><span class="main">}</span> <span class="main">⊢</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NDtrans Top_provable Weaken insert_Diff_single subset_insertI<span class="main">)</span>  

<span class="keyword1" id="ND-AssmBigAnd"><span class="command">lemma</span></span> AssmBigAnd<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">G</span> <span class="main">⊢</span> <span class="free">F</span> <span class="main">⟷</span> <span class="main">{}</span> <span class="main">⊢</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">G</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">F</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ND.ImpI <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Weaken ImpE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ NotBot_provable<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">G</span> <span class="skolem">GS</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">G</span> <span class="main">#</span> <span class="skolem">GS</span><span class="main">)</span> <span class="main">⊢</span> <span class="skolem">F</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">GS</span> <span class="main">⊢</span> <span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> ND.ImpI<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> Cons.IH <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊢</span> <span class="main"><span class="hidden">❙</span><b>⋀</b></span> <span class="skolem">GS</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">G</span><span class="main">,</span><span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="skolem">GS</span><span class="main">}</span> <span class="main">⊢</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="skolem">GS</span><span class="main">}</span> <span class="main">⊢</span> <span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">F</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Weaken<span class="main">[</span><span class="operator">OF</span> * empty_subsetI<span class="main">]</span> ImpE<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Γ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main"><span class="hidden">❙</span><b>⋀</b></span> <span class="skolem">GS</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> F<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>⋀</b></span> <span class="skolem">GS</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ND.Ax<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">G</span><span class="main">,</span><span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="skolem">GS</span><span class="main">}</span> <span class="main">⊢</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Weaken<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> ImpE<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Γ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">G</span><span class="main">,</span><span class="main"><span class="hidden">❙</span><b>⋀</b></span> <span class="skolem">GS</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> F<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">G</span>"</span></span><span class="main">]</span> ND.Ax <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ND.Ax<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊢</span> <span class="main"><span class="hidden">❙</span><b>⋀</b></span> <span class="main">(</span><span class="skolem">G</span> <span class="main">#</span> <span class="skolem">GS</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> ND.ImpI<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AndL_sim<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊢</span> <span class="main"><span class="hidden">❙</span><b>⋀</b></span> <span class="main">(</span><span class="skolem">G</span> <span class="main">#</span> <span class="skolem">GS</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">F</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="skolem">GS</span><span class="main">}</span> <span class="main">⊢</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ImpE<span class="main">[</span><span class="operator">OF</span> _ Ax<span class="main"><span class="main">[</span></span><span class="operator">OF</span> singletonI<span class="main"><span class="main">]</span></span><span class="main">]</span> Weaken <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>      
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">G</span><span class="main">,</span><span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="skolem">GS</span><span class="main">}</span> <span class="main">⊢</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> AndI ImpE ImpI ND.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Weaken insertI1 subset_insertI<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="skolem">GS</span><span class="main">}</span> <span class="main">⊢</span> <span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ImpI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊢</span> <span class="main"><span class="hidden">❙</span><b>⋀</b></span> <span class="skolem">GS</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ImpI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> Cons.IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">GS</span> <span class="main">⊢</span> <span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">G</span> <span class="main">#</span> <span class="skolem">GS</span><span class="main">)</span> <span class="main">⊢</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ImpE Weaken <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ax list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_subset_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ND_Sound">
<div class="head">
<h1>Theory ND_Sound</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> ND_Sound
<span class="keyword2"><span class="keyword">imports</span></span> <a href="ND.html">ND</a> <a href="Sema.html">Sema</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="ND_Sound-BigAndImp"><span class="command">lemma</span></span> BigAndImp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="free">P</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">G</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> set <span class="free">P</span><span class="main">.</span> <span class="free">A</span> <span class="main">⊨</span> <span class="bound">F</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">A</span> <span class="main">⊨</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">P</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> entailment_def<span class="main">)</span>

<span class="keyword1" id="ND_Sound-ND_sound"><span class="command">lemma</span></span> ND_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊫</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ND.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> entailment_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="comment1">(* yeah, Isabelle's facilities are very good with this kind of problem… maybe we should show one or the other case. *)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ND_Compl_Truthtable">
<div class="head">
<h1>Theory ND_Compl_Truthtable</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> ND_Compl_Truthtable
<span class="keyword2"><span class="keyword">imports</span></span> <a href="ND_Sound.html">ND_Sound</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This proof is inspired by Huth and Ryan~\cite{huth2004logic}.›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">turn_true</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">⊨</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="keyword1">else</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1" id="ND_Compl_Truthtable-lemma0"><span class="command">lemma</span></span> lemma0<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊨</span> turn_true <span class="free">𝒜</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> turn_true_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="ND_Compl_Truthtable-turn_true_simps"><span class="command">lemma</span></span> turn_true_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊨</span> <span class="free">F</span> <span class="main">⟹</span> turn_true <span class="free">𝒜</span> <span class="free">F</span> <span class="main">=</span> <span class="free">F</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">𝒜</span> <span class="main">⊨</span> <span class="free">F</span> <span class="main">⟹</span> turn_true <span class="free">𝒜</span> <span class="free">F</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> turn_true_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="comment1">(* often more sensible than to unfold everything *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">line_assm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> valuation <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> formula set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">line_assm</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">≡</span> <span class="main">(`)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> turn_true <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">(</span>Atom <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">line_suitable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> formula <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">line_suitable</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="main">(</span>atoms <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1" id="ND_Compl_Truthtable-line_suitable_junctors"><span class="command">lemma</span></span> line_suitable_junctors<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"line_suitable <span class="free">𝒜</span> <span class="main">(</span>Not <span class="free">F</span><span class="main">)</span> <span class="main">=</span> line_suitable <span class="free">𝒜</span> <span class="free">F</span>"</span></span>
  <span class="quoted"><span class="quoted">"line_suitable <span class="free">𝒜</span> <span class="main">(</span>And <span class="free">F</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>line_suitable <span class="free">𝒜</span> <span class="free">F</span> <span class="main">∧</span> line_suitable <span class="free">𝒜</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"line_suitable <span class="free">𝒜</span> <span class="main">(</span>Or <span class="free">F</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>line_suitable <span class="free">𝒜</span> <span class="free">F</span> <span class="main">∧</span> line_suitable <span class="free">𝒜</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"line_suitable <span class="free">𝒜</span> <span class="main">(</span>Imp <span class="free">F</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>line_suitable <span class="free">𝒜</span> <span class="free">F</span> <span class="main">∧</span> line_suitable <span class="free">𝒜</span> <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> line_suitable_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">linarith</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="ND_Compl_Truthtable-line_assm_Cons"><span class="command">lemma</span></span> line_assm_Cons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"line_assm <span class="free">𝒜</span> <span class="main">(</span><span class="free">k</span><span class="main">▹</span><span class="free">ks</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">𝒜</span> <span class="free">k</span> <span class="keyword1">then</span> Atom <span class="free">k</span> <span class="keyword1">else</span> Not <span class="main">(</span>Atom <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">▹</span> line_assm <span class="free">𝒜</span> <span class="free">ks</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> line_assm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="ND_Compl_Truthtable-NotD"><span class="command">lemma</span></span> NotD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">F</span><span class="main">▹</span><span class="free">Γ</span> <span class="main">⊢</span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Not2I NotE Weaken subset_insertI<span class="main">)</span>

<span class="keyword1" id="ND_Compl_Truthtable-truthline_ND_proof"><span class="command">lemma</span></span> truthline_ND_proof<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"line_suitable <span class="free">Z</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_assm <span class="free">𝒜</span> <span class="free">Z</span> <span class="main">⊢</span> turn_true <span class="free">𝒜</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">k</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Ax<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_suitable_def line_assm_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Bot
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"turn_true <span class="free">𝒜</span> <span class="main">⊥</span> <span class="main">=</span> Not Bot"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> turn_true_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ax NotI<span class="main">)</span> <span class="comment1">(* the theorems from ND/BigFormulas would be useful here. but… nah. *)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⊢</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">F</span><span class="main">)</span> <span class="main">⟷</span> <span class="skolem">Γ</span> <span class="main">⊢</span> <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">Γ</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NDtrans Not2E Not2I<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Not <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"line_assm <span class="free">𝒜</span> <span class="free">Z</span> <span class="main">⊢</span> turn_true <span class="free">𝒜</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>line_assm <span class="free">𝒜</span> <span class="free">Z</span> <span class="main">⊢</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">F</span><span class="main">;</span> <span class="main">¬</span> <span class="free">𝒜</span> <span class="main">⊨</span> <span class="skolem">F</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span><span class="main">▹</span> line_assm <span class="free">𝒜</span> <span class="free">Z</span> <span class="main">⊢</span> <span class="main">⊥</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> NotE<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> F<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">F</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> AndE1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Ax<span class="main"><span class="main">]</span></span> Weaken<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ subset_insertI<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>line_assm <span class="free">𝒜</span> <span class="free">Z</span> <span class="main">⊢</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">G</span><span class="main">;</span> <span class="main">¬</span> <span class="free">𝒜</span> <span class="main">⊨</span> <span class="skolem">G</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span><span class="main">▹</span> line_assm <span class="free">𝒜</span> <span class="free">Z</span> <span class="main">⊢</span> <span class="main">⊥</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> NotE<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> F<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">G</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> AndE2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Ax<span class="main"><span class="main">]</span></span> Weaken<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ subset_insertI<span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="comment1">(* (meson AndL_sim Not2I NotE Weaken subset_insertI) *)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊨</span> <span class="skolem">G</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> ND.NotI AndI<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊨</span> <span class="skolem">G</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">elim</span> ND.OrI1 ND.OrI2<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> NotI <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> NotD <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> OrL_sim<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Imp <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> mIH<span class="main">:</span> <span class="quoted"><span class="quoted">"line_assm <span class="free">𝒜</span> <span class="free">Z</span> <span class="main">⊢</span> turn_true <span class="free">𝒜</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"line_assm <span class="free">𝒜</span> <span class="free">Z</span> <span class="main">⊢</span> turn_true <span class="free">𝒜</span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊨</span> <span class="skolem">F</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">𝒜</span> <span class="main">⊨</span> <span class="skolem">G</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> ImpI NotI ImpL_sim<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Weaken<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ subset_insertI<span class="main"><span class="main">]</span></span> NotSwap NotD NotD<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> BotE<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">thm</span></span> NotD<span class="main">[</span><span class="operator">THEN</span> BotE<span class="main">]</span>

<span class="keyword1" id="ND_Compl_Truthtable-deconstruct_assm_set"><span class="command">lemma</span></span> deconstruct_assm_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">𝒜</span><span class="main">.</span> line_assm <span class="bound">𝒜</span> <span class="main">(</span><span class="free">k</span><span class="main">▹</span><span class="free">Z</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">𝒜</span><span class="main">.</span> line_assm <span class="bound">𝒜</span> <span class="free">Z</span> <span class="main">⊢</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> <span class="free">Z</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> IH <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="skolem">𝒜</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝒜</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_absorb<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∉</span> <span class="free">Z</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">𝒜</span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Since we require the IH for arbitrary <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">𝒜</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, we use a modified <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">𝒜</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> from the conclusion like this:›</span></span>
  <span class="keyword1"><span class="command">from</span></span> IH <span class="keyword1"><span class="command">have</span></span> av<span class="main">:</span> <span class="quoted"><span class="quoted">"line_assm <span class="main">(</span><span class="skolem">𝒜</span><span class="main">(</span><span class="free">k</span> <span class="main">:=</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span><span class="main">▹</span><span class="free">Z</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹However, that modification is only relevant for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">k</span></span><span class="main"><span class="main">▹</span></span><span class="free"><span class="free">Z</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, nothing from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Z</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> gets touched.›</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">∉</span> <span class="free">Z</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_assm <span class="main">(</span><span class="skolem">𝒜</span><span class="main">(</span><span class="free">k</span> <span class="main">:=</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span> <span class="free">Z</span> <span class="main">=</span> line_assm <span class="skolem">𝒜</span> <span class="free">Z</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span> <span class="keyword1"><span class="command">unfolding</span></span> line_assm_def turn_true_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹That means we can rewrite the modified <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> line_assm<span class="antiquote"><span class="antiquote">}</span></span></span></span> like this:›</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"line_assm <span class="main">(</span><span class="skolem">𝒜</span><span class="main">(</span><span class="free">k</span> <span class="main">:=</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span><span class="main">▹</span><span class="free">Z</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">v</span> <span class="keyword1">then</span> Atom <span class="free">k</span> <span class="keyword1">else</span> Not <span class="main">(</span>Atom <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">▹</span> line_assm <span class="skolem">𝒜</span> <span class="free">Z</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Inserting <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> True<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> False<span class="antiquote"><span class="antiquote">}</span></span></span></span> for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>v›</span></span></span></span> yields the two alternatives.›</span></span>
  <span class="keyword1"><span class="command">with</span></span> av <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Atom <span class="free">k</span> <span class="main">▹</span> line_assm <span class="skolem">𝒜</span> <span class="free">Z</span> <span class="main">⊢</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"Not <span class="main">(</span>Atom <span class="free">k</span><span class="main">)</span> <span class="main">▹</span> line_assm <span class="skolem">𝒜</span> <span class="free">Z</span> <span class="main">⊢</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> ND_caseDistinction <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_assm <span class="skolem">𝒜</span> <span class="free">Z</span> <span class="main">⊢</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> ND_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> taut<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊢</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"turn_true <span class="skolem">Z</span> <span class="free">F</span> <span class="main">=</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Z</span> <span class="keyword1"><span class="command">using</span></span> taut <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="comment1">(* ↑ too fast for you? read ↓ *)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_assm <span class="skolem">𝒜</span> <span class="main">{}</span> <span class="main">⊢</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝒜</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">𝒜</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_empty_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> fat<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>atoms <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> atoms_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> su<span class="main">:</span> <span class="quoted"><span class="quoted">"line_suitable <span class="main">(</span>atoms <span class="free">F</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> line_suitable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> truthline_ND_proof<span class="main">[</span><span class="operator">OF</span> su<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> base<span class="main">:</span> <span class="quoted"><span class="quoted">"line_assm <span class="skolem">𝒜</span> <span class="main">(</span>atoms <span class="free">F</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝒜</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">k</span> <span class="skolem">Z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> <span class="skolem">Z</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">▹</span> <span class="skolem">Z</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">Z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">𝒜</span><span class="main">.</span> line_assm <span class="bound">𝒜</span> <span class="skolem">Z</span> <span class="main">⊢</span> <span class="free">F</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹line_assm <span class="skolem">𝒜</span> <span class="main">(</span><span class="skolem">Z</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main">}</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">F</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> deconstruct_assm_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="skolem">𝒜</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="comment1">(* could have done that more efficiently…
  have "line_assm 𝒜 {} ⊢ F" for 𝒜
    using deconstruct_assm_set[OF spec[where P="λ𝒜. line_assm 𝒜 (_ ▹ _) ⊢ F"]]
    using finite_empty_induct[OF fat, where P="λZ. ∀𝒜. line_assm 𝒜 Z ⊢ F",
        OF base[THEN allI[where P="λ𝒜. line_assm 𝒜 (atoms F) ⊢ F"]]]
    by (metis (full_types) insert_Diff_single insert_absorb)*)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> line_assm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> ND_sound_complete<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊢</span> <span class="free">F</span> <span class="main">⟷</span> <span class="main">⊨</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ND_sound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="free">F</span></span><span class="main">]</span> ND_complete<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">F</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> entailment_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ND_Compl_Truthtable_Compact">
<div class="head">
<h1>Theory ND_Compl_Truthtable_Compact</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> ND_Compl_Truthtable_Compact
<span class="keyword2"><span class="keyword">imports</span></span> <a href="ND_Compl_Truthtable.html">ND_Compl_Truthtable</a> <a href="Compactness.html">Compactness</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">theorem</span></span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Γ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> countable formula set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊫</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊫</span> <span class="free">F</span>›</span></span>
  <span class="keyword1"><span class="command">with</span></span> compact_to_formula <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> G <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> ND_complete <span class="quoted"><span class="quoted">‹<span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{}</span> <span class="main">⊢</span> <span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> AssmBigAnd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">G</span> <span class="main">⊢</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> Weaken <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">G</span> <span class="main">⊆</span> <span class="free">Γ</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="HC">
<div class="head">
<h1>Theory HC</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Hilbert Calculus›</span></span>
<span class="keyword1"><span class="command">theory</span></span> HC
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Formulas.html">Formulas</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We can define Hilbert Calculus as the modus ponens closure over a set of axioms:›</span></span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">HC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula  set <span class="main">⇒</span> <span class="tfree">'a</span> formula <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span>"</span> 30<span class="main">)</span> <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">Γ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
Ax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∈</span> <span class="free">Γ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>H</sub></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span> <span class="main">|</span>
MP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>H</sub></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>H</sub></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>H</sub></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹.›</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The problem with that is defining the axioms. Normally, we just write that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">F</span></span> <span class="main"><span class="main"><span class="hidden">❙</span><b>→</b></span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">G</span></span> <span class="main"><span class="main"><span class="hidden">❙</span><b>→</b></span></span> <span class="free"><span class="free">F</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is an axiom, 
  and mean that anything can be substituted for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
Now, we can't just write down a set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>{F <span class="hidden">❙</span><b>→</b> (G <span class="hidden">❙</span><b>→</b> F), \dots›</span></span></span></span>.
Instead, defining it as an inductive set with no induction is a good idea.
›</span></span>
<span class="comment1">(* Note to self: Don't try to formulate these as a definition. Possible, but painful to use. *)</span>
<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">AX0</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">AX0</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">AX0</span>"</span></span>
<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">AX10</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∈</span> AX0 <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∈</span> <span class="free">AX10</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">AX10</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">AX10</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">AX10</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∈</span> <span class="free">AX10</span>"</span></span> <span class="main">|</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∈</span> <span class="free">AX10</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">AX10</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∈</span> <span class="free">AX10</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main">∈</span> <span class="free">AX10</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∈</span> <span class="free">AX10</span>"</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> HC_intros<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">]</span> <span class="main">=</span> 
  AX0.intros<span class="main">[</span><span class="operator">THEN</span> HC.intros<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span>
  AX0.intros<span class="main">[</span><span class="operator">THEN</span> AX10.intros<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">,</span> <span class="operator">THEN</span> HC.intros<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span>
  AX10.intros<span class="main">(</span>2-<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> HC.intros<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span></span></span></span><span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The first four axioms, as originally formulated by Hilbert~\cite{hilbert1928grundlagen}.›</span></span>
<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">AXH</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">AXH</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">AXH</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">AXH</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">AXH</span>"</span></span>

<span class="keyword1" id="HC-HC_mono"><span class="command">lemma</span></span> HC_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span> <span class="main">⟹</span> <span class="free">T</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> HC.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> HC.intros<span class="main">)</span>
<span class="keyword1" id="HC-AX010"><span class="command">lemma</span></span> AX010<span class="main">:</span> <span class="quoted"><span class="quoted">"AX0 <span class="main">⊆</span> AX10"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> AX0.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> AX10.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1" id="HC-AX100"><span class="command">lemma</span></span> AX100<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"AX0 <span class="main">∪</span> AX10 <span class="main">=</span> AX10"</span></span> <span class="keyword1"><span class="command">using</span></span> AX010 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Hilbert's first four axioms and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> AX0<span class="antiquote"><span class="antiquote">}</span></span></span></span> are syntactically quite different.
  Derivability does not change:›</span></span>
<span class="keyword1" id="HC-hilbert_folgeaxiome_as_strong_as_AX0"><span class="command">lemma</span></span> hilbert_folgeaxiome_as_strong_as_AX0<span class="main">:</span> <span class="quoted"><span class="quoted">"AX0 <span class="main">∪</span> <span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main">⟷</span> AXH <span class="main">∪</span> <span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span>
  <span class="quoted"><span class="quoted">"AX0 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"AX0 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">H</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"AX0 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">(</span><span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">H</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">H</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span> <span class="keyword1"><span class="command">using</span></span> HC_intros<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> MP <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> H<span class="main">:</span>
    <span class="quoted"><span class="quoted">"AXH <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">H</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">note</span></span> AXH.intros<span class="main">[</span><span class="operator">THEN</span> HC.Ax<span class="main">]</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> MP <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> <span class="comment1">(* 4s *)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> H 0
  <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> *<span class="main">[</span><span class="operator">THEN</span> HC_mono<span class="main">,</span> <span class="operator">OF</span> Un_upper1<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Z</span> <span class="main">⟷</span> <span class="var">?H</span>"</span></span><span class="main">)</span> <span class="comment1">(* HC, where nothing is automatic (except for after this, nearly everything in this file is) *)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?Z</span></span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">induction</span>
      <span class="keyword3"><span class="command">case</span></span> MP <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> HC.MP <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ax <span class="skolem">F</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> AX0"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">induction</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AXH.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> HC.Ax *<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="free">Γ</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> HC.Ax<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">F</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?Z</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">induction</span>
      <span class="keyword3"><span class="command">case</span></span> MP <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> HC.MP <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ax <span class="skolem">F</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> AXH"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">induction</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AX0.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> HC.Ax *<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="free">Γ</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> HC.Ax<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">F</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"AX0 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> HC_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> HC.MP<span class="main">)</span>
<span class="comment1">(* Can you do that again, but slowly? *)</span>
<span class="keyword1" id="HC-imp_self"><span class="command">lemma</span></span> imp_self<span class="main">:</span> <span class="quoted"><span class="quoted">"AX0 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span><span class="main">.</span> AX0 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="bound">f</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> MP
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">G</span> <span class="keyword1"><span class="command">using</span></span> HC_intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> G<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> F<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">F</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">note</span></span> MP
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main">(</span><span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">G</span> <span class="keyword1"><span class="command">using</span></span> HC_intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> G<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> F<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">F</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">(</span><span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main">(</span><span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">G</span> <span class="keyword1"><span class="command">using</span></span> HC_intros<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> G<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> F<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">F</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> H<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">F</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">(</span><span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">G</span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* You'd get the idea for this theorem just when writing the HCND proof. It's really quite natural. *)</span>
<span class="keyword1"><span class="command">theorem</span></span> Deduction_theorem<span class="main">:</span> <span class="quoted"><span class="quoted">"AX0 <span class="main">∪</span> insert <span class="free">F</span> <span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">G</span> <span class="main">⟹</span> AX0 <span class="main">∪</span> <span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> HC.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ax <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> <span class="skolem">G</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> imp_self <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"AX0 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> HC_mono <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">=</span> <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> sup_ge1 <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≠</span> <span class="skolem">G</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> HC.MP
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">≠</span> <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">∈</span> AX0 <span class="main">∪</span> insert <span class="free">F</span> <span class="free">Γ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">∈</span> AX0 <span class="main">∪</span> <span class="free">Γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> HC.Ax <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"AX0 <span class="main">∪</span> <span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> HC_mono<span class="main">[</span><span class="operator">OF</span> HC_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sup_ge1<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"AX0 <span class="main">∪</span> <span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>MP <span class="skolem">G</span> <span class="skolem">H</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"AX0 <span class="main">∪</span> <span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">H</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">H</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> HC_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> HC.MP <span class="quoted"><span class="quoted">‹AX0 <span class="main">∪</span> <span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">H</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"AX0 <span class="main">∪</span> <span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> HC.MP <span class="quoted"><span class="quoted">‹AX0 <span class="main">∪</span> <span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"AX0 <span class="main">∪</span> <span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="HC_Compl_Consistency">
<div class="head">
<h1>Theory HC_Compl_Consistency</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> HC_Compl_Consistency
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Consistency.html">Consistency</a> <a href="HC.html">HC</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="HC_Compl_Consistency-dt"><span class="command">lemma</span></span> dt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AX100 Deduction_theorem Un_insert_right sup_left_commute<span class="main">)</span>
<span class="keyword1" id="HC_Compl_Consistency-sim"><span class="command">lemma</span></span> sim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> MP dt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1" id="HC_Compl_Consistency-sim_conj"><span class="command">lemma</span></span> sim_conj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">▹</span> <span class="free">G</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> MP dt <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_insert_left<span class="main">)</span>
<span class="keyword1" id="HC_Compl_Consistency-sim_disj"><span class="command">lemma</span></span> sim_disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">F</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">H</span><span class="main">;</span> <span class="free">G</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">H</span><span class="main">;</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">G</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1 dt<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1 dt<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> 2 3 HC.simps HC_intros<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> HC_mono sup_ge2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>3<span class="main">)</span> MP <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="HC_Compl_Consistency-someax"><span class="command">lemma</span></span> someax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> HC_intros<span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span> HC_mono subset_insertI sup_ge2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main">▹</span> <span class="free">F</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> HC.simps HC_mono insertI1 subset_insertI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Un_insert_left dt<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="HC_Compl_Consistency-lem"><span class="command">lemma</span></span> lem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">thm</span></span> HC_intros<span class="main">(</span>7<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="main">⊥</span></span> <span class="quoted"><span class="quoted">"Not <span class="free">F</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AX10.intros<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> Ax HC_mono MP Un_commute Un_insert_left insertI1 sup_ge1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">F</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> someax <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HC.simps Un_insert_left<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">F</span><span class="main">)</span> <span class="main">▹</span> <span class="free">F</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ax HC_mono MP insertI1 subset_insertI<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">F</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_insert_left dt insert_commute<span class="main">)</span>
      
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HC.simps HC_intros<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> HC_mono inf_sup_ord<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> insertI1 insert_is_Un<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">F</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> someax <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HC.simps Un_insert_left<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">F</span><span class="main">)</span> <span class="main">▹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ax HC_mono MP insertI1 subset_insertI<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">F</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_insert_left dt insert_commute<span class="main">)</span>
  
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">F</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> HC_intros<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> HC_mono MP <span class="quoted"><span class="quoted">‹<span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">F</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>›</span></span> dt subset_insertI sup_ge2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> HC.simps HC_intros<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> HC_mono sup_ge2<span class="main">)</span>
<span class="comment1">(*    apply(insert HC_mono dt HC_intros(3-)[THEN HC_mono, OF sup_ge2] sim HC.intros)
    sledgehammer[debug,max_facts=50,timeout=120]*)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="HC_Compl_Consistency-exchg"><span class="command">lemma</span></span> exchg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> AX10.intros<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> HC.simps HC_intros<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> HC_intros<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> HC_mono sup_ge2<span class="main">)</span>
    
<span class="keyword1" id="HC_Compl_Consistency-lem2"><span class="command">lemma</span></span> lem2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exchg lem<span class="main">)</span>
  
  
<span class="keyword1" id="HC_Compl_Consistency-imp_sim"><span class="command">lemma</span></span> imp_sim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span> <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span> <span class="bound">f</span> <span class="bound">Fa</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">F</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="bound">f</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="bound">Fa</span> <span class="main">∨</span> <span class="bound">Fa</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="bound">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> HC_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1"</span> subset_insertI<span class="main">)</span> <span class="comment1">(* &gt; 1.0 s, timed out *)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> HC.simps dt insertI1 subset_insertI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AX10.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Ax<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">F</span> <span class="bound">f</span> <span class="bound">fa</span> <span class="bound">fb</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">F</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="bound">f</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="bound">fa</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">fb</span> <span class="main">▹</span> <span class="bound">F</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="bound">f</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">fb</span> <span class="main">▹</span> <span class="bound">F</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="bound">fa</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> HC_mono MP subset_insertI<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ax <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">G</span>›</span></span> insertI1 lem sim_disj<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="HC_Compl_Consistency-inpcp"><span class="command">lemma</span></span> inpcp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> HC_intros<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> HC_mono MP dt subset_insertI sup_ge2<span class="main">)</span>
    
<span class="keyword1" id="HC_Compl_Consistency-HC_case_distinction"><span class="command">lemma</span></span> HC_case_distinction<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> HC_intros<span class="main">(</span>7<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"Not <span class="free">F</span>"</span></span><span class="main">]</span> lem2
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> HC.simps HC_mono insertI1 sim_disj subset_insertI<span class="main">)</span>
  
<span class="keyword1" id="HC_Compl_Consistency-nand_sim"><span class="command">lemma</span></span> nand_sim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span> <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AX10.intros<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> Ax<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">▹</span> <span class="free">G</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ax HC_mono MP insertI1 subset_insertI<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">▹</span> <span class="free">G</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> HC_intros<span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span> HC_mono MP subset_insertI sup_ge2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_insert_left dt<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AX10.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Ax<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> AX10.intros<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> AX100 Ax HC_mono MP Un_assoc Un_insert_left dt inf_sup_ord<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> insertI1 subset_insertI sup_ge2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 3 inpcp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_insert_left dt<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 5 6 HC_case_distinction <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 4 7 HC_case_distinction <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="HC_Compl_Consistency-HC_contrapos_nn"><span class="command">lemma</span></span> HC_contrapos_nn<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span><span class="main">;</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span> <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> HC_intros<span class="main">(</span>12<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> HC_mono MP <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> HC.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> HC_mono MP dt insertI1 subset_insertI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">meson</span> HC_intros<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> HC_intros<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> HC_mono MP sup_ge2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
      

<span class="keyword1" id="HC_Compl_Consistency-nor_sim"><span class="command">lemma</span></span> nor_sim<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> HC_contrapos_nn assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HC_intros<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span> HC_mono sup_ge2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    
<span class="keyword1" id="HC_Compl_Consistency-HC_contrapos_np"><span class="command">lemma</span></span> HC_contrapos_np<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span><span class="main">;</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> HC_intros<span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span> HC_intros<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> HC_mono MP sup_ge2  HC_contrapos_nn<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">Γ</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Not <span class="free"><span class="free"><span class="free">G</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>    
    
<span class="keyword1" id="HC_Compl_Consistency-not_imp"><span class="command">lemma</span></span> not_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span> <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AX10.intros<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> Ax<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main">▹</span> <span class="free">F</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> HC.simps HC_mono insertI1 subset_insertI<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span> <span class="main">▹</span> <span class="free">F</span> <span class="main">▹</span> <span class="free">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Un_commute Un_insert_right inpcp<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_insert_left dt insert_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="HC_Compl_Consistency-HC_consistent"><span class="command">lemma</span></span> HC_consistent<span class="main">:</span>  <span class="quoted"><span class="quoted">"pcp <span class="main">{</span><span class="bound">Γ</span><span class="main">|</span> <span class="bound">Γ</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="bound">Γ</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> pcp_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> ballI conjI<span class="main"><span class="keyword3">;</span></span> <span class="operator">unfold</span> mem_Collect_eq<span class="main"><span class="keyword3">;</span></span> <span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">;</span></span> <span class="operator">erule</span> contrapos_np<span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HC.Ax<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ax HC_intros<span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span> HC_mono MP Un_upper1 sup_ge2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> sim_conj <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Ax HC_intros<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> HC_intros<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> HC_mono MP sup_ge1 sup_ge2<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> sim_disj <span class="keyword1"><span class="command">using</span></span> Ax <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sim_disj<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ax imp_sim<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ax HC_contrapos_nn MP Un_iff Un_insert_left dt inpcp someax<span class="main">)</span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sim_disj<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ax nand_sim<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span>  sim_conj<span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> Ax Un_iff nor_sim<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> Γ F G <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> sim_conj<span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ax HC_Compl_Consistency.not_imp HC_contrapos_np Un_iff<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ax HC_contrapos_nn HC_intros<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> HC_mono sup_ge1 sup_ge2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">corollary</span></span> HC_complete<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> countable formula"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="free">F</span> <span class="main">⟹</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> contrapos_pp<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?W</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">Γ</span><span class="main">|</span> <span class="bound">Γ</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="bound">Γ</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> countable<span class="main">)</span> formula set<span class="main">)</span> <span class="main">∪</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">show_types</span><span class="main">]</span><span class="main">]</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span>AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span> <span class="main">▹</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AX100 Deduction_theorem HC_intros<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> MP Un_insert_right<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span><span class="main">}</span> <span class="main">∈</span> <span class="var">?W</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> pcp_sat HC_consistent <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sat <span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">⊨</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sat_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
    

  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Resolution">
<div class="head">
<h1>Theory Resolution</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Resolution›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Resolution
<span class="keyword2"><span class="keyword">imports</span></span> <a href="CNF.html">CNF</a> <span class="quoted">"<a href="../../HOL/HOL-Library/While_Combinator.html">HOL-Library.While_Combinator</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Resolution is different from the other proof systems:
  its derivations do not represent proofs in the way the other systems do.
  Rather, they represent invariant additions (under satisfiability) to set of clauses.›</span></span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">Resolution</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> literal set set <span class="main">⇒</span> <span class="tfree">'a</span> literal set <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊢</span> _"</span> <span class="main">[</span>30<span class="main">]</span> 28<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
Ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span>"</span></span> <span class="main">|</span>
R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">¯</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">¯</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The problematic part of this formulation is that we can't talk about a "Resolution Refutation" in an inductive manner. 
  In the places where Gallier's proofs~\cite{gallier2015logic} do that, we have to work around that.›</span></span>

<span class="keyword1" id="Resolution-Resolution_weaken"><span class="command">lemma</span></span> Resolution_weaken<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊢</span> <span class="free">D</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">∪</span> <span class="free">S</span> <span class="main">⊢</span> <span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Resolution.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Resolution.intros<span class="main">)</span>

<span class="keyword1" id="Resolution-Resolution_unnecessary"><span class="command">lemma</span></span> Resolution_unnecessary<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span> <span class="main">∈</span> <span class="free">T</span><span class="main">.</span> <span class="free">S</span> <span class="main">⊢</span> <span class="bound">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∪</span> <span class="free">S</span> <span class="main">⊢</span> <span class="free">D</span> <span class="main">⟷</span> <span class="free">S</span> <span class="main">⊢</span> <span class="free">D</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟷</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?l</span>›</span></span> sd <span class="keyword3"><span class="command">show</span></span>  <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∪</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="free">D</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Resolution.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ass <span class="skolem">D</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> Resolution.Ass <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∉</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> Ass.hyps <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> Ass.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>R <span class="skolem">D</span> <span class="skolem">H</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Resolution.R<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">with</span></span> Resolution_weaken <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-Resolution_taint_assumptions"><span class="command">lemma</span></span> Resolution_taint_assumptions<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∪</span> <span class="free">T</span> <span class="main">⊢</span> <span class="free">C</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound"><span class="bound">R</span></span> <span class="main">⊆</span> <span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="main">(∪)</span> <span class="free">D</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="main">∪</span> <span class="free">T</span> <span class="main">⊢</span> <span class="bound">R</span> <span class="main">∪</span> <span class="free">C</span>"</span></span>
<span class="comment1">(* No, we don't need to show this for an arbitrary clause D, but the proof doesn't get any more readable if you only allow a single atom. *)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∪</span> <span class="free">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Resolution.induct<span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ass <span class="skolem">C</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="free">S</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">∪</span> <span class="skolem">C</span> <span class="main">∈</span> <span class="main">(∪)</span> <span class="free">D</span> <span class="main">`</span> <span class="free">S</span> <span class="main">∪</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> Resolution.Ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(∪)</span> <span class="free">D</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="main">∪</span> <span class="free">T</span> <span class="main">⊢</span> <span class="free">D</span> <span class="main">∪</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> Ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(∪)</span> <span class="free">D</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="main">∪</span> <span class="free">T</span> <span class="main">⊢</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Resolution.Ass<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>R <span class="skolem">C1</span> <span class="skolem">C2</span> <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(∪)</span> <span class="free">D</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="main">∪</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> R <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R1</span></span> <span class="keyword2"><span class="keyword">where</span></span> IH1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R1</span> <span class="main">⊆</span> <span class="free">D</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">⊢</span> <span class="skolem">R1</span> <span class="main">∪</span> <span class="skolem">C1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> R <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R2</span></span> <span class="keyword2"><span class="keyword">where</span></span> IH2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R2</span> <span class="main">⊆</span> <span class="free">D</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">⊢</span> <span class="skolem">R2</span> <span class="main">∪</span> <span class="skolem">C2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> R <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∪</span> <span class="skolem">C1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">¯</span> <span class="main">∈</span> <span class="skolem">R2</span> <span class="main">∪</span> <span class="skolem">C2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">note</span></span> Resolution.R<span class="main">[</span><span class="operator">OF</span> IH1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> IH2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">⊢</span> <span class="main">(</span><span class="skolem">R1</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">R2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main">¯</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">C1</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">C2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main">¯</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_Diff Un_left_commute sup.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">R1</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">R2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main">¯</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">D</span>"</span></span> <span class="comment1">(* hah▹ gotcha. This is the reason that I should be doing this on sets▹ not multisets. - neh, actually, there are others. how is the rule even supposed to look? *)</span>
    <span class="keyword1"><span class="command">using</span></span> IH1<span class="main">(</span>1<span class="main">)</span> IH2<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Resolution is ``strange'':
Given a set of clauses that is presumed to be satisfiable,
it derives new clauses that can be added while preserving the satisfiability of the set of clauses.
However, not every clause that could be added while keeping satisfiability can actually be added by resolution.
Especially, the above lemma <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Resolution_taint_assumptions›</span></span></span></span> gives us the derivability of a clause
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">R</span></span> <span class="main"><span class="main">∪</span></span> <span class="free"><span class="free">C</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, where <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">R</span></span> <span class="main"><span class="main">⊆</span></span> <span class="free"><span class="free">D</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. What we might actually want is the derivability of 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">D</span></span> <span class="main"><span class="main">∪</span></span> <span class="free"><span class="free">C</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. Any model that satisfies <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">R</span></span> <span class="main"><span class="main">∪</span></span> <span class="free"><span class="free">C</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> obviously satisfies <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">D</span></span> <span class="main"><span class="main">∪</span></span> <span class="free"><span class="free">C</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> 
(since they are disjunctions), but Resolution only allows to derive the former.
›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Nevertheless, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Resolution_taint_assumptions›</span></span></span></span>, can still be a quite useful lemma:
picking <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">D</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to be a singleton set only leaves two possibilities for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">R</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Resolution-Resolution_useless_infinite"><span class="command">lemma</span></span> Resolution_useless_infinite<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊢</span> <span class="free">R</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">R</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">S'</span></span> <span class="main">⊆</span> <span class="free">S</span><span class="main">.</span> Ball <span class="bound">S'</span> finite <span class="main">∧</span> finite <span class="bound">S'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">S'</span> <span class="main">⊢</span> <span class="free">R</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Resolution.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ass <span class="skolem">C</span> <span class="skolem">S</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Resolution.Ass <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">C</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>R <span class="skolem">S</span> <span class="skolem">C</span> <span class="skolem">D</span> <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> R.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">C</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">D</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> R.IH <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">SC</span></span> <span class="skolem"><span class="skolem">SD</span></span> <span class="keyword2"><span class="keyword">where</span></span> IH<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="skolem">SC</span><span class="main">⊆</span><span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">C</span><span class="main">∈</span><span class="skolem">SC</span><span class="main">.</span> finite <span class="bound">C</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">SC</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">SC</span> <span class="main">⊢</span> <span class="skolem">C</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">SD</span><span class="main">⊆</span><span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">D</span><span class="main">∈</span><span class="skolem">SD</span><span class="main">.</span> finite <span class="bound">D</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">SD</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">SD</span> <span class="main">⊢</span> <span class="skolem">D</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> IHw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">SC</span> <span class="main">∪</span> <span class="skolem">SD</span> <span class="main">⊢</span> <span class="skolem">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">SC</span> <span class="main">∪</span> <span class="skolem">SD</span> <span class="main">⊢</span> <span class="skolem">D</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Resolution_weaken 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_commute Resolution_weaken <span class="comment1">(* yes, using and simp set. whatever. *)</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> IH<span class="main">(</span>1-3<span class="main">,</span>5-7<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">SC</span> <span class="main">∪</span> <span class="skolem">SD</span>"</span></span><span class="main"><span class="main">]</span></span> Resolution.R<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">∈</span> <span class="skolem">C</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">¯</span> <span class="main">∈</span> <span class="skolem">D</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="comment1">(* situation would be different if we allowed to resolve an infinite amount of literals in one step instead of just one.
   And I think that's exactly the reason why one doesn't do that.
 *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Now we define and verify a toy resolution prover.
Function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>res›</span></span></span></span> computes the set of resolvents of a clause set:›</span></span>
<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">res</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause set <span class="main">⇒</span> <span class="tfree">'a</span> clause set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span>
 <span class="main">(</span><span class="main">⋃</span><span class="bound">C1</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="main">⋃</span><span class="bound">C2</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="main">⋃</span><span class="bound">L1</span> <span class="main">∈</span> <span class="bound">C1</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">L2</span> <span class="main">∈</span> <span class="bound">C2</span><span class="main">.</span>
 <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="bound">L1</span><span class="main">,</span><span class="bound">L2</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span>Pos <span class="bound">i</span><span class="main">,</span>Neg <span class="bound">j</span><span class="main">)</span> <span class="main">⇒</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="bound">j</span> <span class="keyword1">then</span> <span class="main">{</span><span class="main">(</span><span class="bound">C1</span> <span class="main">-</span> <span class="main">{</span>Pos <span class="bound">i</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="bound">C2</span> <span class="main">-</span> <span class="main">{</span>Neg <span class="bound">j</span><span class="main">}</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span>
  <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ex1</span> <span class="main">≡</span> <span class="main">{</span><span class="main">{</span>Neg <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span><span class="main">}</span><span class="main">,</span> <span class="main">{</span>Pos <span class="main">0</span><span class="main">,</span> Pos <span class="main">1</span><span class="main">,</span> Neg <span class="numeral">2</span><span class="main">}</span><span class="main">,</span> <span class="main">{</span>Pos <span class="main">0</span><span class="main">,</span> Pos <span class="main">1</span><span class="main">,</span> Pos <span class="numeral">2</span><span class="main">}</span><span class="main">,</span> <span class="main">{</span>Pos <span class="main">0</span><span class="main">,</span> Neg <span class="main">1</span><span class="main">}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"res ex1"</span></span>
  
<span class="comment1">(* now we want to iterate res. We've got two options. Either use the while combinator,
   which is not so beautiful to present but easy to understand, or use partial_function magic,
  which looks beautiful, but… magic. The ML kind. *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Rwhile</span> <span class="main">::</span><span class="quoted"><span class="quoted">" <span class="tfree">'a</span> clause set <span class="main">⇒</span> <span class="tfree">'a</span> clause set option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Rwhile</span> <span class="main">=</span> while_option <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="main">□</span> <span class="main">∉</span> <span class="bound">S</span> <span class="main">∧</span> <span class="main">¬</span> res <span class="bound">S</span> <span class="main">⊆</span> <span class="bound">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> res <span class="bound">S</span> <span class="main">∪</span> <span class="bound">S</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"Rwhile ex1"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">□</span> <span class="main">∈</span> the <span class="main">(</span>Rwhile ex1<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1" id="Resolution-Rwhile_sound"><span class="command">lemma</span></span> Rwhile_sound<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Rwhile <span class="free">S</span> <span class="main">=</span> Some <span class="free">S'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span> <span class="main">∈</span> <span class="free">S'</span><span class="main">.</span> Resolution <span class="free">S</span> <span class="bound">C</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> while_option_rule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ assms<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Rwhile_def<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ass R res_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits literal.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">all_clauses</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">⊆</span> <span class="main">{</span>Pos <span class="bound">k</span><span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> atoms_of_cnf <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span>Neg <span class="bound">k</span><span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> atoms_of_cnf <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">}</span><span class="main">}</span>"</span></span>
<span class="keyword1" id="Resolution-s_sub_all_clauses"><span class="command">lemma</span></span> s_sub_all_clauses<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> all_clauses <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> all_clauses_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atoms_of_cnf_alt lit_atoms_cases<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> imageI literal.exhaust literal.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> literal.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1" id="Resolution-atoms_res"><span class="command">lemma</span></span> atoms_res<span class="main">:</span> <span class="quoted"><span class="quoted">"atoms_of_cnf <span class="main">(</span>res <span class="free">S</span><span class="main">)</span> <span class="main">⊆</span>  atoms_of_cnf <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> res_def atoms_of_cnf_alt
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lit_atoms_cases <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> literal.splits if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Resolution-exlitE"><span class="command">lemma</span></span> exlitE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">xe</span> <span class="main">=</span> Pos <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">xe</span> <span class="main">=</span> Neg <span class="bound">x</span> <span class="main">⟹</span> False<span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">xe</span> <span class="main">=</span> Pos <span class="bound">x</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xe</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1" id="Resolution-res_in_all_clauses"><span class="command">lemma</span></span> res_in_all_clauses<span class="main">:</span> <span class="quoted"><span class="quoted">"res <span class="free">S</span> <span class="main">⊆</span> all_clauses <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> res_def all_clauses_def atoms_of_cnf_alt lit_atoms_cases
    <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> literal.splits if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> atoms_of_lit.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> atoms_of_lit.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lit_atoms_cases literal.exhaust<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Resolution-Res_in_all_clauses"><span class="command">lemma</span></span> Res_in_all_clauses<span class="main">:</span> <span class="quoted"><span class="quoted">"res <span class="free">S</span> <span class="main">∪</span> <span class="free">S</span> <span class="main">⊆</span> all_clauses <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> res_in_all_clauses s_sub_all_clauses<span class="main">)</span>  
<span class="keyword1" id="Resolution-all_clauses_Res_inv"><span class="command">lemma</span></span> all_clauses_Res_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"all_clauses <span class="main">(</span>res <span class="free">S</span> <span class="main">∪</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> all_clauses <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> all_clauses_def atoms_of_cnf_Un
  <span class="keyword1"><span class="command">using</span></span> atoms_res <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1" id="Resolution-all_clauses_finite"><span class="command">lemma</span></span> all_clauses_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">C</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> finite <span class="bound">C</span><span class="main">)</span> <span class="main">⟹</span> finite <span class="main">(</span>all_clauses <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> all_clauses_def atoms_of_cnf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1" id="Resolution-finite_res"><span class="command">lemma</span></span> finite_res<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> finite <span class="bound">C</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">C</span> <span class="main">∈</span> res <span class="free">S</span><span class="main">.</span> finite <span class="bound">C</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> res_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> literal.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">T</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span> <span class="main">⟹</span> card <span class="free">S</span> <span class="main">&lt;</span> Suc <span class="main">(</span>card <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_mono le_imp_less_Suc<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">C</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> finite <span class="bound">C</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">T</span><span class="main">.</span> Rwhile <span class="free">S</span> <span class="main">=</span> Some <span class="bound">T</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> Rwhile_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> measure_while_option_Some<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">T</span></span><span class="main"><span class="main">.</span></span> Suc <span class="main"><span class="main">(</span></span>card <span class="main"><span class="main">(</span></span>all_clauses <span class="free"><span class="free">S</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">-</span></span> card <span class="bound"><span class="bound">T</span></span>"</span></span></span>
        <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">T</span></span><span class="main"><span class="main">.</span></span> finite <span class="bound"><span class="bound">T</span></span> <span class="main"><span class="main">∧</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">∀</span></span><span class="bound"><span class="bound">C</span></span> <span class="main"><span class="main">∈</span></span> <span class="bound"><span class="bound">T</span></span><span class="main"><span class="main">.</span></span> finite <span class="bound"><span class="bound">C</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">∧</span></span> all_clauses <span class="bound"><span class="bound">T</span></span> <span class="main"><span class="main">=</span></span> all_clauses <span class="free"><span class="free">S</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span><span class="operator">fail</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> all_clauses_finite finite_UnI finite_subset res_in_all_clauses<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_res <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> all_clauses_Res_inv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> diff_less_mono2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Res_in_all_clauses all_clauses_finite card_seteq finite_subset not_le sup_commute sup_ge2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> card_mono le_imp_less_Suc<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> all_clauses_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> s_sub_all_clauses <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">partial_function</span></span><span class="main">(</span>option<span class="main">)</span> <span class="entity">Res</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Res</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">R</span> <span class="main">=</span> res <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">R</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1">then</span> Some <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1">else</span> <span class="free">Res</span> <span class="bound">R</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">declare</span></span> Res.simps<span class="main">[</span><span class="operator">code</span><span class="main">]</span>

<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"Res ex1"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">□</span> <span class="main">∈</span> the <span class="main">(</span>Res ex1<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">code_simp</span>

<span class="keyword1" id="Resolution-res"><span class="command">lemma</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">∈</span> res <span class="free">S</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">⊢</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> res_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> literal.splits if_splits<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> Resolution.simps literal.exhaust<span class="main">)</span>    

<span class="keyword1" id="Resolution-Res_sound"><span class="command">lemma</span></span> Res_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"Res <span class="free">S</span> <span class="main">=</span> Some <span class="free">S'</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">C</span> <span class="main">∈</span> <span class="free">S'</span><span class="main">.</span> <span class="free">S</span> <span class="main">⊢</span> <span class="bound">C</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">S'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Res.fixp_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">S</span> <span class="skolem">S'</span>
  <span class="keyword3"><span class="command">assume</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">S</span> <span class="bound">S'</span><span class="main">.</span> <span class="skolem">X</span> <span class="bound">S</span> <span class="main">=</span> Some <span class="bound">S'</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">C</span><span class="main">∈</span><span class="bound">S'</span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊢</span> <span class="bound">C</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> prem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">let</span> <span class="bound">R</span> <span class="main">=</span> res <span class="skolem">S</span> <span class="main">∪</span> <span class="skolem">S</span> <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">R</span> <span class="main">=</span> <span class="skolem">S</span> <span class="keyword1">then</span> Some <span class="skolem">S</span> <span class="keyword1">else</span> <span class="skolem">X</span> <span class="bound">R</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">S'</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">C</span><span class="main">∈</span><span class="skolem">S'</span><span class="main">.</span> <span class="skolem">S</span> <span class="main">⊢</span> <span class="bound">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"res <span class="skolem">S</span> <span class="main">∪</span> <span class="skolem">S</span> <span class="main">=</span> <span class="skolem">S</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> prem <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Resolution.Ass<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"res <span class="skolem">S</span> <span class="main">∪</span> <span class="skolem">S</span> <span class="main">≠</span> <span class="skolem">S</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> prem <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">(</span>res <span class="skolem">S</span> <span class="main">∪</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">S'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span><span class="main">∈</span><span class="skolem">S'</span><span class="main">.</span> res <span class="skolem">S</span> <span class="main">∪</span> <span class="skolem">S</span> <span class="main">⊢</span> <span class="bound">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Resolution_unnecessary res <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="comment1">(* this needs the generalized Resolution_unnecessary lemma. And I don't get why the option-variant didn't. *)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> option_admissible<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Resolution-Res_terminates"><span class="command">lemma</span></span> Res_terminates<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">C</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> finite <span class="bound">C</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">T</span><span class="main">.</span> Res <span class="free">S</span> <span class="main">=</span> Some <span class="bound">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>all_clauses <span class="free">S</span><span class="main">)</span> <span class="main">-</span> card <span class="free">S</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span> <span class="comment1">(* can be done by induction on "card (all_clauses S - S)", but I found that to be more annoying. *)</span>
  <span class="keyword3"><span class="command">case</span></span> less
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"res <span class="skolem">S</span> <span class="main">∪</span> <span class="skolem">S</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> <span class="skolem">S</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>res <span class="skolem">S</span> <span class="main">∪</span> <span class="skolem">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> less Res_in_all_clauses all_clauses_finite infinite_super<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>res <span class="skolem">S</span> <span class="main">∪</span> <span class="skolem">S</span><span class="main">)</span> finite"</span></span> <span class="keyword1"><span class="command">using</span></span> less.prems<span class="main">(</span>2<span class="main">)</span> finite_res <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">S</span> <span class="main">&lt;</span> card <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False b psubsetI psubset_card_mono sup_ge2<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?r</span> <span class="main">≤</span> <span class="main">(</span>card <span class="main">(</span>all_clauses <span class="skolem">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> less Res_in_all_clauses all_clauses_finite card_mono le_imp_less_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>card <span class="main">(</span>all_clauses <span class="var">?r</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> card <span class="var">?r</span> <span class="main">&lt;</span> <span class="main">(</span>card <span class="main">(</span>all_clauses <span class="skolem">S</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> card <span class="skolem">S</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> all_clauses_Res_inv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> a b c<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Res.simps<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Res.simps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="comment1">(* just to demonstrate, this would not work: *)</span>
<span class="keyword1"><span class="command">code_pred</span></span> <span class="comment1">(*(modes: i ⇒ i ⇒ bool)*)</span> <span class="quoted"><span class="quoted">Resolution</span></span> <span class="keyword1"><span class="command">.</span></span> <span class="comment1">(* can't infer any modes. *)</span>
<span class="keyword1"><span class="command">print_theorems</span></span> <span class="comment1">(* doesn't generate any theorems either. *)</span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Resolution_Sound">
<div class="head">
<h1>Theory Resolution_Sound</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Resolution_Sound
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Resolution.html">Resolution</a> <a href="CNF_Formulas_Sema.html">CNF_Formulas_Sema</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* there is one theory where we show Resolution completeness entirely without the relation to 
normal formulas. We haven't done the same for soundness, because we do not want too many theory files. *)</span>

<span class="keyword1" id="Resolution_Sound-Resolution_insert"><span class="command">lemma</span></span> Resolution_insert<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊢</span> <span class="free">R</span> <span class="main">⟹</span> cnf_semantics <span class="free">𝒜</span> <span class="free">S</span> <span class="main">⟹</span> cnf_semantics <span class="free">𝒜</span> <span class="main">{</span><span class="free">R</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span>  <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Resolution.induct<span class="main"><span class="keyword3">;</span></span>
   <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cnf_semantics_def clause_semantics_def lit_semantics_cases <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> literal.splits<span class="main"><span class="keyword3">;</span></span>
   <span class="operator">blast</span><span class="main">)</span>

<span class="comment1">(* Schöning's resolution lemma. We don't use it. *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊢</span> <span class="free">R</span> <span class="main">⟹</span> cnf_semantics <span class="free">𝒜</span> <span class="free">S</span> <span class="main">⟷</span> cnf_semantics <span class="free">𝒜</span> <span class="main">(</span><span class="free">R</span> <span class="main">▹</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Resolution_insert cnf_semantics_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_iff<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> Resolution_cnf_sound<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> cnf_semantics <span class="free">𝒜</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"cnf_semantics <span class="free">𝒜</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> Resolution_insert assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cnf_semantics <span class="free">𝒜</span> <span class="main">{</span><span class="main">□</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cnf_semantics_def clause_semantics_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Resolution_sound<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> rp<span class="main">:</span> <span class="quoted"><span class="quoted">"cnf <span class="main">(</span>nnf <span class="free">F</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">𝒜</span> <span class="main">⊨</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> Resolution_cnf_sound rp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> cnf_semantics <span class="free">𝒜</span> <span class="main">(</span>cnf <span class="main">(</span>nnf <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">𝒜</span> <span class="main">⊨</span> nnf <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cnf_semantics<span class="main">[</span><span class="operator">OF</span> is_nnf_nnf<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> nnf_semantics <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Resolution_Compl">
<div class="head">
<h1>Theory Resolution_Compl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Completeness›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Resolution_Compl
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Resolution.html">Resolution</a> <a href="CNF_Sema.html">CNF_Sema</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Completeness proof following Schöning~\cite{schoening1987logik}.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">make_lit</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">of</span> True <span class="main">⇒</span> Pos <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">|</span> False <span class="main">⇒</span> Neg <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">restrict_cnf_atom</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">c</span> <span class="main">-</span> <span class="main">{</span>make_lit <span class="main">(</span><span class="main">¬</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">}</span> <span class="main">|</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∧</span> make_lit <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∉</span> <span class="bound">c</span><span class="main">}</span>"</span></span>


<span class="keyword1" id="Resolution_Compl-restrict_cnf_remove"><span class="command">lemma</span></span> restrict_cnf_remove<span class="main">:</span> <span class="quoted"><span class="quoted">"atoms_of_cnf <span class="main">(</span>restrict_cnf_atom <span class="free">a</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">⊆</span>
  atoms_of_cnf <span class="free">c</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span>  restrict_cnf_atom_def atoms_of_cnf_alt lit_atoms_cases make_lit_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> literal.splits bool.splits<span class="main">)</span>

<span class="keyword1" id="Resolution_Compl-cnf_substitution_lemma"><span class="command">lemma</span></span> cnf_substitution_lemma<span class="main">:</span>
  <span class="quoted"><span class="quoted">"cnf_semantics <span class="free">A</span> <span class="main">(</span>restrict_cnf_atom <span class="free">a</span> <span class="free">v</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> cnf_semantics <span class="main">(</span><span class="free">A</span><span class="main">(</span><span class="free">a</span> <span class="main">:=</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> restrict_cnf_atom_def cnf_semantics_def clause_semantics_def lit_semantics_cases make_lit_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> bool.splits literal.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> allE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">-</span> <span class="main">{</span>Neg <span class="free">a</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffI singletonD<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> allE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">-</span> <span class="main">{</span>Pos <span class="free">a</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffI singletonD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Resolution_Compl-finite_restrict"><span class="command">lemma</span></span> finite_restrict<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span> <span class="main">⟹</span> finite <span class="main">(</span>restrict_cnf_atom <span class="free">a</span> <span class="free">v</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> restrict_cnf_atom_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The next lemma describes what we have to (or can) do to a CNF after it has been mangled by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> restrict_cnf_atom<span class="antiquote"><span class="antiquote">}</span></span></span></span> to get back to
(a subset of) the original CNF.
The idea behind this will be clearer upon usage.›</span></span>
<span class="keyword1" id="Resolution_Compl-unrestrict_effects"><span class="command">lemma</span></span> unrestrict_effects<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">{</span>make_lit <span class="main">(</span><span class="main">¬</span><span class="free">v</span><span class="main">)</span> <span class="free">a</span><span class="main">}</span> <span class="main">∪</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">S</span> <span class="keyword1">then</span> <span class="main">{</span>make_lit <span class="main">(</span><span class="main">¬</span><span class="free">v</span><span class="main">)</span> <span class="free">a</span><span class="main">}</span> <span class="main">∪</span> <span class="bound">c</span> <span class="keyword1">else</span> <span class="bound">c</span><span class="main">)</span> <span class="main">`</span> restrict_cnf_atom <span class="free">a</span> <span class="free">v</span> <span class="free">S</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">xa</span> <span class="main">∈</span> restrict_cnf_atom <span class="free">a</span> <span class="free">v</span> <span class="free">S</span><span class="main">;</span> <span class="main">{</span>make_lit <span class="main">(</span><span class="main">¬</span> <span class="free">v</span><span class="main">)</span> <span class="free">a</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">xa</span> <span class="main">∉</span> <span class="free">S</span><span class="main">;</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">xa</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">xa</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">xa</span>
    <span class="keyword1"><span class="command">unfolding</span></span> restrict_cnf_atom_def <span class="keyword1"><span class="command">using</span></span> insert_Diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">{</span>make_lit <span class="main">(</span><span class="main">¬</span> <span class="free">v</span><span class="main">)</span> <span class="free">a</span><span class="main">}</span> <span class="main">∪</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">S</span> <span class="keyword1">then</span> <span class="main">{</span>make_lit <span class="main">(</span><span class="main">¬</span> <span class="free">v</span><span class="main">)</span> <span class="free">a</span><span class="main">}</span> <span class="main">∪</span> <span class="bound">c</span> <span class="keyword1">else</span> <span class="bound">c</span><span class="main">)</span> <span class="main">`</span> restrict_cnf_atom <span class="free">a</span> <span class="free">v</span> <span class="free">S</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">unfolding</span></span> image_iff <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">elim</span> bexE<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution_Compl-can_cope_with_unrestrict_effects"><span class="command">lemma</span></span> can_cope_with_unrestrict_effects<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> su<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">R</span></span> <span class="main">⊆</span> <span class="main">{</span>make_lit <span class="free">v</span> <span class="free">a</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">{</span>make_lit <span class="free">v</span> <span class="free">a</span><span class="main">}</span> <span class="main">∪</span> <span class="bound">c</span> <span class="keyword1">else</span> <span class="bound">c</span><span class="main">)</span> <span class="main">`</span> <span class="free">T</span> <span class="main">⊢</span> <span class="bound">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> Resolution_taint_assumptions<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> D<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span>make_lit <span class="free">v</span> <span class="free">a</span><span class="main">}</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> taint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">∪</span> <span class="skolem">Λ</span> <span class="main">⊢</span> <span class="main">□</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound"><span class="bound">R</span></span><span class="main">⊆</span><span class="main">{</span>make_lit <span class="free">v</span> <span class="free">a</span><span class="main">}</span><span class="main">.</span> insert <span class="main">(</span>make_lit <span class="free">v</span> <span class="free">a</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">Γ</span> <span class="main">∪</span> <span class="skolem">Λ</span> <span class="main">⊢</span> <span class="bound">R</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span> <span class="skolem">Λ</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_cong insert_def sup_bot.right_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">c</span></span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound"><span class="bound">c</span></span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∉</span> <span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> SI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">{</span>make_lit <span class="free">v</span> <span class="free">a</span><span class="main">}</span> <span class="main">∪</span> <span class="bound">c</span> <span class="keyword1">else</span> <span class="bound">c</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span> <span class="main">=</span>
    <span class="main">(</span>insert <span class="main">(</span>make_lit <span class="free">v</span> <span class="free">a</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">c</span></span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="bound"><span class="bound">c</span></span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∉</span> <span class="free">n</span><span class="main">}</span>
  "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> pr <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">R</span></span> <span class="main">⊆</span> <span class="main">{</span>make_lit <span class="free">v</span> <span class="free">a</span><span class="main">}</span><span class="main">.</span>
  <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">{</span>make_lit <span class="free">v</span> <span class="free">a</span><span class="main">}</span> <span class="main">∪</span> <span class="bound">c</span> <span class="keyword1">else</span> <span class="bound">c</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span> <span class="main">⊢</span> <span class="bound">R</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> SI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> S<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> taint<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Resolution_weaken su <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> image_Un sup.order_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution_Compl-unrestrict'"><span class="command">lemma</span></span> unrestrict'<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">R</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rp<span class="main">:</span> <span class="quoted"><span class="quoted">"restrict_cnf_atom <span class="free">a</span> <span class="free">v</span> <span class="free">S</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">R</span></span> <span class="main">⊆</span> <span class="main">{</span>make_lit <span class="main">(</span><span class="main">¬</span><span class="free">v</span><span class="main">)</span> <span class="free">a</span><span class="main">}</span><span class="main">.</span> <span class="free">S</span> <span class="main">⊢</span> <span class="bound">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword1"><span class="command">from</span></span> unrestrict_effects<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The idea is that the restricted set lost some clauses, and that some others were crippled.
    So, there must be a set of clauses to heal and a set of clauses to reinsert to get the original.
    (Mind you, this is not exactly what is happening, because e.g. both
   <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">C</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="skolem"><span class="skolem">k</span></span><span class="main"><span class="main">¯</span></span><span class="main"><span class="main">}</span></span> <span class="main"><span class="main">∪</span></span> <span class="skolem"><span class="skolem">C</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> might be in there and get reduced to one <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">C</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
    You then heal that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">C</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="skolem"><span class="skolem">k</span></span><span class="main"><span class="main">¯</span></span><span class="main"><span class="main">}</span></span> <span class="main"><span class="main">∪</span></span> <span class="skolem"><span class="skolem">C</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and insert the shadowed <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">C</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span><span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>…›</span></span></span></span> Details.)
 ›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> S<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">c</span> <span class="main">∈</span> <span class="skolem">n</span> <span class="keyword1">then</span> <span class="main">{</span>make_lit <span class="main">(</span><span class="main">¬</span> <span class="free">v</span><span class="main">)</span> <span class="free">a</span><span class="main">}</span> <span class="main">∪</span> <span class="bound">c</span> <span class="keyword1">else</span> <span class="bound">c</span><span class="main">)</span> <span class="main">`</span> restrict_cnf_atom <span class="free">a</span> <span class="free">v</span> <span class="free">S</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> exI<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">c</span><span class="main">.</span> <span class="main">{</span>make_lit <span class="main">(</span><span class="main">¬</span><span class="free">v</span><span class="main">)</span> <span class="free">a</span><span class="main">}</span> <span class="main">∪</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">S</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">note</span></span>  finite_restrict S
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> can_cope_with_unrestrict_effects<span class="main">[</span><span class="operator">OF</span> rp<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> S Resolution_weaken subset_refl sup.order_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution_Compl-Resolution_complete_standalone_finite"><span class="command">lemma</span></span> Resolution_complete_standalone_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">𝒜</span><span class="main">.</span> <span class="main">¬</span>cnf_semantics <span class="bound">𝒜</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>atoms_of_cnf <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> fin ns
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"atoms_of_cnf <span class="free">S</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_psubset_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> psubset
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"atoms_of_cnf <span class="skolem">S</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">𝒜</span><span class="main">.</span> <span class="main">¬</span> cnf_semantics <span class="bound">𝒜</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cnf_semantics_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> e <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">{</span><span class="main">□</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> atoms_of_cnf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">fast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Resolution.Ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> unsat_restrict<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">𝒜</span><span class="main">.</span> <span class="main">¬</span> cnf_semantics <span class="bound">𝒜</span> <span class="main">(</span>restrict_cnf_atom <span class="skolem">a</span> <span class="skolem">v</span> <span class="skolem">S</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">v</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">𝒜</span><span class="main">.</span> <span class="main">¬</span> cnf_semantics <span class="bound">𝒜</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cnf_substitution_lemma<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"atoms_of_cnf <span class="skolem">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> atoms_of_cnf <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"atoms_of_cnf <span class="main">(</span>restrict_cnf_atom <span class="skolem">a</span> <span class="skolem">v</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">⊂</span> atoms_of_cnf <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span>
      <span class="keyword1"><span class="command">using</span></span> restrict_cnf_remove<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> psubset<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this unsat_restrict<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"restrict_cnf_atom <span class="skolem">a</span> <span class="skolem">v</span> <span class="skolem">S</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> unrestrict'<span class="main">[</span><span class="operator">OF</span> IH<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">_</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> unr_IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">R</span></span><span class="main">⊆</span><span class="main">{</span>make_lit <span class="skolem">v</span> <span class="skolem">a</span><span class="main">}</span><span class="main">.</span> <span class="skolem">S</span> <span class="main">⊢</span> <span class="bound">R</span>"</span></span>
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="comment1">(* unbelievable, how much worry finding that "¬ _" cost… otherwise, you get weird sledgehammer results. *)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted">False</span><span class="main">]</span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted">True</span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Resolution.R<span class="main">[</span><span class="operator">OF</span> _ _ singletonI singletonI<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> make_lit_def<span class="main">)</span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> subset_singletonD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹What you might actually want is  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">∀</span></span><span class="bound"><span class="bound">𝒜</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">¬</span></span>cnf_semantics <span class="bound"><span class="bound">𝒜</span></span> <span class="free"><span class="free">S</span></span> <span class="main"><span class="main">⟹</span></span> <span class="free"><span class="free">S</span></span> <span class="main"><span class="main">⊢</span></span> <span class="main"><span class="main">□</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  Unfortunately, applying compactness (to get a finite set with a finite number of atoms) here is problematic:
  You would need to convert all clauses to disjunction-formulas, but there might be clauses with an infinite number of atoms. 
  Removing those has to be done before applying compactness, we would possibly have to remove an infinite number of infinite clauses.
  Since the notion of a formula with an infinite number of atoms is not exactly standard, it is probably better to just skip this.
 ›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Resolution_Compl_Consistency">
<div class="head">
<h1>Theory Resolution_Compl_Consistency</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Resolution_Compl_Consistency
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Resolution.html">Resolution</a> <a href="Consistency.html">Consistency</a> <a href="CNF_Formulas.html">CNF_Formulas</a> <a href="CNF_Formulas_Sema.html">CNF_Formulas_Sema</a>
<span class="keyword2"><span class="keyword">begin</span></span>
 
<span class="keyword1" id="Resolution_Compl_Consistency-OrI2'"><span class="command">lemma</span></span> OrI2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span><span class="free">P</span> <span class="main">⟹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Resolution_Compl_Consistency-atomD"><span class="command">lemma</span></span> atomD<span class="main">:</span> <span class="quoted"><span class="quoted">"Atom <span class="free">k</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">{</span>Pos <span class="free">k</span><span class="main">}</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">(</span>cnf <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Not <span class="main">(</span>Atom <span class="free">k</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">{</span>Neg <span class="free">k</span><span class="main">}</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">(</span>cnf <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
      
<span class="keyword1" id="Resolution_Compl_Consistency-pcp_disj"><span class="command">lemma</span></span> pcp_disj<span class="main">:</span> <span class="comment1">(* this is the same as for LSC ⇒ Res. but I don't want to make the proof of that too, so I'm keeping my code duplication *)</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">G</span> <span class="main">∈</span> <span class="free">Γ</span><span class="main">;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">xa</span><span class="main">.</span> <span class="main">(</span><span class="bound">xa</span> <span class="main">=</span> <span class="free">F</span> <span class="main">∨</span> <span class="bound">xa</span> <span class="main">∈</span> <span class="free">Γ</span><span class="main">)</span> <span class="main">⟶</span> is_cnf <span class="bound">xa</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>cnf <span class="free">F</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">Γ</span><span class="main">.</span> cnf <span class="bound">x</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">xa</span><span class="main">.</span> <span class="main">(</span><span class="bound">xa</span> <span class="main">=</span> <span class="free">G</span> <span class="main">∨</span> <span class="bound">xa</span> <span class="main">∈</span> <span class="free">Γ</span><span class="main">)</span> <span class="main">⟶</span> is_cnf <span class="bound">xa</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>cnf <span class="free">G</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">Γ</span><span class="main">.</span> cnf <span class="bound">x</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span><span class="main">)</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">Γ</span><span class="main">.</span> is_cnf <span class="bound">x</span><span class="main">⟧</span>
    <span class="main">⟹</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">Γ</span><span class="main">.</span> cnf <span class="bound">x</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_cnf <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> db<span class="main">:</span> <span class="quoted"><span class="quoted">"is_disj <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"is_lit_plus <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"is_disj <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_cnf <span class="free">F</span> <span class="main">∧</span> is_cnf <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">G</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="main">(</span>cnf <span class="main">`</span> <span class="main">(</span><span class="free">F</span> <span class="main">▹</span> <span class="free">Γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="main">(</span>cnf <span class="main">`</span> <span class="main">(</span><span class="free">G</span> <span class="main">▹</span> <span class="free">Γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Γ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="main">(</span>cnf <span class="main">`</span> <span class="free">Γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> IH <span class="keyword1"><span class="command">have</span></span> IH_readable<span class="main">:</span> <span class="quoted"><span class="quoted">"cnf <span class="free">F</span> <span class="main">∪</span> <span class="var">?Γ</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span> <span class="quoted"><span class="quoted">"cnf <span class="free">G</span> <span class="main">∪</span> <span class="var">?Γ</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"cnf <span class="free">F</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> cnf <span class="free">G</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cnf <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> ST<span class="main">:</span> <span class="quoted"><span class="quoted">"cnf <span class="free">F</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">S</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"cnf <span class="free">G</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">T</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cnf_disj_ex db<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="comment1">(* try applying meson here. It's weird. and sledgehammer even suggests it. *)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="comment1">(* hint: card S ≤ 1 *)</span>
    <span class="keyword1"><span class="command">hence</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"cnf <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="skolem">T</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">S</span><span class="main">▹</span><span class="var">?Γ</span> <span class="main">⊢</span> <span class="main">□</span><span class="main">;</span> <span class="skolem">T</span><span class="main">▹</span><span class="var">?Γ</span> <span class="main">⊢</span> <span class="main">□</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="skolem">T</span><span class="main">▹</span> <span class="var">?Γ</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">▹</span><span class="var">?Γ</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span><span class="main">▹</span><span class="var">?Γ</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> s_w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="skolem">T</span> <span class="main">▹</span> <span class="var">?Γ</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Resolution_weaken <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_commute insert_is_Un<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> Resolution_taint_assumptions<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">T</span><span class="main">}</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?Γ</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">□</span>"</span></span> <span class="quoted"><span class="skolem">S</span></span><span class="main">]</span> t
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∪</span> <span class="skolem">T</span> <span class="main">▹</span> <span class="var">?Γ</span> <span class="main">⊢</span> <span class="skolem">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span><span class="main">⊆</span><span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Un_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> literal_subset_sandwich<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">□</span> <span class="main">∨</span> <span class="skolem">R</span> <span class="main">=</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"is_lit_plus <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"cnf <span class="free">F</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">S</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">⊆</span> <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> is_lit_plus.cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> literal_subset_sandwich<span class="main">[</span><span class="operator">OF</span> db<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ST<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> R<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">□</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> R<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> Resolution_unnecessary<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">_</span><span class="main">}</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> R<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">R</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="skolem">T</span> <span class="main">▹</span> <span class="var">?Γ</span> <span class="main">⊢</span> <span class="main">□</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">S</span> <span class="main">∪</span> <span class="skolem">T</span> <span class="main">▹</span> <span class="var">?Γ</span> <span class="main">⊢</span> <span class="main">□</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="skolem">S</span>"</span></span> 
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> s_w <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> IH ST R 1<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UN_insert insert_absorb insert_is_Un<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution_Compl_Consistency-R_consistent"><span class="command">lemma</span></span> R_consistent<span class="main">:</span> <span class="quoted"><span class="quoted">"pcp <span class="main">{</span><span class="bound">Γ</span><span class="main">|</span><span class="bound">Γ</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">γ</span> <span class="main">∈</span> <span class="bound">Γ</span><span class="main">.</span> is_cnf <span class="bound">γ</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="main">(</span>cnf <span class="main">`</span> <span class="bound">Γ</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> pcp_def
  <span class="keyword1"><span class="command">unfolding</span></span> Ball_def
  <span class="keyword1"><span class="command">unfolding</span></span> mem_Collect_eq
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> contrapos_pp<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> not_ex de_Morgan_conj de_Morgan_disj not_not not_all not_imp disj_not1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> impI allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> disjE exE conjE<span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> OrI2'<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> not_ex de_Morgan_conj de_Morgan_disj not_not not_all not_imp disj_not1 Ball_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Ass Pow_bottom Pow_empty UN_I cnf.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Diff_insert_absorb Resolution.simps insert_absorb singletonI sup_bot.right_neutral atomD<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> UN_insert cnf.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> insert_absorb is_cnf.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sup_assoc<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> pcp_disj<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">theorem</span></span> Resolution_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> countable formula"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="free">F</span> <span class="main">⟹</span> cnf <span class="main">(</span>nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> contrapos_pp<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>cnf <span class="main">(</span>nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>cnf_form_of <span class="main">(</span>nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">Γ</span> <span class="main">|</span><span class="bound">Γ</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">γ</span><span class="main">∈</span><span class="bound">Γ</span><span class="main">.</span> is_cnf <span class="bound">γ</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">⋃</span> <span class="main">(</span>cnf <span class="main">`</span> <span class="bound">Γ</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cnf_cnf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> is_nnf_nnf<span class="main"><span class="main">]</span></span> c cnf_form_of_is<span class="main"><span class="main">[</span></span><span class="operator">OF</span> is_nnf_nnf<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> pcp_sat<span class="main">[</span><span class="operator">OF</span> R_consistent this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sat <span class="main">{</span>cnf_form_of <span class="main">(</span>nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">⊨</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sat_def cnf_form_semantics<span class="main"><span class="main">[</span></span><span class="operator">OF</span> is_nnf_nnf<span class="main"><span class="main">]</span></span> nnf_semantics<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

    
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="HCSC">
<div class="head">
<h1>Theory HCSC</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Proof Transformation›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This is organized as a ring closure›</span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹HC to SC›</span></span>
<span class="keyword1"><span class="command">theory</span></span> HCSC
<span class="keyword2"><span class="keyword">imports</span></span> <a href="HC.html">HC</a> <a href="SC_Cut.html">SC_Cut</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="HCSC-extended_AxE"><span class="command">lemma</span></span> extended_AxE<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span> <span class="free">Δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> extended_Ax<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute inter_add_right2<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> HCSC<span class="main">:</span> <span class="quoted"><span class="quoted">"AX10 <span class="main">∪</span> set_mset <span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="main">{#</span><span class="free">F</span><span class="main">#}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> HC.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ax <span class="skolem">F</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">note</span></span> SCp.intros<span class="main">(</span>3-<span class="main">)</span><span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Essentially, we need to prove all the axioms of Hibert Calculus in Sequent Calculus.›</span></span>
    <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="main">{#</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span><span class="main">)</span><span class="main">#}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="main">{#</span><span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span><span class="main">)</span><span class="main">#}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">G</span> <span class="skolem">F</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="main">{#</span><span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">H</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main">(</span><span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">H</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">H</span><span class="main">)</span><span class="main">)</span><span class="main">#}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">H</span> <span class="skolem">G</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="main">{#</span><span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">F</span><span class="main">#}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="main">{#</span><span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">#}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="main">{#</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span><span class="main">#}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="main">{#</span><span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">F</span><span class="main">#}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="main">{#</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span><span class="main">#}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="main">{#</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">F</span><span class="main">#}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="main">{#</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">F</span><span class="main">)</span><span class="main">#}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="main">{#</span><span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">H</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">H</span><span class="main">)</span><span class="main">)</span><span class="main">#}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> AX0 <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="main">{#</span><span class="skolem">F</span><span class="main">#}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> AX0.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> K L<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> AX10"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> AX10.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> A B C D E F G H I J<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> set_mset <span class="free">Γ</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> extended_Ax<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>MP <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> MP <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="main">{#</span><span class="skolem">F</span><span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="main">{#</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> ImpR_inv<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Δ<span class="main"><span class="main">=</span></span><span class="quoted">Mempty</span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span><span class="free">Γ</span> <span class="main">⇒</span> <span class="main">{#</span><span class="skolem">G</span><span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> IH<span class="main">(</span>1<span class="main">)</span> weakenR <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="main">{#</span><span class="skolem">G</span><span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="main">{#</span><span class="skolem">G</span><span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cut<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> F<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">F</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SCND">
<div class="head">
<h1>Theory SCND</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹SC to ND›</span></span>
<span class="keyword1"><span class="command">theory</span></span> SCND
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SC.html">SC</a> <a href="ND.html">ND</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="SCND-SCND"><span class="command">lemma</span></span> SCND<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟹</span> <span class="main">(</span>set_mset <span class="free">Γ</span><span class="main">)</span> <span class="main">∪</span> Not <span class="main">`</span> <span class="main">(</span>set_mset <span class="free">Δ</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">⊥</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> BotL <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ND.Ax<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Ax <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ND.Ax NotE UnCI image_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NotL <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NotI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotR <span class="skolem">F</span> <span class="skolem">Γ</span> <span class="skolem">Δ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Not2IE<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndL <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">Γ</span> <span class="skolem">Δ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AndL_sim<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndR <span class="skolem">Γ</span> <span class="skolem">F</span> <span class="skolem">Δ</span> <span class="skolem">G</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AndR_sim<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> OrL <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> OrL_sim<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> OrR <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> OrR_sim<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpL <span class="skolem">Γ</span> <span class="skolem">F</span> <span class="skolem">Δ</span> <span class="skolem">G</span><span class="main">)</span> <span class="keyword1"><span class="command">from</span></span> ImpL.IH <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ImpL_sim<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> ImpR <span class="keyword1"><span class="command">from</span></span> ImpR.IH <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ImpR_sim<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="NDHC">
<div class="head">
<h1>Theory NDHC</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ND to HC›</span></span>
<span class="keyword1"><span class="command">theory</span></span> NDHC
<span class="keyword2"><span class="keyword">imports</span></span> <a href="ND.html">ND</a> <a href="HC.html">HC</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The fundamental difference between the two is that Natural Deduction updates its set of assumptions while Hilbert Calculus does not.
The Deduction Theorem <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Deduction_theorem<span class="antiquote"><span class="antiquote">}</span></span></span></span> helps with this.›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> NDHC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">F</span> <span class="main">⟹</span> AX10 <span class="main">∪</span> <span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ND.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Ax <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> HC.Ax<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NotE <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> AX10.intros<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> HC.simps subsetCE sup_ge1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotI  <span class="skolem">F</span> <span class="skolem">Γ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> HC_intros<span class="main">(</span>11<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> HC_NotI<span class="main">:</span> <span class="quoted"><span class="quoted">"AX10 <span class="main">∪</span> <span class="skolem">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="skolem">A</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span> <span class="main">⟹</span> AX10 <span class="main">∪</span> <span class="skolem">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span> 
    <span class="keyword1"><span class="command">using</span></span> MP HC_mono <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_ge1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> NotI <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Deduction_theorem<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Γ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"AX10 <span class="main">∪</span> <span class="skolem">Γ</span>"</span></span><span class="main">]</span> HC_NotI <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AX100 Un_assoc Un_insert_right<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>CC <span class="skolem">F</span> <span class="skolem">Γ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"AX10 <span class="main">∪</span> <span class="skolem">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Deduction_theorem<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Γ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"AX10 <span class="main">∪</span> <span class="skolem">Γ</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AX100 Un_assoc Un_insert_right<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"AX10 <span class="main">∪</span> <span class="skolem">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> AX10.intros<span class="main">(</span>10<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HC.simps UnCI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndE1 <span class="skolem">Γ</span> <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> AX10.intros<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> HC.simps UnCI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndE2 <span class="skolem">Γ</span> <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> AX10.intros<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> HC.simps UnCI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndI <span class="skolem">Γ</span> <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> HC_intros<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> HC_mono HC.simps sup_ge1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrE <span class="skolem">Γ</span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹AX10 <span class="main">∪</span> <span class="main">(</span><span class="skolem">F</span> <span class="main">▹</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="skolem">H</span>›</span></span> <span class="quoted"><span class="quoted">‹AX10 <span class="main">∪</span> <span class="main">(</span><span class="skolem">G</span> <span class="main">▹</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="skolem">H</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
       <span class="quoted"><span class="quoted">"AX10 <span class="main">∪</span> <span class="skolem">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">H</span>"</span></span> <span class="quoted"><span class="quoted">"AX10 <span class="main">∪</span> <span class="skolem">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Deduction_theorem<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Γ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"AX10 <span class="main">∪</span> <span class="skolem">Γ</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AX100 Un_assoc Un_insert_right<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> HC_intros<span class="main">(</span>7<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> HC_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ sup_ge1<span class="main"><span class="main">]</span></span><span class="main">]</span> MP
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"AX10 <span class="main">∪</span> <span class="skolem">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span>  <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">with</span></span> MP <span class="quoted"><span class="quoted">‹AX10 <span class="main">∪</span> <span class="skolem">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrI1 <span class="skolem">Γ</span> <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> AX10.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> HC.simps UnCI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrI2 <span class="skolem">Γ</span> <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> AX10.intros<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> HC.simps UnCI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpE <span class="skolem">Γ</span> <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> MP  <span class="quoted"><span class="quoted">‹AX10 <span class="main">∪</span> <span class="skolem">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="skolem">F</span>›</span></span>  <span class="quoted"><span class="quoted">‹AX10 <span class="main">∪</span> <span class="skolem">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpI <span class="skolem">F</span> <span class="skolem">Γ</span> <span class="skolem">G</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Deduction_theorem<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Γ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"AX10 <span class="main">∪</span> <span class="skolem">Γ</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AX100 Un_assoc Un_insert_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="HCSCND">
<div class="head">
<h1>Theory HCSCND</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹HC, SC, and ND›</span></span>
<span class="keyword1"><span class="command">theory</span></span> HCSCND
<span class="keyword2"><span class="keyword">imports</span></span> <a href="HCSC.html">HCSC</a> <a href="SCND.html">SCND</a> <a href="NDHC.html">NDHC</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">theorem</span></span> HCSCND<span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">hc</span> <span class="free">F</span> <span class="main">≡</span> AX10 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">nd</span> <span class="free">F</span> <span class="main">≡</span> <span class="main">{}</span> <span class="main">⊢</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">sc</span> <span class="free">F</span> <span class="main">≡</span> <span class="main">{#}</span> <span class="main">⇒</span> <span class="main">{#</span> <span class="free">F</span> <span class="main">#}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">hc</span> <span class="free">F</span> <span class="main">⟷</span> <span class="free">nd</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">nd</span> <span class="free">F</span> <span class="main">⟷</span> <span class="free">sc</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">sc</span> <span class="free">F</span> <span class="main">⟷</span> <span class="free">hc</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> HCSC<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> F<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">F</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Γ<span class="main"><span class="main">=</span></span><span class="quoted">Mempty</span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
      SCND<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Γ<span class="main"><span class="main">=</span></span><span class="quoted">Mempty</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Δ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{#</span><span class="free">F</span><span class="main">#}</span>"</span></span><span class="main">]</span> ND.ND.CC<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> F<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">F</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Γ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span><span class="main">]</span>
      NDHC<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Γ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> F<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">F</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="LSC">
<div class="head">
<h1>Theory LSC</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Transforming SC proofs into proofs of CNFs›</span></span>
<span class="keyword1"><span class="command">theory</span></span> LSC
<span class="keyword2"><span class="keyword">imports</span></span> <a href="CNF_Formulas.html">CNF_Formulas</a> <a href="SC_Cut.html">SC_Cut</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Left handed SC with NNF transformation:›</span></span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">LSC</span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span><span class="keyword3">)</span>"</span> <span class="main">[</span>53<span class="main">]</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">― ‹logic:›</span>
Ax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">,</span>Atom <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>n</sub></span></span>"</span></span> <span class="main">|</span>
BotL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>n</sub></span></span>"</span></span> <span class="main">|</span>
AndL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main"><span class="hidden">❙</span><b>∧</b></span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>n</sub></span></span>"</span></span> <span class="main">|</span>               
OrL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main"><span class="hidden">❙</span><b>∨</b></span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>n</sub></span></span>"</span></span> <span class="main">|</span>
<span class="comment1">― ‹nnf rules:›</span>
NotOrNNF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="main">⟹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main"><span class="hidden">❙</span><b>∨</b></span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>n</sub></span></span>"</span></span> <span class="main">|</span>
NotAndNNF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="main">⟹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="main">⟹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main"><span class="hidden">❙</span><b>∧</b></span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>n</sub></span></span>"</span></span> <span class="main">|</span>
ImpNNF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>n</sub></span></span>"</span></span> <span class="main">|</span>
NotImpNNF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="main">⟹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>n</sub></span></span>"</span></span> <span class="main">|</span>
NotNotNNF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="main">⟹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>n</sub></span></span>"</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> LSC.intros<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span></span></span></span><span class="main">]</span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹You can prove that derivability in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> SCp<span class="antiquote"><span class="antiquote">}</span></span></span></span> is invariant to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> nnf<span class="antiquote"><span class="antiquote">}</span></span></span></span>,
and then transform <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> SCp<span class="antiquote"><span class="antiquote">}</span></span></span></span> to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> LSC<span class="antiquote"><span class="antiquote">}</span></span></span></span> while assuming NNF.
However, the transformation introduces the trouble of handling the right side of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> SCp<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
The idea behind this is that handling the transformation is easier when not requiring NNF.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹One downside of the whole approach is that we often need everything to be in NNF. To shorten:›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_nnf_mset</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set_mset <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">.</span> is_nnf <span class="bound">x</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="main">{#}</span> <span class="main">⟹</span> is_nnf_mset <span class="free">Γ</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#}</span><span class="main">::</span><span class="tfree">'a</span> formula multiset "</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>BotL <span class="skolem">Γ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> <span class="main">⊥</span><span class="main">,</span><span class="skolem">Γ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">meson</span> multi_member_split<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ax <span class="skolem">A</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="comment1">(* this case makes you think that there's something wrong with this proof *)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndL <span class="skolem">Γ</span> <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">hence</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">G</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotL<span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="comment1">(* this demonstrates it *)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1" id="LSC-LSC_to_SC"><span class="command">lemma</span></span> LSC_to_SC<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="main">{#}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> LSC.induct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> NotL_inv <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> extended_Ax<span class="main">)</span>

<span class="keyword1" id="LSC-SC_to_LSC"><span class="command">lemma</span></span> SC_to_LSC<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">+</span> <span class="main">(</span>image_mset Not <span class="free">Δ</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> GO<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
    <span class="quoted"><span class="quoted">"NO_MATCH <span class="main">{#</span> <span class="skolem">B</span> <span class="main">#}</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span><span class="skolem">S</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">T</span> <span class="main">=</span> <span class="skolem">F</span><span class="main">,</span> <span class="main">(</span><span class="skolem">S</span><span class="main">+</span><span class="skolem">T</span><span class="main">)</span>"</span></span> 
    <span class="quoted"><span class="quoted">"NO_MATCH <span class="main">{#</span> <span class="skolem">B</span> <span class="main">#}</span> <span class="skolem">S</span> <span class="main">⟹</span> <span class="skolem">S</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span><span class="skolem">T</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">F</span><span class="main">,</span> <span class="main">(</span><span class="skolem">S</span><span class="main">+</span><span class="skolem">T</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"NO_MATCH <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="skolem">H</span><span class="main">)</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="skolem">F</span><span class="main">,</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="skolem">G</span><span class="main">,</span><span class="skolem">S</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="skolem">G</span><span class="main">,</span><span class="skolem">F</span><span class="main">,</span><span class="skolem">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">B</span> <span class="skolem">S</span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span> <span class="skolem">T</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>BotL <span class="skolem">Γ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> <span class="main">⊥</span><span class="main">,</span><span class="skolem">Γ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">meson</span> multi_member_split<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ax <span class="skolem">k</span> <span class="skolem">Γ</span> <span class="skolem">Δ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ'</span></span> <span class="skolem"><span class="skolem">Δ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> Atom <span class="skolem">k</span><span class="main">,</span> <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">=</span> Atom <span class="skolem">k</span><span class="main">,</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">meson</span> multi_member_split<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> LSC.Ax <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> SC_LSC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="main">{#}</span> <span class="main">⟷</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> SC_to_LSC LSC_to_SC <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The nice thing: The NNF-Transformation is even easier to show on the one-sided variant.›</span></span>
<span class="comment1">(* part of that is because it is written down in a way that is easier to tackle for the solvers *)</span>
<span class="keyword1" id="LSC-LSC_NNF"><span class="command">lemma</span></span> LSC_NNF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> image_mset nnf <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> LSC.induct<span class="main">)</span> 
  <span class="comment1">(* auto solved all, but I want to know what's going on. *)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotOrNNF <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">Γ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> NotOrNNF.IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">F</span><span class="main">)</span><span class="main">,</span> nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">G</span><span class="main">)</span><span class="main">,</span> image_mset nnf <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> LSC.AndL <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">F</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">G</span><span class="main">)</span><span class="main">,</span> image_mset nnf <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndL <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">Γ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> AndL.IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nnf <span class="skolem">F</span><span class="main">,</span> nnf <span class="skolem">G</span><span class="main">,</span> image_mset nnf <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> LSC.AndL<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nnf <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> nnf <span class="skolem">G</span><span class="main">,</span> image_mset nnf <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>  
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> add_mset_commute<span class="main">)</span>

<span class="keyword1" id="LSC-LSC_NNF_back"><span class="command">lemma</span></span> LSC_NNF_back<span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset nnf <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"image_mset nnf <span class="free">Γ</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> LSC.induct<span class="main">)</span> 
<span class="keyword1"><span class="command">oops</span></span>
<span class="comment1">(* should be possible, but I don't need it. *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹If we got rid of the rules for NNF, we could call it Gentzen-Schütte-calculus. But it turned out that not doing that works quite fine.›</span></span>
 
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹If you stare at left-handed Sequent calcului for too long, and they start staring back:
Try imagining that there is a <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">⊥</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> on the right hand side.
Also, bear in mind that provability of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Γ</span></span> <span class="keyword1"><span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and satisfiability of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Γ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are opposites here.›</span></span>

<span class="keyword1" id="LSC-LHCut"><span class="command">lemma</span></span> LHCut<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span><span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">unfolding</span></span> SC_LSC<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">using</span></span> NotL_inv cut <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> 
 <span class="keyword2"><span class="keyword">shows</span></span> LSC_AndL_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main"><span class="hidden">❙</span><b>∧</b></span><span class="free">G</span><span class="main">,</span><span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> <span class="free">F</span><span class="main">,</span><span class="free">G</span><span class="main">,</span><span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span>   LSC_OrL_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main"><span class="hidden">❙</span><b>∨</b></span><span class="free">G</span><span class="main">,</span><span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> <span class="free">F</span><span class="main">,</span><span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∧</span> <span class="free">G</span><span class="main">,</span><span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> SC_LSC AndL_inv OrL_inv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> LSC_invs <span class="main">=</span> LSC_AndL_inv LSC_OrL_inv
<span class="comment1">(* these are actually suitable as dest rules. But the proofs are usually slow, so I'd rather not. *)</span>

<span class="comment1">(* direct proof is easy here and it saves us the hassle of the nnf-assumption *)</span>
<span class="keyword1" id="LSC-LSC_weaken_set"><span class="command">lemma</span></span> LSC_weaken_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">+</span> <span class="free">Θ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> LSC.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>
<span class="keyword1" id="LSC-LSC_weaken"><span class="command">lemma</span></span> LSC_weaken<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> <span class="free">F</span><span class="main">,</span><span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> LSC_weaken_set <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_mset_add_single<span class="main">)</span>

<span class="keyword1" id="LSC-LSC_Contract"><span class="command">lemma</span></span> LSC_Contract<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sfp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span> <span class="free">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> SC_LSC contractL sfp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="LSC-cnf"><span class="command">lemma</span></span> cnf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free">H</span><span class="main">)</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟷</span> <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">H</span><span class="main">)</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l1</span> <span class="main">⟷</span> <span class="var">?r1</span>"</span></span><span class="main">)</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free">H</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟷</span> <span class="main">(</span><span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">F</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="free">H</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">F</span><span class="main">)</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l2</span> <span class="main">⟷</span> <span class="var">?r2</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> GO<span class="comment1">(* get out *)</span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>   
    <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span><span class="skolem">G</span><span class="main">,</span><span class="skolem">S</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> <span class="skolem">G</span><span class="main">,</span><span class="skolem">F</span><span class="main">,</span><span class="skolem">S</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?r1</span></span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="var"><span class="quoted"><span class="var">?l1</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?l1</span>›</span></span><span class="main">[</span><span class="operator">THEN</span> LSC_invs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free">H</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> LSC_invs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> gh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">,</span> <span class="free">H</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?r1</span></span></span> <span class="keyword1"><span class="command">using</span></span> f gh <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> LSC_invs <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> LSC_weaken<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?r2</span></span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="var"><span class="quoted"><span class="var">?l2</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?l2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">,</span> <span class="free">H</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> LSC_invs<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?r2</span></span></span>  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> LSC_invs <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> LSC_weaken<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?l1</span></span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="var"><span class="quoted"><span class="var">?r1</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?r1</span>›</span></span><span class="main">[</span><span class="operator">THEN</span> LSC_invs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">G</span><span class="main">,</span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">H</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">,</span> <span class="free">H</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> LSC_Contract <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> LSC_invs<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?l1</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> LSC.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?l2</span></span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="var"><span class="quoted"><span class="var">?r2</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?r2</span>›</span></span><span class="main">[</span><span class="operator">THEN</span> LSC_invs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">F</span><span class="main">,</span> <span class="free">H</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">,</span> <span class="free">H</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> LSC_Contract <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> LSC_invs<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?l2</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> LSC.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l1</span> <span class="main">⟷</span> <span class="var">?r1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l2</span> <span class="main">⟷</span> <span class="var">?r2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Interestingly, the DNF congruences are a lot easier to show, requiring neither weakening nor contraction.
  The reasons are to be sought in the asymmetries between the rules for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> And<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Or<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
<span class="keyword1" id="LSC-dnf"><span class="command">lemma</span></span> dnf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">H</span><span class="main">)</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟷</span> <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free">H</span><span class="main">)</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t1</span>"</span></span><span class="main">)</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">H</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟷</span> <span class="main">(</span><span class="free">G</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free">F</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="free">H</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free">F</span><span class="main">)</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t2</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> GO<span class="comment1">(* get out *)</span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span><span class="skolem">G</span><span class="main">,</span><span class="skolem">S</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> <span class="skolem">G</span><span class="main">,</span><span class="skolem">F</span><span class="main">,</span><span class="skolem">S</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span> <span class="skolem">I</span> <span class="skolem">J</span> <span class="skolem">S</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?t1</span></span></span> <span class="var"><span class="quoted"><span class="var">?t2</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> LSC_invs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LSC-LSC_sim_Resolution1"><span class="command">lemma</span></span> LSC_sim_Resolution1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">T</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Atom <span class="free">k</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">S</span><span class="main">,</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span>Atom <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">T</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> R <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> LSC_invs<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> LHCut<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> F<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"Atom <span class="free"><span class="free">k</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span><span class="main">,</span> Atom <span class="free">k</span><span class="main">,</span> Atom <span class="free">k</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">S</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> LSC_weaken r<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">" <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="free">k</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">T</span><span class="main">,</span> Atom <span class="free">k</span><span class="main">,</span> Atom <span class="free">k</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">S</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Atom <span class="free">k</span><span class="main">,</span> Atom <span class="free">k</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">S</span><span class="main">,</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="free">k</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">T</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> LSC_invs<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> add_mset_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹analogously›</span></span><span class="comment1">(*&lt;*)</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">,</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span>Atom <span class="free">k</span><span class="main">)</span><span class="main">,</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span>Atom <span class="free">k</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">T</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> LSC_weaken r<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Atom <span class="free">k</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">S</span><span class="main">,</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="free">k</span><span class="main">)</span><span class="main">,</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="free">k</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">T</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> LSC_weaken
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> LSC_invs<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="comment1">(*&gt;*)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="free">k</span><span class="main">)</span><span class="main">,</span> Atom <span class="free">k</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">S</span><span class="main">,</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="free">k</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">T</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LSC-LSC_need_it_once_have_many"><span class="command">lemma</span></span>
  LSC_need_it_once_have_many<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> el<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> set <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> once<span class="main">:</span> <span class="quoted"><span class="quoted">"form_of_lit <span class="free">A</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="main">(</span>removeAll <span class="free">A</span> <span class="free">F</span><span class="main">)</span><span class="main">,</span><span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"disj_of_clause <span class="free">F</span><span class="main">,</span><span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span> <span class="comment1">(* there might be a smarter way to prove this by splitting F into two lists… but nah. *)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">f</span> <span class="skolem">F</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> Cons.prems <span class="keyword1"><span class="command">have</span></span> ihm<span class="main">:</span> <span class="quoted"><span class="quoted">"form_of_lit <span class="free">A</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="main">(</span>removeAll <span class="free">A</span> <span class="skolem">F</span><span class="main">)</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> True <span class="keyword1"><span class="command">have</span></span> split<span class="main">:</span> <span class="quoted"><span class="quoted">"form_of_lit <span class="skolem">f</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="quoted"><span class="quoted">"disj_of_clause <span class="main">(</span>removeAll <span class="free">A</span> <span class="skolem">F</span><span class="main">)</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> LSC_invs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons.IH<span class="main">[</span><span class="operator">OF</span> _ ihm<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> set <span class="skolem">F</span> <span class="main">⟹</span> disj_of_clause <span class="skolem">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> split<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"disj_of_clause <span class="skolem">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> set <span class="skolem">F</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">with</span></span> split<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> Cons.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> prem<span class="main">:</span> <span class="quoted"><span class="quoted">"form_of_lit <span class="free">A</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="quoted"><span class="quoted">"form_of_lit <span class="skolem">f</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="quoted"><span class="quoted">"disj_of_clause <span class="main">(</span>removeAll <span class="free">A</span> <span class="skolem">F</span><span class="main">)</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> LSC_invs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"form_of_lit <span class="free">A</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="main">(</span>removeAll <span class="free">A</span> <span class="skolem">F</span><span class="main">)</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> False Cons.prems <span class="keyword1"><span class="command">have</span></span> el<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> set <span class="skolem">F</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Cons.IH<span class="main">[</span><span class="operator">OF</span> el d<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"disj_of_clause <span class="skolem">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> prem<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* LSC_sim_Resolution1 is the naive summer child that requires everything to be in the right order. Here comes the real fun *)</span>
<span class="keyword1" id="LSC-LSC_Sim_resolution_la"><span class="command">lemma</span></span> LSC_Sim_resolution_la<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"disj_of_clause <span class="main">(</span>removeAll <span class="main">(</span><span class="free">k</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="free">F</span> <span class="main">@</span> removeAll <span class="main">(</span><span class="free">k</span><span class="main">¯</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> el<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">∈</span> set <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">¯</span> <span class="main">∈</span> set <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"disj_of_clause <span class="free">F</span><span class="main">,</span> disj_of_clause <span class="free">G</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> LSC_or_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">H</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟷</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">H</span><span class="main">)</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"is_nnf <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"is_nnf <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"is_nnf <span class="skolem">H</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> LSC_invs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> dd<span class="main">:</span> <span class="quoted"><span class="quoted">"disj_of_clause <span class="main">(</span><span class="skolem">F</span> <span class="main">@</span> <span class="skolem">G</span><span class="main">)</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> disj_of_clause <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="skolem">G</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">F</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> LSC_invs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LSC_or_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> LSC_sim_Resolution1<span class="main">[</span><span class="operator">OF</span> dd<span class="main"><span class="main">[</span></span><span class="operator">OF</span> R<span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> unord<span class="main">:</span> <span class="quoted"><span class="quoted">"Atom <span class="free">k</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="main">(</span>removeAll <span class="main">(</span><span class="free">k</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="free">F</span><span class="main">)</span><span class="main">,</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="free">k</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="main">(</span>removeAll <span class="main">(</span><span class="free">k</span><span class="main">¯</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> LSC_need_it_once_have_many<span class="main">[</span><span class="operator">OF</span> el<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> LSC_need_it_once_have_many<span class="main">[</span><span class="operator">OF</span> el<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> unord
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> sc_insertion_ordering<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LSC-two_list_induct"><span class="command">lemma</span></span> two_list_induct<span class="main">[</span><span class="operator">case_names</span> Nil Cons<span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">[]</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">a</span> <span class="bound">S</span> <span class="bound">T</span><span class="main">.</span> <span class="free">P</span> <span class="bound">S</span> <span class="bound">T</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">a</span> <span class="main">#</span> <span class="bound">S</span><span class="main">)</span> <span class="bound">T</span> <span class="main">&amp;&amp;&amp;</span> <span class="free">P</span> <span class="bound">S</span> <span class="main">(</span><span class="bound">a</span> <span class="main">#</span> <span class="bound">T</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">S</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">S</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="LSC-distrib1"><span class="command">lemma</span></span> distrib1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span><span class="main">;</span> image_mset disj_of_clause <span class="main">(</span>mset <span class="free">G</span><span class="main">)</span> <span class="main">+</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span><span class="main">⟧</span>
    <span class="main">⟹</span> mset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span> <span class="main">+</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="comment1">(* surprisingly, the proof having a <span class="hidden">❙</span><b>∧</b> instead of the <span class="hidden">❙</span><b>∨</b> looks very similar. Yes, I mistook the two at some point… and downstream, where this is used, I only had to do a few text replacements. makes you really wonder whether what you're proving is meaningful. *)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">G</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> GO<span class="comment1">(* get out *)</span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"NO_MATCH <span class="main">(</span><span class="main">{#</span><span class="skolem">I</span><span class="main"><span class="hidden">❙</span><b>∨</b></span><span class="skolem">J</span><span class="main">#}</span><span class="main">)</span> <span class="skolem">H</span> <span class="main">⟹</span> <span class="skolem">H</span><span class="main">+</span><span class="main">{#</span><span class="skolem">F</span><span class="main"><span class="hidden">❙</span><b>∨</b></span><span class="skolem">G</span><span class="main">#}</span><span class="main">+</span><span class="skolem">S</span> <span class="main">=</span> <span class="skolem">F</span><span class="main"><span class="hidden">❙</span><b>∨</b></span><span class="skolem">G</span><span class="main">,</span><span class="skolem">H</span><span class="main">+</span><span class="skolem">S</span>"</span></span>
   <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span> <span class="skolem">S</span> <span class="skolem">I</span> <span class="skolem">J</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">g</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span> disj_of_clause <span class="skolem">g</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LSC_weaken add_mset_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹image_mset disj_of_clause <span class="main">(</span>mset <span class="main">(</span><span class="skolem">g</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>›</span></span> 
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset disj_of_clause <span class="main">(</span>mset <span class="skolem">G</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>disj_of_clause <span class="skolem">g</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons.IH<span class="main">[</span><span class="operator">OF</span> 1 2<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"disj_of_clause <span class="skolem">g</span><span class="main">,</span> mset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span> mset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> LSC_weaken_set <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.assoc add.commute add_mset_add_single<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> IH 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="LSC-mset_concat_map_cons"><span class="command">lemma</span></span> mset_concat_map_cons<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mset <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> <span class="free">F</span> <span class="bound">c</span> <span class="main">#</span> <span class="free">G</span> <span class="bound">c</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mset <span class="main">(</span>map <span class="free">F</span> <span class="free">S</span><span class="main">)</span> <span class="main">+</span> mset <span class="main">(</span>concat <span class="main">(</span>map <span class="free">G</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">S</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>

<span class="keyword1" id="LSC-distrib"><span class="command">lemma</span></span> distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"
  image_mset disj_of_clause <span class="main">(</span>mset <span class="free">F</span><span class="main">)</span> <span class="main">+</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> 
  image_mset disj_of_clause <span class="main">(</span>mset <span class="free">G</span><span class="main">)</span> <span class="main">+</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span>
  mset <span class="main">[</span>disj_of_clause <span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">.</span> c <span class="main">←</span> <span class="free">F</span><span class="main">,</span> d <span class="main">←</span> <span class="free">G</span><span class="main">]</span> <span class="main">+</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> two_list_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹image_mset disj_of_clause <span class="main">(</span>mset <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"disj_of_clause <span class="skolem">a</span><span class="main">,</span> image_mset disj_of_clause <span class="main">(</span>mset <span class="skolem">F</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹image_mset disj_of_clause <span class="main">(</span>mset <span class="skolem">G</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset disj_of_clause <span class="main">(</span>mset <span class="skolem">G</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>image_mset disj_of_clause <span class="main">(</span>mset <span class="skolem">F</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset disj_of_clause <span class="main">(</span>mset <span class="skolem">G</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>mset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> disj_of_clause <span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> LSC_weaken_set <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute union_assoc<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> distrib1<span class="main">[</span><span class="operator">OF</span> a b<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset disj_of_clause <span class="main">(</span>mset <span class="skolem">F</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>mset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> disj_of_clause <span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_lcomm<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">[</span><span class="operator">OF</span> this c<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> disj_of_clause <span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
  <span class="main">(</span>mset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> disj_of_clause <span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute union_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span> <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Just the whole thing again, with slightly more mset magic and swapping things around.›</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹image_mset disj_of_clause <span class="main">(</span>mset <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">G</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"disj_of_clause <span class="skolem">a</span><span class="main">,</span> image_mset disj_of_clause <span class="main">(</span>mset <span class="skolem">G</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹image_mset disj_of_clause <span class="main">(</span>mset <span class="skolem">F</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset disj_of_clause <span class="main">(</span>mset <span class="skolem">F</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>image_mset disj_of_clause <span class="main">(</span>mset <span class="skolem">G</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset disj_of_clause <span class="main">(</span>mset <span class="skolem">F</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>mset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> disj_of_clause <span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">)</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> LSC_weaken_set <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute union_assoc<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> list_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> disj_of_clause <span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">)</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span>
  <span class="main">(</span>mset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> disj_of_clause <span class="bound">d</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="skolem">a</span><span class="main">)</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">F</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">Γ</span></span><span class="main">)</span> <span class="comment1">(* meh, I should have only prooved one direction, would have been easier *)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">f</span> <span class="skolem">F</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> disj_of_clause <span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">#</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span>
      disj_of_clause <span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="skolem">f</span><span class="main">,</span> mset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> disj_of_clause <span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">)</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> disj_of_clause <span class="skolem">f</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="skolem">a</span><span class="main">,</span> mset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> disj_of_clause <span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">)</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> LSC_invs<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> mset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> disj_of_clause <span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">)</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>disj_of_clause <span class="skolem">f</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="skolem">a</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> mset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> disj_of_clause <span class="bound">d</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="skolem">a</span><span class="main">)</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>disj_of_clause <span class="skolem">f</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="skolem">a</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.IH
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> disj_of_clause_is_nnf insert_iff is_nnf.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> set_mset_add_mset_insert<span class="main">)</span>
      <span class="comment1">(* this was the step that shows why I'm doing this *)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> distrib1<span class="main">[</span><span class="operator">OF</span> a b<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset disj_of_clause <span class="main">(</span>mset <span class="skolem">G</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>mset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> disj_of_clause <span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">)</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">[</span><span class="operator">OF</span> c this <span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> disj_of_clause <span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
  <span class="main">(</span>mset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> disj_of_clause <span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">)</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> list_commute <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mset_concat_map_cons add.assoc add.left_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="LSC-LSC_BigAndL"><span class="command">lemma</span></span> LSC_BigAndL<span class="main">:</span> <span class="quoted"><span class="quoted">"mset <span class="free">F</span> <span class="main">+</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> <span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="free">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LSC_weaken<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> LSC.AndL add_mset_commute union_mset_add_mset_right<span class="main">)</span>
<span class="keyword1" id="LSC-LSC_Top_unused"><span class="command">lemma</span></span> LSC_Top_unused<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span><span class="main">;</span> is_nnf_mset <span class="free">Γ</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">-</span> <span class="main">{#</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">⊥</span><span class="main">#}</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> LSC.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Ax <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LSC.Ax add.commute diff_union_swap formula.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> formula.inject<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> BotL <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LSC.BotL add.commute diff_union_swap formula.distinct<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndL <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">Γ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="main">-</span> <span class="main">{#</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">⊥</span><span class="main">#}</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">-</span> <span class="main">{#</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">⊥</span><span class="main">#}</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AndL.hyps LSC.AndL diff_single_trivial diff_union_swap2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute diff_union_swap formula.distinct<span class="main"><span class="main">(</span></span>19<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrL <span class="skolem">F</span> <span class="skolem">Γ</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="main">-</span> <span class="main">{#</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">⊥</span><span class="main">#}</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="main">-</span> <span class="main">{#</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">⊥</span><span class="main">#}</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">-</span> <span class="main">{#</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">⊥</span><span class="main">#}</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LSC.OrL OrL.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> OrL.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> diff_single_trivial diff_union_swap2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_union_swap formula.distinct<span class="main"><span class="main">(</span></span>21<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="LSC-LSC_BigAndL_inv"><span class="command">lemma</span></span> LSC_BigAndL_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="free">F</span><span class="main">,</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> set <span class="free">F</span><span class="main">.</span> is_nnf <span class="bound">f</span> <span class="main">⟹</span> is_nnf_mset <span class="free">Γ</span> <span class="main">⟹</span> mset <span class="free">F</span> <span class="main">+</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> LSC_Top_unused <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">a</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> LSC_invs <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset <span class="skolem">F</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LSC-LSC_reassociate_Ands"><span class="command">lemma</span></span> LSC_reassociate_Ands<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span>disj_of_clause <span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∈#</span> <span class="free">C</span><span class="main">#}</span> <span class="main">+</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span>
   is_nnf_mset <span class="free">Γ</span> <span class="main">⟹</span>
  <span class="main">{#</span>disj_of_clause <span class="main">(</span><span class="bound">c</span> <span class="main">@</span> <span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∈#</span> <span class="free">C</span><span class="main">#}</span> <span class="main">+</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>add <span class="skolem">x</span> <span class="skolem">C</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> add.prems <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>disj_of_clause <span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="skolem">b</span><span class="main">)</span><span class="main">,</span> <span class="main">{#</span>disj_of_clause <span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∈#</span> <span class="skolem">C</span><span class="main">#}</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>disj_of_clause <span class="main">(</span><span class="skolem">a</span><span class="main">@</span><span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">{#</span>disj_of_clause <span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∈#</span> <span class="skolem">C</span><span class="main">#}</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> pn<span class="main">:</span> <span class="quoted"><span class="quoted">"is_nnf_mset <span class="main">(</span><span class="main">{#</span>disj_of_clause <span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∈#</span> <span class="skolem">C</span><span class="main">#}</span> <span class="main">+</span> <span class="skolem">Γ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_nnf_mset <span class="skolem">Γ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"disj_of_clause <span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="skolem">b</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> is_nnf_mset <span class="skolem">Γ</span> <span class="main">⟹</span> disj_of_clause <span class="main">(</span><span class="skolem">a</span> <span class="main">@</span> <span class="skolem">b</span><span class="main">)</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> LSC_invs<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">OF</span> _ pn<span class="main">]</span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span>disj_of_clause <span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∈#</span> <span class="skolem">C</span><span class="main">#}</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>disj_of_clause <span class="main">(</span><span class="skolem">a</span><span class="main">@</span><span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="skolem">Γ</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> add.IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span>disj_of_clause <span class="main">(</span><span class="bound">c</span> <span class="main">@</span> <span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∈#</span> <span class="skolem">C</span><span class="main">#}</span> <span class="main">+</span> <span class="main">(</span>disj_of_clause <span class="main">(</span><span class="skolem">a</span> <span class="main">@</span> <span class="skolem">b</span><span class="main">)</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_nnf_mset <span class="skolem">Γ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="LSC-LSC_cnf"><span class="command">lemma</span></span> LSC_cnf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> is_nnf_mset <span class="free">Γ</span> <span class="main">⟹</span> image_mset cnf_form_of <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> LSC.induct<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"NO_MATCH <span class="main">(</span>And <span class="skolem">I</span> <span class="skolem">J</span><span class="main">)</span> <span class="skolem">F</span> <span class="main">⟹</span> NO_MATCH <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">⊥</span><span class="main">)</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="skolem">F</span><span class="main">,</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">⊥</span><span class="main">,</span><span class="skolem">Γ</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">⊥</span><span class="main">,</span><span class="skolem">F</span><span class="main">,</span><span class="skolem">Γ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">I</span> <span class="skolem">J</span> <span class="skolem">Γ</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">⊥</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LSC_weaken<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Ax <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cnf_form_of_defs<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> BotL <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cnf_form_of_defs<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> GO<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"NO_MATCH <span class="main">(</span><span class="main">{#</span><span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="skolem">I</span><span class="main">#}</span><span class="main">)</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main">+</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="skolem">G</span><span class="main">,</span> <span class="main">(</span><span class="skolem">F</span> <span class="main">+</span> <span class="skolem">S</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span> <span class="skolem">S</span> <span class="skolem">I</span> <span class="skolem">J</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndL <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> LSC_BigAndL_inv <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> LSC_BigAndL <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cnf_form_of_defs<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrL <span class="skolem">F</span> <span class="skolem">Γ</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset disj_of_clause <span class="main">(</span>mset <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> map <span class="main">(</span><span class="main">(@)</span> <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>cnf_lists <span class="skolem">G</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cnf_lists <span class="skolem">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> pig<span class="main">:</span> <span class="quoted"><span class="quoted">"is_nnf_mset <span class="skolem">Γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span>
      <span class="quoted"><span class="quoted">"mset <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> disj_of_clause <span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">)</span> <span class="main">(</span>cnf_lists <span class="skolem">G</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cnf_lists <span class="skolem">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
    <span class="comment1">(* just some nasty modification of the conjunction *)</span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword1"><span class="command">note</span></span> cms<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> mset_map<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> map_concat comp_def
    <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> disj_of_clause <span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> disj_of_clause <span class="bound">d</span><span class="main">)</span> <span class="main">(</span>
      mset <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cnf_lists <span class="skolem">G</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cnf_lists <span class="skolem">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> disj_of_clause <span class="main">(</span><span class="bound">c</span><span class="main">@</span><span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>
      mset <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cnf_lists <span class="skolem">G</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cnf_lists <span class="skolem">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> LSC_reassociate_Ands pig <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="hidden">❙</span><b>⋀</b></span> <span class="main">(</span>map disj_of_clause <span class="main">(</span>cnf_lists <span class="skolem">F</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span><span class="main">;</span> <span class="main"><span class="hidden">❙</span><b>⋀</b></span> <span class="main">(</span>map disj_of_clause <span class="main">(</span>cnf_lists <span class="skolem">G</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span><span class="main">⟧</span>
    <span class="main">⟹</span> is_nnf_mset <span class="skolem">Γ</span>
    <span class="main">⟹</span> <span class="main"><span class="hidden">❙</span><b>⋀</b></span> <span class="main">(</span>map disj_of_clause <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> map <span class="main">(</span><span class="main">(@)</span> <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>cnf_lists <span class="skolem">G</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cnf_lists <span class="skolem">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> 
    <span class="comment1">(* the actual disjunction is happening here *)</span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span> <span class="keyword1"><span class="command">using</span></span> distrib<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span> 2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> LSC_BigAndL_inv <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> LSC_BigAndL<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> OrL <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> 1 <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cnf_form_of_def form_of_cnf_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="LSC_Resolution">
<div class="head">
<h1>Theory LSC_Resolution</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Converting between Resolution and SC proofs›</span></span>
<span class="keyword1"><span class="command">theory</span></span> LSC_Resolution
<span class="keyword2"><span class="keyword">imports</span></span> <a href="LSC.html">LSC</a> <a href="Resolution.html">Resolution</a>
<span class="keyword2"><span class="keyword">begin</span></span>    

<span class="keyword1" id="LSC_Resolution-literal_subset_sandwich"><span class="command">lemma</span></span> literal_subset_sandwich<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_lit_plus <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"cnf <span class="free">F</span> <span class="main">=</span> <span class="main">{</span><span class="free">C</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">=</span> <span class="main">□</span> <span class="main">∨</span> <span class="free">R</span> <span class="main">=</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> is_lit_plus.cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span> <span class="comment1">(* proof somewhat strange internally… *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Proof following Gallier~\cite{gallier2015logic}.›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> CSC_Resolution_pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">γ</span> <span class="main">∈</span> set_mset <span class="free">Γ</span><span class="main">.</span> is_cnf <span class="bound">γ</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>cnf <span class="main">`</span> set_mset <span class="free">Γ</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> LSC.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ax <span class="skolem">k</span> <span class="skolem">Γ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>cnf <span class="main">`</span> set_mset <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span>Atom <span class="skolem">k</span><span class="main">)</span><span class="main">,</span> Atom <span class="skolem">k</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">⊢</span> <span class="main">{</span><span class="skolem">k</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">⊢</span> <span class="main">{</span><span class="skolem">k</span><span class="main">¯</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Resolution.Ass<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> Resolution.R<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>BotL <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ass<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndL <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">Γ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>cnf <span class="main">`</span> set_mset <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_left_commute sup.assoc<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="comment1">(* The idea for the whole trickery with F being a literal (is_disj has to only allows right deep formulas)
    and the sandwiching is from Gallier, but mentioned there only in one little sentence. *)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrL <span class="skolem">F</span> <span class="skolem">Γ</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_cnf <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"is_disj <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> db<span class="main">:</span> <span class="quoted"><span class="quoted">"is_disj <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"is_lit_plus <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"is_disj <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">-</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">F</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_cnf <span class="skolem">F</span> <span class="main">∧</span> is_cnf <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">G</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> OrL <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="main">(</span>cnf <span class="main">`</span> set_mset <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="main">(</span>cnf <span class="main">`</span> set_mset <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Γ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="main">(</span>cnf <span class="main">`</span> set_mset <span class="skolem">Γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> IH <span class="keyword1"><span class="command">have</span></span> IH_readable<span class="main">:</span> <span class="quoted"><span class="quoted">"cnf <span class="skolem">F</span> <span class="main">∪</span> <span class="var">?Γ</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span> <span class="quoted"><span class="quoted">"cnf <span class="skolem">G</span> <span class="main">∪</span> <span class="var">?Γ</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"cnf <span class="skolem">F</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> cnf <span class="skolem">G</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cnf <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> ST<span class="main">:</span> <span class="quoted"><span class="quoted">"cnf <span class="skolem">F</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">S</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"cnf <span class="skolem">G</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">T</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cnf_disj_ex db<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="comment1">(* try applying meson here. It's weird. and sledgehammer even suggests it. *)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="comment1">(* hint: card S ≤ 1 *)</span>
    <span class="keyword1"><span class="command">hence</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"cnf <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="skolem">T</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">S</span><span class="main">▹</span><span class="var">?Γ</span> <span class="main">⊢</span> <span class="main">□</span><span class="main">;</span> <span class="skolem">T</span><span class="main">▹</span><span class="var">?Γ</span> <span class="main">⊢</span> <span class="main">□</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="skolem">T</span><span class="main">▹</span> <span class="var">?Γ</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">▹</span><span class="var">?Γ</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span><span class="main">▹</span><span class="var">?Γ</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> s_w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="skolem">T</span> <span class="main">▹</span> <span class="var">?Γ</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Resolution_weaken <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_commute insert_is_Un<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> Resolution_taint_assumptions<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">T</span><span class="main">}</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?Γ</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">□</span>"</span></span> <span class="quoted"><span class="skolem">S</span></span><span class="main">]</span> t
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∪</span> <span class="skolem">T</span> <span class="main">▹</span> <span class="main">⋃</span><span class="main">(</span>cnf <span class="main">`</span> set_mset <span class="skolem">Γ</span><span class="main">)</span> <span class="main">⊢</span> <span class="skolem">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span><span class="main">⊆</span><span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Un_commute<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> literal_subset_sandwich<span class="main">[</span><span class="operator">OF</span> db<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ST<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> R<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">□</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> R<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> Resolution_unnecessary<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">_</span><span class="main">}</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> R<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">R</span> <span class="main">▹</span> <span class="skolem">S</span> <span class="main">∪</span> <span class="skolem">T</span> <span class="main">▹</span> <span class="var">?Γ</span> <span class="main">⊢</span> <span class="main">□</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">S</span> <span class="main">∪</span> <span class="skolem">T</span> <span class="main">▹</span> <span class="var">?Γ</span> <span class="main">⊢</span> <span class="main">□</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="skolem">S</span>"</span></span> 
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> s_w <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> IH ST R <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> case_readable<span class="main">:</span> <span class="quoted"><span class="quoted">"cnf <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?Γ</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">corollary</span></span> LSC_Resolution<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="main">(</span>cnf <span class="main">`</span> nnf <span class="main">`</span> set_mset <span class="free">Γ</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset nnf <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LSC_NNF<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> LSC_cnf<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="main">(</span>cnf_form_of <span class="main">∘</span> nnf<span class="main">)</span> <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_mset.compositionality is_nnf_nnf<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">γ</span> <span class="main">∈</span> set_mset <span class="main">(</span>image_mset <span class="main">(</span>cnf_form_of <span class="main">∘</span> nnf<span class="main">)</span> <span class="free">Γ</span><span class="main">)</span><span class="main">.</span> is_cnf <span class="bound">γ</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> cnf_form_of_is<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">,</span> <span class="operator">OF</span> is_nnf_nnf<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> CSC_Resolution_pre
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>cnf <span class="main">`</span> set_mset <span class="main">(</span>image_mset <span class="main">(</span>cnf_form_of <span class="main">∘</span> nnf<span class="main">)</span> <span class="free">Γ</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">F</span><span class="main">.</span> cnf <span class="main">(</span>cnf_form_of <span class="main">(</span>nnf <span class="bound">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> set_mset <span class="free">Γ</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cnf_cnf<span class="main">[</span><span class="operator">OF</span> is_nnf_nnf<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">corollary</span></span> SC_Resolution<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="main">{#}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="main">(</span>cnf <span class="main">`</span> nnf <span class="main">`</span> set_mset <span class="free">Γ</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset nnf <span class="free">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LSC_NNF SC_LSC<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>cnf<span class="main">`</span> nnf <span class="main">`</span> set_mset <span class="main">(</span>image_mset nnf <span class="free">Γ</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> LSC_Resolution <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> is_nnf_nnf_id<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span> is_nnf_nnf<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Gallier just goes "Any resolution refutation can be transformed to a derivation in SCNF'"
   But we don't know what a resolution refutation is, inductively speaking. *)</span>
<span class="comment1">(* would have been a bit nicer with orderings on formula to convert mset → list *)</span>
<span class="keyword1" id="LSC_Resolution-Resolution_LSC_pre"><span class="command">lemma</span></span> Resolution_LSC_pre<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊢</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"Ball <span class="free">S</span> finite"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">S'</span> <span class="bound">R'</span><span class="main">.</span> <span class="main">∀</span><span class="bound">Γ</span><span class="main">.</span> set <span class="bound">R'</span> <span class="main">=</span> <span class="free">R</span> <span class="main">∧</span> set <span class="main">(</span>map set <span class="bound">S'</span><span class="main">)</span> <span class="main">=</span> <span class="free">S</span> <span class="main">∧</span> 
    <span class="main">(</span>disj_of_clause <span class="bound">R'</span><span class="main">,</span> <span class="main">{#</span>disj_of_clause <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈#</span> mset <span class="bound">S'</span><span class="main">#}</span> <span class="main">+</span> <span class="bound">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟶</span> <span class="main">{#</span>disj_of_clause <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈#</span> mset <span class="bound">S'</span><span class="main">#}</span> <span class="main">+</span> <span class="bound">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span>"</span></span>
<span class="comment1">(* order of quantifiers is important here… *)</span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Resolution.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ass <span class="skolem">F</span> <span class="skolem">S</span><span class="main">)</span>
  <span class="comment1">(* Idea: we don't just obtain an S', we obtain an S' that contains R (and not just some reordering of it) *)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Sm</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Sm</span> <span class="main">=</span> <span class="skolem">S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">F</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> Sm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="skolem">F</span><span class="main">▹</span><span class="skolem">Sm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∉</span> <span class="skolem">Sm</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span> <span class="comment1">(* try doing this with obtain… *)</span>
  <span class="keyword1"><span class="command">with</span></span> Ass <span class="keyword1"><span class="command">have</span></span> fsm<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Sm</span>"</span></span> <span class="quoted"><span class="quoted">"Ball <span class="skolem">Sm</span> finite"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Sm'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Sm</span> <span class="main">=</span> set <span class="main">(</span>map set <span class="skolem">Sm'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> ex_map_conv finite_list<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> set <span class="skolem">R'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ass finite_list <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> set <span class="main">(</span>map set <span class="main">(</span><span class="skolem">R'</span><span class="main">#</span><span class="skolem">Sm'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Sm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> LSC_Contract<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">R'</span></span></span><span class="main"><span class="main"><span class="main">#</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">Sm'</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">R'</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S add_ac<span class="main">)</span>
  <span class="comment1">(* this was the base case. ugh. *)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>R <span class="skolem">S</span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> R.prems <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> R.IH<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> fin<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> R.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">FR</span></span> <span class="skolem"><span class="skolem">FS</span></span> <span class="keyword2"><span class="keyword">where</span></span> IHF<span class="main">:</span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">FR</span> <span class="main">=</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map set <span class="skolem">FS</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">S</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Γ</span> <span class="bound">GS</span><span class="main">.</span> <span class="main">(</span>disj_of_clause <span class="skolem">FR</span><span class="main">,</span> image_mset disj_of_clause <span class="main">(</span>mset <span class="main">(</span><span class="skolem">FS</span><span class="main">@</span><span class="bound">GS</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="bound">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> 
      <span class="main">⟹</span> image_mset disj_of_clause <span class="main">(</span>mset <span class="main">(</span><span class="skolem">FS</span><span class="main">@</span><span class="bound">GS</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="bound">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> add.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> R.IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> fin<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> R.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">GR</span></span> <span class="skolem"><span class="skolem">GS</span></span> <span class="keyword2"><span class="keyword">where</span></span> IHG<span class="main">:</span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">GR</span> <span class="main">=</span> <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map set <span class="skolem">GS</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">S</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Γ</span> <span class="bound">HS</span><span class="main">.</span> <span class="main">(</span>disj_of_clause <span class="skolem">GR</span><span class="main">,</span> image_mset disj_of_clause <span class="main">(</span>mset <span class="main">(</span><span class="skolem">GS</span><span class="main">@</span><span class="bound">HS</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="bound">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> 
      <span class="main">⟹</span> image_mset disj_of_clause <span class="main">(</span>mset <span class="main">(</span><span class="skolem">GS</span><span class="main">@</span><span class="bound">HS</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="bound">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> add.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset disj_of_clause <span class="main">(</span>mset <span class="main">(</span><span class="skolem">FS</span> <span class="main">@</span> <span class="skolem">GS</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"disj_of_clause <span class="skolem">FR</span><span class="main">,</span> disj_of_clause <span class="skolem">GR</span><span class="main">,</span> image_mset disj_of_clause <span class="main">(</span>mset <span class="main">(</span><span class="skolem">FS</span> <span class="main">@</span> <span class="skolem">GS</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span> <span class="keyword1"><span class="command">using</span></span> IHF<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">GS</span></span> <span class="quoted"><span class="skolem">Γ</span></span><span class="main">]</span> IHG<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">FS</span></span> <span class="quoted"><span class="quoted">"disj_of_clause <span class="skolem">FR</span><span class="main">,</span> <span class="skolem">Γ</span>"</span></span><span class="main">]</span> that
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mset_commute add_ac<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">FS</span></span> <span class="main"><span class="main">@</span></span> <span class="skolem"><span class="skolem">GS</span></span>"</span></span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"removeAll <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">k</span></span><span class="main"><span class="main"><span class="hidden">⇧</span><sup>+</sup></span></span><span class="main"><span class="main">)</span></span> <span class="skolem"><span class="skolem">FR</span></span> <span class="main"><span class="main">@</span></span> removeAll <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">k</span></span><span class="main"><span class="main">¯</span></span><span class="main"><span class="main">)</span></span> <span class="skolem"><span class="skolem">GR</span></span>"</span></span></span><span class="main"><span class="main">]</span></span> allI impI conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IHF IHG<span class="main"><span class="keyword3">;</span></span><span class="operator">fail</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> IHF IHG<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span><span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> IH<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> LSC_Sim_resolution_la <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IHF IHG R.hyps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="LSC_Resolution-Resolution_LSC_pre_nodisj"><span class="command">lemma</span></span> Resolution_LSC_pre_nodisj<span class="main">:</span> <span class="comment1">(* I've tried showing this directly instead of Resolution_LSC_pre, but that is surprisingly painful. *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊢</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"Ball <span class="free">S</span> finite"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">S'</span> <span class="bound">R'</span><span class="main">.</span> <span class="main">∀</span><span class="bound">Γ</span><span class="main">.</span> is_nnf_mset <span class="bound">Γ</span> <span class="main">⟶</span> is_disj <span class="bound">R'</span> <span class="main">∧</span> is_nnf <span class="bound">S'</span> <span class="main">∧</span> cnf <span class="bound">R'</span> <span class="main">=</span> <span class="main">{</span><span class="free">R</span><span class="main">}</span> <span class="main">∧</span> cnf <span class="bound">S'</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="bound">R'</span><span class="main">,</span> <span class="bound">S'</span><span class="main">,</span> <span class="bound">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟶</span> <span class="bound">S'</span><span class="main">,</span> <span class="bound">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> mehorder<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">Γ</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Resolution_LSC_pre<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">,</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S'</span></span> <span class="skolem"><span class="skolem">R'</span></span> <span class="keyword2"><span class="keyword">where</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Γ</span><span class="main">.</span> is_nnf_mset <span class="bound">Γ</span> <span class="main">⟹</span> set <span class="skolem">R'</span> <span class="main">=</span> <span class="free">R</span> <span class="main">∧</span> set <span class="main">(</span>map set <span class="skolem">S'</span><span class="main">)</span> <span class="main">=</span> <span class="free">S</span> <span class="main">∧</span> 
  <span class="main">(</span>disj_of_clause <span class="skolem">R'</span><span class="main">,</span> image_mset disj_of_clause <span class="main">(</span>mset <span class="skolem">S'</span><span class="main">)</span> <span class="main">+</span> <span class="bound">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟶</span> image_mset disj_of_clause <span class="main">(</span>mset <span class="skolem">S'</span><span class="main">)</span> <span class="main">+</span> <span class="bound">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"is_nnf_mset <span class="skolem">Γ</span> <span class="main">⟹</span> <span class="main">(</span>disj_of_clause <span class="skolem">R'</span><span class="main">,</span> image_mset disj_of_clause <span class="main">(</span>mset <span class="skolem">S'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> image_mset disj_of_clause <span class="main">(</span>mset <span class="skolem">S'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="hidden">❙</span><b>⋀</b></span></span>map disj_of_clause <span class="skolem"><span class="skolem">S'</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"disj_of_clause <span class="skolem"><span class="skolem">R'</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> disj_of_clause_is<span class="main"><span class="keyword3">;</span></span><span class="operator">fail</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cnf_disj o<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> o <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cnf_BigAnd cnf_disj<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> Γ
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> p<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> mehorder<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> LSC_BigAndL_inv<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span><span class="operator">fail</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LSC_BigAndL<span class="main">)</span>     
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Resolution_LSC1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">F</span><span class="main">.</span> is_nnf <span class="bound">F</span> <span class="main">∧</span> cnf <span class="bound">F</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">{#</span><span class="bound">F</span><span class="main">#}</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">f</span> <span class="main">∪</span> <span class="bound">g</span> <span class="main">|</span><span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">∧</span> <span class="bound">g</span> <span class="main">∈</span> <span class="skolem">G</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">□</span><span class="main">}</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main">=</span> <span class="main">{</span><span class="main">□</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">f</span> <span class="main">∪</span> <span class="bound">g</span> <span class="main">|</span><span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">∧</span> <span class="bound">g</span> <span class="main">∈</span> <span class="skolem">G</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">□</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">≠</span> <span class="main">{</span><span class="main">□</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">E</span><span class="main">.</span> <span class="bound">E</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">∧</span> <span class="bound">E</span> <span class="main">≠</span> <span class="main">□</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> m <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">E</span><span class="main">.</span> <span class="bound">E</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">∧</span> <span class="bound">E</span> <span class="main">≠</span> <span class="main">□</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> E <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">note</span></span> E <span class="main">=</span> this
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> m <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> E <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">∪</span> <span class="skolem">D</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">f</span> <span class="main">∪</span> <span class="bound">g</span> <span class="main">|</span><span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">∧</span> <span class="bound">g</span> <span class="main">∈</span> <span class="skolem">G</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> m E <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">{</span><span class="main">□</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">G</span> <span class="main">=</span> <span class="main">{</span><span class="main">□</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">f</span> <span class="main">∪</span> <span class="bound">g</span> <span class="main">|</span><span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">∧</span> <span class="bound">g</span> <span class="main">∈</span> <span class="skolem">G</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">□</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> <span class="main">{</span><span class="main">□</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> *<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">G</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">F</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> that<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> *<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"is_nnf <span class="skolem">F</span> <span class="main">⟹</span> is_nnf_mset <span class="skolem">Γ</span> <span class="main">⟹</span> cnf <span class="skolem">F</span> <span class="main">=</span> <span class="main">{</span><span class="main">□</span><span class="main">}</span> <span class="main">⟹</span> <span class="skolem">F</span><span class="main">,</span><span class="skolem">Γ</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">Γ</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">F</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> cnf.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> LSC.LSC.AndL LSC_weaken add_mset_commute singleton_Un_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> *<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LSC.LSC.OrL<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">from</span></span> Resolution_useless_infinite<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S'</span></span> <span class="keyword2"><span class="keyword">where</span></span> su<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S'</span><span class="main">⊆</span><span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S'</span>"</span></span> <span class="quoted"><span class="quoted">"Ball <span class="skolem">S'</span> finite"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">S'</span> <span class="main">⊢</span> <span class="main">□</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> Resolution_LSC_pre_nodisj<span class="main">[</span><span class="operator">OF</span> pr finite.emptyI fin<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_nnf <span class="skolem">S''</span>"</span></span> <span class="quoted"><span class="quoted">"cnf <span class="skolem">S''</span> <span class="main">⊆</span> <span class="skolem">S'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#</span> <span class="skolem">S''</span> <span class="main">#}</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">OF</span> disj_is_nnf<span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted">Mempty</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LSC_weaken add_mset_commute empty_iff set_mset_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> su <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Resolution_SC1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">F</span><span class="main">.</span> cnf <span class="main">(</span>nnf <span class="bound">F</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">{#</span><span class="bound">F</span><span class="main">#}</span> <span class="main">⇒</span> <span class="main">{#}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> Resolution_LSC1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> ex_forward<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> conjE<span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> is_nnf_nnf_id<span class="main"><span class="keyword3">;</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> SC_LSC<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span><span class="operator">fail</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="comment1">(* really, these proofs have to do with sets, multisets and lists.
If I'd introduce finite sets somehow, the chaos would be perfect.
I want out.
*)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ND_FiniteAssms">
<div class="head">
<h1>Theory ND_FiniteAssms</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> ND_FiniteAssms
<span class="keyword2"><span class="keyword">imports</span></span> <a href="ND.html">ND</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="ND_FiniteAssms-ND_finite_assms"><span class="command">lemma</span></span> ND_finite_assms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">F</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">Γ'</span><span class="main">.</span> <span class="bound">Γ'</span> <span class="main">⊆</span> <span class="free">Γ</span> <span class="main">∧</span> finite <span class="bound">Γ'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">Γ'</span> <span class="main">⊢</span> <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ND.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ax <span class="skolem">F</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">F</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ND.Ax<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AndI <span class="skolem">Γ</span> <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> AndI.IH<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Γ1 <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> AndI.IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Γ2 <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">Γ1</span></span></span><span class="main"><span class="main"><span class="main">∪</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">Γ2</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Weaken <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ND.AndI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>CC <span class="skolem">F</span> <span class="skolem">Γ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> CC.IH <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Γ' <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">note</span></span> Γ' <span class="main">=</span> this
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Not <span class="skolem">F</span> <span class="main">∈</span> <span class="skolem">Γ'</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹case distinction: Did we actually use <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="hidden">❙</span><b>¬</b></span></span><span class="skolem"><span class="skolem">F</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>?›</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">⊆</span> <span class="skolem">Γ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Γ' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> Γ' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> BotE <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">Γ'</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">F</span><span class="main">▹</span><span class="skolem">Γ''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">F</span> <span class="main">∉</span> <span class="skolem">Γ''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Set.set_insert<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ''</span> <span class="main">⊆</span> <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Γ''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">F</span><span class="main">▹</span><span class="skolem">Γ''</span> <span class="main">⊢</span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Γ' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ND.CC <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> AndE1 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ND.AndE1<span class="main">)</span> <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> AndE2 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ND.AndE2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> OrI1 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ND.OrI1<span class="main">)</span> <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> OrI2 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ND.OrI2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrE <span class="skolem">Γ</span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> OrE.IH<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Γ1 <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> OrE.IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Γ2 <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> OrE.IH<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Γ3 <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> calculation this
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ1</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">Γ2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">F</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">Γ3</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">G</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span> <span class="main">⊢</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Weaken<span class="main">[</span><span class="operator">OF</span> _ sup_ge1<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">▹</span><span class="var">?w</span> <span class="main">⊢</span> <span class="skolem">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">▹</span><span class="var">?w</span> <span class="main">⊢</span> <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Weaken <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_commute Un_insert_right Un_upper1 Weaken insert_Diff_single<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span> <span class="main">⊢</span> <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ND.OrE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var"><span class="var">?w</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Clever evasion of the case distinction made for CC.›</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpI <span class="skolem">F</span> <span class="skolem">Γ</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ImpI.IH <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Γ' <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">Γ'</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">{</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">F</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Weaken <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ND.ImpI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpE <span class="skolem">Γ</span> <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ImpE.IH<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Γ1 <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> ImpE.IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Γ2 <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">Γ1</span></span></span> <span class="main"><span class="main"><span class="main">∪</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">Γ2</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Weaken <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ND.ImpE<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> F<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">F</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotE <span class="skolem">Γ</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> NotE.IH<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Γ1 <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> NotE.IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Γ2 <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">Γ1</span></span></span> <span class="main"><span class="main"><span class="main">∪</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">Γ2</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Weaken <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ND.NotE<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> F<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">F</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotI <span class="skolem">F</span> <span class="skolem">Γ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> NotI.IH <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> Γ' <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">Γ'</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">{</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">F</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Weaken <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ND.NotI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> F<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">F</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We thought that a lemma like this would be necessary for the ND completeness by SC completeness proof
  (this lemma shows that if we made an ND proof, we can always limit ourselves to a finite set of assumptions --
   and thus put all the assumptions into one formula).
That is not the case, since in the completeness proof,
we assume a valid entailment and have to show (the existence of) a derivation.
The author hopes that his misunderstanding can help the reader's understanding.›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> ND_no_assms<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">Γ'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"set <span class="free">Γ'</span> <span class="main">⊆</span> <span class="free">Γ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">{}</span> <span class="main">⊢</span> <span class="main"><span class="hidden">❙</span><b>⋀</b></span><span class="free">Γ'</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">from</span></span> ND_finite_assms<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span><span class="main">⊆</span><span class="free">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">⊢</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Γ'</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> Γ'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">=</span> set <span class="skolem">G</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> finite_list <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Γ'</span><span class="main">⊆</span><span class="free">Γ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">G</span> <span class="main">⊆</span> <span class="free">Γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Γ'</span> <span class="main">⊢</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊢</span> <span class="main"><span class="hidden">❙</span><b>⋀</b></span> <span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Γ' AssmBigAnd <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> 1<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Γ'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">G</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ND_Compl_SC">
<div class="head">
<h1>Theory ND_Compl_SC</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹An alternate proof of ND completeness›</span></span>
<span class="keyword1"><span class="command">theory</span></span> ND_Compl_SC
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SC_Sema.html">SC_Sema</a> <a href="ND_Sound.html">ND_Sound</a> <a href="SCND.html">SCND</a> <a href="Compactness.html">Compactness</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="ND_Compl_SC-ND_sound_complete_countable"><span class="command">lemma</span></span> ND_sound_complete_countable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Γ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> countable formula set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">F</span> <span class="main">⟷</span> <span class="free">Γ</span> <span class="main">⊫</span> <span class="free">F</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n</span> <span class="main">⟷</span> <span class="var">?s</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> ND_sound<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span>
  <span class="keyword1"><span class="command">with</span></span> compact_entailment <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">⊫</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">⊆</span> <span class="free">Γ</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> entailment_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ''</span></span> <span class="keyword2"><span class="keyword">where</span></span> Γ''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">=</span> set_mset <span class="skolem">Γ''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_set_mset_mset_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> su<span class="main">:</span> <span class="quoted"><span class="quoted">"set_mset <span class="skolem">Γ''</span> <span class="main">⊆</span> <span class="free">Γ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 0  Γ'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> 0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="skolem">Γ''</span> <span class="main">⇒</span> <span class="main">{#</span><span class="free">F</span><span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sequent_semantics_def entailment_def Γ'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> SC_sound_complete <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ''</span> <span class="main">⇒</span> <span class="main">{#</span><span class="free">F</span><span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> SCND <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="skolem">Γ''</span> <span class="main">∪</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">`</span> set_mset <span class="main">{#</span><span class="free">F</span><span class="main">#}</span> <span class="main">⊢</span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="keyword1"><span class="command">using</span></span> ND.CC Weaken<span class="main">[</span><span class="operator">OF</span> _ su<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> insert_mono<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹If you do not like the requirement that our atoms are countable,
you can also restrict yourself to a finite set of assumptions.›</span></span>
  
<span class="keyword1" id="ND_Compl_SC-ND_sound_complete_finite"><span class="command">lemma</span></span> ND_sound_complete_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">Γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">F</span> <span class="main">⟷</span> <span class="free">Γ</span> <span class="main">⊫</span> <span class="free">F</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n</span> <span class="main">⟷</span> <span class="var">?s</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> ND_sound<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ''</span></span> <span class="keyword2"><span class="keyword">where</span></span> Γ''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">=</span> set_mset <span class="skolem">Γ''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_set_mset_mset_set assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> su<span class="main">:</span> <span class="quoted"><span class="quoted">"set_mset <span class="skolem">Γ''</span> <span class="main">⊆</span> <span class="free">Γ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Γ'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="skolem">Γ''</span> <span class="main">⇒</span> <span class="main">{#</span><span class="free">F</span><span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">unfolding</span></span> sequent_semantics_def entailment_def Γ'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> SC_sound_complete <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ''</span> <span class="main">⇒</span> <span class="main">{#</span><span class="free">F</span><span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> SCND <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="skolem">Γ''</span> <span class="main">∪</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">`</span> set_mset <span class="main">{#</span><span class="free">F</span><span class="main">#}</span> <span class="main">⊢</span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="keyword1"><span class="command">using</span></span> ND.CC Weaken<span class="main">[</span><span class="operator">OF</span> _ su<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> insert_mono<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Resolution_Compl_SC_Small">
<div class="head">
<h1>Theory Resolution_Compl_SC_Small</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Resolution_Compl_SC_Small
<span class="keyword2"><span class="keyword">imports</span></span> <a href="LSC_Resolution.html">LSC_Resolution</a> <a href="Resolution.html">Resolution</a> <a href="SC_Sema.html">SC_Sema</a> <a href="CNF_Formulas_Sema.html">CNF_Formulas_Sema</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* if you think that cnf transformation of LSC and Compactness are funky, this is the proof for you. *)</span>
<span class="keyword1" id="Resolution_Compl_SC_Small-Resolution_complete'"><span class="command">lemma</span></span> Resolution_complete'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> val<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊫</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span><span class="main">(</span>cnf <span class="main">∘</span> nnf<span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span><span class="main">}</span> <span class="main">∪</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> fin <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S'</span></span> <span class="keyword2"><span class="keyword">where</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> set_mset <span class="skolem">S'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_set_mset_mset_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> cnf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> set_mset <span class="main">(</span>image_mset <span class="main">(</span>cnf_form_of <span class="main">∘</span> nnf<span class="main">)</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span><span class="main">,</span> <span class="skolem">S'</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> is_cnf <span class="bound">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cnf_form_of_is is_nnf_nnf<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> entailment_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> val
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊫</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊫</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span>nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nnf_semantics<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊫</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span>cnf_form_of <span class="main">(</span>nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cnf_form_semantics<span class="main"><span class="main">[</span></span><span class="operator">OF</span> is_nnf_nnf<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="main">(</span>image_mset nnf <span class="skolem">S'</span><span class="main">)</span> <span class="main">⊫</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span>cnf_form_of <span class="main">(</span>nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nnf_semantics<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="main">(</span>image_mset <span class="main">(</span>cnf_form_of <span class="main">∘</span> nnf<span class="main">)</span> <span class="skolem">S'</span><span class="main">)</span> <span class="main">⊫</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span>cnf_form_of <span class="main">(</span>nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cnf_form_semantics<span class="main"><span class="main">[</span></span><span class="operator">OF</span> is_nnf_nnf<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="main">(</span>cnf_form_of <span class="main">∘</span> nnf<span class="main">)</span> <span class="skolem">S'</span> <span class="main">⇒</span> <span class="main">{#</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span>cnf_form_of <span class="main">(</span>nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">#}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> SC_sound_complete sequent_intuitonistic_semantics <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="main">(</span>cnf_form_of <span class="main">∘</span> nnf<span class="main">)</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span><span class="main">,</span> <span class="skolem">S'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">{#}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> NotR_inv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="main">(</span>cnf_form_of <span class="main">∘</span> nnf<span class="main">)</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span><span class="main">,</span> <span class="skolem">S'</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SC_LSC is_nnf_nnf nnf_cnf_form<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> CSC_Resolution_pre <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>cnf <span class="main">`</span> set_mset <span class="main">(</span>image_mset <span class="main">(</span>cnf_form_of <span class="main">∘</span> nnf<span class="main">)</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span><span class="main">,</span> <span class="skolem">S'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> cnf <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> cnf_cnf<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">,</span> <span class="operator">OF</span> is_nnf_nnf<span class="main">]</span> 
               <span class="keyword1"><span class="command">unfolding</span></span> set_image_mset image_comp comp_def S <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Resolution_complete_single<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cnf <span class="main">(</span>nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Resolution_complete'<span class="main">[</span><span class="operator">OF</span> finite.emptyI<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">F</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">unfolding</span></span> entailment_def comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="comment1">(* the interesting thing that I want to state with this lemma (although much weaker than Resolution_complete (yes, the one from the other file without the '))
   is that you can prove all these things relatively easily. You don't need complicated things like compactness or that CNF transformation.
   (I did not feel like separating "that CNF transformation" into different files, so you'll either have to believe me
    or stare at the used lemmas and simp sets, etc. very intensely. *)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Resolution_Compl_SC_Full">
<div class="head">
<h1>Theory Resolution_Compl_SC_Full</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Resolution_Compl_SC_Full
<span class="keyword2"><span class="keyword">imports</span></span> <a href="LSC_Resolution.html">LSC_Resolution</a> <a href="Resolution.html">Resolution</a> <a href="SC_Sema.html">SC_Sema</a> <a href="Compactness.html">Compactness</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Resolution_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> countable formula set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> val<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊫</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span><span class="main">(</span>cnf <span class="main">∘</span> nnf<span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span><span class="main">}</span> <span class="main">∪</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span>
  <span class="comment1">(* look: S may be infinite. *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mun</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">⋃</span><span class="main">(</span><span class="main">(</span>cnf <span class="main">∘</span> nnf<span class="main">)</span> <span class="main">`</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="comment1">(* note: there's an alternate version of this proof with CSC_Resolution_pre and the CNF_Semantics *)</span>
  <span class="keyword1"><span class="command">from</span></span> compact_entailment<span class="main">[</span><span class="operator">OF</span> val<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S''</span></span> <span class="keyword2"><span class="keyword">where</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> su<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S''</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> val'<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">S''</span> <span class="main">⊫</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> fin <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S'</span></span> <span class="keyword2"><span class="keyword">where</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S''</span> <span class="main">=</span> set_mset <span class="skolem">S'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_set_mset_mset_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> cnf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> set_mset <span class="main">(</span>image_mset <span class="main">(</span>cnf_form_of <span class="main">∘</span> nnf<span class="main">)</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span><span class="main">,</span> <span class="skolem">S'</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> is_cnf <span class="bound">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cnf_form_of_is is_nnf_nnf<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> entailment_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> val' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S''</span> <span class="main">⊫</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S'</span> <span class="main">⇒</span> <span class="main">{#</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span><span class="main">)</span><span class="main">#}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> SC_sound_complete sequent_intuitonistic_semantics S <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span><span class="main">,</span> <span class="skolem">S'</span> <span class="main">⇒</span> <span class="main">{#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NotR_inv<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"image_mset nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span><span class="main">,</span> <span class="skolem">S'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">{#}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> LSC_NNF SC_LSC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"image_mset nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free">F</span><span class="main">,</span> <span class="skolem">S'</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SC_LSC is_nnf_nnf<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> LSC_Resolution <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>cnf <span class="main">`</span> nnf <span class="main">`</span> set_mset <span class="main">(</span>image_mset nnf <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span><span class="main">,</span> <span class="skolem">S'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span>  <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?mun</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">F</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">S''</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">□</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> set_image_mset image_comp comp_def S is_nnf_nnf_id<span class="main">[</span><span class="operator">OF</span> is_nnf_nnf<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> Resolution_weaken<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?mun</span> <span class="free">S</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> su <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UN_Un Un_left_commute sup.order_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="MiniSC">
<div class="head">
<h1>Theory MiniSC</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹SC and Implication-only formulas›</span></span>
<span class="keyword1"><span class="command">theory</span></span> MiniSC
<span class="keyword2"><span class="keyword">imports</span></span> <a href="MiniFormulas.html">MiniFormulas</a> <a href="SC.html">SC</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_mini_mset</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> set_mset <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">.</span> is_mini_formula <span class="bound">F</span>"</span></span>
<span class="keyword1" id="MiniSC-to_mini_mset_is"><span class="command">lemma</span></span> to_mini_mset_is<span class="main">:</span> <span class="quoted"><span class="quoted">"is_mini_mset <span class="main">(</span>image_mset to_mini_formula <span class="free">Γ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="MiniSC-SC_full_to_mini"><span class="command">lemma</span></span> SC_full_to_mini<span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="main">≡</span> image_mset to_mini_formula"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">tms</span> <span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> tmsi<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span><span class="skolem">S</span><span class="main">)</span> <span class="main">=</span> to_mini_formula <span class="skolem">F</span><span class="main">,</span> <span class="free">tms</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">S</span> <span class="keyword1"><span class="command">unfolding</span></span> tms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> asm <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>BotL <span class="skolem">Γ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">∈#</span> <span class="free">tms</span> <span class="skolem">Γ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCp.BotL <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ax <span class="skolem">k</span> <span class="skolem">Γ</span> <span class="skolem">Δ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span> <span class="main">∈#</span> <span class="free">tms</span> <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span> <span class="main">∈#</span> <span class="free">tms</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tms_def <span class="keyword1"><span class="command">using</span></span> image_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCp.Ax<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotR <span class="skolem">F</span> <span class="skolem">Γ</span> <span class="skolem">Δ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> tmsi to_mini_formula.simps
      <span class="keyword1"><span class="command">using</span></span> weakenR SCp.ImpR <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NotL <span class="skolem">Γ</span> <span class="skolem">F</span> <span class="skolem">Δ</span><span class="main">)</span> <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.ImpL<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> ImpR <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCp.ImpR <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> ImpL <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCp.ImpL <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> AndR <span class="keyword1"><span class="command">from</span></span> AndR<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> weakenR <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.ImpR SCp.ImpL<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> AndL <span class="keyword1"><span class="command">from</span></span> AndL<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> weakenR<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.ImpR SCp.ImpL<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> OrR <span class="keyword1"><span class="command">from</span></span> OrR<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> weakenR <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.ImpR SCp.ImpL<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrL <span class="skolem">F</span> <span class="skolem">Γ</span> <span class="skolem">Δ</span> <span class="skolem">G</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> SCp.ImpL
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_mini_formula <span class="skolem">F</span><span class="main">,</span> <span class="free">tms</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="free">tms</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  OrL<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> tmsi<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> weakenR <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_mini_formula <span class="skolem">F</span><span class="main">,</span> <span class="free">tms</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">,</span> <span class="free">tms</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="comment1">(* sooo close. *)</span>
      <span class="keyword1"><span class="command">with</span></span> SCp.ImpR <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="skolem">Γ</span> <span class="main">⇒</span> to_mini_formula <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">,</span> <span class="free">tms</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_mini_formula <span class="skolem">G</span><span class="main">,</span> <span class="free">tms</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="free">tms</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">tms</span> <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">tms</span> <span class="skolem">Δ</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tmsi <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>to_mini_formula <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> to_mini_formula <span class="skolem">G</span><span class="main">,</span> <span class="free">tms</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="free">tms</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> tmsi to_mini_formula.simps <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="MiniSC-SC_mini_to_full"><span class="command">lemma</span></span> SC_mini_to_full<span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="main">≡</span> image_mset to_mini_formula"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">tms</span> <span class="free">Δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> tmsi<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span><span class="skolem">S</span><span class="main">)</span> <span class="main">=</span> to_mini_formula <span class="skolem">F</span><span class="main">,</span> <span class="free">tms</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">S</span> <span class="keyword1"><span class="command">unfolding</span></span> tms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">note</span></span> ImpL_inv ImpR_inv<span class="main">[</span><span class="operator">dest</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="main">(</span><span class="main">λ</span><span class="bound">F</span> <span class="bound">G</span><span class="main">.</span> Not <span class="bound">F</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> Or"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> And"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">F</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">S'</span> <span class="main">=</span> <span class="free">tms</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">S</span> <span class="skolem">S'</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> that is_mini_formula.simps<span class="main"><span class="main">(</span></span>4-6<span class="main"><span class="main">)</span></span> msed_map_invR tms_def to_mini_is_mini union_commute<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">note</span></span> dr <span class="main">=</span> no<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">F</span> <span class="bound">G</span><span class="main">.</span> Not <span class="bound">F</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">dest</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
            no<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted">Or</span><span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">dest</span><span class="main"><span class="main">!</span></span><span class="main">]</span> 
            no<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted">And</span><span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">dest</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> whai<span class="comment1">(* we have an implication *)</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
    <span class="main">(</span><span class="main">∃</span><span class="bound">S2</span> <span class="bound">H</span> <span class="bound">J</span><span class="main">.</span> <span class="skolem">S</span> <span class="main">=</span> <span class="bound">H</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="bound">J</span><span class="main">,</span> <span class="bound">S2</span> <span class="main">∧</span> <span class="skolem">F</span> <span class="main">=</span> to_mini_formula <span class="bound">H</span> <span class="main">∧</span> <span class="skolem">G</span> <span class="main">=</span> to_mini_formula <span class="bound">J</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">S2</span> <span class="bound">H</span> <span class="bound">J</span><span class="main">.</span> <span class="skolem">S</span> <span class="main">=</span> <span class="bound">H</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="bound">J</span><span class="main">,</span> <span class="bound">S2</span> <span class="main">∧</span> <span class="skolem">F</span> <span class="main">=</span> <span class="main">(</span>to_mini_formula <span class="bound">H</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">G</span> <span class="main">=</span> to_mini_formula <span class="bound">J</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">S2</span> <span class="bound">H</span> <span class="bound">J</span><span class="main">.</span> <span class="skolem">S</span> <span class="main">=</span> <span class="bound">H</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="bound">J</span><span class="main">,</span> <span class="bound">S2</span> <span class="main">∧</span> <span class="skolem">F</span> <span class="main">=</span>  to_mini_formula <span class="bound">H</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> to_mini_formula <span class="bound">J</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span> <span class="main">∧</span> <span class="skolem">G</span> <span class="main">=</span> <span class="main">⊥</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">S2</span> <span class="bound">H</span><span class="main">.</span> <span class="skolem">S</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="bound">H</span><span class="main">,</span> <span class="bound">S2</span> <span class="main">∧</span> <span class="skolem">F</span> <span class="main">=</span> to_mini_formula <span class="bound">H</span> <span class="main">∧</span> <span class="skolem">G</span> <span class="main">=</span> <span class="main">⊥</span><span class="main">)</span>
  "</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">S1</span> <span class="main">=</span> <span class="free">tms</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">S1</span> <span class="skolem">S</span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> <span class="comment1">(* ohno… *)</span>
    <span class="keyword1"><span class="command">note</span></span> that<span class="main">[</span><span class="operator">unfolded</span> tms_def<span class="main">]</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S2</span></span> <span class="skolem"><span class="skolem">pim</span></span> <span class="keyword2"><span class="keyword">where</span></span> S2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S1</span> <span class="main">=</span> image_mset to_mini_formula <span class="skolem">S2</span>"</span></span>
                        <span class="keyword2"><span class="keyword">and</span></span>   S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="skolem">pim</span><span class="main">,</span> <span class="skolem">S2</span>"</span></span>
                        <span class="keyword2"><span class="keyword">and</span></span> pim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span> <span class="main">=</span> to_mini_formula <span class="skolem">pim</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> msed_map_invR union_commute<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> pim <span class="keyword1"><span class="command">unfolding</span></span> S <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">pim</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> asm <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="free">Γ</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="free">Δ</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="free">Δ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"to_mini_formula <span class="skolem">F</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> BotL <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> tms_def <span class="keyword1"><span class="command">using</span></span> * SCp.BotL <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_iff multiset.set_map<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span> <span class="main">=</span> to_mini_formula <span class="skolem">F</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main">=</span> Atom <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="skolem">k</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ax _ <span class="skolem">k</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> tms_def <span class="keyword1"><span class="command">unfolding</span></span> in_image_mset Set.image_iff
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> bexE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> *<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> SCp.Ax<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpL <span class="skolem">Γ'</span> <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> whai<span class="main">[</span><span class="operator">OF</span> ImpL<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> disjE exE conjE<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S2</span> <span class="skolem">H</span> <span class="skolem">J</span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">J</span><span class="main">,</span> <span class="skolem">S2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> to_mini_formula <span class="skolem">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> to_mini_formula <span class="skolem">J</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">=</span> <span class="free">tms</span> <span class="skolem">S2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="free">tms</span> <span class="skolem">Δ</span> <span class="main">=</span> <span class="free">tms</span> <span class="main">(</span><span class="skolem">H</span><span class="main">,</span><span class="skolem">Δ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">=</span> <span class="free">tms</span> <span class="main">(</span><span class="skolem">J</span><span class="main">,</span> <span class="skolem">S2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="skolem">Δ</span> <span class="main">=</span> <span class="free">tms</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ImpL.hyps<span class="main">(</span>5<span class="main">)</span> add_left_imp_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> ImpL<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> ImpL<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCp.ImpL <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S2</span> <span class="skolem">H</span> <span class="skolem">J</span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">J</span><span class="main">,</span> <span class="skolem">S2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> to_mini_formula <span class="skolem">H</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> to_mini_formula <span class="skolem">J</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">=</span> <span class="free">tms</span> <span class="skolem">S2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="free">tms</span> <span class="skolem">Δ</span> <span class="main">=</span> <span class="free">tms</span> <span class="main">(</span><span class="skolem">H</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">,</span><span class="skolem">Δ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">=</span> <span class="free">tms</span> <span class="main">(</span><span class="skolem">J</span><span class="main">,</span> <span class="skolem">S2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="skolem">Δ</span> <span class="main">=</span> <span class="free">tms</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ImpL.hyps<span class="main">(</span>5<span class="main">)</span> add_left_imp_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> ImpL<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> ImpL<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Bot_delR <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.OrL <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ImpR_inv <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S2</span> <span class="skolem">H</span> <span class="skolem">J</span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">J</span><span class="main">,</span> <span class="skolem">S2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> to_mini_formula <span class="skolem">H</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> to_mini_formula <span class="skolem">J</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">=</span> <span class="free">tms</span> <span class="skolem">S2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="free">tms</span> <span class="skolem">Δ</span> <span class="main">=</span> <span class="free">tms</span> <span class="main">(</span><span class="skolem">H</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">J</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">,</span><span class="skolem">Δ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">=</span> <span class="free">tms</span> <span class="main">(</span><span class="main">⊥</span><span class="main">,</span> <span class="skolem">S2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="skolem">Δ</span> <span class="main">=</span> <span class="free">tms</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ImpL.hyps<span class="main">(</span>5<span class="main">)</span> add_left_imp_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> ImpL<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Bot_delR SCp.AndL ImpR_inv * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_mset_remove_trivial inL1<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S2</span> <span class="skolem">H</span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">S2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> to_mini_formula <span class="skolem">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">=</span> <span class="free">tms</span> <span class="skolem">S2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="free">tms</span> <span class="skolem">Δ</span> <span class="main">=</span> <span class="free">tms</span> <span class="main">(</span><span class="skolem">H</span><span class="main">,</span><span class="skolem">Δ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">=</span> <span class="free">tms</span> <span class="main">(</span><span class="main">⊥</span><span class="main">,</span> <span class="skolem">S2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="skolem">Δ</span> <span class="main">=</span> <span class="free">tms</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ImpL.hyps<span class="main">(</span>5<span class="main">)</span> add_left_imp_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> ImpL<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.NotL <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ImpR_inv <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpR <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">Δ'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> whai<span class="main">[</span><span class="operator">OF</span> ImpR<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> disjE  exE conjE<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S2</span> <span class="skolem">H</span> <span class="skolem">J</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">J</span><span class="main">,</span> <span class="skolem">S2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> to_mini_formula <span class="skolem">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> to_mini_formula <span class="skolem">J</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ImpR.hyps<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.ImpR<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S2</span> <span class="skolem">H</span> <span class="skolem">J</span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="skolem">J</span><span class="main">,</span> <span class="skolem">S2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> to_mini_formula <span class="skolem">H</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> to_mini_formula <span class="skolem">J</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ'</span> <span class="main">=</span> <span class="free">tms</span> <span class="skolem">S2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="free">tms</span> <span class="skolem">Δ</span> <span class="main">=</span> <span class="free">tms</span> <span class="main">(</span><span class="skolem">H</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">,</span><span class="skolem">Δ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ'</span> <span class="main">=</span> <span class="free">tms</span> <span class="main">(</span><span class="skolem">J</span><span class="main">,</span> <span class="skolem">S2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="skolem">Δ</span> <span class="main">=</span> <span class="free">tms</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ImpR.hyps<span class="main">(</span>3<span class="main">)</span> add_left_imp_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> SCp.OrR<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span> * ImpR.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NotL_inv<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> botoff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">H</span><span class="main">,</span> <span class="main">⊥</span><span class="main">,</span> <span class="skolem">S2</span> <span class="main">⟹</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">S2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span> <span class="skolem">H</span> <span class="skolem">S2</span> <span class="keyword1"><span class="command">using</span></span> Bot_delR <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S2</span> <span class="skolem">H</span> <span class="skolem">J</span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">J</span><span class="main">,</span> <span class="skolem">S2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> to_mini_formula <span class="skolem">H</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> to_mini_formula <span class="skolem">J</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="free">tms</span> <span class="skolem">Γ</span> <span class="main">=</span> <span class="free">tms</span> <span class="main">(</span><span class="skolem">H</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">J</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ'</span> <span class="main">=</span> <span class="free">tms</span> <span class="main">(</span><span class="main">⊥</span><span class="main">,</span> <span class="skolem">S2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ImpR.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="comment1">(* hm, not optimal that we need mini_mini… *)</span>
      <span class="keyword1"><span class="command">from</span></span> ImpR<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> * <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ImpL_inv botoff<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>  
      <span class="comment1">(* verbose version *)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S2</span> <span class="skolem">H</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">S2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> to_mini_formula <span class="skolem">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S2</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">S2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> to_mini_formula <span class="skolem">H</span> <span class="main">∧</span> <span class="skolem">G</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="free">tms</span> <span class="skolem">Γ</span> <span class="main">=</span> <span class="free">tms</span> <span class="main">(</span><span class="skolem">H</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ'</span> <span class="main">=</span> <span class="free">tms</span> <span class="main">(</span><span class="main">⊥</span><span class="main">,</span> <span class="skolem">S2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ImpR<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">with</span></span> ImpR<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">,</span> <span class="skolem">S2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">H</span><span class="main">,</span> <span class="skolem">S2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> SCp.NotR Bot_delR <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> MiniSC_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset to_mini_formula <span class="free">Γ</span> <span class="main">⇒</span> image_mset to_mini_formula <span class="free">Δ</span> <span class="main">⟷</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> SC_mini_to_full SC_full_to_mini <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="MiniSC_HC">
<div class="head">
<h1>Theory MiniSC_HC</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹SC to HC›</span></span>
<span class="keyword1"><span class="command">theory</span></span> MiniSC_HC
<span class="keyword2"><span class="keyword">imports</span></span> <a href="MiniSC.html">MiniSC</a> <a href="HC.html">HC</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">AX1</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∈</span> AX0 <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∈</span> <span class="free">AX1</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∈</span> <span class="free">AX1</span>"</span></span>
<span class="keyword1" id="MiniSC_HC-AX01"><span class="command">lemma</span></span> AX01<span class="main">:</span> <span class="quoted"><span class="quoted">"AX0 <span class="main">⊆</span> AX1"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AX1.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subsetI<span class="main">)</span>
<span class="keyword1" id="MiniSC_HC-AX1_away"><span class="command">lemma</span></span> AX1_away<span class="main">:</span> <span class="quoted"><span class="quoted">"AX1 <span class="main">∪</span> <span class="free">Γ</span> <span class="main">=</span> AX0 <span class="main">∪</span> <span class="main">(</span><span class="free">Γ</span> <span class="main">∪</span> AX1<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> AX01 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="MiniSC_HC-Deduction1"><span class="command">lemma</span></span> Deduction1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">▹</span> <span class="main">(</span>AX1 <span class="main">∪</span> <span class="free">Γ</span> <span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="main">(</span>AX1 <span class="main">∪</span> <span class="free">Γ</span><span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> AX1_away <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Deduction_theorem HC.simps HC_mono Un_commute Un_insert_left insertI1 subset_insertI<span class="main">)</span>
<span class="keyword1" id="MiniSC_HC-Deduction2"><span class="command">lemma</span></span> Deduction2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main">▹</span> <span class="main">(</span>AX1 <span class="main">∪</span> <span class="free">Γ</span><span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="main">(</span>AX1 <span class="main">∪</span> <span class="free">Γ</span><span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="free">F</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟷</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> l<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">with</span></span> Deduction_theorem<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Γ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"AX1 <span class="main">∪</span> <span class="free">Γ</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> F<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> G<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">⊥</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"AX1 <span class="main">∪</span> <span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> AX1_away <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"AX1 <span class="main">∪</span> <span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> AX1.intros<span class="main">(</span>2<span class="main">)</span> HC.Ax <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">using</span></span> HC.MP <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> HC.simps HC_mono insertI1 subset_insertI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">⟹</span> is_mini_mset <span class="free">Γ</span> <span class="main">⟹</span> is_mini_mset <span class="free">Δ</span> <span class="main">⟹</span>
  <span class="main">(</span>set_mset <span class="free">Γ</span> <span class="main">∪</span> <span class="main">(</span><span class="main">λ</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main">`</span> set_mset <span class="free">Δ</span> <span class="main">∪</span> AX1<span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpL <span class="skolem">Γ</span> <span class="skolem">F</span> <span class="skolem">Δ</span> <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ImpL.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_mini_mset <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"is_mini_mset <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> ImpL.IH<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> IH1<span class="main">:</span> <span class="quoted"><span class="quoted">"set_mset <span class="skolem">Γ</span> <span class="main">∪</span> <span class="main">(</span><span class="main">λ</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main">`</span> set_mset <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∪</span> AX1 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> IH1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span> <span class="main">▹</span> set_mset <span class="skolem">Γ</span> <span class="main">∪</span> <span class="main">(</span><span class="main">λ</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main">`</span> set_mset <span class="skolem">Δ</span> <span class="main">∪</span> AX1 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> ImpL.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_mini_mset <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"is_mini_mset <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> ImpL.IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> IH2<span class="main">:</span> <span class="quoted"><span class="quoted">"set_mset <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">λ</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main">`</span> set_mset <span class="skolem">Δ</span> <span class="main">∪</span> AX1 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> IH2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">▹</span> <span class="main">(</span>set_mset <span class="skolem">Γ</span> <span class="main">∪</span> <span class="main">(</span><span class="main">λ</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main">`</span> set_mset <span class="skolem">Δ</span> <span class="main">∪</span> AX1<span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span> <span class="main">▹</span> AX1 <span class="main">∪</span> <span class="skolem">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">▹</span> AX1 <span class="main">∪</span> <span class="skolem">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span> <span class="main">▹</span> AX1 <span class="main">∪</span> <span class="skolem">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span> 
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ax Deduction1 Deduction2 HC_mono MP insertI1 subset_insertI<span class="main">)</span>
    <span class="comment1">(* I don't construct the actual proofs for the Rs. Sledgehammer is doing all the interesting work. :/ *)</span>
  <span class="keyword1"><span class="command">from</span></span> R<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Γ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"set_mset <span class="skolem">Γ</span> <span class="main">∪</span> <span class="main">(</span><span class="main">λ</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main">`</span> set_mset <span class="skolem">Δ</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span> <span class="main">▹</span> <span class="main">(</span>set_mset <span class="skolem">Γ</span> <span class="main">∪</span> <span class="main">(</span><span class="main">λ</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main">`</span> set_mset <span class="skolem">Δ</span> <span class="main">∪</span> AX1<span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH2 IH1 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_commute<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpR <span class="skolem">F</span> <span class="skolem">Γ</span> <span class="skolem">G</span> <span class="skolem">Δ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_mini_mset <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"is_mini_mset <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> ImpR.IH <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">▹</span> <span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span> <span class="main">▹</span> set_mset <span class="skolem">Γ</span> <span class="main">∪</span> <span class="main">(</span><span class="main">λ</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main">`</span> set_mset <span class="skolem">Δ</span> <span class="main">∪</span> AX1 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span> <span class="main">▹</span> <span class="skolem">Γ</span> <span class="main">∪</span> AX1 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">▹</span> <span class="skolem">G</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span> <span class="main">▹</span> <span class="skolem">Γ</span> <span class="main">∪</span> AX1 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span> <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AX1_away Deduction2 Deduction_theorem Un_commute Un_insert_right<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ax <span class="skolem">k</span> <span class="skolem">Γ</span> <span class="skolem">Δ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">▹</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span> <span class="main">▹</span> <span class="skolem">Γ</span> <span class="main">∪</span> AX1 <span class="keyword1">⊢<span class="hidden">⇩</span><sub>H</sub></span> <span class="main">⊥</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">Γ</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> HC.simps insert_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> R<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> F<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Γ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"set_mset <span class="skolem">Γ</span> <span class="main">∪</span> <span class="main">(</span><span class="main">λ</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span> <span class="main">`</span> set_mset <span class="skolem">Δ</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Ax.hyps
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_absorb<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> BotL <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HC.Ax<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="MiniSC_Craig">
<div class="head">
<h1>Theory MiniSC_Craig</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Craig Interpolation›</span></span>
<span class="keyword1"><span class="command">theory</span></span> MiniSC_Craig
<span class="keyword2"><span class="keyword">imports</span></span> <a href="MiniSC.html">MiniSC</a> <a href="Formulas.html">Formulas</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">atoms_mset</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">atoms_mset</span> <span class="free"><span class="bound"><span class="entity">Θ</span></span></span> <span class="main">≡</span> <span class="main">⋃</span><span class="bound">F</span> <span class="main">∈</span> set_mset <span class="free"><span class="bound"><span class="entity">Θ</span></span></span><span class="main">.</span> atoms <span class="bound">F</span>"</span></span>
  
<span class="comment1">(* which version of craig interpolation we show doesn't matter: *)</span>
<span class="keyword1" id="MiniSC_Craig-interpolation_equal_styles"><span class="command">lemma</span></span> interpolation_equal_styles<span class="main">:</span> <span class="quoted"><span class="quoted">"
<span class="main">(</span><span class="main">∀</span><span class="bound">Γ</span> <span class="bound">Δ</span> <span class="bound">Γ'</span> <span class="bound">Δ'</span><span class="main">.</span> <span class="bound">Γ</span> <span class="main">+</span> <span class="bound">Γ'</span> <span class="main">⇒</span> <span class="bound">Δ</span> <span class="main">+</span> <span class="bound">Δ'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">F</span> <span class="main">::</span> <span class="tfree">'a</span> formula<span class="main">.</span> <span class="bound">Γ</span> <span class="main">⇒</span> <span class="bound">F</span><span class="main">,</span><span class="bound">Δ</span> <span class="main">∧</span> <span class="bound">F</span><span class="main">,</span><span class="bound">Γ'</span> <span class="main">⇒</span> <span class="bound">Δ'</span> <span class="main">∧</span> atoms <span class="bound">F</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="bound">Γ</span> <span class="main">+</span> <span class="bound">Δ</span><span class="main">)</span> <span class="main">∧</span> atoms <span class="bound">F</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="bound">Γ'</span> <span class="main">+</span> <span class="bound">Δ'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟷</span>
<span class="main">(</span><span class="main">∀</span><span class="bound">Γ</span> <span class="bound">Δ</span><span class="main">.</span> <span class="bound">Γ</span> <span class="main">⇒</span> <span class="bound">Δ</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">F</span> <span class="main">::</span> <span class="tfree">'a</span> formula<span class="main">.</span> <span class="bound">Γ</span> <span class="main">⇒</span> <span class="main">{#</span><span class="bound">F</span><span class="main">#}</span> <span class="main">∧</span> <span class="main">{#</span><span class="bound">F</span><span class="main">#}</span> <span class="main">⇒</span> <span class="bound">Δ</span> <span class="main">∧</span> atoms <span class="bound">F</span> <span class="main">⊆</span> atoms_mset <span class="bound">Γ</span> <span class="main">∧</span> atoms <span class="bound">F</span> <span class="main">⊆</span> atoms_mset <span class="bound">Δ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> iffI allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">Γ</span> <span class="skolem">Δ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">+</span> <span class="main">{#}</span> <span class="main">⇒</span> <span class="main">{#}</span> <span class="main">+</span> <span class="skolem">Δ</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">F</span><span class="main">.</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="bound">F</span><span class="main">,</span> <span class="main">{#}</span> <span class="main">∧</span> <span class="bound">F</span><span class="main">,</span> <span class="main">{#}</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">∧</span> atoms <span class="bound">F</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ</span> <span class="main">+</span> <span class="main">{#}</span><span class="main">)</span> <span class="main">∧</span> atoms <span class="bound">F</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="main">{#}</span> <span class="main">+</span> <span class="skolem">Δ</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">Γ</span> <span class="skolem">Δ</span> <span class="skolem">Γ'</span> <span class="skolem">Δ'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">+</span> image_mset Not <span class="skolem">Γ'</span> <span class="main">+</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">Γ'</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">Γ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SCp.NotR<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">+</span> image_mset Not <span class="skolem">Δ</span> <span class="main">⇒</span> image_mset Not <span class="skolem">Γ'</span> <span class="main">+</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">Δ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">Δ'</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SCp.NotL<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> SCp.NotL union_mset_add_mset_right<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">THEN</span> mp<span class="main">,</span> <span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">F</span><span class="main">.</span> <span class="skolem">Γ</span> <span class="main">+</span> image_mset <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">Δ</span> <span class="main">⇒</span> <span class="main">{#</span><span class="bound">F</span><span class="main">#}</span> <span class="main">∧</span> <span class="main">{#</span><span class="bound">F</span><span class="main">#}</span> <span class="main">⇒</span> image_mset <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">Γ'</span> <span class="main">+</span> <span class="skolem">Δ'</span> <span class="main">∧</span> atoms <span class="bound">F</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ</span> <span class="main">+</span> image_mset <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∧</span> atoms <span class="bound">F</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span>image_mset <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">Γ'</span> <span class="main">+</span> <span class="skolem">Δ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">+</span> image_mset <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">Δ</span> <span class="main">⇒</span> <span class="main">{#</span><span class="skolem">F</span><span class="main">#}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span><span class="skolem">F</span><span class="main">#}</span> <span class="main">⇒</span> image_mset <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="skolem">Γ'</span> <span class="main">+</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> at<span class="main">:</span> <span class="quoted"><span class="quoted">"atoms <span class="skolem">F</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">Δ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"atoms <span class="skolem">F</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ'</span> <span class="main">+</span> <span class="skolem">Δ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">Δ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">Γ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NotL_inv inR1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span><span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">Γ'</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">Δ'</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NotR_inv inL1<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> p at n <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
    

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The original version of the interpolation theorem is due to Craig~\cite{craig1957linear}.
Our proof partly follows the approach of Troelstra and Schwichtenberg~\cite{troelstra2000basic} but,
especially with the mini formulas, adds its own spin.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> SC_Craig_interpolation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">+</span> <span class="free">Γ'</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">+</span> <span class="free">Δ'</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">F</span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span><span class="free">Δ</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span><span class="free">Γ'</span> <span class="main">⇒</span> <span class="free">Δ'</span>"</span></span>
    <span class="quoted"><span class="quoted">"atoms <span class="free">F</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="free">Γ</span> <span class="main">+</span> <span class="free">Δ</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"atoms <span class="free">F</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="free">Γ'</span> <span class="main">+</span> <span class="free">Δ'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> split_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">H'</span><span class="main">.</span> <span class="skolem">H</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">F</span> <span class="skolem">J</span><span class="main">,</span><span class="bound">H'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">I'</span><span class="main">.</span> <span class="skolem">I</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">F</span> <span class="skolem">J</span><span class="main">,</span><span class="bound">I'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">F</span> <span class="skolem">J</span><span class="main">,</span> <span class="skolem">G</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">+</span> <span class="skolem">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span> <span class="skolem">I</span> <span class="skolem">J</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">F</span> <span class="skolem">J</span> <span class="main">∈#</span> <span class="skolem">H</span> <span class="main">+</span> <span class="skolem">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> add_ac<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> union_single_eq_member<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> multi_member_split union_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> mini<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">F</span><span class="main">.</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="bound">F</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">∧</span> <span class="bound">F</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ'</span> <span class="main">∧</span> 
    atoms <span class="bound">F</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∧</span> atoms <span class="bound">F</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ'</span> <span class="main">+</span> <span class="skolem">Δ'</span><span class="main">)</span> <span class="main">∧</span> is_mini_formula <span class="bound">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">+</span> <span class="skolem">Δ'</span>"</span></span> <span class="quoted"><span class="quoted">"is_mini_mset <span class="main">(</span><span class="skolem">Γ</span><span class="main">+</span><span class="skolem">Γ'</span><span class="main">+</span><span class="skolem">Δ</span><span class="main">+</span><span class="skolem">Δ'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span> <span class="skolem">Γ'</span> <span class="skolem">Δ</span> <span class="skolem">Δ'</span>
  <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">+</span> <span class="skolem">Δ'</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">Γ</span></span> <span class="quoted"><span class="skolem">Γ'</span></span> <span class="quoted"><span class="skolem">Δ</span></span> <span class="quoted"><span class="skolem">Δ'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> BotL <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> exI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">∈#</span> <span class="skolem">Γ</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> BotL 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">∧</span> <span class="main">⊥</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ'</span> <span class="main">∧</span> atoms <span class="main">⊥</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∧</span> atoms <span class="main">⊥</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ'</span> <span class="main">+</span> <span class="skolem">Δ'</span><span class="main">)</span> <span class="main">∧</span> is_mini_formula <span class="main">⊥</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SCp.BotL<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">⊥</span> <span class="main">∈#</span> <span class="skolem">Γ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> BotL 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="main">⊤</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">∧</span> <span class="main">⊤</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ'</span> <span class="main">∧</span> atoms <span class="main">⊤</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∧</span> atoms <span class="main">⊤</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ'</span> <span class="main">+</span> <span class="skolem">Δ'</span><span class="main">)</span> <span class="main">∧</span> is_mini_formula <span class="main">⊤</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Top_def SCp.ImpR SCp.ImpL SCp.BotL <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ax <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ss</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="skolem">Γ</span> <span class="main">⇒</span> <span class="bound">F</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">∧</span> <span class="bound">F</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ'</span> <span class="main">∧</span> is_mini_formula <span class="bound">F</span><span class="main">)</span>"</span></span> <span class="comment1">(* troelstra calls it a split sequent. *)</span>
    <span class="keyword1"><span class="command">have</span></span> ff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss</span> <span class="main">⊥</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span> <span class="main">∈#</span> <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span> <span class="main">∈#</span> <span class="skolem">Δ</span>"</span></span> <span class="comment1">(* troelstra uses ⊤ in this case. That can't be right. (p. 117, case Ax, right bottom split) *)</span>
      <span class="keyword1"><span class="command">using</span></span> SCp.BotL SCp.Ax<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> fs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss</span> <span class="main">(</span>Atom <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span> <span class="main">∈#</span> <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span> <span class="main">∈#</span> <span class="skolem">Δ'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.Ax<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> sf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss</span> <span class="main">(</span><span class="main">(</span>Atom <span class="skolem">k</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span> <span class="main">∈#</span> <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span> <span class="main">∈#</span> <span class="skolem">Δ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.ImpR SCp.ImpL <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SCp.Ax<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span> SCp.BotL<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss</span> <span class="main">⊤</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span> <span class="main">∈#</span> <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span> <span class="main">∈#</span> <span class="skolem">Δ'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Top_def <span class="keyword1"><span class="command">using</span></span> that SCp.ImpR SCp.Ax BotL_canonical <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> in_sumE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">A</span> <span class="main">∈#</span> <span class="main">(</span><span class="skolem">F</span> <span class="main">+</span> <span class="skolem">G</span><span class="main">)</span><span class="main">;</span> <span class="skolem">A</span> <span class="main">∈#</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="skolem">P</span><span class="main">;</span> <span class="skolem">A</span> <span class="main">∈#</span> <span class="skolem">G</span> <span class="main">⟹</span> <span class="skolem">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">P</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> trust_firstE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="skolem">Q</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">F</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">F</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="bound">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">P</span> <span class="skolem">Q</span> <span class="skolem">F</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> Ax <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">elim</span> in_sumE<span class="main">)</span> <span class="main">(</span><span class="operator">frule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ff fs sf ss<span class="main"><span class="keyword3">;</span></span> <span class="operator">elim</span> conjE trust_firstE<span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpR <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">Δ''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> split_seq<span class="main">[</span><span class="operator">of</span> <span class="quoted">Imp</span><span class="main">,</span> <span class="operator">OF</span> ImpR<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> disjE exE<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H'</span> <span class="keyword3"><span class="command">assume</span></span> Δ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">=</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">Γ'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ''</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">-</span> <span class="main">{#</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">#}</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Δ'</span>"</span></span> <span class="quoted"><span class="quoted">"is_mini_mset <span class="main">(</span><span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ'</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">-</span> <span class="main">{#</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">#}</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Δ'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that ImpR<span class="main">(</span>3-<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_assoc Δ<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span>  ImpR<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Fa</span></span> <span class="keyword2"><span class="keyword">where</span></span> Fam<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ'</span>"</span></span> <span class="quoted"><span class="quoted">"is_mini_formula <span class="skolem">Fa</span>"</span></span>
        <span class="quoted"><span class="quoted">"atoms <span class="skolem">Fa</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"atoms <span class="skolem">Fa</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ'</span> <span class="main">+</span> <span class="skolem">Δ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Δ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Δ <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">Fa</span></span></span></span><span class="main"><span class="main">]</span></span> conjI <span class="quoted"><span class="quoted">‹is_mini_formula <span class="skolem">Fa</span>›</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fam <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> SCp.ImpR<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> inR1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fast</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fam <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"atoms <span class="skolem">Fa</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"atoms <span class="skolem">Fa</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ'</span> <span class="main">+</span> <span class="skolem">Δ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fam <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I'</span> <span class="keyword3"><span class="command">assume</span></span> Δ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ'</span> <span class="main">=</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">Γ'</span> <span class="main">=</span> <span class="skolem">Γ</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span><span class="skolem">Γ'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ''</span> <span class="main">=</span> <span class="skolem">Δ</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"is_mini_mset <span class="main">(</span><span class="skolem">Γ</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Δ</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ImpR<span class="main">(</span>3-<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.left_commute Δ'<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> ImpR<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Fa</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> Fam<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span>"</span></span> <span class="quoted"><span class="quoted">"is_mini_formula <span class="skolem">Fa</span>"</span></span>
        <span class="quoted"><span class="quoted">"atoms <span class="skolem">Fa</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">Δ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"atoms <span class="skolem">Fa</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ'</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Δ' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Δ' <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">Fa</span></span></span></span><span class="main"><span class="main">]</span></span> conjI <span class="quoted"><span class="quoted">‹is_mini_formula <span class="skolem">Fa</span>›</span></span><span class="main">)</span>
         <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fam <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
         <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fam <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SCp.ImpR inL1<span class="main">)</span>
         <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"atoms <span class="skolem">Fa</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">Δ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"atoms <span class="skolem">Fa</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ'</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fam <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpL <span class="skolem">Γ''</span> <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> split_seq<span class="main">[</span><span class="operator">of</span> <span class="quoted">Imp</span><span class="main">,</span> <span class="operator">OF</span> ImpL<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> disjE exE<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H'</span> <span class="keyword3"><span class="command">assume</span></span> Γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> Γ <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ''</span> <span class="main">=</span> <span class="skolem">Γ'</span> <span class="main">+</span> <span class="skolem">H'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">+</span> <span class="skolem">Δ'</span> <span class="main">=</span> <span class="skolem">Δ'</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span><span class="skolem">Δ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ImpL<span class="main">(</span>5-<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_assoc Γ<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"is_mini_mset <span class="main">(</span><span class="skolem">Γ'</span> <span class="main">+</span> <span class="skolem">H'</span> <span class="main">+</span> <span class="skolem">Δ'</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ImpL<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Γ<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> ImpL<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> * this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Fa</span></span> <span class="keyword2"><span class="keyword">where</span></span> IH1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">Δ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">H'</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> 
        <span class="quoted"><span class="quoted">"atoms <span class="skolem">Fa</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">H'</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span><span class="skolem">Δ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"atoms <span class="skolem">Fa</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ'</span> <span class="main">+</span> <span class="skolem">Δ'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"is_mini_formula <span class="skolem">Fa</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> Γ <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ''</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">+</span> <span class="skolem">Δ'</span> <span class="main">=</span> <span class="skolem">Δ</span> <span class="main">+</span> <span class="skolem">Δ'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ImpL<span class="main">(</span>5-<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_mini_mset <span class="main">(</span><span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ'</span> <span class="main">+</span> <span class="skolem">Δ</span> <span class="main">+</span> <span class="skolem">Δ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ImpL<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Γ<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> ImpL<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> * this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ga</span></span> <span class="keyword2"><span class="keyword">where</span></span> IH2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span> <span class="main">⇒</span> <span class="skolem">Ga</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ga</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ'</span>"</span></span> 
        <span class="quoted"><span class="quoted">"atoms <span class="skolem">Ga</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Δ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"atoms <span class="skolem">Ga</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ'</span> <span class="main">+</span> <span class="skolem">Δ'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"is_mini_formula <span class="skolem">Ga</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A big part of the difficulty of this proof is finding a way to instantiate the IHs.
        Interestingly, this is not the only way that works. 
        Originally, we used <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">Γ''</span></span> <span class="main"><span class="main">=</span></span> <span class="skolem"><span class="skolem">H'</span></span> <span class="main"><span class="main">+</span></span> <span class="skolem"><span class="skolem">Γ'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">F</span></span><span class="main"><span class="main">,</span></span> <span class="skolem"><span class="skolem">Δ</span></span> <span class="main"><span class="main">+</span></span> <span class="skolem"><span class="skolem">Δ'</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">F</span></span><span class="main"><span class="main">,</span></span><span class="skolem"><span class="skolem">Δ</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">+</span></span> <span class="skolem"><span class="skolem">Δ'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
        to instantiate the IH (which is in some sense more natural, less use of commutativity).
        This gave us a <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">Fa</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> that verifies <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">H'</span></span> <span class="main"><span class="main">⇒</span></span> <span class="skolem"><span class="skolem">Fa</span></span><span class="main"><span class="main">,</span></span> <span class="skolem"><span class="skolem">F</span></span><span class="main"><span class="main">,</span></span> <span class="skolem"><span class="skolem">Δ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">Fa</span></span><span class="main"><span class="main">,</span></span> <span class="skolem"><span class="skolem">Γ'</span></span> <span class="main"><span class="main">⇒</span></span> <span class="skolem"><span class="skolem">Δ'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
         and resulted in the interpolant <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"to_mini_formula <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">Fa</span></span> <span class="main"><span class="main"><span class="hidden">❙</span><b>∨</b></span></span> <span class="skolem"><span class="skolem">Ga</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">Fa</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">Ga</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?w</span></span>"</span></span></span><span class="main"><span class="main">]</span></span> conjI<span class="main">)</span>  
        <span class="keyword1"><span class="command">from</span></span> IH1<span class="main">(</span>1<span class="main">)</span> IH2<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SCp.ImpL<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> IH1<span class="main">(</span>2<span class="main">)</span> IH2<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="var">?w</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Γ
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> SCp.ImpL inR1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> SCp.ImpR<span class="main"><span class="main">]</span></span> SCp.ImpR<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> weakenR weakenL<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"atoms <span class="var">?w</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">Δ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"atoms <span class="var">?w</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ'</span> <span class="main">+</span> <span class="skolem">Δ'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> IH1<span class="main">(</span>3-<span class="main">)</span> IH2<span class="main">(</span>3-<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> Γ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_mini_formula <span class="var">?w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_mini_formula <span class="skolem">Fa</span>›</span></span> <span class="quoted"><span class="quoted">‹is_mini_formula <span class="skolem">Ga</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I'</span> <span class="keyword3"><span class="command">assume</span></span> Γ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">=</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span>"</span></span> <span class="keyword1"><span class="command">note</span></span> ImpL<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> Γ'<span class="main">]</span>
      <span class="keyword1"><span class="command">from</span></span> Γ' <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ''</span> <span class="main">=</span> <span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">I'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">+</span> <span class="skolem">Δ'</span> <span class="main">=</span> <span class="skolem">Δ</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span><span class="skolem">Δ'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ImpL<span class="main">(</span>5-<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_assoc add_ac<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_mini_mset <span class="main">(</span><span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">I'</span> <span class="main">+</span> <span class="skolem">Δ</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ImpL<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Γ'<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> ImpL<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> * this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Fa</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> IH1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">I'</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ'</span>"</span></span> <span class="quoted"><span class="quoted">"is_mini_formula <span class="skolem">Fa</span>"</span></span>
        <span class="quoted"><span class="quoted">"atoms <span class="skolem">Fa</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">I'</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span><span class="skolem">Δ'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"atoms <span class="skolem">Fa</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">Δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> Γ' <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ''</span> <span class="main">=</span> <span class="skolem">Γ</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">+</span> <span class="skolem">Δ'</span> <span class="main">=</span> <span class="skolem">Δ</span> <span class="main">+</span> <span class="skolem">Δ'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ImpL<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac <span class="quoted"><span class="quoted">‹<span class="skolem">Γ''</span> <span class="main">=</span> <span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">I'</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_mini_mset <span class="main">(</span><span class="skolem">Γ</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Δ</span> <span class="main">+</span> <span class="skolem">Δ'</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> ImpL<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Γ'<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> ImpL<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> * this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ga</span></span> <span class="skolem"><span class="skolem">l</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> IH2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Ga</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ga</span><span class="main">,</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span> <span class="main">⇒</span> <span class="skolem">Δ'</span>"</span></span> <span class="quoted"><span class="quoted">"is_mini_formula <span class="skolem">Ga</span>"</span></span>
        <span class="quoted"><span class="quoted">"atoms <span class="skolem">Ga</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Δ'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"atoms <span class="skolem">Ga</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">Δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Same thing as in the other case, just with 
        <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">G</span></span><span class="main"><span class="main">,</span></span> <span class="skolem"><span class="skolem">Γ''</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">G</span></span><span class="main"><span class="main">,</span></span> <span class="skolem"><span class="skolem">I'</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">+</span></span> <span class="skolem"><span class="skolem">Γ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">Δ</span></span> <span class="main"><span class="main">+</span></span> <span class="skolem"><span class="skolem">Δ'</span></span> <span class="main"><span class="main">=</span></span> <span class="skolem"><span class="skolem">Δ'</span></span> <span class="main"><span class="main">+</span></span> <span class="skolem"><span class="skolem">Δ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
        <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">Γ''</span></span> <span class="main"><span class="main">=</span></span> <span class="skolem"><span class="skolem">I'</span></span> <span class="main"><span class="main">+</span></span> <span class="skolem"><span class="skolem">Γ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">F</span></span><span class="main"><span class="main">,</span></span> <span class="skolem"><span class="skolem">Δ</span></span> <span class="main"><span class="main">+</span></span> <span class="skolem"><span class="skolem">Δ'</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">F</span></span><span class="main"><span class="main">,</span></span><span class="skolem"><span class="skolem">Δ'</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">+</span></span> <span class="skolem"><span class="skolem">Δ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
       resulting in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"to_mini_formula <span class="main"><span class="main">(</span></span><span class="main"><span class="main"><span class="hidden">❙</span><b>¬</b></span></span><span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">Fa</span></span> <span class="main"><span class="main"><span class="hidden">❙</span><b>∨</b></span></span> <span class="skolem"><span class="skolem">Ga</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Ga</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="skolem">Fa</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span> <span class="main">=</span> to_mini_formula <span class="main">(</span><span class="skolem">Ga</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="skolem">Fa</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IH1<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> IH2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mini_to_mini<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?w</span></span></span></span></span><span class="main"><span class="main">]</span></span> conjI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> IH1<span class="main">(</span>1<span class="main">)</span> IH2<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="var">?w</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> SCp.ImpR SCp.ImpL<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inR1 weakenR BotL_canonical<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> IH1<span class="main">(</span>2<span class="main">)</span> IH2<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Γ'
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.ImpL SCp.ImpR <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> weakenL weakenR<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"atoms <span class="var">?w</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">Δ</span><span class="main">)</span>"</span></span>
             <span class="quoted"><span class="quoted">"atoms <span class="var">?w</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">Γ'</span> <span class="main">+</span> <span class="skolem">Δ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH1<span class="main">(</span>3-<span class="main">)</span> IH2<span class="main">(</span>3-<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> Γ' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_mini_formula <span class="var">?w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_mini_formula <span class="skolem">Fa</span>›</span></span> <span class="quoted"><span class="quoted">‹is_mini_formula <span class="skolem">Ga</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The rest is just those cases that can't happen because of the mini formula property.›</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute is_mini_formula.simps union_iff union_single_eq_member<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">tms</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula multiset <span class="main">⇒</span> <span class="tfree">'a</span> formula multiset"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tms</span> <span class="main">=</span> image_mset to_mini_formula"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tms</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">+</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tms</span> <span class="skolem">A</span> <span class="main">+</span> <span class="skolem">tms</span> <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tms</span> <span class="main">{#</span><span class="skolem">F</span><span class="main">#}</span> <span class="main">=</span> <span class="main">{#</span>to_mini_formula <span class="skolem">F</span><span class="main">#}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span> <span class="skolem">B</span> <span class="skolem">F</span> <span class="keyword1"><span class="command">unfolding</span></span> tms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"atoms_mset <span class="main">(</span><span class="skolem">tms</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="main">=</span> atoms_mset <span class="skolem">Γ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span> <span class="keyword1"><span class="command">unfolding</span></span> tms_def <span class="keyword1"><span class="command">using</span></span> mini_formula_atoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> imm<span class="main">:</span> <span class="quoted"><span class="quoted">"is_mini_mset <span class="main">(</span><span class="skolem">tms</span> <span class="free">Γ</span> <span class="main">+</span> <span class="skolem">tms</span> <span class="free">Γ'</span> <span class="main">+</span> <span class="skolem">tms</span> <span class="free">Δ</span> <span class="main">+</span> <span class="skolem">tms</span> <span class="free">Δ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tms</span> <span class="free">Γ</span> <span class="main">+</span> <span class="skolem">tms</span> <span class="free">Γ'</span> <span class="main">⇒</span> <span class="skolem">tms</span> <span class="free">Δ</span> <span class="main">+</span> <span class="skolem">tms</span> <span class="free">Δ'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tms_def <span class="keyword1"><span class="command">using</span></span> SC_full_to_mini <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> mini<span class="main">[</span><span class="operator">OF</span> this imm<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> hp<span class="comment1">(*habemus papam*)</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="skolem">tms</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">tms</span> <span class="free">Δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">tms</span> <span class="free">Γ'</span> <span class="main">⇒</span> <span class="skolem">tms</span> <span class="free">Δ'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> su<span class="main">:</span> <span class="quoted"><span class="quoted">"atoms <span class="skolem">F</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">tms</span> <span class="free">Γ</span> <span class="main">+</span> <span class="skolem">tms</span> <span class="free">Δ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"atoms <span class="skolem">F</span> <span class="main">⊆</span> atoms_mset <span class="main">(</span><span class="skolem">tms</span> <span class="free">Γ'</span> <span class="main">+</span> <span class="skolem">tms</span> <span class="free">Δ'</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mf<span class="main">:</span> <span class="quoted"><span class="quoted">"is_mini_formula <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> hp mf <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tms</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="skolem">tms</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="free">Δ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tms</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="free">Γ'</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">tms</span> <span class="free">Δ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mini_to_mini<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> tms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="free">Δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="free">Γ'</span> <span class="main">⇒</span> <span class="free">Δ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> SC_mini_to_full <span class="keyword1"><span class="command">unfolding</span></span> tms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> su <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">Γ</span><span class="main">.</span> atoms_mset <span class="main">(</span><span class="skolem">tms</span> <span class="bound">Γ</span><span class="main">)</span> <span class="main">=</span> atoms_mset <span class="bound">Γ</span>›</span></span> image_mset_union that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="comment1">(*
  Gallier:
   - wouldn't hold without bottom. Try interpolating A → A and B → B 
   - is an application of cut elimination? oh well, if you'd have a cut rule in the ⇒ predicate,
      you'd be in trouble, ok.
*)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Note that there is an extension to Craig interpolation:
One can show that atoms that only appear positively/negatively in the original formulas will only appear
positively/negatively in the interpolant. ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">patoms_mset</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">⋃</span><span class="bound">F</span><span class="main">∈</span>set_mset <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> fst <span class="main">(</span>pn_atoms <span class="bound">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">natoms_mset</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">⋃</span><span class="bound">F</span><span class="main">∈</span>set_mset <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> snd <span class="main">(</span>pn_atoms <span class="bound">F</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> SC_Craig_interpolation_pn<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">+</span> <span class="free">Γ'</span> <span class="main">⇒</span> <span class="free">Δ</span> <span class="main">+</span> <span class="free">Δ'</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">F</span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="free">F</span><span class="main">,</span><span class="free">Δ</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">,</span><span class="free">Γ'</span> <span class="main">⇒</span> <span class="free">Δ'</span>"</span></span>
    <span class="quoted"><span class="quoted">"fst <span class="main">(</span>pn_atoms <span class="free">F</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>patoms_mset <span class="free">Γ</span> <span class="main">∪</span> natoms_mset <span class="free">Δ</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>natoms_mset <span class="free">Γ'</span> <span class="main">∪</span> patoms_mset <span class="free">Δ'</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"snd <span class="main">(</span>pn_atoms <span class="free">F</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>natoms_mset <span class="free">Γ</span> <span class="main">∪</span> patoms_mset <span class="free">Δ</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>patoms_mset <span class="free">Γ'</span> <span class="main">∪</span> natoms_mset <span class="free">Δ'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> split_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">H'</span><span class="main">.</span> <span class="skolem">H</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">F</span> <span class="skolem">J</span><span class="main">,</span><span class="bound">H'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">I'</span><span class="main">.</span> <span class="skolem">I</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">F</span> <span class="skolem">J</span><span class="main">,</span><span class="bound">I'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">F</span> <span class="skolem">J</span><span class="main">,</span> <span class="skolem">G</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">+</span> <span class="skolem">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">H</span> <span class="skolem">I</span> <span class="skolem">J</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">F</span> <span class="skolem">J</span> <span class="main">∈#</span> <span class="skolem">H</span> <span class="main">+</span> <span class="skolem">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> add_ac<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> union_single_eq_member<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> multi_member_split union_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> mini<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">F</span> <span class="main">::</span> <span class="tfree">'a</span> formula<span class="main">.</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="bound">F</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">∧</span> <span class="bound">F</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ'</span> <span class="main">∧</span> 
    fst <span class="main">(</span>pn_atoms <span class="bound">F</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>patoms_mset <span class="skolem">Γ</span> <span class="main">∪</span> natoms_mset <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>natoms_mset <span class="skolem">Γ'</span> <span class="main">∪</span> patoms_mset <span class="skolem">Δ'</span><span class="main">)</span> <span class="main">∧</span> 
    snd <span class="main">(</span>pn_atoms <span class="bound">F</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>natoms_mset <span class="skolem">Γ</span> <span class="main">∪</span> patoms_mset <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>patoms_mset <span class="skolem">Γ'</span> <span class="main">∪</span> natoms_mset <span class="skolem">Δ'</span><span class="main">)</span> <span class="main">∧</span> is_mini_formula <span class="bound">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ</span> <span class="main">+</span> <span class="skolem">Δ'</span>"</span></span> <span class="quoted"><span class="quoted">"is_mini_mset <span class="main">(</span><span class="skolem">Γ</span><span class="main">+</span><span class="skolem">Γ'</span><span class="main">+</span><span class="skolem">Δ</span><span class="main">+</span><span class="skolem">Δ'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span> <span class="skolem">Γ'</span> <span class="skolem">Δ</span> <span class="skolem">Δ'</span>
  <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">+</span> <span class="skolem">Δ'</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">Γ</span></span> <span class="quoted"><span class="skolem">Γ'</span></span> <span class="quoted"><span class="skolem">Δ</span></span> <span class="quoted"><span class="skolem">Δ'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SCp.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> BotL 
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?om</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">F</span><span class="main">.</span> fst <span class="main">(</span>pn_atoms <span class="bound">F</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>patoms_mset <span class="skolem">Γ</span> <span class="main">∪</span> natoms_mset <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>natoms_mset <span class="skolem">Γ'</span> <span class="main">∪</span> patoms_mset <span class="skolem">Δ'</span><span class="main">)</span> <span class="main">∧</span>
        snd <span class="main">(</span>pn_atoms <span class="bound">F</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>natoms_mset <span class="skolem">Γ</span> <span class="main">∪</span> patoms_mset <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>patoms_mset <span class="skolem">Γ'</span> <span class="main">∪</span> natoms_mset <span class="skolem">Δ'</span><span class="main">)</span> <span class="main">∧</span> is_mini_formula <span class="main">(</span><span class="bound">F</span> <span class="main">::</span> <span class="tfree">'a</span> formula<span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> exI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">∈#</span> <span class="skolem">Γ</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> BotL 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="main">⊥</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">∧</span> <span class="main">⊥</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ'</span> <span class="main">∧</span> <span class="var">?om</span> <span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SCp.BotL<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">⊥</span> <span class="main">∈#</span> <span class="skolem">Γ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> BotL 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="main">⊤</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">∧</span> <span class="main">⊤</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ'</span> <span class="main">∧</span> <span class="var">?om</span> <span class="main">⊤</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Top_def SCp.ImpR SCp.ImpL SCp.BotL prod_unions_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.intros<span class="main"><span class="main">(</span></span>3-<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ax <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ss</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">F</span><span class="main">.</span> <span class="main">(</span><span class="skolem">Γ</span> <span class="main">⇒</span> <span class="bound">F</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">∧</span> <span class="bound">F</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ'</span> <span class="main">∧</span> fst <span class="main">(</span>pn_atoms <span class="bound">F</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>patoms_mset <span class="skolem">Γ</span> <span class="main">∪</span> natoms_mset <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>natoms_mset <span class="skolem">Γ'</span> <span class="main">∪</span> patoms_mset <span class="skolem">Δ'</span><span class="main">)</span> <span class="main">∧</span>
        snd <span class="main">(</span>pn_atoms <span class="bound">F</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>natoms_mset <span class="skolem">Γ</span> <span class="main">∪</span> patoms_mset <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>patoms_mset <span class="skolem">Γ'</span> <span class="main">∪</span> natoms_mset <span class="skolem">Δ'</span><span class="main">)</span> <span class="main">∧</span> is_mini_formula <span class="bound">F</span><span class="main">)</span>"</span></span> <span class="comment1">(* troelstra calls it a split sequent. *)</span>
    <span class="keyword1"><span class="command">have</span></span> ff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss</span> <span class="main">⊥</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span> <span class="main">∈#</span> <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span> <span class="main">∈#</span> <span class="skolem">Δ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> SCp.BotL SCp.Ax<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> fs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss</span> <span class="main">(</span>Atom <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span> <span class="main">∈#</span> <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span> <span class="main">∈#</span> <span class="skolem">Δ'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.Ax<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> sf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss</span> <span class="main">(</span><span class="main">(</span>Atom <span class="skolem">k</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span> <span class="main">∈#</span> <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span> <span class="main">∈#</span> <span class="skolem">Δ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.ImpR SCp.ImpL <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SCp.Ax<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span> SCp.BotL exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_unions_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss</span> <span class="main">⊤</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span> <span class="main">∈#</span> <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"Atom <span class="skolem">k</span> <span class="main">∈#</span> <span class="skolem">Δ'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Top_def <span class="keyword1"><span class="command">using</span></span> that SCp.ImpR <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_unions_def SCp.Ax<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> in_sumE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">A</span> <span class="main">∈#</span> <span class="main">(</span><span class="skolem">F</span> <span class="main">+</span> <span class="skolem">G</span><span class="main">)</span><span class="main">;</span> <span class="skolem">A</span> <span class="main">∈#</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="skolem">P</span><span class="main">;</span> <span class="skolem">A</span> <span class="main">∈#</span> <span class="skolem">G</span> <span class="main">⟹</span> <span class="skolem">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">P</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> trust_firstE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="skolem">Q</span> <span class="skolem">F</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">F</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">F</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="bound">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">P</span> <span class="skolem">Q</span> <span class="skolem">F</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> Ax <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">elim</span> in_sumE<span class="main">)</span> <span class="main">(</span><span class="operator">frule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ff fs sf ss<span class="main"><span class="keyword3">;</span></span> <span class="operator">elim</span> conjE trust_firstE<span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpR <span class="skolem">F</span> <span class="skolem">G</span> <span class="skolem">Δ''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> split_seq<span class="main">[</span><span class="operator">of</span> <span class="quoted">Imp</span><span class="main">,</span> <span class="operator">OF</span> ImpR<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> disjE exE<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H'</span> <span class="keyword3"><span class="command">assume</span></span> Δ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">=</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">Γ'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ''</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">-</span> <span class="main">{#</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">#}</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Δ'</span>"</span></span> <span class="quoted"><span class="quoted">"is_mini_mset <span class="main">(</span><span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ'</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">-</span> <span class="main">{#</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">#}</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Δ'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that ImpR<span class="main">(</span>3-<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_assoc Δ<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span>  ImpR<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Fa</span></span> <span class="keyword2"><span class="keyword">where</span></span> Fam<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ'</span>"</span></span> <span class="quoted"><span class="quoted">"is_mini_formula <span class="skolem">Fa</span>"</span></span>
        <span class="quoted"><span class="quoted">"fst <span class="main">(</span>pn_atoms <span class="skolem">Fa</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>patoms_mset <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="main">∪</span> natoms_mset <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>natoms_mset <span class="skolem">Γ'</span> <span class="main">∪</span> patoms_mset <span class="skolem">Δ'</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"snd <span class="main">(</span>pn_atoms <span class="skolem">Fa</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>natoms_mset <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="main">∪</span> patoms_mset <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>patoms_mset <span class="skolem">Γ'</span> <span class="main">∪</span> natoms_mset <span class="skolem">Δ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Δ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Δ <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">Fa</span></span></span></span><span class="main"><span class="main">]</span></span> conjI <span class="quoted"><span class="quoted">‹is_mini_formula <span class="skolem">Fa</span>›</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fam <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> SCp.ImpR<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> inR1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fast</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fam <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>pn_atoms <span class="skolem">Fa</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>patoms_mset <span class="skolem">Γ</span> <span class="main">∪</span> natoms_mset <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>natoms_mset <span class="skolem">Γ'</span> <span class="main">∪</span> patoms_mset <span class="skolem">Δ'</span><span class="main">)</span>"</span></span> 
             <span class="quoted"><span class="quoted">"snd <span class="main">(</span>pn_atoms <span class="skolem">Fa</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>natoms_mset <span class="skolem">Γ</span> <span class="main">∪</span> patoms_mset <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>patoms_mset <span class="skolem">Γ'</span> <span class="main">∪</span> natoms_mset <span class="skolem">Δ'</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Fam<span class="main">(</span>4-<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prod_unions_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I'</span> <span class="keyword3"><span class="command">assume</span></span> Δ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ'</span> <span class="main">=</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">Γ'</span> <span class="main">=</span> <span class="skolem">Γ</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span><span class="skolem">Γ'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Δ''</span> <span class="main">=</span> <span class="skolem">Δ</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"is_mini_mset <span class="main">(</span><span class="skolem">Γ</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Δ</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ImpR<span class="main">(</span>3-<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.left_commute Δ'<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> ImpR<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Fa</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> Fam<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span>"</span></span> <span class="quoted"><span class="quoted">"is_mini_formula <span class="skolem">Fa</span>"</span></span>
        <span class="quoted"><span class="quoted">"fst <span class="main">(</span>pn_atoms <span class="skolem">Fa</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>patoms_mset <span class="skolem">Γ</span> <span class="main">∪</span> natoms_mset <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>natoms_mset <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ'</span><span class="main">)</span> <span class="main">∪</span> patoms_mset <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"snd <span class="main">(</span>pn_atoms <span class="skolem">Fa</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>natoms_mset <span class="skolem">Γ</span> <span class="main">∪</span> patoms_mset <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>patoms_mset <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Γ'</span><span class="main">)</span> <span class="main">∪</span> natoms_mset <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Δ' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Δ' <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">Fa</span></span></span></span><span class="main"><span class="main">]</span></span> conjI <span class="quoted"><span class="quoted">‹is_mini_formula <span class="skolem">Fa</span>›</span></span><span class="main">)</span>
         <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fam <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
         <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fam <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SCp.ImpR inL1<span class="main">)</span>
         <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>pn_atoms <span class="skolem">Fa</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>patoms_mset <span class="skolem">Γ</span> <span class="main">∪</span> natoms_mset <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>natoms_mset <span class="skolem">Γ'</span> <span class="main">∪</span> patoms_mset <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="quoted"><span class="quoted">"snd <span class="main">(</span>pn_atoms <span class="skolem">Fa</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>natoms_mset <span class="skolem">Γ</span> <span class="main">∪</span> patoms_mset <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>patoms_mset <span class="skolem">Γ'</span> <span class="main">∪</span> natoms_mset <span class="main">(</span><span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span><span class="main">)</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> Fam <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prod_unions_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpL <span class="skolem">Γ''</span> <span class="skolem">F</span> <span class="skolem">G</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> split_seq<span class="main">[</span><span class="operator">of</span> <span class="quoted">Imp</span><span class="main">,</span> <span class="operator">OF</span> ImpL<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> disjE exE<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H'</span> <span class="keyword3"><span class="command">assume</span></span> Γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">=</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> Γ <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ''</span> <span class="main">=</span> <span class="skolem">Γ'</span> <span class="main">+</span> <span class="skolem">H'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">+</span> <span class="skolem">Δ'</span> <span class="main">=</span> <span class="skolem">Δ'</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span><span class="skolem">Δ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ImpL<span class="main">(</span>5-<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_assoc Γ<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"is_mini_mset <span class="main">(</span><span class="skolem">Γ'</span> <span class="main">+</span> <span class="skolem">H'</span> <span class="main">+</span> <span class="skolem">Δ'</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ImpL<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Γ<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> ImpL<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> * this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Fa</span></span> <span class="keyword2"><span class="keyword">where</span></span> IH1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">Δ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">H'</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> 
        <span class="quoted"><span class="quoted">"fst <span class="main">(</span>pn_atoms <span class="skolem">Fa</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>patoms_mset <span class="skolem">Γ'</span> <span class="main">∪</span> natoms_mset <span class="skolem">Δ'</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>natoms_mset <span class="skolem">H'</span> <span class="main">∪</span> patoms_mset <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"snd <span class="main">(</span>pn_atoms <span class="skolem">Fa</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>natoms_mset <span class="skolem">Γ'</span> <span class="main">∪</span> patoms_mset <span class="skolem">Δ'</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>patoms_mset <span class="skolem">H'</span> <span class="main">∪</span> natoms_mset <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"is_mini_formula <span class="skolem">Fa</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> Γ <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ''</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">+</span> <span class="skolem">Δ'</span> <span class="main">=</span> <span class="skolem">Δ</span> <span class="main">+</span> <span class="skolem">Δ'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ImpL<span class="main">(</span>5-<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_mini_mset <span class="main">(</span><span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ'</span> <span class="main">+</span> <span class="skolem">Δ</span> <span class="main">+</span> <span class="skolem">Δ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ImpL<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Γ<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> ImpL<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> * this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ga</span></span> <span class="keyword2"><span class="keyword">where</span></span> IH2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span> <span class="main">⇒</span> <span class="skolem">Ga</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ga</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ'</span>"</span></span> 
        <span class="quoted"><span class="quoted">"fst <span class="main">(</span>pn_atoms <span class="skolem">Ga</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>patoms_mset <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span><span class="main">)</span> <span class="main">∪</span> natoms_mset <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>natoms_mset <span class="skolem">Γ'</span> <span class="main">∪</span> patoms_mset <span class="skolem">Δ'</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"snd <span class="main">(</span>pn_atoms <span class="skolem">Ga</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>natoms_mset <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">H'</span><span class="main">)</span> <span class="main">∪</span> patoms_mset <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>patoms_mset <span class="skolem">Γ'</span> <span class="main">∪</span> natoms_mset <span class="skolem">Δ'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"is_mini_formula <span class="skolem">Ga</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">Fa</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">Ga</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?w</span></span>"</span></span></span><span class="main"><span class="main">]</span></span> conjI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> IH1<span class="main">(</span>1<span class="main">)</span> IH2<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SCp.ImpL<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> IH1<span class="main">(</span>2<span class="main">)</span> IH2<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="var">?w</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Γ
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> SCp.ImpL inR1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> SCp.ImpR<span class="main"><span class="main">]</span></span> SCp.ImpR<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> weakenR weakenL<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>pn_atoms <span class="var">?w</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>patoms_mset <span class="skolem">Γ</span> <span class="main">∪</span> natoms_mset <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>natoms_mset <span class="skolem">Γ'</span> <span class="main">∪</span> patoms_mset <span class="skolem">Δ'</span><span class="main">)</span>"</span></span> 
             <span class="quoted"><span class="quoted">"snd <span class="main">(</span>pn_atoms <span class="var">?w</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>natoms_mset <span class="skolem">Γ</span> <span class="main">∪</span> patoms_mset <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>patoms_mset <span class="skolem">Γ'</span> <span class="main">∪</span> natoms_mset <span class="skolem">Δ'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> IH1<span class="main">(</span>3-<span class="main">)</span> IH2<span class="main">(</span>3-<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> Γ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prod_unions_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_mini_formula <span class="var">?w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_mini_formula <span class="skolem">Fa</span>›</span></span> <span class="quoted"><span class="quoted">‹is_mini_formula <span class="skolem">Ga</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I'</span> <span class="keyword3"><span class="command">assume</span></span> Γ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ'</span> <span class="main">=</span> <span class="skolem">F</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span>"</span></span> <span class="keyword1"><span class="command">note</span></span> ImpL<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> Γ'<span class="main">]</span>
      <span class="keyword1"><span class="command">from</span></span> Γ' <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ''</span> <span class="main">=</span> <span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">I'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ</span> <span class="main">+</span> <span class="skolem">Δ'</span> <span class="main">=</span> <span class="skolem">Δ</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span><span class="skolem">Δ'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ImpL<span class="main">(</span>5-<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_assoc add_ac<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_mini_mset <span class="main">(</span><span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">I'</span> <span class="main">+</span> <span class="skolem">Δ</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ImpL<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Γ'<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> ImpL<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> * this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Fa</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> IH1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Fa</span><span class="main">,</span> <span class="skolem">I'</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ'</span>"</span></span> <span class="quoted"><span class="quoted">"is_mini_formula <span class="skolem">Fa</span>"</span></span>
        <span class="quoted"><span class="quoted">"fst <span class="main">(</span>pn_atoms <span class="skolem">Fa</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>patoms_mset <span class="skolem">Γ</span> <span class="main">∪</span> natoms_mset <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>natoms_mset <span class="skolem">I'</span> <span class="main">∪</span> patoms_mset <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">" snd <span class="main">(</span>pn_atoms <span class="skolem">Fa</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>natoms_mset <span class="skolem">Γ</span> <span class="main">∪</span> patoms_mset <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>patoms_mset <span class="skolem">I'</span> <span class="main">∪</span> natoms_mset <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">Δ'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> Γ' <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">Γ''</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Δ</span> <span class="main">+</span> <span class="skolem">Δ'</span> <span class="main">=</span> <span class="skolem">Δ'</span> <span class="main">+</span> <span class="skolem">Δ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ImpL<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac <span class="quoted"><span class="quoted">‹<span class="skolem">Γ''</span> <span class="main">=</span> <span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">I'</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_mini_mset <span class="main">(</span><span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">Γ</span> <span class="main">+</span> <span class="skolem">Δ'</span> <span class="main">+</span> <span class="skolem">Δ</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> ImpL<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Γ'<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> ImpL<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> * this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ga</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> IH2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span> <span class="main">⇒</span> <span class="skolem">Ga</span><span class="main">,</span> <span class="skolem">Δ'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ga</span><span class="main">,</span> <span class="skolem">Γ</span> <span class="main">⇒</span> <span class="skolem">Δ</span>"</span></span> <span class="quoted"><span class="quoted">"is_mini_formula <span class="skolem">Ga</span>"</span></span>
        <span class="quoted"><span class="quoted">"fst <span class="main">(</span>pn_atoms <span class="skolem">Ga</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>patoms_mset <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span><span class="main">)</span> <span class="main">∪</span> natoms_mset <span class="skolem">Δ'</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>natoms_mset <span class="skolem">Γ</span> <span class="main">∪</span> patoms_mset <span class="skolem">Δ</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"snd <span class="main">(</span>pn_atoms <span class="skolem">Ga</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>natoms_mset <span class="main">(</span><span class="skolem">G</span><span class="main">,</span> <span class="skolem">I'</span><span class="main">)</span> <span class="main">∪</span> patoms_mset <span class="skolem">Δ'</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>patoms_mset <span class="skolem">Γ</span> <span class="main">∪</span> natoms_mset <span class="skolem">Δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Fa</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">Ga</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">⊥</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span> <span class="main">=</span> to_mini_formula <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="skolem">Fa</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">Ga</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_mini_formula.simps mini_to_mini<span class="main">[</span><span class="operator">OF</span> IH1<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> mini_to_mini<span class="main">[</span><span class="operator">OF</span> IH2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IH1<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> IH2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?w</span></span></span></span></span><span class="main"><span class="main">]</span></span> conjI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> IH1<span class="main">(</span>1<span class="main">)</span> IH2<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⇒</span> <span class="var">?w</span><span class="main">,</span> <span class="skolem">Δ</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> SCp.ImpR SCp.ImpL<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inR1 weakenR BotL_canonical<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> IH1<span class="main">(</span>2<span class="main">)</span> IH2<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span><span class="main">,</span> <span class="skolem">Γ'</span> <span class="main">⇒</span> <span class="skolem">Δ'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Γ'
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SCp.ImpL SCp.ImpR <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> weakenL weakenR<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>pn_atoms <span class="var">?w</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>patoms_mset <span class="skolem">Γ</span> <span class="main">∪</span> natoms_mset <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>natoms_mset <span class="skolem">Γ'</span> <span class="main">∪</span> patoms_mset <span class="skolem">Δ'</span><span class="main">)</span>"</span></span>
             <span class="quoted"><span class="quoted">"snd <span class="main">(</span>pn_atoms <span class="var">?w</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>natoms_mset <span class="skolem">Γ</span> <span class="main">∪</span> patoms_mset <span class="skolem">Δ</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>patoms_mset <span class="skolem">Γ'</span> <span class="main">∪</span> natoms_mset <span class="skolem">Δ'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> IH1<span class="main">(</span>4-<span class="main">)</span> IH2<span class="main">(</span>4-<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> Γ' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prod_unions_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_mini_formula <span class="var">?w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_mini_formula <span class="skolem">Fa</span>›</span></span> <span class="quoted"><span class="quoted">‹is_mini_formula <span class="skolem">Ga</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute is_mini_formula.simps union_iff union_single_eq_member<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">tms</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula multiset <span class="main">⇒</span> <span class="tfree">'a</span> formula multiset"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tms</span> <span class="main">=</span> image_mset to_mini_formula"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tms</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">+</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tms</span> <span class="skolem">A</span> <span class="main">+</span> <span class="skolem">tms</span> <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tms</span> <span class="main">{#</span><span class="skolem">F</span><span class="main">#}</span> <span class="main">=</span> <span class="main">{#</span>to_mini_formula <span class="skolem">F</span><span class="main">#}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span> <span class="skolem">B</span> <span class="skolem">F</span> <span class="keyword1"><span class="command">unfolding</span></span> tms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> imm<span class="main">:</span> <span class="quoted"><span class="quoted">"is_mini_mset <span class="main">(</span><span class="skolem">tms</span> <span class="free">Γ</span> <span class="main">+</span> <span class="skolem">tms</span> <span class="free">Γ'</span> <span class="main">+</span> <span class="skolem">tms</span> <span class="free">Δ</span> <span class="main">+</span> <span class="skolem">tms</span> <span class="free">Δ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tms</span> <span class="free">Γ</span> <span class="main">+</span> <span class="skolem">tms</span> <span class="free">Γ'</span> <span class="main">⇒</span> <span class="skolem">tms</span> <span class="free">Δ</span> <span class="main">+</span> <span class="skolem">tms</span> <span class="free">Δ'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tms_def <span class="keyword1"><span class="command">using</span></span> SC_full_to_mini <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> mini<span class="main">[</span><span class="operator">OF</span> this imm<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> hp<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="skolem">tms</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="skolem">tms</span> <span class="free">Δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="skolem">tms</span> <span class="free">Γ'</span> <span class="main">⇒</span> <span class="skolem">tms</span> <span class="free">Δ'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> su<span class="main">:</span> <span class="quoted"><span class="quoted">" fst <span class="main">(</span>pn_atoms <span class="skolem">F</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>patoms_mset <span class="main">(</span><span class="skolem">tms</span> <span class="free">Γ</span><span class="main">)</span> <span class="main">∪</span> natoms_mset <span class="main">(</span><span class="skolem">tms</span> <span class="free">Δ</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>natoms_mset <span class="main">(</span><span class="skolem">tms</span> <span class="free">Γ'</span><span class="main">)</span> <span class="main">∪</span> patoms_mset <span class="main">(</span><span class="skolem">tms</span> <span class="free">Δ'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"snd <span class="main">(</span>pn_atoms <span class="skolem">F</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>natoms_mset <span class="main">(</span><span class="skolem">tms</span> <span class="free">Γ</span><span class="main">)</span> <span class="main">∪</span> patoms_mset <span class="main">(</span><span class="skolem">tms</span> <span class="free">Δ</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>patoms_mset <span class="main">(</span><span class="skolem">tms</span> <span class="free">Γ'</span><span class="main">)</span> <span class="main">∪</span> natoms_mset <span class="main">(</span><span class="skolem">tms</span> <span class="free">Δ'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mf<span class="main">:</span> <span class="quoted"><span class="quoted">"is_mini_formula <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> hp mf <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tms</span> <span class="free">Γ</span> <span class="main">⇒</span> <span class="skolem">tms</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="free">Δ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tms</span> <span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="free">Γ'</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">tms</span> <span class="free">Δ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mini_to_mini<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> tms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⇒</span> <span class="skolem">F</span><span class="main">,</span> <span class="free">Δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">,</span> <span class="free">Γ'</span> <span class="main">⇒</span> <span class="free">Δ'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> SC_mini_to_full <span class="keyword1"><span class="command">unfolding</span></span> tms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pn_atoms <span class="main">(</span>to_mini_formula <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> pn_atoms <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">F</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_unions_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> pn_tms<span class="main">:</span> <span class="quoted"><span class="quoted">"patoms_mset <span class="main">(</span><span class="skolem">tms</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="main">=</span> patoms_mset <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"natoms_mset <span class="main">(</span><span class="skolem">tms</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="main">=</span> natoms_mset <span class="skolem">Γ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Γ</span> <span class="keyword1"><span class="command">unfolding</span></span> tms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> su<span class="main">[</span><span class="operator">unfolded</span> pn_tms<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">F</span></span><span class="main">,</span> <span class="operator">OF</span> * _ _<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="comment1">(* why this proof, again? Troelstra, somewhat unintuitively uses Fa <span class="hidden">❙</span><b>→</b> Ga and Fa <span class="hidden">❙</span><b>∧</b> Ga as interpolants in the
   ImpL cases. The asymmetry seems weird, at least. This shows: at least, they are correct. *)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>